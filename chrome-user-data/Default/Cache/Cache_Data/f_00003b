(function(){"use strict";var mu={},Yh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof mu<"u"?mu:typeof self<"u"?self:{};function ds(n){if(n.__esModule)return n;var l=n.default;if(typeof l=="function"){var t=function p(){return this instanceof p?Reflect.construct(l,arguments,this.constructor):l.apply(this,arguments)};t.prototype=l.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(p){var d=Object.getOwnPropertyDescriptor(n,p);Object.defineProperty(t,p,d.get?d:{enumerable:!0,get:function(){return n[p]}})}),t}var bu={},Mn={},fs=function(n,l){return fs=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,p){t.__proto__=p}||function(t,p){for(var d in p)Object.prototype.hasOwnProperty.call(p,d)&&(t[d]=p[d])},fs(n,l)};function Eu(n,l){if(typeof l!="function"&&l!==null)throw new TypeError("Class extends value "+String(l)+" is not a constructor or null");fs(n,l);function t(){this.constructor=n}n.prototype=l===null?Object.create(l):(t.prototype=l.prototype,new t)}var Ei=function(){return Ei=Object.assign||function(l){for(var t,p=1,d=arguments.length;p<d;p++){t=arguments[p];for(var y in t)Object.prototype.hasOwnProperty.call(t,y)&&(l[y]=t[y])}return l},Ei.apply(this,arguments)};function Bu(n,l){var t={};for(var p in n)Object.prototype.hasOwnProperty.call(n,p)&&l.indexOf(p)<0&&(t[p]=n[p]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var d=0,p=Object.getOwnPropertySymbols(n);d<p.length;d++)l.indexOf(p[d])<0&&Object.prototype.propertyIsEnumerable.call(n,p[d])&&(t[p[d]]=n[p[d]]);return t}function Tu(n,l,t,p){var d=arguments.length,y=d<3?l:p===null?p=Object.getOwnPropertyDescriptor(l,t):p,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")y=Reflect.decorate(n,l,t,p);else for(var u=n.length-1;u>=0;u--)(s=n[u])&&(y=(d<3?s(y):d>3?s(l,t,y):s(l,t))||y);return d>3&&y&&Object.defineProperty(l,t,y),y}function Ou(n,l){return function(t,p){l(t,p,n)}}function Au(n,l,t,p,d,y){function s(_){if(_!==void 0&&typeof _!="function")throw new TypeError("Function expected");return _}for(var u=p.kind,h=u==="getter"?"get":u==="setter"?"set":"value",v=!l&&n?p.static?n:n.prototype:null,o=l||(v?Object.getOwnPropertyDescriptor(v,p.name):{}),a,r=!1,e=t.length-1;e>=0;e--){var i={};for(var c in p)i[c]=c==="access"?{}:p[c];for(var c in p.access)i.access[c]=p.access[c];i.addInitializer=function(_){if(r)throw new TypeError("Cannot add initializers after decoration has completed");y.push(s(_||null))};var f=(0,t[e])(u==="accessor"?{get:o.get,set:o.set}:o[h],i);if(u==="accessor"){if(f===void 0)continue;if(f===null||typeof f!="object")throw new TypeError("Object expected");(a=s(f.get))&&(o.get=a),(a=s(f.set))&&(o.set=a),(a=s(f.init))&&d.unshift(a)}else(a=s(f))&&(u==="field"?d.unshift(a):o[h]=a)}v&&Object.defineProperty(v,p.name,o),r=!0}function Ru(n,l,t){for(var p=arguments.length>2,d=0;d<l.length;d++)t=p?l[d].call(n,t):l[d].call(n);return p?t:void 0}function Fu(n){return typeof n=="symbol"?n:"".concat(n)}function ku(n,l,t){return typeof l=="symbol"&&(l=l.description?"[".concat(l.description,"]"):""),Object.defineProperty(n,"name",{configurable:!0,value:t?"".concat(t," ",l):l})}function wu(n,l){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,l)}function Cu(n,l,t,p){function d(y){return y instanceof t?y:new t(function(s){s(y)})}return new(t||(t=Promise))(function(y,s){function u(o){try{v(p.next(o))}catch(a){s(a)}}function h(o){try{v(p.throw(o))}catch(a){s(a)}}function v(o){o.done?y(o.value):d(o.value).then(u,h)}v((p=p.apply(n,l||[])).next())})}function Mu(n,l){var t={label:0,sent:function(){if(y[0]&1)throw y[1];return y[1]},trys:[],ops:[]},p,d,y,s=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return s.next=u(0),s.throw=u(1),s.return=u(2),typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function u(v){return function(o){return h([v,o])}}function h(v){if(p)throw new TypeError("Generator is already executing.");for(;s&&(s=0,v[0]&&(t=0)),t;)try{if(p=1,d&&(y=v[0]&2?d.return:v[0]?d.throw||((y=d.return)&&y.call(d),0):d.next)&&!(y=y.call(d,v[1])).done)return y;switch(d=0,y&&(v=[v[0]&2,y.value]),v[0]){case 0:case 1:y=v;break;case 4:return t.label++,{value:v[1],done:!1};case 5:t.label++,d=v[1],v=[0];continue;case 7:v=t.ops.pop(),t.trys.pop();continue;default:if(y=t.trys,!(y=y.length>0&&y[y.length-1])&&(v[0]===6||v[0]===2)){t=0;continue}if(v[0]===3&&(!y||v[1]>y[0]&&v[1]<y[3])){t.label=v[1];break}if(v[0]===6&&t.label<y[1]){t.label=y[1],y=v;break}if(y&&t.label<y[2]){t.label=y[2],t.ops.push(v);break}y[2]&&t.ops.pop(),t.trys.pop();continue}v=l.call(n,t)}catch(o){v=[6,o],d=0}finally{p=y=0}if(v[0]&5)throw v[1];return{value:v[0]?v[1]:void 0,done:!0}}}var Bi=Object.create?function(n,l,t,p){p===void 0&&(p=t);var d=Object.getOwnPropertyDescriptor(l,t);(!d||("get"in d?!l.__esModule:d.writable||d.configurable))&&(d={enumerable:!0,get:function(){return l[t]}}),Object.defineProperty(n,p,d)}:function(n,l,t,p){p===void 0&&(p=t),n[p]=l[t]};function xu(n,l){for(var t in n)t!=="default"&&!Object.prototype.hasOwnProperty.call(l,t)&&Bi(l,n,t)}function Ti(n){var l=typeof Symbol=="function"&&Symbol.iterator,t=l&&n[l],p=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&p>=n.length&&(n=void 0),{value:n&&n[p++],done:!n}}};throw new TypeError(l?"Object is not iterable.":"Symbol.iterator is not defined.")}function ps(n,l){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var p=t.call(n),d,y=[],s;try{for(;(l===void 0||l-- >0)&&!(d=p.next()).done;)y.push(d.value)}catch(u){s={error:u}}finally{try{d&&!d.done&&(t=p.return)&&t.call(p)}finally{if(s)throw s.error}}return y}function Lu(){for(var n=[],l=0;l<arguments.length;l++)n=n.concat(ps(arguments[l]));return n}function Du(){for(var n=0,l=0,t=arguments.length;l<t;l++)n+=arguments[l].length;for(var p=Array(n),d=0,l=0;l<t;l++)for(var y=arguments[l],s=0,u=y.length;s<u;s++,d++)p[d]=y[s];return p}function Gu(n,l,t){if(t||arguments.length===2)for(var p=0,d=l.length,y;p<d;p++)(y||!(p in l))&&(y||(y=Array.prototype.slice.call(l,0,p)),y[p]=l[p]);return n.concat(y||Array.prototype.slice.call(l))}function gn(n){return this instanceof gn?(this.v=n,this):new gn(n)}function Hu(n,l,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var p=t.apply(n,l||[]),d,y=[];return d=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),u("next"),u("throw"),u("return",s),d[Symbol.asyncIterator]=function(){return this},d;function s(e){return function(i){return Promise.resolve(i).then(e,a)}}function u(e,i){p[e]&&(d[e]=function(c){return new Promise(function(f,_){y.push([e,c,f,_])>1||h(e,c)})},i&&(d[e]=i(d[e])))}function h(e,i){try{v(p[e](i))}catch(c){r(y[0][3],c)}}function v(e){e.value instanceof gn?Promise.resolve(e.value.v).then(o,a):r(y[0][2],e)}function o(e){h("next",e)}function a(e){h("throw",e)}function r(e,i){e(i),y.shift(),y.length&&h(y[0][0],y[0][1])}}function Nu(n){var l,t;return l={},p("next"),p("throw",function(d){throw d}),p("return"),l[Symbol.iterator]=function(){return this},l;function p(d,y){l[d]=n[d]?function(s){return(t=!t)?{value:gn(n[d](s)),done:!1}:y?y(s):s}:y}}function ju(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var l=n[Symbol.asyncIterator],t;return l?l.call(n):(n=typeof Ti=="function"?Ti(n):n[Symbol.iterator](),t={},p("next"),p("throw"),p("return"),t[Symbol.asyncIterator]=function(){return this},t);function p(y){t[y]=n[y]&&function(s){return new Promise(function(u,h){s=n[y](s),d(u,h,s.done,s.value)})}}function d(y,s,u,h){Promise.resolve(h).then(function(v){y({value:v,done:u})},s)}}function qu(n,l){return Object.defineProperty?Object.defineProperty(n,"raw",{value:l}):n.raw=l,n}var Qh=Object.create?function(n,l){Object.defineProperty(n,"default",{enumerable:!0,value:l})}:function(n,l){n.default=l},hs=function(n){return hs=Object.getOwnPropertyNames||function(l){var t=[];for(var p in l)Object.prototype.hasOwnProperty.call(l,p)&&(t[t.length]=p);return t},hs(n)};function Uu(n){if(n&&n.__esModule)return n;var l={};if(n!=null)for(var t=hs(n),p=0;p<t.length;p++)t[p]!=="default"&&Bi(l,n,t[p]);return Qh(l,n),l}function Wu(n){return n&&n.__esModule?n:{default:n}}function $u(n,l,t,p){if(t==="a"&&!p)throw new TypeError("Private accessor was defined without a getter");if(typeof l=="function"?n!==l||!p:!l.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?p:t==="a"?p.call(n):p?p.value:l.get(n)}function Vu(n,l,t,p,d){if(p==="m")throw new TypeError("Private method is not writable");if(p==="a"&&!d)throw new TypeError("Private accessor was defined without a setter");if(typeof l=="function"?n!==l||!d:!l.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return p==="a"?d.call(n,t):d?d.value=t:l.set(n,t),t}function zu(n,l){if(l===null||typeof l!="object"&&typeof l!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof n=="function"?l===n:n.has(l)}function Ku(n,l,t){if(l!=null){if(typeof l!="object"&&typeof l!="function")throw new TypeError("Object expected.");var p,d;if(t){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");p=l[Symbol.asyncDispose]}if(p===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");p=l[Symbol.dispose],t&&(d=p)}if(typeof p!="function")throw new TypeError("Object not disposable.");d&&(p=function(){try{d.call(this)}catch(y){return Promise.reject(y)}}),n.stack.push({value:l,dispose:p,async:t})}else t&&n.stack.push({async:!0});return l}var Xh=typeof SuppressedError=="function"?SuppressedError:function(n,l,t){var p=new Error(t);return p.name="SuppressedError",p.error=n,p.suppressed=l,p};function Ju(n){function l(y){n.error=n.hasError?new Xh(y,n.error,"An error was suppressed during disposal."):y,n.hasError=!0}var t,p=0;function d(){for(;t=n.stack.pop();)try{if(!t.async&&p===1)return p=0,n.stack.push(t),Promise.resolve().then(d);if(t.dispose){var y=t.dispose.call(t.value);if(t.async)return p|=2,Promise.resolve(y).then(d,function(s){return l(s),d()})}else p|=1}catch(s){l(s)}if(p===1)return n.hasError?Promise.reject(n.error):Promise.resolve();if(n.hasError)throw n.error}return d()}function Yu(n,l){return typeof n=="string"&&/^\.\.?\//.test(n)?n.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(t,p,d,y,s){return p?l?".jsx":".js":d&&(!y||!s)?t:d+y+"."+s.toLowerCase()+"js"}):n}var Zh={__extends:Eu,__assign:Ei,__rest:Bu,__decorate:Tu,__param:Ou,__esDecorate:Au,__runInitializers:Ru,__propKey:Fu,__setFunctionName:ku,__metadata:wu,__awaiter:Cu,__generator:Mu,__createBinding:Bi,__exportStar:xu,__values:Ti,__read:ps,__spread:Lu,__spreadArrays:Du,__spreadArray:Gu,__await:gn,__asyncGenerator:Hu,__asyncDelegator:Nu,__asyncValues:ju,__makeTemplateObject:qu,__importStar:Uu,__importDefault:Wu,__classPrivateFieldGet:$u,__classPrivateFieldSet:Vu,__classPrivateFieldIn:zu,__addDisposableResource:Ku,__disposeResources:Ju,__rewriteRelativeImportExtension:Yu},ey=Object.freeze({__proto__:null,__addDisposableResource:Ku,get __assign(){return Ei},__asyncDelegator:Nu,__asyncGenerator:Hu,__asyncValues:ju,__await:gn,__awaiter:Cu,__classPrivateFieldGet:$u,__classPrivateFieldIn:zu,__classPrivateFieldSet:Vu,__createBinding:Bi,__decorate:Tu,__disposeResources:Ju,__esDecorate:Au,__exportStar:xu,__extends:Eu,__generator:Mu,__importDefault:Wu,__importStar:Uu,__makeTemplateObject:qu,__metadata:wu,__param:Ou,__propKey:Fu,__read:ps,__rest:Bu,__rewriteRelativeImportExtension:Yu,__runInitializers:Ru,__setFunctionName:ku,__spread:Lu,__spreadArray:Gu,__spreadArrays:Du,__values:Ti,default:Zh}),X=ds(ey),Xt={},Oi={},ys="1.13.7",Qu=typeof self=="object"&&self.self===self&&self||typeof Oi=="object"&&Oi.global===Oi&&Oi||Function("return this")()||{},Ai=Array.prototype,vs=Object.prototype,Xu=typeof Symbol<"u"?Symbol.prototype:null,ty=Ai.push,xn=Ai.slice,Ln=vs.toString,ry=vs.hasOwnProperty,Zu=typeof ArrayBuffer<"u",ny=typeof DataView<"u",ay=Array.isArray,el=Object.keys,tl=Object.create,rl=Zu&&ArrayBuffer.isView,iy=isNaN,sy=isFinite,nl=!{toString:null}.propertyIsEnumerable("toString"),al=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],oy=Math.pow(2,53)-1;function ot(n,l){return l=l==null?n.length-1:+l,function(){for(var t=Math.max(arguments.length-l,0),p=Array(t),d=0;d<t;d++)p[d]=arguments[d+l];switch(l){case 0:return n.call(this,p);case 1:return n.call(this,arguments[0],p);case 2:return n.call(this,arguments[0],arguments[1],p)}var y=Array(l+1);for(d=0;d<l;d++)y[d]=arguments[d];return y[l]=p,n.apply(this,y)}}function cr(n){var l=typeof n;return l==="function"||l==="object"&&!!n}function il(n){return n===null}function gs(n){return n===void 0}function _s(n){return n===!0||n===!1||Ln.call(n)==="[object Boolean]"}function sl(n){return!!(n&&n.nodeType===1)}function Ze(n){var l="[object "+n+"]";return function(t){return Ln.call(t)===l}}var Ri=Ze("String"),Ss=Ze("Number"),ol=Ze("Date"),ul=Ze("RegExp"),ll=Ze("Error"),Ps=Ze("Symbol"),Is=Ze("ArrayBuffer"),cl=Ze("Function"),uy=Qu.document&&Qu.document.childNodes;typeof/./!="function"&&typeof Int8Array!="object"&&typeof uy!="function"&&(cl=function(n){return typeof n=="function"||!1});var et=cl,dl=Ze("Object"),fl=ny&&(!/\[native code\]/.test(String(DataView))||dl(new DataView(new ArrayBuffer(8)))),ms=typeof Map<"u"&&dl(new Map),ly=Ze("DataView");function cy(n){return n!=null&&et(n.getInt8)&&Is(n.buffer)}var Dn=fl?cy:ly,dr=ay||Ze("Array");function fr(n,l){return n!=null&&ry.call(n,l)}var bs=Ze("Arguments");(function(){bs(arguments)||(bs=function(n){return fr(n,"callee")})})();var Fi=bs;function pl(n){return!Ps(n)&&sy(n)&&!isNaN(parseFloat(n))}function Es(n){return Ss(n)&&iy(n)}function Bs(n){return function(){return n}}function hl(n){return function(l){var t=n(l);return typeof t=="number"&&t>=0&&t<=oy}}function yl(n){return function(l){return l==null?void 0:l[n]}}var ki=yl("byteLength"),dy=hl(ki),fy=/\[object ((I|Ui)nt(8|16|32)|Float(32|64)|Uint8Clamped|Big(I|Ui)nt64)Array\]/;function py(n){return rl?rl(n)&&!Dn(n):dy(n)&&fy.test(Ln.call(n))}var Ts=Zu?py:Bs(!1),ft=yl("length");function hy(n){for(var l={},t=n.length,p=0;p<t;++p)l[n[p]]=!0;return{contains:function(d){return l[d]===!0},push:function(d){return l[d]=!0,n.push(d)}}}function vl(n,l){l=hy(l);var t=al.length,p=n.constructor,d=et(p)&&p.prototype||vs,y="constructor";for(fr(n,y)&&!l.contains(y)&&l.push(y);t--;)y=al[t],y in n&&n[y]!==d[y]&&!l.contains(y)&&l.push(y)}function ze(n){if(!cr(n))return[];if(el)return el(n);var l=[];for(var t in n)fr(n,t)&&l.push(t);return nl&&vl(n,l),l}function gl(n){if(n==null)return!0;var l=ft(n);return typeof l=="number"&&(dr(n)||Ri(n)||Fi(n))?l===0:ft(ze(n))===0}function Os(n,l){var t=ze(l),p=t.length;if(n==null)return!p;for(var d=Object(n),y=0;y<p;y++){var s=t[y];if(l[s]!==d[s]||!(s in d))return!1}return!0}function Ae(n){if(n instanceof Ae)return n;if(!(this instanceof Ae))return new Ae(n);this._wrapped=n}Ae.VERSION=ys,Ae.prototype.value=function(){return this._wrapped},Ae.prototype.valueOf=Ae.prototype.toJSON=Ae.prototype.value,Ae.prototype.toString=function(){return String(this._wrapped)};function _l(n){return new Uint8Array(n.buffer||n,n.byteOffset||0,ki(n))}var Sl="[object DataView]";function As(n,l,t,p){if(n===l)return n!==0||1/n===1/l;if(n==null||l==null)return!1;if(n!==n)return l!==l;var d=typeof n;return d!=="function"&&d!=="object"&&typeof l!="object"?!1:Pl(n,l,t,p)}function Pl(n,l,t,p){n instanceof Ae&&(n=n._wrapped),l instanceof Ae&&(l=l._wrapped);var d=Ln.call(n);if(d!==Ln.call(l))return!1;if(fl&&d=="[object Object]"&&Dn(n)){if(!Dn(l))return!1;d=Sl}switch(d){case"[object RegExp]":case"[object String]":return""+n==""+l;case"[object Number]":return+n!=+n?+l!=+l:+n==0?1/+n===1/l:+n==+l;case"[object Date]":case"[object Boolean]":return+n==+l;case"[object Symbol]":return Xu.valueOf.call(n)===Xu.valueOf.call(l);case"[object ArrayBuffer]":case Sl:return Pl(_l(n),_l(l),t,p)}var y=d==="[object Array]";if(!y&&Ts(n)){var s=ki(n);if(s!==ki(l))return!1;if(n.buffer===l.buffer&&n.byteOffset===l.byteOffset)return!0;y=!0}if(!y){if(typeof n!="object"||typeof l!="object")return!1;var u=n.constructor,h=l.constructor;if(u!==h&&!(et(u)&&u instanceof u&&et(h)&&h instanceof h)&&"constructor"in n&&"constructor"in l)return!1}t=t||[],p=p||[];for(var v=t.length;v--;)if(t[v]===n)return p[v]===l;if(t.push(n),p.push(l),y){if(v=n.length,v!==l.length)return!1;for(;v--;)if(!As(n[v],l[v],t,p))return!1}else{var o=ze(n),a;if(v=o.length,ze(l).length!==v)return!1;for(;v--;)if(a=o[v],!(fr(l,a)&&As(n[a],l[a],t,p)))return!1}return t.pop(),p.pop(),!0}function Il(n,l){return As(n,l)}function _n(n){if(!cr(n))return[];var l=[];for(var t in n)l.push(t);return nl&&vl(n,l),l}function Rs(n){var l=ft(n);return function(t){if(t==null)return!1;var p=_n(t);if(ft(p))return!1;for(var d=0;d<l;d++)if(!et(t[n[d]]))return!1;return n!==El||!et(t[Fs])}}var Fs="forEach",ml="has",ks=["clear","delete"],bl=["get",ml,"set"],yy=ks.concat(Fs,bl),El=ks.concat(bl),vy=["add"].concat(ks,Fs,ml),Bl=ms?Rs(yy):Ze("Map"),Tl=ms?Rs(El):Ze("WeakMap"),Ol=ms?Rs(vy):Ze("Set"),Al=Ze("WeakSet");function Ir(n){for(var l=ze(n),t=l.length,p=Array(t),d=0;d<t;d++)p[d]=n[l[d]];return p}function Rl(n){for(var l=ze(n),t=l.length,p=Array(t),d=0;d<t;d++)p[d]=[l[d],n[l[d]]];return p}function ws(n){for(var l={},t=ze(n),p=0,d=t.length;p<d;p++)l[n[t[p]]]=t[p];return l}function Gn(n){var l=[];for(var t in n)et(n[t])&&l.push(t);return l.sort()}function Cs(n,l){return function(t){var p=arguments.length;if(l&&(t=Object(t)),p<2||t==null)return t;for(var d=1;d<p;d++)for(var y=arguments[d],s=n(y),u=s.length,h=0;h<u;h++){var v=s[h];(!l||t[v]===void 0)&&(t[v]=y[v])}return t}}var Ms=Cs(_n),Sn=Cs(ze),xs=Cs(_n,!0);function gy(){return function(){}}function Fl(n){if(!cr(n))return{};if(tl)return tl(n);var l=gy();l.prototype=n;var t=new l;return l.prototype=null,t}function kl(n,l){var t=Fl(n);return l&&Sn(t,l),t}function wl(n){return cr(n)?dr(n)?n.slice():Ms({},n):n}function Cl(n,l){return l(n),n}function Ls(n){return dr(n)?n:[n]}Ae.toPath=Ls;function Hn(n){return Ae.toPath(n)}function Ds(n,l){for(var t=l.length,p=0;p<t;p++){if(n==null)return;n=n[l[p]]}return t?n:void 0}function Gs(n,l,t){var p=Ds(n,Hn(l));return gs(p)?t:p}function Ml(n,l){l=Hn(l);for(var t=l.length,p=0;p<t;p++){var d=l[p];if(!fr(n,d))return!1;n=n[d]}return!!t}function wi(n){return n}function mr(n){return n=Sn({},n),function(l){return Os(l,n)}}function Ci(n){return n=Hn(n),function(l){return Ds(l,n)}}function Nn(n,l,t){if(l===void 0)return n;switch(t??3){case 1:return function(p){return n.call(l,p)};case 3:return function(p,d,y){return n.call(l,p,d,y)};case 4:return function(p,d,y,s){return n.call(l,p,d,y,s)}}return function(){return n.apply(l,arguments)}}function xl(n,l,t){return n==null?wi:et(n)?Nn(n,l,t):cr(n)&&!dr(n)?mr(n):Ci(n)}function Mi(n,l){return xl(n,l,1/0)}Ae.iteratee=Mi;function pt(n,l,t){return Ae.iteratee!==Mi?Ae.iteratee(n,l):xl(n,l,t)}function Ll(n,l,t){l=pt(l,t);for(var p=ze(n),d=p.length,y={},s=0;s<d;s++){var u=p[s];y[u]=l(n[u],u,n)}return y}function Hs(){}function Dl(n){return n==null?Hs:function(l){return Gs(n,l)}}function Gl(n,l,t){var p=Array(Math.max(0,n));l=Nn(l,t,1);for(var d=0;d<n;d++)p[d]=l(d);return p}function xi(n,l){return l==null&&(l=n,n=0),n+Math.floor(Math.random()*(l-n+1))}var Pn=Date.now||function(){return new Date().getTime()};function Hl(n){var l=function(y){return n[y]},t="(?:"+ze(n).join("|")+")",p=RegExp(t),d=RegExp(t,"g");return function(y){return y=y==null?"":""+y,p.test(y)?y.replace(d,l):y}}var Nl={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},jl=Hl(Nl),_y=ws(Nl),ql=Hl(_y),Ul=Ae.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},Ns=/(.)^/,Sy={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},Py=/\\|'|\r|\n|\u2028|\u2029/g;function Iy(n){return"\\"+Sy[n]}var my=/^\s*(\w|\$)+\s*$/;function Wl(n,l,t){!l&&t&&(l=t),l=xs({},l,Ae.templateSettings);var p=RegExp([(l.escape||Ns).source,(l.interpolate||Ns).source,(l.evaluate||Ns).source].join("|")+"|$","g"),d=0,y="__p+='";n.replace(p,function(v,o,a,r,e){return y+=n.slice(d,e).replace(Py,Iy),d=e+v.length,o?y+=`'+
((__t=(`+o+`))==null?'':_.escape(__t))+
'`:a?y+=`'+
((__t=(`+a+`))==null?'':__t)+
'`:r&&(y+=`';
`+r+`
__p+='`),v}),y+=`';
`;var s=l.variable;if(s){if(!my.test(s))throw new Error("variable is not a bare identifier: "+s)}else y=`with(obj||{}){
`+y+`}
`,s="obj";y=`var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};
`+y+`return __p;
`;var u;try{u=new Function(s,"_",y)}catch(v){throw v.source=y,v}var h=function(v){return u.call(this,v,Ae)};return h.source="function("+s+`){
`+y+"}",h}function $l(n,l,t){l=Hn(l);var p=l.length;if(!p)return et(t)?t.call(n):t;for(var d=0;d<p;d++){var y=n==null?void 0:n[l[d]];y===void 0&&(y=t,d=p),n=et(y)?y.call(n):y}return n}var by=0;function Vl(n){var l=++by+"";return n?n+l:l}function zl(n){var l=Ae(n);return l._chain=!0,l}function Kl(n,l,t,p,d){if(!(p instanceof l))return n.apply(t,d);var y=Fl(n.prototype),s=n.apply(y,d);return cr(s)?s:y}var br=ot(function(n,l){var t=br.placeholder,p=function(){for(var d=0,y=l.length,s=Array(y),u=0;u<y;u++)s[u]=l[u]===t?arguments[d++]:l[u];for(;d<arguments.length;)s.push(arguments[d++]);return Kl(n,p,this,this,s)};return p});br.placeholder=Ae;var js=ot(function(n,l,t){if(!et(n))throw new TypeError("Bind must be called on a function");var p=ot(function(d){return Kl(n,p,l,this,t.concat(d))});return p}),vt=hl(ft);function Er(n,l,t,p){if(p=p||[],!l&&l!==0)l=1/0;else if(l<=0)return p.concat(n);for(var d=p.length,y=0,s=ft(n);y<s;y++){var u=n[y];if(vt(u)&&(dr(u)||Fi(u)))if(l>1)Er(u,l-1,t,p),d=p.length;else for(var h=0,v=u.length;h<v;)p[d++]=u[h++];else t||(p[d++]=u)}return p}var Jl=ot(function(n,l){l=Er(l,!1,!1);var t=l.length;if(t<1)throw new Error("bindAll must be passed function names");for(;t--;){var p=l[t];n[p]=js(n[p],n)}return n});function Yl(n,l){var t=function(p){var d=t.cache,y=""+(l?l.apply(this,arguments):p);return fr(d,y)||(d[y]=n.apply(this,arguments)),d[y]};return t.cache={},t}var qs=ot(function(n,l,t){return setTimeout(function(){return n.apply(null,t)},l)}),Ql=br(qs,Ae,1);function Xl(n,l,t){var p,d,y,s,u=0;t||(t={});var h=function(){u=t.leading===!1?0:Pn(),p=null,s=n.apply(d,y),p||(d=y=null)},v=function(){var o=Pn();!u&&t.leading===!1&&(u=o);var a=l-(o-u);return d=this,y=arguments,a<=0||a>l?(p&&(clearTimeout(p),p=null),u=o,s=n.apply(d,y),p||(d=y=null)):!p&&t.trailing!==!1&&(p=setTimeout(h,a)),s};return v.cancel=function(){clearTimeout(p),u=0,p=d=y=null},v}function Zl(n,l,t){var p,d,y,s,u,h=function(){var o=Pn()-d;l>o?p=setTimeout(h,l-o):(p=null,t||(s=n.apply(u,y)),p||(y=u=null))},v=ot(function(o){return u=this,y=o,d=Pn(),p||(p=setTimeout(h,l),t&&(s=n.apply(u,y))),s});return v.cancel=function(){clearTimeout(p),p=y=u=null},v}function ec(n,l){return br(l,n)}function Li(n){return function(){return!n.apply(this,arguments)}}function tc(){var n=arguments,l=n.length-1;return function(){for(var t=l,p=n[l].apply(this,arguments);t--;)p=n[t].call(this,p);return p}}function rc(n,l){return function(){if(--n<1)return l.apply(this,arguments)}}function Us(n,l){var t;return function(){return--n>0&&(t=l.apply(this,arguments)),n<=1&&(l=null),t}}var nc=br(Us,2);function Ws(n,l,t){l=pt(l,t);for(var p=ze(n),d,y=0,s=p.length;y<s;y++)if(d=p[y],l(n[d],d,n))return d}function ac(n){return function(l,t,p){t=pt(t,p);for(var d=ft(l),y=n>0?0:d-1;y>=0&&y<d;y+=n)if(t(l[y],y,l))return y;return-1}}var Di=ac(1),$s=ac(-1);function Vs(n,l,t,p){t=pt(t,p,1);for(var d=t(l),y=0,s=ft(n);y<s;){var u=Math.floor((y+s)/2);t(n[u])<d?y=u+1:s=u}return y}function ic(n,l,t){return function(p,d,y){var s=0,u=ft(p);if(typeof y=="number")n>0?s=y>=0?y:Math.max(y+u,s):u=y>=0?Math.min(y+1,u):y+u+1;else if(t&&y&&u)return y=t(p,d),p[y]===d?y:-1;if(d!==d)return y=l(xn.call(p,s,u),Es),y>=0?y+s:-1;for(y=n>0?s:u-1;y>=0&&y<u;y+=n)if(p[y]===d)return y;return-1}}var zs=ic(1,Di,Vs),sc=ic(-1,$s);function jn(n,l,t){var p=vt(n)?Di:Ws,d=p(n,l,t);if(d!==void 0&&d!==-1)return n[d]}function oc(n,l){return jn(n,mr(l))}function Gt(n,l,t){l=Nn(l,t);var p,d;if(vt(n))for(p=0,d=n.length;p<d;p++)l(n[p],p,n);else{var y=ze(n);for(p=0,d=y.length;p<d;p++)l(n[y[p]],y[p],n)}return n}function Zt(n,l,t){l=pt(l,t);for(var p=!vt(n)&&ze(n),d=(p||n).length,y=Array(d),s=0;s<d;s++){var u=p?p[s]:s;y[s]=l(n[u],u,n)}return y}function uc(n){var l=function(t,p,d,y){var s=!vt(t)&&ze(t),u=(s||t).length,h=n>0?0:u-1;for(y||(d=t[s?s[h]:h],h+=n);h>=0&&h<u;h+=n){var v=s?s[h]:h;d=p(d,t[v],v,t)}return d};return function(t,p,d,y){var s=arguments.length>=3;return l(t,Nn(p,y,4),d,s)}}var In=uc(1),Gi=uc(-1);function pr(n,l,t){var p=[];return l=pt(l,t),Gt(n,function(d,y,s){l(d,y,s)&&p.push(d)}),p}function lc(n,l,t){return pr(n,Li(pt(l)),t)}function Hi(n,l,t){l=pt(l,t);for(var p=!vt(n)&&ze(n),d=(p||n).length,y=0;y<d;y++){var s=p?p[y]:y;if(!l(n[s],s,n))return!1}return!0}function Ni(n,l,t){l=pt(l,t);for(var p=!vt(n)&&ze(n),d=(p||n).length,y=0;y<d;y++){var s=p?p[y]:y;if(l(n[s],s,n))return!0}return!1}function At(n,l,t,p){return vt(n)||(n=Ir(n)),(typeof t!="number"||p)&&(t=0),zs(n,l,t)>=0}var cc=ot(function(n,l,t){var p,d;return et(l)?d=l:(l=Hn(l),p=l.slice(0,-1),l=l[l.length-1]),Zt(n,function(y){var s=d;if(!s){if(p&&p.length&&(y=Ds(y,p)),y==null)return;s=y[l]}return s==null?s:s.apply(y,t)})});function ji(n,l){return Zt(n,Ci(l))}function dc(n,l){return pr(n,mr(l))}function Ks(n,l,t){var p=-1/0,d=-1/0,y,s;if(l==null||typeof l=="number"&&typeof n[0]!="object"&&n!=null){n=vt(n)?n:Ir(n);for(var u=0,h=n.length;u<h;u++)y=n[u],y!=null&&y>p&&(p=y)}else l=pt(l,t),Gt(n,function(v,o,a){s=l(v,o,a),(s>d||s===-1/0&&p===-1/0)&&(p=v,d=s)});return p}function fc(n,l,t){var p=1/0,d=1/0,y,s;if(l==null||typeof l=="number"&&typeof n[0]!="object"&&n!=null){n=vt(n)?n:Ir(n);for(var u=0,h=n.length;u<h;u++)y=n[u],y!=null&&y<p&&(p=y)}else l=pt(l,t),Gt(n,function(v,o,a){s=l(v,o,a),(s<d||s===1/0&&p===1/0)&&(p=v,d=s)});return p}var Ey=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;function Js(n){return n?dr(n)?xn.call(n):Ri(n)?n.match(Ey):vt(n)?Zt(n,wi):Ir(n):[]}function Ys(n,l,t){if(l==null||t)return vt(n)||(n=Ir(n)),n[xi(n.length-1)];var p=Js(n),d=ft(p);l=Math.max(Math.min(l,d),0);for(var y=d-1,s=0;s<l;s++){var u=xi(s,y),h=p[s];p[s]=p[u],p[u]=h}return p.slice(0,l)}function pc(n){return Ys(n,1/0)}function hc(n,l,t){var p=0;return l=pt(l,t),ji(Zt(n,function(d,y,s){return{value:d,index:p++,criteria:l(d,y,s)}}).sort(function(d,y){var s=d.criteria,u=y.criteria;if(s!==u){if(s>u||s===void 0)return 1;if(s<u||u===void 0)return-1}return d.index-y.index}),"value")}function qi(n,l){return function(t,p,d){var y=l?[[],[]]:{};return p=pt(p,d),Gt(t,function(s,u){var h=p(s,u,t);n(y,s,h)}),y}}var yc=qi(function(n,l,t){fr(n,t)?n[t].push(l):n[t]=[l]}),vc=qi(function(n,l,t){n[t]=l}),gc=qi(function(n,l,t){fr(n,t)?n[t]++:n[t]=1}),_c=qi(function(n,l,t){n[t?0:1].push(l)},!0);function Sc(n){return n==null?0:vt(n)?n.length:ze(n).length}function By(n,l,t){return l in t}var Qs=ot(function(n,l){var t={},p=l[0];if(n==null)return t;et(p)?(l.length>1&&(p=Nn(p,l[1])),l=_n(n)):(p=By,l=Er(l,!1,!1),n=Object(n));for(var d=0,y=l.length;d<y;d++){var s=l[d],u=n[s];p(u,s,n)&&(t[s]=u)}return t}),Pc=ot(function(n,l){var t=l[0],p;return et(t)?(t=Li(t),l.length>1&&(p=l[1])):(l=Zt(Er(l,!1,!1),String),t=function(d,y){return!At(l,y)}),Qs(n,t,p)});function Xs(n,l,t){return xn.call(n,0,Math.max(0,n.length-(l==null||t?1:l)))}function mn(n,l,t){return n==null||n.length<1?l==null||t?void 0:[]:l==null||t?n[0]:Xs(n,n.length-l)}function Br(n,l,t){return xn.call(n,l==null||t?1:l)}function Ic(n,l,t){return n==null||n.length<1?l==null||t?void 0:[]:l==null||t?n[n.length-1]:Br(n,Math.max(0,n.length-l))}function mc(n){return pr(n,Boolean)}function bc(n,l){return Er(n,l,!1)}var Zs=ot(function(n,l){return l=Er(l,!0,!0),pr(n,function(t){return!At(l,t)})}),Ec=ot(function(n,l){return Zs(n,l)});function qn(n,l,t,p){_s(l)||(p=t,t=l,l=!1),t!=null&&(t=pt(t,p));for(var d=[],y=[],s=0,u=ft(n);s<u;s++){var h=n[s],v=t?t(h,s,n):h;l&&!t?((!s||y!==v)&&d.push(h),y=v):t?At(y,v)||(y.push(v),d.push(h)):At(d,h)||d.push(h)}return d}var Bc=ot(function(n){return qn(Er(n,!0,!0))});function Tc(n){for(var l=[],t=arguments.length,p=0,d=ft(n);p<d;p++){var y=n[p];if(!At(l,y)){var s;for(s=1;s<t&&At(arguments[s],y);s++);s===t&&l.push(y)}}return l}function Un(n){for(var l=n&&Ks(n,ft).length||0,t=Array(l),p=0;p<l;p++)t[p]=ji(n,p);return t}var Oc=ot(Un);function Ac(n,l){for(var t={},p=0,d=ft(n);p<d;p++)l?t[n[p]]=l[p]:t[n[p][0]]=n[p][1];return t}function Rc(n,l,t){l==null&&(l=n||0,n=0),t||(t=l<n?-1:1);for(var p=Math.max(Math.ceil((l-n)/t),0),d=Array(p),y=0;y<p;y++,n+=t)d[y]=n;return d}function Fc(n,l){if(l==null||l<1)return[];for(var t=[],p=0,d=n.length;p<d;)t.push(xn.call(n,p,p+=l));return t}function eo(n,l){return n._chain?Ae(l).chain():l}function to(n){return Gt(Gn(n),function(l){var t=Ae[l]=n[l];Ae.prototype[l]=function(){var p=[this._wrapped];return ty.apply(p,arguments),eo(this,t.apply(Ae,p))}}),Ae}Gt(["pop","push","reverse","shift","sort","splice","unshift"],function(n){var l=Ai[n];Ae.prototype[n]=function(){var t=this._wrapped;return t!=null&&(l.apply(t,arguments),(n==="shift"||n==="splice")&&t.length===0&&delete t[0]),eo(this,t)}}),Gt(["concat","join","slice"],function(n){var l=Ai[n];Ae.prototype[n]=function(){var t=this._wrapped;return t!=null&&(t=l.apply(t,arguments)),eo(this,t)}});var Ty=Object.freeze({__proto__:null,VERSION:ys,after:rc,all:Hi,allKeys:_n,any:Ni,assign:Sn,before:Us,bind:js,bindAll:Jl,chain:zl,chunk:Fc,clone:wl,collect:Zt,compact:mc,compose:tc,constant:Bs,contains:At,countBy:gc,create:kl,debounce:Zl,default:Ae,defaults:xs,defer:Ql,delay:qs,detect:jn,difference:Zs,drop:Br,each:Gt,escape:jl,every:Hi,extend:Ms,extendOwn:Sn,filter:pr,find:jn,findIndex:Di,findKey:Ws,findLastIndex:$s,findWhere:oc,first:mn,flatten:bc,foldl:In,foldr:Gi,forEach:Gt,functions:Gn,get:Gs,groupBy:yc,has:Ml,head:mn,identity:wi,include:At,includes:At,indexBy:vc,indexOf:zs,initial:Xs,inject:In,intersection:Tc,invert:ws,invoke:cc,isArguments:Fi,isArray:dr,isArrayBuffer:Is,isBoolean:_s,isDataView:Dn,isDate:ol,isElement:sl,isEmpty:gl,isEqual:Il,isError:ll,isFinite:pl,isFunction:et,isMap:Bl,isMatch:Os,isNaN:Es,isNull:il,isNumber:Ss,isObject:cr,isRegExp:ul,isSet:Ol,isString:Ri,isSymbol:Ps,isTypedArray:Ts,isUndefined:gs,isWeakMap:Tl,isWeakSet:Al,iteratee:Mi,keys:ze,last:Ic,lastIndexOf:sc,map:Zt,mapObject:Ll,matcher:mr,matches:mr,max:Ks,memoize:Yl,methods:Gn,min:fc,mixin:to,negate:Li,noop:Hs,now:Pn,object:Ac,omit:Pc,once:nc,pairs:Rl,partial:br,partition:_c,pick:Qs,pluck:ji,property:Ci,propertyOf:Dl,random:xi,range:Rc,reduce:In,reduceRight:Gi,reject:lc,rest:Br,restArguments:ot,result:$l,sample:Ys,select:pr,shuffle:pc,size:Sc,some:Ni,sortBy:hc,sortedIndex:Vs,tail:Br,take:mn,tap:Cl,template:Wl,templateSettings:Ul,throttle:Xl,times:Gl,toArray:Js,toPath:Ls,transpose:Un,unescape:ql,union:Bc,uniq:qn,unique:qn,uniqueId:Vl,unzip:Un,values:Ir,where:dc,without:Ec,wrap:ec,zip:Oc}),ro=to(Ty);ro._=ro;var Oy=Object.freeze({__proto__:null,VERSION:ys,after:rc,all:Hi,allKeys:_n,any:Ni,assign:Sn,before:Us,bind:js,bindAll:Jl,chain:zl,chunk:Fc,clone:wl,collect:Zt,compact:mc,compose:tc,constant:Bs,contains:At,countBy:gc,create:kl,debounce:Zl,default:ro,defaults:xs,defer:Ql,delay:qs,detect:jn,difference:Zs,drop:Br,each:Gt,escape:jl,every:Hi,extend:Ms,extendOwn:Sn,filter:pr,find:jn,findIndex:Di,findKey:Ws,findLastIndex:$s,findWhere:oc,first:mn,flatten:bc,foldl:In,foldr:Gi,forEach:Gt,functions:Gn,get:Gs,groupBy:yc,has:Ml,head:mn,identity:wi,include:At,includes:At,indexBy:vc,indexOf:zs,initial:Xs,inject:In,intersection:Tc,invert:ws,invoke:cc,isArguments:Fi,isArray:dr,isArrayBuffer:Is,isBoolean:_s,isDataView:Dn,isDate:ol,isElement:sl,isEmpty:gl,isEqual:Il,isError:ll,isFinite:pl,isFunction:et,isMap:Bl,isMatch:Os,isNaN:Es,isNull:il,isNumber:Ss,isObject:cr,isRegExp:ul,isSet:Ol,isString:Ri,isSymbol:Ps,isTypedArray:Ts,isUndefined:gs,isWeakMap:Tl,isWeakSet:Al,iteratee:Mi,keys:ze,last:Ic,lastIndexOf:sc,map:Zt,mapObject:Ll,matcher:mr,matches:mr,max:Ks,memoize:Yl,methods:Gn,min:fc,mixin:to,negate:Li,noop:Hs,now:Pn,object:Ac,omit:Pc,once:nc,pairs:Rl,partial:br,partition:_c,pick:Qs,pluck:ji,property:Ci,propertyOf:Dl,random:xi,range:Rc,reduce:In,reduceRight:Gi,reject:lc,rest:Br,restArguments:ot,result:$l,sample:Ys,select:pr,shuffle:pc,size:Sc,some:Ni,sortBy:hc,sortedIndex:Vs,tail:Br,take:mn,tap:Cl,template:Wl,templateSettings:Ul,throttle:Xl,times:Gl,toArray:Js,toPath:Ls,transpose:Un,unescape:ql,union:Bc,uniq:qn,unique:qn,uniqueId:Vl,unzip:Un,values:Ir,where:dc,without:Ec,wrap:ec,zip:Oc}),Pe=ds(Oy),Ne={},Ht={},no={},kc;function $e(){return kc||(kc=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.InvalidStateAccessorError=n.AccessorType=n.aggregateGroupableEvents=n.Placement=n.isTransactionMetaEvent=n.isMetaEvent=n.idFromEvent=n.isDBRef=n.TOTAL=n.UNASSIGNED_PLAYER=void 0;var l=X,t=l.__importStar(Pe);n.UNASSIGNED_PLAYER="unassigned",n.TOTAL="total";function p(a){return t.has(a,"$id")&&t.has(a,"$ref")}n.isDBRef=p;function d(a){if(a!==void 0){if(a._id!==void 0)return a._id;if(a.id!==void 0)return a.id}}n.idFromEvent=d;function y(a){return a.hasOwnProperty("code")&&t.contains(["insert","delete","replace","transaction","edit_group","undo","redo"],a.code)}n.isMetaEvent=y;function s(a){return a.hasOwnProperty("code")&&a.code==="transaction"}n.isTransactionMetaEvent=s;var u;(function(a){a[a.Before=0]="Before",a[a.After=1]="After"})(u=n.Placement||(n.Placement={}));function h(a){for(var r={deleteIds:[],insertions:[]},e=0,i=a;e<i.length;e++){var c=i[e];v(c,r)}return r}n.aggregateGroupableEvents=h;function v(a,r){var e,i;switch(a.code){case"insert":if(a.beforeId)r.insertions.push([a.beforeId,u.Before,a.events]);else if(a.afterId)r.insertions.push([a.afterId,u.After,a.events]);else throw new Error("need before/after id");break;case"delete":(e=r.deleteIds).push.apply(e,a.deleteIds);break;case"replace":if(a.deleteIds.length===0)throw new Error("need deletes in a replace");(i=r.deleteIds).push.apply(i,a.deleteIds),r.insertions.push([a.deleteIds[0],u.After,a.events]);break;case"edit_group":for(var c=0,f=a.events;c<f.length;c++){var _=f[c];v(_,r)}break}}(function(a){a[a.Latest=0]="Latest",a[a.Before=1]="Before",a[a.After=2]="After"})(n.AccessorType||(n.AccessorType={}));var o=function(a){l.__extends(r,a);function r(e,i){var c=a.call(this,"Could not find ".concat(i," for accessor ").concat(e,"."))||this;return c.name="InvalidStateAccessorError",c}return r}(Error);n.InvalidStateAccessorError=o}(no)),no}var wc;function Ee(){if(wc)return Ht;wc=1,Object.defineProperty(Ht,"__esModule",{value:!0}),Ht.SnapshottedStateEngine=Ht.SnapshottedStateEngineStateType=Ht.VersionedStateEngine=Ht.StateEngine=void 0;var n=X,l=n.__importStar(Pe),t=$e(),p=function(){function u(h){this.baseEvents=h,this.nextEventOffset=0,this.idToIndexMap={}}return Object.defineProperty(u.prototype,"latestState",{get:function(){return this.getLatestState()},enumerable:!1,configurable:!0}),u.prototype.stateBeforeEventOrUndefined=function(h){try{this.stateBeforeEvent(h)}catch{return}},u.prototype.stateBeforeEventId=function(h){return this.stateBeforeEvent(this.indexForEventId(h))},u.prototype.stateBeforeEventIdOrLatest=function(h){return h!==void 0?this.stateBeforeEvent(this.indexForEventId(h)):this.latestState},u.prototype.stateAfterEvent=function(h){return this.stateBeforeEvent(h+1)},u.prototype.stateAfterEventId=function(h){return this.stateAfterEvent(this.indexForEventId(h))},u.prototype.indexForEventId=function(h){return this.idToIndexMap[h]},u.prototype.processToBeforeEvent=function(h){if(h>this.baseEvents.length||h===0)return!1;for(;this.nextEventOffset<h;)this.fullyProcessNextEvent();return!0},u.prototype.processToLatestEvent=function(){for(;this.nextEventOffset<this.baseEvents.length;)this.fullyProcessNextEvent()},u.prototype.fullyProcessNextEvent=function(){var h=this.nextEvent;if(h!==void 0){var v=(0,t.idFromEvent)(h);this.idToIndexMap[v]=this.nextEventOffset,this.preProcessEvent(h),this.processNextEvent(),this.nextEventOffset++,this.postProcessEvent(h)}},u.prototype.preProcessEvent=function(h){},u.prototype.postProcessEvent=function(h){},Object.defineProperty(u.prototype,"nextEvent",{get:function(){return this.baseEvents[this.nextEventOffset]},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"lastEvent",{get:function(){if(this.nextEventOffset!==0)return this.baseEvents[this.nextEventOffset-1]},enumerable:!1,configurable:!0}),u}();Ht.StateEngine=p;var d=function(u){n.__extends(h,u);function h(v){var o=u.call(this,v)||this;o.baseEvents=v,o.stateHistory=[];var a=o.initialState().set("nextEventOffset",o.nextEventOffset);return o.stateHistory.push(a),o}return h.prototype.get=function(v){return this.currentState.toJS()[v]},h.prototype.getLatest=function(v){return this.latestState.toJS()[v]},h.prototype.getLatestState=function(){return this.processToLatestEvent(),this.stateHistory[this.nextEventOffset]},Object.defineProperty(h.prototype,"currentState",{get:function(){return this.stateHistory[this.nextEventOffset]},enumerable:!1,configurable:!0}),h.prototype.stateBeforeEvent=function(v){if(v<0||v>this.baseEvents.length)throw new t.InvalidStateAccessorError(t.AccessorType.Before,v.toString());return this.processToBeforeEvent(v),this.stateHistory[v]},h.prototype.processNextEvent=function(){var v=this.processOneEvent(this.currentState,this.nextEvent);if(v){var o=v.set("nextEventOffset",this.nextEventOffset);this.stateHistory.push(o)}},h.prototype.rollbackToBeforeEvent=function(v){v>this.stateHistory.length-1||(this.nextEventOffset=v,this.stateHistory.splice(v+1,1/0))},h}(p);Ht.VersionedStateEngine=d;var y=function(){function u(){}return u}();Ht.SnapshottedStateEngineStateType=y;var s=function(u){n.__extends(h,u);function h(v){var o=u.call(this,v)||this;return o.baseEvents=v,o.snapshotIntervals=[10,40,80],o.snapshotRotationInterval=10,o.eventsSinceLastRotation=0,o.snapshots={},o.extensionEngines=[],o.resetToInitialState(),o}return h.prototype.get=function(v){return this.currentState[v]},h.prototype.getLatest=function(v){return this.latestState[v]},Object.defineProperty(h.prototype,"currentState",{get:function(){return this.state},enumerable:!1,configurable:!0}),h.prototype.getLatestState=function(){return this.processToLatestEvent(),this.state},h.prototype.stateBeforeEvent=function(v){if(v<0||v>this.baseEvents.length)throw new t.InvalidStateAccessorError(t.AccessorType.Before,v.toString());return v===this.nextEventOffset?this.currentState:(this.rollbackToBeforeEvent(v),this.currentState)},h.prototype.resetToInitialState=function(){this.state=this.initialState(),this.snapshots={},this.nextEventOffset=0,this.eventsSinceLastRotation=0},h.prototype.copyState=function(){return JSON.parse(JSON.stringify(this.state))},h.prototype.rotateSnapshots=function(){for(var v={},o=this.nextEventOffset-1,a=l.sortBy(Object.keys(this.snapshots).map(Number),function(P){return-1*Number(P)}),r=0,e=this.snapshotIntervals;r<e.length;r++){for(var i=e[r],c=a[0],f=0,_=a;f<_.length;f++){var S=_[f];if(Number(S)<o+1-i)break;c=S}c!==void 0&&(v[c]=!0)}for(var S in this.snapshots)this.snapshots.hasOwnProperty(S)&&v[S]!==!0&&delete this.snapshots[S];this.snapshots[o+1]=this.copyState(),this.eventsSinceLastRotation=0},h.prototype.processNextEvent=function(){this.processOneEvent(this.state,this.nextEvent),this.eventsSinceLastRotation++},h.prototype.postProcessEvent=function(v){for(var o=0,a=this.extensionEngines;o<a.length;o++){var r=a[o];r.fullyProcessNextEvent()}this.eventsSinceLastRotation>=this.snapshotRotationInterval&&this.rotateSnapshots()},h.prototype.rollbackToBeforeEvent=function(v){for(var o,a=l.sortBy(Object.keys(this.snapshots).map(Number),function(R){return-1*Number(R)}),r=0,e=a;r<e.length;r++){var i=e[r];if(Number(i)<v){o=Number(i);break}else delete this.snapshots[i]}if(o===void 0){this.resetToInitialState();for(var c=0,f=this.extensionEngines;c<f.length;c++){var _=f[c];_.rollbackToBeforeEvent(0)}this.processToBeforeEvent(v);return}for(var S=0,P=this.extensionEngines;S<P.length;S++){var _=P[S];_.rollbackToBeforeEvent(o)}var I=[this.eventsSinceLastRotation,this.nextEventOffset-o,this.snapshotRotationInterval],E=I[0],B=I[1],b=I[2];this.eventsSinceLastRotation=((E-B)%b+b)%b,this.nextEventOffset=o,this.state.restoreFromSnapshot(JSON.parse(JSON.stringify(this.snapshots[o]))),this.processToBeforeEvent(v)},h}(p);return Ht.SnapshottedStateEngine=s,Ht}var hr={},Cc;function Mc(){if(Cc)return hr;Cc=1,Object.defineProperty(hr,"__esModule",{value:!0}),hr.setDebug=hr.debug=void 0,hr.debug=!1;function n(l){hr.debug=l}return hr.setDebug=n,hr}var xc;function gt(){if(xc)return Ne;xc=1,Object.defineProperty(Ne,"__esModule",{value:!0}),Ne.EngineStateAccessor=Ne.BaseStateAccessor=Ne.TranscoderController=Ne.CompactorController=Ne.InvalidEventIndexError=Ne.Controller=Ne.SnapshottedTranscoder=Ne.TranscoderState=Ne.SabertoothError=void 0;var n=X,l=n.__importStar(Pe),t=n.__importStar(Ee()),p=n.__importStar($e()),d=Mc(),y=function(c){n.__extends(f,c);function f(_,S){var P=c.call(this,JSON.stringify({type:_,reason:S}))||this;return P.name="SabertoothError",Object.setPrototypeOf(P,f.prototype),P}return f}(Error);Ne.SabertoothError=y;var s=function(c){n.__extends(f,c);function f(){var _=c!==null&&c.apply(this,arguments)||this;return _.outStream=[],_.idToInputIndex={},_.idToOutputIndex={},_.idToOutputCount={},_.outIndexMap={},_}return f.prototype.restoreFromSnapshot=function(_){this.outStream=_.outStream,this.idToInputIndex=_.idToInputIndex,this.idToOutputIndex=_.idToOutputIndex,this.idToOutputCount=_.idToOutputCount},f}(t.SnapshottedStateEngineStateType);Ne.TranscoderState=s;var u=function(c){n.__extends(f,c);function f(){return c!==null&&c.apply(this,arguments)||this}return Object.defineProperty(f.prototype,"outStream",{get:function(){return this.state.outStream},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"outIndexMap",{get:function(){return this.state.outIndexMap},enumerable:!1,configurable:!0}),f.prototype.preProcessEvent=function(_){var S=p.idFromEvent(_);this.state.idToInputIndex[S]=this.idToIndexMap[S],this.state.idToOutputIndex[S]=this.outStream.length},f.prototype.postProcessEvent=function(_){var S=p.idFromEvent(_);this.state.idToOutputCount[S]=this.state.outStream.length-this.state.idToOutputIndex[S];for(var P=this.state.idToOutputIndex[S],I=P;I<this.state.outStream.length;I++){var E=p.idFromEvent(this.state.outStream[I]);this.state.outIndexMap[E]=I}c.prototype.postProcessEvent.call(this,_)},f.prototype.currentStateOfEngine=function(_){return this.outStream.length===0?_.stateBeforeEvent(0):_.stateAfterEvent(this.outStream.length-1)},f.prototype.firstOutputIndexAfterInputEventId=function(_){var S=this.state.idToOutputIndex[_],P=this.state.idToOutputCount[_];return S+P},f.prototype._inputEventForOutputIndex=function(_){for(var S in this.state.idToInputIndex)if(this.state.idToOutputIndex[S]<=_&&this.state.idToOutputIndex[S]+this.state.idToOutputCount[S]>_)return this.baseEvents[this.state.idToInputIndex[S]];throw new Error("input event index missing output event index")},f.prototype._outputEventsForInputIndex=function(_){for(var S=[],P=p.idFromEvent(this.baseEvents[_]),I=0;I<this.state.idToOutputCount[P];I++)S.push(this.state.outStream[I+this.state.idToOutputIndex[P]]);return S},f}(t.SnapshottedStateEngine);Ne.SnapshottedTranscoder=u;var h=function(){function c(){}return c.prototype.pushSerializedBatch=function(f){var _=JSON.parse(f);return this.pushBatch(_)},c.prototype.pushBatch=function(f,_){for(var S=this.outputStream().length-1,P=0,I=f;P<I.length;P++){var E=I[P],B=this.push(E,_);S=Math.min(S,B)}return S},c.prototype.latestState=function(){return new this.stateAccessorClass(p.AccessorType.Latest,this)},c.prototype.setDebug=function(f){return(0,d.setDebug)(f)},c}();Ne.Controller=h;var v=function(c){n.__extends(f,c);function f(_){var S=c.call(this,"State for ".concat(_," was undefined."))||this;return S.name="InvalidEventIndexError",S}return f}(Error);Ne.InvalidEventIndexError=v;var o=function(c){n.__extends(f,c);function f(){var _=c!==null&&c.apply(this,arguments)||this;return _.scratch=[],_.preScratchTailIndex=void 0,_.numberOfEventsPushed=0,_}return f.prototype.inStreamLength=function(){return this.compactor.inStream.length},f.prototype.clearScratch=function(){if(this.scratch.length!==0){for(var _=0,S=this.engines;_<S.length;_++){var P=S[_];P.rollbackToBeforeEvent(this.preScratchTailIndex+1)}this.compactor.clearScratch(this.scratch),this.scratch=[],this.preScratchTailIndex=void 0}},f.prototype.pushToScratch=function(_){if(p.isMetaEvent(_))throw"Scratch does not currently support compactor metaevents";this.preScratchTailIndex===void 0&&(this.preScratchTailIndex=this.compactor.outStream.length-1),this.scratch.push(_),this.compactor.pushForScratch(_)},f.prototype.pushBatchToScratch=function(_){for(var S=0,P=_;S<P.length;S++){var I=P[S];this.pushToScratch(I)}},f.prototype.firstScratchEventId=function(){if(this.scratch.length!==0)return this.scratch[0].id},f.prototype.undoRedoAvailability=function(_){var S=this.compactor.eventTargetedByUndoSubjectToBlacklist(_);return{undo:S!==void 0,undoEvent:S,redo:this.compactor.redoIsPossible(_)}},f.prototype.push=function(_,S){this.clearScratch(),this.numberOfEventsPushed++;var P=this.compactor.outStream.length-1,I=Number(this.compactor.push(_,S??"looselyCheckUndoRedo"));if(P<=I)return I;for(var E=0,B=this.engines;E<B.length;E++){var b=B[E];b.rollbackToBeforeEvent(I+1)}return I},f.prototype.pushBatch=function(_,S){return c.prototype.pushBatch.call(this,_,S)},f.prototype.stateBeforeEvent=function(_){var S=new this.stateAccessorClass(p.AccessorType.Before,this);if(S.eventIndex=this.compactor.outIndexMap[_],S.eventIndex===void 0)throw new p.InvalidStateAccessorError(p.AccessorType.Before,_);return S},f.prototype.stateAfterEvent=function(_){var S=new this.stateAccessorClass(p.AccessorType.After,this);if(S.eventIndex=this.compactor.outIndexMap[_],S.eventIndex===void 0)throw new p.InvalidStateAccessorError(p.AccessorType.After,_);return S},f.prototype.stateAfterTimestamp=function(_){var S=i(this.compactor.outStream,_);return S?this.stateAfterEvent(S.id):new this.stateAccessorClass(p.AccessorType.After,this)},f.prototype.eventIdAfterTimestamp=function(_){var S=i(this.compactor.outStream,_);if(S)return S.id;throw new Error("No event found for timestamp ".concat(_))},f.prototype.outputStream=function(){return this.compactor.outStream},f.prototype.outputEventById=function(_){return this.compactor.outStream[this.compactor.outIndexMap[_]]},f.prototype.outputEventsById=function(_){return l.map(_,this.outputEventById,this)},f.prototype.updateFromPushPayload=function(_,S){for(var P=this.compactor.outStream.length-1,I={},E=0,B=S;E<B.length;E++){var b=B[E];I[p.idFromEvent(b)]=b}for(var R=this.numberOfEventsPushed;R<_.length;R++){var F=_[R],x=I[F];if(x!==void 0){var w=x.event_data;P=Math.min(P,this.push(w,"looselyCheckUndoRedo"))}else{console.log("WARNING: The controller thinks that event "+F+" is new. But we cannot find it in the newEvents in the push payload. Will not attempt to push any more events");break}}return P},f.prototype.updateFromSerializedPushPayload=function(_,S){var P=JSON.parse(S);return this.updateFromPushPayload(_,P)},f}(h);Ne.CompactorController=o;var a=function(c){n.__extends(f,c);function f(){var _=c!==null&&c.apply(this,arguments)||this;return _.legacyEvents=[],_}return f.prototype.push=function(_){var S=p.idFromEvent(_);if(S!==void 0&&this.transcoder.latestState.idToInputIndex[S]!==void 0)return this.replaceEventsInLegacyStream([_]);var P=this.transcoder.outStream.length-1;return this.legacyEvents.push(_),this.transcoder.processToLatestEvent(),P},f.prototype.processUndosFromPushPayload=function(_){for(var S=void 0,P=Math.min(_.length,this.legacyEvents.length),I=0;I<P;I++)if(_[I]!==p.idFromEvent(this.legacyEvents[I])){S=I-1;break}return S===void 0&&_.length<this.legacyEvents.length&&(S=_.length-1),S!==void 0?this.deleteTailEvents(this.legacyEvents.length-1-S):this.transcoder.outStream.length-1},f.prototype.updateFromPushPayload=function(_,S){if(this.transcoder.baseEvents.length>0){var P=p.idFromEvent(this.transcoder.baseEvents[0]);P&&P.indexOf("auto_generated")!==-1&&_.unshift(P)}for(var I=this.processUndosFromPushPayload(_),E={},B=0,b=S;B<b.length;B++){var R=b[B];E[p.idFromEvent(R)]=R}for(var F=[],x=0,w=this.legacyEvents;x<w.length;x++){var L=w[x],D=p.idFromEvent(L);D&&l.has(E,D)&&F.push(E[D])}F.length!==0&&(I=this.replaceEventsInLegacyStream(F));for(var U=this.legacyEvents.length;U<_.length;U++){var G=_[U],q=E[G];if(q!==void 0)this.push(q);else{console.log("WARNING: The controller thinks that event "+G+" is new. But we cannot find it in the newEvents in the push payload. Will not attempt to push any more events");break}}return this.transcoder.processToLatestEvent(),I},f.prototype.updateFromSerializedPushPayload=function(_,S){var P=JSON.parse(S);return this.updateFromPushPayload(_,P)},f.prototype.replaceEventsInLegacyStream=function(_){for(var S=l.clone(this.transcoder.latestState),P=1/0,I=0,E=0,B=_;E<B.length;E++){var b=B[E],R=p.idFromEvent(b),F=S.idToInputIndex[R];F<P&&(P=F,I=S.idToOutputIndex[R])}this.transcoder.rollbackToBeforeEvent(P);var x=this.transcoder.outStream.length-1;this.setEngineOutStreamAndIndex(I);for(var w=0,L=_;w<L.length;w++){var D=L[w],U=S.idToInputIndex[p.idFromEvent(D)];this.legacyEvents.splice(U,1,D)}return this.transcoder.processToLatestEvent(),x},f.prototype.deleteTailEvents=function(_){_=Math.min(this.legacyEvents.length,_),this.legacyEvents.splice(this.legacyEvents.length-_,_),this.transcoder.rollbackToBeforeEvent(this.legacyEvents.length);var S=this.transcoder.outStream.length-1;return this.setEngineOutStreamAndIndex(this.transcoder.outStream.length),S},f.prototype.stateBeforeLegacyEvent=function(_){var S=new this.stateAccessorClass(p.AccessorType.Before,this);return S.eventIndex=this.transcoder.latestState.idToOutputIndex[_],S},f.prototype.stateAfterLegacyEvent=function(_){var S=new this.stateAccessorClass(p.AccessorType.Before,this);return S.eventIndex=this.transcoder.firstOutputIndexAfterInputEventId(_),S},f.prototype.stateBeforeEvent=function(_){var S=new this.stateAccessorClass(p.AccessorType.Before,this);return S.eventIndex=this.transcoder.outIndexMap[_],S},f.prototype.stateAfterEvent=function(_){var S=new this.stateAccessorClass(p.AccessorType.After,this);return S.eventIndex=this.transcoder.outIndexMap[_],S},f.prototype.stateAfterTimestamp=function(_){return new this.stateAccessorClass(p.AccessorType.After,this)},f.prototype.eventIdAfterTimestamp=function(_){throw new Error("method not implemented for Transcoder")},f.prototype.outputStream=function(){return this.transcoder.processToLatestEvent(),this.transcoder.outStream},f.prototype.outputEventById=function(_){return this.outputStream()[this.transcoder.outIndexMap[_]]},f.prototype.outputEventsById=function(_){return l.map(_,this.outputEventById,this)},f.prototype.setEngineOutStreamAndIndex=function(_){for(var S=0,P=this.engines;S<P.length;S++){var I=P[S];I.baseEvents=this.transcoder.outStream,I.rollbackToBeforeEvent(_)}},f}(h);Ne.TranscoderController=a;var r=function(){function c(f){this.accessorType=f,this.typeToMethodName={0:"latestState",1:"stateBeforeEvent",2:"stateAfterEvent"}}return c}();Ne.BaseStateAccessor=r;var e=function(c){n.__extends(f,c);function f(_,S){var P=c.call(this,_)||this;return P.controller=S,P}return f.prototype.get=function(_,S){return this.stateForCurrentAccessType(S)[_]},f.prototype.call=function(_,S,P){var I;return(I=this.stateForCurrentAccessType(P))[_].apply(I,S)},f.prototype.stateForCurrentAccessType=function(_){if(this.accessorType===p.AccessorType.Latest)return _[this.typeToMethodName[this.accessorType]];var S=_[this.typeToMethodName[this.accessorType]](this.eventIndex);if(S===void 0)throw new v(this.eventIndex);return S},f}(r);Ne.EngineStateAccessor=e;function i(c,f){for(var _=0,S=c.length-1;_<=S;){var P=Math.floor((_+S)/2),I=c[P-1];if(I){if(c[P].createdAt>f&&I.createdAt<=f)return I}else return c[P];var E=c[P].createdAt;E&&f<E?S=P-1:_=P+1}return c[c.length-1]}return Ne}var ao={},Tr={},Lc;function io(){if(Lc)return Tr;Lc=1,Object.defineProperty(Tr,"__esModule",{value:!0}),Tr.stripNulls=Tr.modularSlice=void 0;function n(t,p,d){for(var y=[],s=p,u=0;u<d;s=(s+1)%t.length,++u)y.push(t[s]);return y}Tr.modularSlice=n;function l(t){return t.filter(function(p){return p!==null})}return Tr.stripNulls=l,Tr}var Dc;function Or(){return Dc||(Dc=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.SabertoothEventCompactor=n.ComponentStream=n.undoableEditTag=void 0;var l=X,t=l.__importStar(Pe),p=l.__importStar($e()),d=io(),y=gt(),s;(function(v){v[v.Insert=0]="Insert",v[v.Delete=1]="Delete"})(s=n.undoableEditTag||(n.undoableEditTag={}));var u=function(){function v(o,a){this.identifier=o,this.playCodeTransformer=a,this.inStream=[],this.outStream=[],this.inIndexMap={},this.outIndexMap={},this.inEventIdToOutEventIdMap={}}return v.prototype.push=function(o){var a;this.inIndexMap[o.id]=this.inStream.length,this.inStream.push(o);var r=this.handleEvent(o);return this.inEventIdToOutEventIdMap[o.id]=(a=this.outStream[this.outStream.length-1])===null||a===void 0?void 0:a.id,r},v.prototype.outStreamIsEmpty=function(){return this.outStream.length===0},v.prototype.eventTargetedByUndoSubjectToBlacklist=function(){var o=this.eventTargetedByUndo();if(o!==void 0&&(this.eventBlacklistedForUndo===void 0||!this.eventBlacklistedForUndo(o)))return o},v.prototype.redoIsPossible=function(){return this.eventTargetedByRedo()!==void 0},v.prototype.shouldIgnoreRedo=function(){var o=this.inStream.length-1;return o<0?!0:this.inStream[o].code==="redo"},v.prototype.eventTargetedByUndo=function(o){for(var a=1,r=o?this.inIndexMap[o.id]-1:this.inStream.length-1,e=r;e>=0;e--)if(this.inStream[e].code==="undo")a++;else if(a--,a===0)return this.inStream[e]},v.prototype.eventTargetedByRedo=function(o){for(var a=1,r=o?this.inIndexMap[o.id]-1:this.inStream.length-1,e=r;e>=0;e--)if(this.inStream[e].code==="redo")a++;else if(this.inStream[e].code==="undo"){if(a--,a===0)return this.inStream[e]}else return},v.prototype.ensureComponentStream=function(o){o.compactorAttributes?o.compactorAttributes.stream=this.identifier:o.compactorAttributes={stream:this.identifier}},v.prototype.ensureComponentStreams=function(o){for(var a=0,r=o;a<r.length;a++){var e=r[a];this.ensureComponentStream(e)}return o},v.prototype.pushToOutStream=function(o){o.code==="play"&&this.playCodeTransformer&&this.handlePlayCodeTransformation(o),this.ensureComponentStream(o),this.outStream.push(o)},v.prototype.pushToOutstream=function(o,a){for(var r,e=0,i=a;e<i.length;e++){var c=i[e];c.code==="play"&&this.playCodeTransformer&&this.handlePlayCodeTransformation(c)}(r=this.outStream).splice.apply(r,l.__spreadArray([o,0],a,!1))},v.prototype.handleEvent=function(o){switch(o.code){case"insert":return this.handleInsert(o);case"delete":return this.handleDelete(o);case"replace":return this.handleReplace(o);case"edit_group":return this.handleEditGroup(o);case"transaction":return this.handleTransaction(o);case"set_game_settings":return this.handleSetGameSettings(o);case"undo":var a=this.eventTargetedByUndo(o);return a!==void 0?this.handleUndo(a):String(this.outStream.length-1);case"redo":var r=this.eventTargetedByRedo(o);return r!==void 0?this.handleRedo(r):String(this.outStream.length-1);case"play":return this.pushEvent(o);default:return this.pushEvent(o)}},v.prototype.pushEvent=function(o){return this.outIndexMap[o.id]=this.outStream.length,this.pushToOutStream(o),String(this.outStream.length-2)},v.prototype.rebuildOutIndexMap=function(o){for(var a=o+1;a<this.outStream.length;a++)this.outIndexMap[this.outStream[a].id]=Number(a)},v.prototype.handleInsert=function(o){var a;if(o.beforeId!==void 0)a=this.outIndexMap[o.beforeId];else if(o.afterId!==void 0)a=this.outIndexMap[o.afterId]+1;else return console.log("Malformed insert command, either beforeId or afterId is required"),String(this.outStream.length-1);return this.pushToOutstream(a,this.ensureComponentStreams(o.events)),this.rebuildOutIndexMap(a-1),String(a-1)},v.prototype.annotateEventWithDeleteEvents=function(o){o.deleteEvents=[];for(var a=0,r=o.deleteIds;a<r.length;a++){var e=r[a];o.deleteEvents.push([this.outIndexMap[e],this.outStream[this.outIndexMap[e]]])}o.deleteEvents=t.sortBy(o.deleteEvents,function(i){var c=i[0];return i[1],-1*c})},v.prototype.annotateEventWithEditGroupUndoEvents=function(o){o.edits=[];for(var a=p.aggregateGroupableEvents(o.events),r=0,e=a.deleteIds;r<e.length;r++){var i=e[r],c=this.outIndexMap[i],f=this.outStream[c];o.edits.push([s.Delete,c,[f]])}for(var _=0,S=a.insertions;_<S.length;_++){var P=S[_],I=P[0],E=P[1],B=P[2],b=E===p.Placement.Before?0:1,R=this.outIndexMap[I]+b;o.edits.push([s.Insert,R,B])}o.edits=t.sortBy(o.edits,function(F){return-1*F[1]})},v.prototype.handlePlayCodeTransformation=function(o){var a,r,e=o.attributes,i=e.play_code,c=e.play_details;o.attributes.play_code=(r=(a=this.playCodeTransformer)===null||a===void 0?void 0:a.transform(i,c))!==null&&r!==void 0?r:i},v.prototype.handleDelete=function(o){this.annotateEventWithDeleteEvents(o);for(var a=0,r=o.deleteEvents;a<r.length;a++){var e=r[a][0];this.outStream.splice(e,1)}var i=t.last(o.deleteEvents)[0]-1;return this.rebuildOutIndexMap(i),String(i)},v.prototype.handleReplace=function(o){var a=this.outIndexMap[o.deleteIds[0]];this.annotateEventWithDeleteEvents(o);for(var r=0,e=o.deleteEvents;r<e.length;r++){var i=e[r][0];this.outStream.splice(i,1),i<a&&a--}this.pushToOutstream(a,this.ensureComponentStreams(o.events));var c=t.last(o.deleteEvents)[0]-1;return this.rebuildOutIndexMap(c),String(c)},v.prototype.handleTransaction=function(o){for(var a=0,r=o.events;a<r.length;a++){var e=r[a];this.outIndexMap[e.id]=this.outStream.length,this.pushToOutStream(e)}return String(this.outStream.length-(1+o.events.length))},v.prototype.handleSetGameSettings=function(o){var a=this.outStream.findIndex(function(e){return e.code==="set_game_settings"}),r=a-1;return a!==-1?(this.outStream[a]=o,this.rebuildOutIndexMap(r),String(r)):(this.pushToOutStream(o),String(this.outStream.length-2))},v.prototype.handleEditGroup=function(o){var a=this.outStream.length;o.events=(0,d.stripNulls)(o.events),this.annotateEventWithEditGroupUndoEvents(o);for(var r=0,e=o.edits;r<e.length;r++){var i=e[r],c=i[0],f=i[1],_=i[2];switch(f<a&&(a=f),c){case s.Delete:this.outStream.splice(f,_.length);break;case s.Insert:this.pushToOutstream(f,this.ensureComponentStreams(_));break}}return this.rebuildOutIndexMap(a-1),String(a-1)},v.prototype.handleUndo=function(o){switch(o.code){case"insert":return this.undoInsert(o);case"delete":return this.undoDelete(o);case"replace":return this.undoReplace(o);case"transaction":return this.undoTransaction(o);case"edit_group":return this.undoEditGroup(o);case"redo":return this.undoRedo(o);case"undo":return console.log("Cannot call handleUndo on an undo event. Use redo instead. Illegal operation."),String(this.outStream.length-1);default:return this.undoSabertoothEvent(o)}},v.prototype.undoSabertoothEvent=function(o){var a=this.outIndexMap[o.id];return this.outStream.splice(a,1),this.rebuildOutIndexMap(a-1),String(a-1)},v.prototype.undoInsert=function(o){var a;if(o.beforeId!==void 0)a=this.outIndexMap[o.beforeId]-o.events.length;else if(o.afterId!==void 0)a=this.outIndexMap[o.afterId]+1;else return console.log("Malformed insert command, either beforeId or afterId is required"),String(this.outStream.length-1);return this.outStream.splice(a,o.events.length),this.rebuildOutIndexMap(a-1),String(a-1)},v.prototype.undoDelete=function(o){for(var a=o.deleteEvents.length-1;a>=0;a--){var r=o.deleteEvents[a],e=r[0],i=r[1];this.pushToOutstream(e,[i])}var c=t.last(o.deleteEvents)[0]-1;return this.rebuildOutIndexMap(c),String(c)},v.prototype.undoReplace=function(o){var a=this.outIndexMap[o.events[0].id];this.outStream.splice(a,o.events.length);for(var r=o.deleteEvents.length-1;r>=0;r--){var e=o.deleteEvents[r],i=e[0],c=e[1];this.pushToOutstream(i,[c])}var f=Math.min.apply(Math,l.__spreadArray([a-1],t.map(o.deleteEvents,function(_){return _[0]-1}),!1));return this.rebuildOutIndexMap(f),String(f)},v.prototype.undoEditGroup=function(o){o.events=(0,d.stripNulls)(o.events);for(var a=this.outStream.length,r=o.edits.length-1;r>=0;r--){var e=o.edits[r],i=e[0],c=e[1],f=e[2];i===s.Delete?(this.pushToOutstream(c,f),a=Math.min(c,a)):(this.outStream.splice(c,f.length),a=Math.min(c,a))}return this.rebuildOutIndexMap(a-1),String(a-1)},v.prototype.undoTransaction=function(o){if(o.events.length===0)return String(this.outStream.length-1);var a=this.outIndexMap[o.events[0].id]-1;return this.outStream.splice(a+1,o.events.length),String(a)},v.prototype.undoRedo=function(o){var a=this.eventTargetedByRedo(o);return a===void 0?(console.log("Attempted to undo an illegal redo. Illegal operation."),String(this.outStream.length-1)):this.handleEvent(a)},v.prototype.handleRedo=function(o){if(o.code!=="undo")return console.log("Got a redo event following a ".concat(o.code,". Illegal operation.")),String(this.outStream.length-1);var a=this.eventTargetedByUndo(o);return a===void 0?(console.log("Attempted to redo an illegal undo. Illegal operation."),String(this.outStream.length-1)):this.handleEvent(a)},v}();n.ComponentStream=u;var h=function(){function v(o){this.transformer=o,this.inStream=[],this.componentStreams={head:new u("head",this.transformer),main:new u("main",this.transformer),tail:new u("tail",this.transformer)},this.outStream=[],this.outIndexMap={}}return v.prototype.push=function(o,a){var r=this.targetedComponentStreamIdentifier(o),e=this.componentStreams[r];if(o.code==="undo"){if(e.outStreamIsEmpty()){if(a==="strictlyCheckUndoRedo")throw new y.SabertoothError("undo_not_possible","Undo event was pushed to the compactor but there was nothing to undo");return"-1"}else if(e.eventTargetedByUndoSubjectToBlacklist()===void 0)throw new y.SabertoothError("undo_not_possible","Undo event was pushed to the compactor but undo is not currently possible")}else if(o.code==="redo"&&!e.redoIsPossible()){if(e.shouldIgnoreRedo()&&a!=="strictlyCheckUndoRedo")return String(e.outStream.length-1);throw new y.SabertoothError("redo_not_possible","Redo event was pushed to the compactor but there was nothing to redo")}this.inStream.push(o);var i=e.push(o);return this.reconcileOutStreamWithChanges(r,i)},v.prototype.clearScratch=function(o){this.outStream.splice(this.outStream.length-o.length,o.length)},v.prototype.pushForScratch=function(o){this.outIndexMap[o.id]=this.outStream.length,this.outStream.push(o)},v.prototype.eventTargetedByUndoSubjectToBlacklist=function(o){return this.componentStreams[o].eventTargetedByUndoSubjectToBlacklist()},v.prototype.redoIsPossible=function(o){return this.componentStreams[o].redoIsPossible()},v.prototype.targetedComponentStreamIdentifier=function(o){return o.compactorAttributes!==void 0&&o.compactorAttributes.stream!==void 0?o.compactorAttributes.stream:"main"},v.prototype.reconcileOutStreamWithChanges=function(o,a){for(var r,e,i=["head","main","tail"],c=0,f=0,_=t.clone(i);f<_.length;f++){var S=_[f];if(o===S)break;i.splice(0,1);var P=this.componentStreams[S];c+=P.outStream.length}c+=Number(a),this.outStream.splice(c+1,1/0);for(var I=0,E=i;I<E.length;I++){var S=E[I],P=this.componentStreams[S];P.outStream.length!==0&&(S===o?(r=this.outStream).splice.apply(r,l.__spreadArray([this.outStream.length,0],P.outStream.slice(Number(a)+1),!1)):(e=this.outStream).splice.apply(e,l.__spreadArray([this.outStream.length,0],P.outStream,!1)))}return this.rebuildOutIndexMap(c),String(c)},v.prototype.rebuildOutIndexMap=function(o){for(var a=o+1;a<this.outStream.length;a++)this.outIndexMap[this.outStream[a].id]=Number(a)},v}();n.SabertoothEventCompactor=h}(ao)),ao}var Wn={},Gc;function Ay(){if(Gc)return Wn;Gc=1,Object.defineProperty(Wn,"__esModule",{value:!0}),Wn.applyMixins=void 0;function n(l,t){t.forEach(function(p){Object.getOwnPropertyNames(p.prototype).forEach(function(d){l.prototype[d]=p.prototype[d]})})}return Wn.applyMixins=n,Wn}var so={},oo={exports:{}},Hc;function fe(){return Hc||(Hc=1,function(n,l){(function(t,p){n.exports=p()})(Yh,function(){var t=Array.prototype.slice;function p(g,m){m&&(g.prototype=Object.create(m.prototype)),g.prototype.constructor=g}function d(g){return h(g)?g:H(g)}p(y,d);function y(g){return v(g)?g:Q(g)}p(s,d);function s(g){return o(g)?g:oe(g)}p(u,d);function u(g){return h(g)&&!a(g)?g:pe(g)}function h(g){return!!(g&&g[e])}function v(g){return!!(g&&g[i])}function o(g){return!!(g&&g[c])}function a(g){return v(g)||o(g)}function r(g){return!!(g&&g[f])}d.isIterable=h,d.isKeyed=v,d.isIndexed=o,d.isAssociative=a,d.isOrdered=r,d.Keyed=y,d.Indexed=s,d.Set=u;var e="@@__IMMUTABLE_ITERABLE__@@",i="@@__IMMUTABLE_KEYED__@@",c="@@__IMMUTABLE_INDEXED__@@",f="@@__IMMUTABLE_ORDERED__@@",_="delete",S=5,P=1<<S,I=P-1,E={},B={value:!1},b={value:!1};function R(g){return g.value=!1,g}function F(g){g&&(g.value=!0)}function x(){}function w(g,m){m=m||0;for(var T=Math.max(0,g.length-m),O=new Array(T),A=0;A<T;A++)O[A]=g[A+m];return O}function L(g){return g.size===void 0&&(g.size=g.__iterate(U)),g.size}function D(g,m){if(typeof m!="number"){var T=m>>>0;if(""+T!==m||T===4294967295)return NaN;m=T}return m<0?L(g)+m:m}function U(){return!0}function G(g,m,T){return(g===0||T!==void 0&&g<=-T)&&(m===void 0||T!==void 0&&m>=T)}function q(g,m){return ne(g,m,0)}function z(g,m){return ne(g,m,m)}function ne(g,m,T){return g===void 0?T:g<0?Math.max(0,m+g):m===void 0?g:Math.min(m,g)}var ue=0,ee=1,$=2,Y=typeof Symbol=="function"&&Symbol.iterator,W="@@iterator",J=Y||W;function ae(g){this.next=g}ae.prototype.toString=function(){return"[Iterator]"},ae.KEYS=ue,ae.VALUES=ee,ae.ENTRIES=$,ae.prototype.inspect=ae.prototype.toSource=function(){return this.toString()},ae.prototype[J]=function(){return this};function se(g,m,T,O){var A=g===0?m:g===1?T:[m,T];return O?O.value=A:O={value:A,done:!1},O}function ie(){return{value:void 0,done:!0}}function ye(g){return!!Z(g)}function j(g){return g&&typeof g.next=="function"}function te(g){var m=Z(g);return m&&m.call(g)}function Z(g){var m=g&&(Y&&g[Y]||g[W]);if(typeof m=="function")return m}function M(g){return g&&typeof g.length=="number"}p(H,d);function H(g){return g==null?Qe():h(g)?g.toSeq():wt(g)}H.of=function(){return H(arguments)},H.prototype.toSeq=function(){return this},H.prototype.toString=function(){return this.__toString("Seq {","}")},H.prototype.cacheResult=function(){return!this._cache&&this.__iterateUncached&&(this._cache=this.entrySeq().toArray(),this.size=this._cache.length),this},H.prototype.__iterate=function(g,m){return Vt(this,g,m,!0)},H.prototype.__iterator=function(g,m){return Mt(this,g,m,!0)},p(Q,H);function Q(g){return g==null?Qe().toKeyedSeq():h(g)?v(g)?g.toSeq():g.fromEntrySeq():ht(g)}Q.prototype.toKeyedSeq=function(){return this},p(oe,H);function oe(g){return g==null?Qe():h(g)?v(g)?g.entrySeq():g.toIndexedSeq():It(g)}oe.of=function(){return oe(arguments)},oe.prototype.toIndexedSeq=function(){return this},oe.prototype.toString=function(){return this.__toString("Seq [","]")},oe.prototype.__iterate=function(g,m){return Vt(this,g,m,!1)},oe.prototype.__iterator=function(g,m){return Mt(this,g,m,!1)},p(pe,H);function pe(g){return(g==null?Qe():h(g)?v(g)?g.entrySeq():g:It(g)).toSetSeq()}pe.of=function(){return pe(arguments)},pe.prototype.toSetSeq=function(){return this},H.isSeq=st,H.Keyed=Q,H.Set=pe,H.Indexed=oe;var ce="@@__IMMUTABLE_SEQ__@@";H.prototype[ce]=!0,p(Ie,oe);function Ie(g){this._array=g,this.size=g.length}Ie.prototype.get=function(g,m){return this.has(g)?this._array[D(this,g)]:m},Ie.prototype.__iterate=function(g,m){for(var T=this._array,O=T.length-1,A=0;A<=O;A++)if(g(T[m?O-A:A],A,this)===!1)return A+1;return A},Ie.prototype.__iterator=function(g,m){var T=this._array,O=T.length-1,A=0;return new ae(function(){return A>O?ie():se(g,A,T[m?O-A++:A++])})},p(Te,Q);function Te(g){var m=Object.keys(g);this._object=g,this._keys=m,this.size=m.length}Te.prototype.get=function(g,m){return m!==void 0&&!this.has(g)?m:this._object[g]},Te.prototype.has=function(g){return this._object.hasOwnProperty(g)},Te.prototype.__iterate=function(g,m){for(var T=this._object,O=this._keys,A=O.length-1,k=0;k<=A;k++){var C=O[m?A-k:k];if(g(T[C],C,this)===!1)return k+1}return k},Te.prototype.__iterator=function(g,m){var T=this._object,O=this._keys,A=O.length-1,k=0;return new ae(function(){var C=O[m?A-k:k];return k++>A?ie():se(g,C,T[C])})},Te.prototype[f]=!0,p(me,oe);function me(g){this._iterable=g,this.size=g.length||g.size}me.prototype.__iterateUncached=function(g,m){if(m)return this.cacheResult().__iterate(g,m);var T=this._iterable,O=te(T),A=0;if(j(O))for(var k;!(k=O.next()).done&&g(k.value,A++,this)!==!1;);return A},me.prototype.__iteratorUncached=function(g,m){if(m)return this.cacheResult().__iterator(g,m);var T=this._iterable,O=te(T);if(!j(O))return new ae(ie);var A=0;return new ae(function(){var k=O.next();return k.done?k:se(g,A++,k.value)})},p(qe,oe);function qe(g){this._iterator=g,this._iteratorCache=[]}qe.prototype.__iterateUncached=function(g,m){if(m)return this.cacheResult().__iterate(g,m);for(var T=this._iterator,O=this._iteratorCache,A=0;A<O.length;)if(g(O[A],A++,this)===!1)return A;for(var k;!(k=T.next()).done;){var C=k.value;if(O[A]=C,g(C,A++,this)===!1)break}return A},qe.prototype.__iteratorUncached=function(g,m){if(m)return this.cacheResult().__iterator(g,m);var T=this._iterator,O=this._iteratorCache,A=0;return new ae(function(){if(A>=O.length){var k=T.next();if(k.done)return k;O[A]=k.value}return se(g,A,O[A++])})};function st(g){return!!(g&&g[ce])}var Ue;function Qe(){return Ue||(Ue=new Ie([]))}function ht(g){var m=Array.isArray(g)?new Ie(g).fromEntrySeq():j(g)?new qe(g).fromEntrySeq():ye(g)?new me(g).fromEntrySeq():typeof g=="object"?new Te(g):void 0;if(!m)throw new TypeError("Expected Array or iterable object of [k, v] entries, or keyed object: "+g);return m}function It(g){var m=Ct(g);if(!m)throw new TypeError("Expected Array or iterable object of values: "+g);return m}function wt(g){var m=Ct(g)||typeof g=="object"&&new Te(g);if(!m)throw new TypeError("Expected Array or iterable object of values, or keyed object: "+g);return m}function Ct(g){return M(g)?new Ie(g):j(g)?new qe(g):ye(g)?new me(g):void 0}function Vt(g,m,T,O){var A=g._cache;if(A){for(var k=A.length-1,C=0;C<=k;C++){var N=A[T?k-C:C];if(m(N[1],O?N[0]:C,g)===!1)return C+1}return C}return g.__iterateUncached(m,T)}function Mt(g,m,T,O){var A=g._cache;if(A){var k=A.length-1,C=0;return new ae(function(){var N=A[T?k-C:C];return C++>k?ie():se(m,O?N[0]:C-1,N[1])})}return g.__iteratorUncached(m,T)}function mt(g,m){return m?xt(m,g,"",{"":g}):bt(g)}function xt(g,m,T,O){return Array.isArray(m)?g.call(O,T,oe(m).map(function(A,k){return xt(g,A,k,m)})):Lt(m)?g.call(O,T,Q(m).map(function(A,k){return xt(g,A,k,m)})):m}function bt(g){return Array.isArray(g)?oe(g).map(bt).toList():Lt(g)?Q(g).map(bt).toMap():g}function Lt(g){return g&&(g.constructor===Object||g.constructor===void 0)}function Re(g,m){if(g===m||g!==g&&m!==m)return!0;if(!g||!m)return!1;if(typeof g.valueOf=="function"&&typeof m.valueOf=="function"){if(g=g.valueOf(),m=m.valueOf(),g===m||g!==g&&m!==m)return!0;if(!g||!m)return!1}return!!(typeof g.equals=="function"&&typeof m.equals=="function"&&g.equals(m))}function zt(g,m){if(g===m)return!0;if(!h(m)||g.size!==void 0&&m.size!==void 0&&g.size!==m.size||g.__hash!==void 0&&m.__hash!==void 0&&g.__hash!==m.__hash||v(g)!==v(m)||o(g)!==o(m)||r(g)!==r(m))return!1;if(g.size===0&&m.size===0)return!0;var T=!a(g);if(r(g)){var O=g.entries();return m.every(function(V,K){var re=O.next().value;return re&&Re(re[1],V)&&(T||Re(re[0],K))})&&O.next().done}var A=!1;if(g.size===void 0)if(m.size===void 0)typeof g.cacheResult=="function"&&g.cacheResult();else{A=!0;var k=g;g=m,m=k}var C=!0,N=m.__iterate(function(V,K){if(T?!g.has(V):A?!Re(V,g.get(K,E)):!Re(g.get(K,E),V))return C=!1,!1});return C&&g.size===N}p(Le,oe);function Le(g,m){if(!(this instanceof Le))return new Le(g,m);if(this._value=g,this.size=m===void 0?1/0:Math.max(0,m),this.size===0){if(Ut)return Ut;Ut=this}}Le.prototype.toString=function(){return this.size===0?"Repeat []":"Repeat [ "+this._value+" "+this.size+" times ]"},Le.prototype.get=function(g,m){return this.has(g)?this._value:m},Le.prototype.includes=function(g){return Re(this._value,g)},Le.prototype.slice=function(g,m){var T=this.size;return G(g,m,T)?this:new Le(this._value,z(m,T)-q(g,T))},Le.prototype.reverse=function(){return this},Le.prototype.indexOf=function(g){return Re(this._value,g)?0:-1},Le.prototype.lastIndexOf=function(g){return Re(this._value,g)?this.size:-1},Le.prototype.__iterate=function(g,m){for(var T=0;T<this.size;T++)if(g(this._value,T,this)===!1)return T+1;return T},Le.prototype.__iterator=function(g,m){var T=this,O=0;return new ae(function(){return O<T.size?se(g,O++,T._value):ie()})},Le.prototype.equals=function(g){return g instanceof Le?Re(this._value,g._value):zt(g)};var Ut;function He(g,m){if(!g)throw new Error(m)}p(De,oe);function De(g,m,T){if(!(this instanceof De))return new De(g,m,T);if(He(T!==0,"Cannot step a Range by 0"),g=g||0,m===void 0&&(m=1/0),T=T===void 0?1:Math.abs(T),m<g&&(T=-T),this._start=g,this._end=m,this._step=T,this.size=Math.max(0,Math.ceil((m-g)/T-1)+1),this.size===0){if(ur)return ur;ur=this}}De.prototype.toString=function(){return this.size===0?"Range []":"Range [ "+this._start+"..."+this._end+(this._step!==1?" by "+this._step:"")+" ]"},De.prototype.get=function(g,m){return this.has(g)?this._start+D(this,g)*this._step:m},De.prototype.includes=function(g){var m=(g-this._start)/this._step;return m>=0&&m<this.size&&m===Math.floor(m)},De.prototype.slice=function(g,m){return G(g,m,this.size)?this:(g=q(g,this.size),m=z(m,this.size),m<=g?new De(0,0):new De(this.get(g,this._end),this.get(m,this._end),this._step))},De.prototype.indexOf=function(g){var m=g-this._start;if(m%this._step===0){var T=m/this._step;if(T>=0&&T<this.size)return T}return-1},De.prototype.lastIndexOf=function(g){return this.indexOf(g)},De.prototype.__iterate=function(g,m){for(var T=this.size-1,O=this._step,A=m?this._start+T*O:this._start,k=0;k<=T;k++){if(g(A,k,this)===!1)return k+1;A+=m?-O:O}return k},De.prototype.__iterator=function(g,m){var T=this.size-1,O=this._step,A=m?this._start+T*O:this._start,k=0;return new ae(function(){var C=A;return A+=m?-O:O,k>T?ie():se(g,k++,C)})},De.prototype.equals=function(g){return g instanceof De?this._start===g._start&&this._end===g._end&&this._step===g._step:zt(this,g)};var ur;p(yt,d);function yt(){throw TypeError("Abstract")}p(_r,yt);function _r(){}p(Bn,yt);function Bn(){}p(ts,yt);function ts(){}yt.Keyed=_r,yt.Indexed=Bn,yt.Set=ts;var gi=typeof Math.imul=="function"&&Math.imul(4294967295,2)===-2?Math.imul:function(m,T){m=m|0,T=T|0;var O=m&65535,A=T&65535;return O*A+((m>>>16)*A+O*(T>>>16)<<16>>>0)|0};function Qo(g){return g>>>1&1073741824|g&3221225471}function Et(g){if(g===!1||g===null||g===void 0||typeof g.valueOf=="function"&&(g=g.valueOf(),g===!1||g===null||g===void 0))return 0;if(g===!0)return 1;var m=typeof g;if(m==="number"){if(g!==g||g===1/0)return 0;var T=g|0;for(T!==g&&(T^=g*4294967295);g>4294967295;)g/=4294967295,T^=g;return Qo(T)}if(m==="string")return g.length>f_?l_(g):Xo(g);if(typeof g.hashCode=="function")return g.hashCode();if(m==="object")return c_(g);if(typeof g.toString=="function")return Xo(g.toString());throw new Error("Value type "+m+" cannot be hashed.")}function l_(g){var m=nu[g];return m===void 0&&(m=Xo(g),ru===p_&&(ru=0,nu={}),ru++,nu[g]=m),m}function Xo(g){for(var m=0,T=0;T<g.length;T++)m=31*m+g.charCodeAt(T)|0;return Qo(m)}function c_(g){var m;if(Zo&&(m=eu.get(g),m!==void 0)||(m=g[vn],m!==void 0)||!ih&&(m=g.propertyIsEnumerable&&g.propertyIsEnumerable[vn],m!==void 0||(m=d_(g),m!==void 0)))return m;if(m=++tu,tu&1073741824&&(tu=0),Zo)eu.set(g,m);else{if(ah!==void 0&&ah(g)===!1)throw new Error("Non-extensible objects are not allowed as keys.");if(ih)Object.defineProperty(g,vn,{enumerable:!1,configurable:!1,writable:!1,value:m});else if(g.propertyIsEnumerable!==void 0&&g.propertyIsEnumerable===g.constructor.prototype.propertyIsEnumerable)g.propertyIsEnumerable=function(){return this.constructor.prototype.propertyIsEnumerable.apply(this,arguments)},g.propertyIsEnumerable[vn]=m;else if(g.nodeType!==void 0)g[vn]=m;else throw new Error("Unable to set a non-enumerable property on object.")}return m}var ah=Object.isExtensible,ih=function(){try{return Object.defineProperty({},"@",{}),!0}catch{return!1}}();function d_(g){if(g&&g.nodeType>0)switch(g.nodeType){case 1:return g.uniqueID;case 9:return g.documentElement&&g.documentElement.uniqueID}}var Zo=typeof WeakMap=="function",eu;Zo&&(eu=new WeakMap);var tu=0,vn="__immutablehash__";typeof Symbol=="function"&&(vn=Symbol(vn));var f_=16,p_=255,ru=0,nu={};function Bt(g){He(g!==1/0,"Cannot perform this action with an infinite size.")}p(be,_r);function be(g){return g==null?Wt():au(g)&&!r(g)?g:Wt().withMutations(function(m){var T=y(g);Bt(T.size),T.forEach(function(O,A){return m.set(A,O)})})}be.of=function(){var g=t.call(arguments,0);return Wt().withMutations(function(m){for(var T=0;T<g.length;T+=2){if(T+1>=g.length)throw new Error("Missing value for key: "+g[T]);m.set(g[T],g[T+1])}})},be.prototype.toString=function(){return this.__toString("Map {","}")},be.prototype.get=function(g,m){return this._root?this._root.get(0,void 0,g,m):m},be.prototype.set=function(g,m){return lh(this,g,m)},be.prototype.setIn=function(g,m){return this.updateIn(g,E,function(){return m})},be.prototype.remove=function(g){return lh(this,g,E)},be.prototype.deleteIn=function(g){return this.updateIn(g,function(){return E})},be.prototype.update=function(g,m,T){return arguments.length===1?g(this):this.updateIn([g],m,T)},be.prototype.updateIn=function(g,m,T){T||(T=m,m=void 0);var O=hh(this,xh(g),m,T);return O===E?void 0:O},be.prototype.clear=function(){return this.size===0?this:this.__ownerID?(this.size=0,this._root=null,this.__hash=void 0,this.__altered=!0,this):Wt()},be.prototype.merge=function(){return rs(this,void 0,arguments)},be.prototype.mergeWith=function(g){var m=t.call(arguments,1);return rs(this,g,m)},be.prototype.mergeIn=function(g){var m=t.call(arguments,1);return this.updateIn(g,Wt(),function(T){return typeof T.merge=="function"?T.merge.apply(T,m):m[m.length-1]})},be.prototype.mergeDeep=function(){return rs(this,dh,arguments)},be.prototype.mergeDeepWith=function(g){var m=t.call(arguments,1);return rs(this,fh(g),m)},be.prototype.mergeDeepIn=function(g){var m=t.call(arguments,1);return this.updateIn(g,Wt(),function(T){return typeof T.mergeDeep=="function"?T.mergeDeep.apply(T,m):m[m.length-1]})},be.prototype.sort=function(g){return We(wn(this,g))},be.prototype.sortBy=function(g,m){return We(wn(this,m,g))},be.prototype.withMutations=function(g){var m=this.asMutable();return g(m),m.wasAltered()?m.__ensureOwner(this.__ownerID):this},be.prototype.asMutable=function(){return this.__ownerID?this:this.__ensureOwner(new x)},be.prototype.asImmutable=function(){return this.__ensureOwner()},be.prototype.wasAltered=function(){return this.__altered},be.prototype.__iterator=function(g,m){return new iu(this,g,m)},be.prototype.__iterate=function(g,m){var T=this,O=0;return this._root&&this._root.iterate(function(A){return O++,g(A[1],A[0],T)},m),O},be.prototype.__ensureOwner=function(g){return g===this.__ownerID?this:g?ou(this.size,this._root,g,this.__hash):(this.__ownerID=g,this.__altered=!1,this)};function au(g){return!!(g&&g[sh])}be.isMap=au;var sh="@@__IMMUTABLE_MAP__@@",Se=be.prototype;Se[sh]=!0,Se[_]=Se.remove,Se.removeIn=Se.deleteIn;function _i(g,m){this.ownerID=g,this.entries=m}_i.prototype.get=function(g,m,T,O){for(var A=this.entries,k=0,C=A.length;k<C;k++)if(Re(T,A[k][0]))return A[k][1];return O},_i.prototype.update=function(g,m,T,O,A,k,C){for(var N=A===E,V=this.entries,K=0,re=V.length;K<re&&!Re(O,V[K][0]);K++);var le=K<re;if(le?V[K][1]===A:N)return this;if(F(C),(N||!le)&&F(k),!(N&&V.length===1)){if(!le&&!N&&V.length>=S_)return h_(g,V,O,A);var de=g&&g===this.ownerID,ve=de?V:w(V);return le?N?K===re-1?ve.pop():ve[K]=ve.pop():ve[K]=[O,A]:ve.push([O,A]),de?(this.entries=ve,this):new _i(g,ve)}};function Tn(g,m,T){this.ownerID=g,this.bitmap=m,this.nodes=T}Tn.prototype.get=function(g,m,T,O){m===void 0&&(m=Et(T));var A=1<<((g===0?m:m>>>g)&I),k=this.bitmap;return k&A?this.nodes[yh(k&A-1)].get(g+S,m,T,O):O},Tn.prototype.update=function(g,m,T,O,A,k,C){T===void 0&&(T=Et(O));var N=(m===0?T:T>>>m)&I,V=1<<N,K=this.bitmap,re=(K&V)!==0;if(!re&&A===E)return this;var le=yh(K&V-1),de=this.nodes,ve=re?de[le]:void 0,_e=uu(ve,g,m+S,T,O,A,k,C);if(_e===ve)return this;if(!re&&_e&&de.length>=P_)return v_(g,de,K,N,_e);if(re&&!_e&&de.length===2&&ch(de[le^1]))return de[le^1];if(re&&_e&&de.length===1&&ch(_e))return _e;var Ce=g&&g===this.ownerID,$t=re?_e?K:K^V:K|V,Qt=re?_e?vh(de,le,_e,Ce):__(de,le,Ce):g_(de,le,_e,Ce);return Ce?(this.bitmap=$t,this.nodes=Qt,this):new Tn(g,$t,Qt)};function Si(g,m,T){this.ownerID=g,this.count=m,this.nodes=T}Si.prototype.get=function(g,m,T,O){m===void 0&&(m=Et(T));var A=(g===0?m:m>>>g)&I,k=this.nodes[A];return k?k.get(g+S,m,T,O):O},Si.prototype.update=function(g,m,T,O,A,k,C){T===void 0&&(T=Et(O));var N=(m===0?T:T>>>m)&I,V=A===E,K=this.nodes,re=K[N];if(V&&!re)return this;var le=uu(re,g,m+S,T,O,A,k,C);if(le===re)return this;var de=this.count;if(!re)de++;else if(!le&&(de--,de<I_))return y_(g,K,de,N);var ve=g&&g===this.ownerID,_e=vh(K,N,le,ve);return ve?(this.count=de,this.nodes=_e,this):new Si(g,de,_e)};function On(g,m,T){this.ownerID=g,this.keyHash=m,this.entries=T}On.prototype.get=function(g,m,T,O){for(var A=this.entries,k=0,C=A.length;k<C;k++)if(Re(T,A[k][0]))return A[k][1];return O},On.prototype.update=function(g,m,T,O,A,k,C){T===void 0&&(T=Et(O));var N=A===E;if(T!==this.keyHash)return N?this:(F(C),F(k),lu(this,g,m,T,[O,A]));for(var V=this.entries,K=0,re=V.length;K<re&&!Re(O,V[K][0]);K++);var le=K<re;if(le?V[K][1]===A:N)return this;if(F(C),(N||!le)&&F(k),N&&re===2)return new lr(g,this.keyHash,V[K^1]);var de=g&&g===this.ownerID,ve=de?V:w(V);return le?N?K===re-1?ve.pop():ve[K]=ve.pop():ve[K]=[O,A]:ve.push([O,A]),de?(this.entries=ve,this):new On(g,this.keyHash,ve)};function lr(g,m,T){this.ownerID=g,this.keyHash=m,this.entry=T}lr.prototype.get=function(g,m,T,O){return Re(T,this.entry[0])?this.entry[1]:O},lr.prototype.update=function(g,m,T,O,A,k,C){var N=A===E,V=Re(O,this.entry[0]);if(V?A===this.entry[1]:N)return this;if(F(C),N){F(k);return}return V?g&&g===this.ownerID?(this.entry[1]=A,this):new lr(g,this.keyHash,[O,A]):(F(k),lu(this,g,m,Et(O),[O,A]))},_i.prototype.iterate=On.prototype.iterate=function(g,m){for(var T=this.entries,O=0,A=T.length-1;O<=A;O++)if(g(T[m?A-O:O])===!1)return!1},Tn.prototype.iterate=Si.prototype.iterate=function(g,m){for(var T=this.nodes,O=0,A=T.length-1;O<=A;O++){var k=T[m?A-O:O];if(k&&k.iterate(g,m)===!1)return!1}},lr.prototype.iterate=function(g,m){return g(this.entry)},p(iu,ae);function iu(g,m,T){this._type=m,this._reverse=T,this._stack=g._root&&oh(g._root)}iu.prototype.next=function(){for(var g=this._type,m=this._stack;m;){var T=m.node,O=m.index++,A;if(T.entry){if(O===0)return su(g,T.entry)}else if(T.entries){if(A=T.entries.length-1,O<=A)return su(g,T.entries[this._reverse?A-O:O])}else if(A=T.nodes.length-1,O<=A){var k=T.nodes[this._reverse?A-O:O];if(k){if(k.entry)return su(g,k.entry);m=this._stack=oh(k,m)}continue}m=this._stack=this._stack.__prev}return ie()};function su(g,m){return se(g,m[0],m[1])}function oh(g,m){return{node:g,index:0,__prev:m}}function ou(g,m,T,O){var A=Object.create(Se);return A.size=g,A._root=m,A.__ownerID=T,A.__hash=O,A.__altered=!1,A}var uh;function Wt(){return uh||(uh=ou(0))}function lh(g,m,T){var O,A;if(g._root){var k=R(B),C=R(b);if(O=uu(g._root,g.__ownerID,0,void 0,m,T,k,C),!C.value)return g;A=g.size+(k.value?T===E?-1:1:0)}else{if(T===E)return g;A=1,O=new _i(g.__ownerID,[[m,T]])}return g.__ownerID?(g.size=A,g._root=O,g.__hash=void 0,g.__altered=!0,g):O?ou(A,O):Wt()}function uu(g,m,T,O,A,k,C,N){return g?g.update(m,T,O,A,k,C,N):k===E?g:(F(N),F(C),new lr(m,O,[A,k]))}function ch(g){return g.constructor===lr||g.constructor===On}function lu(g,m,T,O,A){if(g.keyHash===O)return new On(m,O,[g.entry,A]);var k=(T===0?g.keyHash:g.keyHash>>>T)&I,C=(T===0?O:O>>>T)&I,N,V=k===C?[lu(g,m,T+S,O,A)]:(N=new lr(m,O,A),k<C?[g,N]:[N,g]);return new Tn(m,1<<k|1<<C,V)}function h_(g,m,T,O){g||(g=new x);for(var A=new lr(g,Et(T),[T,O]),k=0;k<m.length;k++){var C=m[k];A=A.update(g,0,void 0,C[0],C[1])}return A}function y_(g,m,T,O){for(var A=0,k=0,C=new Array(T),N=0,V=1,K=m.length;N<K;N++,V<<=1){var re=m[N];re!==void 0&&N!==O&&(A|=V,C[k++]=re)}return new Tn(g,A,C)}function v_(g,m,T,O,A){for(var k=0,C=new Array(P),N=0;T!==0;N++,T>>>=1)C[N]=T&1?m[k++]:void 0;return C[O]=A,new Si(g,k+1,C)}function rs(g,m,T){for(var O=[],A=0;A<T.length;A++){var k=T[A],C=y(k);h(k)||(C=C.map(function(N){return mt(N)})),O.push(C)}return ph(g,m,O)}function dh(g,m,T){return g&&g.mergeDeep&&h(m)?g.mergeDeep(m):Re(g,m)?g:m}function fh(g){return function(m,T,O){if(m&&m.mergeDeepWith&&h(T))return m.mergeDeepWith(g,T);var A=g(m,T,O);return Re(m,A)?m:A}}function ph(g,m,T){return T=T.filter(function(O){return O.size!==0}),T.length===0?g:g.size===0&&!g.__ownerID&&T.length===1?g.constructor(T[0]):g.withMutations(function(O){for(var A=m?function(C,N){O.update(N,E,function(V){return V===E?C:m(V,C,N)})}:function(C,N){O.set(N,C)},k=0;k<T.length;k++)T[k].forEach(A)})}function hh(g,m,T,O){var A=g===E,k=m.next();if(k.done){var C=A?T:g,N=O(C);return N===C?g:N}He(A||g&&g.set,"invalid keyPath");var V=k.value,K=A?E:g.get(V,E),re=hh(K,m,T,O);return re===K?g:re===E?g.remove(V):(A?Wt():g).set(V,re)}function yh(g){return g=g-(g>>1&1431655765),g=(g&858993459)+(g>>2&858993459),g=g+(g>>4)&252645135,g=g+(g>>8),g=g+(g>>16),g&127}function vh(g,m,T,O){var A=O?g:w(g);return A[m]=T,A}function g_(g,m,T,O){var A=g.length+1;if(O&&m+1===A)return g[m]=T,g;for(var k=new Array(A),C=0,N=0;N<A;N++)N===m?(k[N]=T,C=-1):k[N]=g[N+C];return k}function __(g,m,T){var O=g.length-1;if(T&&m===O)return g.pop(),g;for(var A=new Array(O),k=0,C=0;C<O;C++)C===m&&(k=1),A[C]=g[C+k];return A}var S_=P/4,P_=P/2,I_=P/4;p(ke,Bn);function ke(g){var m=cu();if(g==null)return m;if(gh(g))return g;var T=s(g),O=T.size;return O===0?m:(Bt(O),O>0&&O<P?Ii(0,O,S,null,new Sr(T.toArray())):m.withMutations(function(A){A.setSize(O),T.forEach(function(k,C){return A.set(C,k)})}))}ke.of=function(){return this(arguments)},ke.prototype.toString=function(){return this.__toString("List [","]")},ke.prototype.get=function(g,m){if(g=D(this,g),g>=0&&g<this.size){g+=this._origin;var T=Ih(this,g);return T&&T.array[g&I]}return m},ke.prototype.set=function(g,m){return m_(this,g,m)},ke.prototype.remove=function(g){return this.has(g)?g===0?this.shift():g===this.size-1?this.pop():this.splice(g,1):this},ke.prototype.insert=function(g,m){return this.splice(g,0,m)},ke.prototype.clear=function(){return this.size===0?this:this.__ownerID?(this.size=this._origin=this._capacity=0,this._level=S,this._root=this._tail=null,this.__hash=void 0,this.__altered=!0,this):cu()},ke.prototype.push=function(){var g=arguments,m=this.size;return this.withMutations(function(T){Pr(T,0,m+g.length);for(var O=0;O<g.length;O++)T.set(m+O,g[O])})},ke.prototype.pop=function(){return Pr(this,0,-1)},ke.prototype.unshift=function(){var g=arguments;return this.withMutations(function(m){Pr(m,-g.length);for(var T=0;T<g.length;T++)m.set(T,g[T])})},ke.prototype.shift=function(){return Pr(this,1)},ke.prototype.merge=function(){return ns(this,void 0,arguments)},ke.prototype.mergeWith=function(g){var m=t.call(arguments,1);return ns(this,g,m)},ke.prototype.mergeDeep=function(){return ns(this,dh,arguments)},ke.prototype.mergeDeepWith=function(g){var m=t.call(arguments,1);return ns(this,fh(g),m)},ke.prototype.setSize=function(g){return Pr(this,0,g)},ke.prototype.slice=function(g,m){var T=this.size;return G(g,m,T)?this:Pr(this,q(g,T),z(m,T))},ke.prototype.__iterator=function(g,m){var T=0,O=Sh(this,m);return new ae(function(){var A=O();return A===Pi?ie():se(g,T++,A)})},ke.prototype.__iterate=function(g,m){for(var T=0,O=Sh(this,m),A;(A=O())!==Pi&&g(A,T++,this)!==!1;);return T},ke.prototype.__ensureOwner=function(g){return g===this.__ownerID?this:g?Ii(this._origin,this._capacity,this._level,this._root,this._tail,g,this.__hash):(this.__ownerID=g,this)};function gh(g){return!!(g&&g[_h])}ke.isList=gh;var _h="@@__IMMUTABLE_LIST__@@",ct=ke.prototype;ct[_h]=!0,ct[_]=ct.remove,ct.setIn=Se.setIn,ct.deleteIn=ct.removeIn=Se.removeIn,ct.update=Se.update,ct.updateIn=Se.updateIn,ct.mergeIn=Se.mergeIn,ct.mergeDeepIn=Se.mergeDeepIn,ct.withMutations=Se.withMutations,ct.asMutable=Se.asMutable,ct.asImmutable=Se.asImmutable,ct.wasAltered=Se.wasAltered;function Sr(g,m){this.array=g,this.ownerID=m}Sr.prototype.removeBefore=function(g,m,T){if(T===m?1<<m:this.array.length===0)return this;var O=T>>>m&I;if(O>=this.array.length)return new Sr([],g);var A=O===0,k;if(m>0){var C=this.array[O];if(k=C&&C.removeBefore(g,m-S,T),k===C&&A)return this}if(A&&!k)return this;var N=An(this,g);if(!A)for(var V=0;V<O;V++)N.array[V]=void 0;return k&&(N.array[O]=k),N},Sr.prototype.removeAfter=function(g,m,T){if(T===(m?1<<m:0)||this.array.length===0)return this;var O=T-1>>>m&I;if(O>=this.array.length)return this;var A;if(m>0){var k=this.array[O];if(A=k&&k.removeAfter(g,m-S,T),A===k&&O===this.array.length-1)return this}var C=An(this,g);return C.array.splice(O+1),A&&(C.array[O]=A),C};var Pi={};function Sh(g,m){var T=g._origin,O=g._capacity,A=mi(O),k=g._tail;return C(g._root,g._level,0);function C(K,re,le){return re===0?N(K,le):V(K,re,le)}function N(K,re){var le=re===A?k&&k.array:K&&K.array,de=re>T?0:T-re,ve=O-re;return ve>P&&(ve=P),function(){if(de===ve)return Pi;var _e=m?--ve:de++;return le&&le[_e]}}function V(K,re,le){var de,ve=K&&K.array,_e=le>T?0:T-le>>re,Ce=(O-le>>re)+1;return Ce>P&&(Ce=P),function(){do{if(de){var $t=de();if($t!==Pi)return $t;de=null}if(_e===Ce)return Pi;var Qt=m?--Ce:_e++;de=C(ve&&ve[Qt],re-S,le+(Qt<<re))}while(!0)}}}function Ii(g,m,T,O,A,k,C){var N=Object.create(ct);return N.size=m-g,N._origin=g,N._capacity=m,N._level=T,N._root=O,N._tail=A,N.__ownerID=k,N.__hash=C,N.__altered=!1,N}var Ph;function cu(){return Ph||(Ph=Ii(0,0,S))}function m_(g,m,T){if(m=D(g,m),m!==m)return g;if(m>=g.size||m<0)return g.withMutations(function(C){m<0?Pr(C,m).set(0,T):Pr(C,0,m+1).set(m,T)});m+=g._origin;var O=g._tail,A=g._root,k=R(b);return m>=mi(g._capacity)?O=du(O,g.__ownerID,0,m,T,k):A=du(A,g.__ownerID,g._level,m,T,k),k.value?g.__ownerID?(g._root=A,g._tail=O,g.__hash=void 0,g.__altered=!0,g):Ii(g._origin,g._capacity,g._level,A,O):g}function du(g,m,T,O,A,k){var C=O>>>T&I,N=g&&C<g.array.length;if(!N&&A===void 0)return g;var V;if(T>0){var K=g&&g.array[C],re=du(K,m,T-S,O,A,k);return re===K?g:(V=An(g,m),V.array[C]=re,V)}return N&&g.array[C]===A?g:(F(k),V=An(g,m),A===void 0&&C===V.array.length-1?V.array.pop():V.array[C]=A,V)}function An(g,m){return m&&g&&m===g.ownerID?g:new Sr(g?g.array.slice():[],m)}function Ih(g,m){if(m>=mi(g._capacity))return g._tail;if(m<1<<g._level+S){for(var T=g._root,O=g._level;T&&O>0;)T=T.array[m>>>O&I],O-=S;return T}}function Pr(g,m,T){m!==void 0&&(m=m|0),T!==void 0&&(T=T|0);var O=g.__ownerID||new x,A=g._origin,k=g._capacity,C=A+m,N=T===void 0?k:T<0?k+T:A+T;if(C===A&&N===k)return g;if(C>=N)return g.clear();for(var V=g._level,K=g._root,re=0;C+re<0;)K=new Sr(K&&K.array.length?[void 0,K]:[],O),V+=S,re+=1<<V;re&&(C+=re,A+=re,N+=re,k+=re);for(var le=mi(k),de=mi(N);de>=1<<V+S;)K=new Sr(K&&K.array.length?[K]:[],O),V+=S;var ve=g._tail,_e=de<le?Ih(g,N-1):de>le?new Sr([],O):ve;if(ve&&de>le&&C<k&&ve.array.length){K=An(K,O);for(var Ce=K,$t=V;$t>S;$t-=S){var Qt=le>>>$t&I;Ce=Ce.array[Qt]=An(Ce.array[Qt],O)}Ce.array[le>>>S&I]=ve}if(N<k&&(_e=_e&&_e.removeAfter(O,0,N)),C>=de)C-=de,N-=de,V=S,K=null,_e=_e&&_e.removeBefore(O,0,C);else if(C>A||de<le){for(re=0;K;){var cs=C>>>V&I;if(cs!==de>>>V&I)break;cs&&(re+=(1<<V)*cs),V-=S,K=K.array[cs]}K&&C>A&&(K=K.removeBefore(O,V,C-re)),K&&de<le&&(K=K.removeAfter(O,V,de-re)),re&&(C-=re,N-=re)}return g.__ownerID?(g.size=N-C,g._origin=C,g._capacity=N,g._level=V,g._root=K,g._tail=_e,g.__hash=void 0,g.__altered=!0,g):Ii(C,N,V,K,_e)}function ns(g,m,T){for(var O=[],A=0,k=0;k<T.length;k++){var C=T[k],N=s(C);N.size>A&&(A=N.size),h(C)||(N=N.map(function(V){return mt(V)})),O.push(N)}return A>g.size&&(g=g.setSize(A)),ph(g,m,O)}function mi(g){return g<P?0:g-1>>>S<<S}p(We,be);function We(g){return g==null?as():mh(g)?g:as().withMutations(function(m){var T=y(g);Bt(T.size),T.forEach(function(O,A){return m.set(A,O)})})}We.of=function(){return this(arguments)},We.prototype.toString=function(){return this.__toString("OrderedMap {","}")},We.prototype.get=function(g,m){var T=this._map.get(g);return T!==void 0?this._list.get(T)[1]:m},We.prototype.clear=function(){return this.size===0?this:this.__ownerID?(this.size=0,this._map.clear(),this._list.clear(),this):as()},We.prototype.set=function(g,m){return Eh(this,g,m)},We.prototype.remove=function(g){return Eh(this,g,E)},We.prototype.wasAltered=function(){return this._map.wasAltered()||this._list.wasAltered()},We.prototype.__iterate=function(g,m){var T=this;return this._list.__iterate(function(O){return O&&g(O[1],O[0],T)},m)},We.prototype.__iterator=function(g,m){return this._list.fromEntrySeq().__iterator(g,m)},We.prototype.__ensureOwner=function(g){if(g===this.__ownerID)return this;var m=this._map.__ensureOwner(g),T=this._list.__ensureOwner(g);return g?fu(m,T,g,this.__hash):(this.__ownerID=g,this._map=m,this._list=T,this)};function mh(g){return au(g)&&r(g)}We.isOrderedMap=mh,We.prototype[f]=!0,We.prototype[_]=We.prototype.remove;function fu(g,m,T,O){var A=Object.create(We.prototype);return A.size=g?g.size:0,A._map=g,A._list=m,A.__ownerID=T,A.__hash=O,A}var bh;function as(){return bh||(bh=fu(Wt(),cu()))}function Eh(g,m,T){var O=g._map,A=g._list,k=O.get(m),C=k!==void 0,N,V;if(T===E){if(!C)return g;A.size>=P&&A.size>=O.size*2?(V=A.filter(function(K,re){return K!==void 0&&k!==re}),N=V.toKeyedSeq().map(function(K){return K[0]}).flip().toMap(),g.__ownerID&&(N.__ownerID=V.__ownerID=g.__ownerID)):(N=O.remove(m),V=k===A.size-1?A.pop():A.set(k,void 0))}else if(C){if(T===A.get(k)[1])return g;N=O,V=A.set(k,[m,T])}else N=O.set(m,A.size),V=A.set(A.size,[m,T]);return g.__ownerID?(g.size=N.size,g._map=N,g._list=V,g.__hash=void 0,g):fu(N,V)}p(Dt,Q);function Dt(g,m){this._iter=g,this._useKeys=m,this.size=g.size}Dt.prototype.get=function(g,m){return this._iter.get(g,m)},Dt.prototype.has=function(g){return this._iter.has(g)},Dt.prototype.valueSeq=function(){return this._iter.valueSeq()},Dt.prototype.reverse=function(){var g=this,m=pu(this,!0);return this._useKeys||(m.valueSeq=function(){return g._iter.toSeq().reverse()}),m},Dt.prototype.map=function(g,m){var T=this,O=Th(this,g,m);return this._useKeys||(O.valueSeq=function(){return T._iter.toSeq().map(g,m)}),O},Dt.prototype.__iterate=function(g,m){var T=this,O;return this._iter.__iterate(this._useKeys?function(A,k){return g(A,k,T)}:(O=m?wh(this):0,function(A){return g(A,m?--O:O++,T)}),m)},Dt.prototype.__iterator=function(g,m){if(this._useKeys)return this._iter.__iterator(g,m);var T=this._iter.__iterator(ee,m),O=m?wh(this):0;return new ae(function(){var A=T.next();return A.done?A:se(g,m?--O:O++,A.value,A)})},Dt.prototype[f]=!0,p(Rn,oe);function Rn(g){this._iter=g,this.size=g.size}Rn.prototype.includes=function(g){return this._iter.includes(g)},Rn.prototype.__iterate=function(g,m){var T=this,O=0;return this._iter.__iterate(function(A){return g(A,O++,T)},m)},Rn.prototype.__iterator=function(g,m){var T=this._iter.__iterator(ee,m),O=0;return new ae(function(){var A=T.next();return A.done?A:se(g,O++,A.value,A)})},p(Fn,pe);function Fn(g){this._iter=g,this.size=g.size}Fn.prototype.has=function(g){return this._iter.includes(g)},Fn.prototype.__iterate=function(g,m){var T=this;return this._iter.__iterate(function(O){return g(O,O,T)},m)},Fn.prototype.__iterator=function(g,m){var T=this._iter.__iterator(ee,m);return new ae(function(){var O=T.next();return O.done?O:se(g,O.value,O.value,O)})},p(kn,Q);function kn(g){this._iter=g,this.size=g.size}kn.prototype.entrySeq=function(){return this._iter.toSeq()},kn.prototype.__iterate=function(g,m){var T=this;return this._iter.__iterate(function(O){if(O){kh(O);var A=h(O);return g(A?O.get(1):O[1],A?O.get(0):O[0],T)}},m)},kn.prototype.__iterator=function(g,m){var T=this._iter.__iterator(ee,m);return new ae(function(){for(;;){var O=T.next();if(O.done)return O;var A=O.value;if(A){kh(A);var k=h(A);return se(g,k?A.get(0):A[0],k?A.get(1):A[1],O)}}})},Rn.prototype.cacheResult=Dt.prototype.cacheResult=Fn.prototype.cacheResult=kn.prototype.cacheResult=vu;function Bh(g){var m=Kt(g);return m._iter=g,m.size=g.size,m.flip=function(){return g},m.reverse=function(){var T=g.reverse.apply(this);return T.flip=function(){return g.reverse()},T},m.has=function(T){return g.includes(T)},m.includes=function(T){return g.has(T)},m.cacheResult=vu,m.__iterateUncached=function(T,O){var A=this;return g.__iterate(function(k,C){return T(C,k,A)!==!1},O)},m.__iteratorUncached=function(T,O){if(T===$){var A=g.__iterator(T,O);return new ae(function(){var k=A.next();if(!k.done){var C=k.value[0];k.value[0]=k.value[1],k.value[1]=C}return k})}return g.__iterator(T===ee?ue:ee,O)},m}function Th(g,m,T){var O=Kt(g);return O.size=g.size,O.has=function(A){return g.has(A)},O.get=function(A,k){var C=g.get(A,E);return C===E?k:m.call(T,C,A,g)},O.__iterateUncached=function(A,k){var C=this;return g.__iterate(function(N,V,K){return A(m.call(T,N,V,K),V,C)!==!1},k)},O.__iteratorUncached=function(A,k){var C=g.__iterator($,k);return new ae(function(){var N=C.next();if(N.done)return N;var V=N.value,K=V[0];return se(A,K,m.call(T,V[1],K,g),N)})},O}function pu(g,m){var T=Kt(g);return T._iter=g,T.size=g.size,T.reverse=function(){return g},g.flip&&(T.flip=function(){var O=Bh(g);return O.reverse=function(){return g.flip()},O}),T.get=function(O,A){return g.get(m?O:-1-O,A)},T.has=function(O){return g.has(m?O:-1-O)},T.includes=function(O){return g.includes(O)},T.cacheResult=vu,T.__iterate=function(O,A){var k=this;return g.__iterate(function(C,N){return O(C,N,k)},!A)},T.__iterator=function(O,A){return g.__iterator(O,!A)},T}function Oh(g,m,T,O){var A=Kt(g);return O&&(A.has=function(k){var C=g.get(k,E);return C!==E&&!!m.call(T,C,k,g)},A.get=function(k,C){var N=g.get(k,E);return N!==E&&m.call(T,N,k,g)?N:C}),A.__iterateUncached=function(k,C){var N=this,V=0;return g.__iterate(function(K,re,le){if(m.call(T,K,re,le))return V++,k(K,O?re:V-1,N)},C),V},A.__iteratorUncached=function(k,C){var N=g.__iterator($,C),V=0;return new ae(function(){for(;;){var K=N.next();if(K.done)return K;var re=K.value,le=re[0],de=re[1];if(m.call(T,de,le,g))return se(k,O?le:V++,de,K)}})},A}function b_(g,m,T){var O=be().asMutable();return g.__iterate(function(A,k){O.update(m.call(T,A,k,g),0,function(C){return C+1})}),O.asImmutable()}function E_(g,m,T){var O=v(g),A=(r(g)?We():be()).asMutable();g.__iterate(function(C,N){A.update(m.call(T,C,N,g),function(V){return V=V||[],V.push(O?[N,C]:C),V})});var k=Ch(g);return A.map(function(C){return Fe(g,k(C))})}function hu(g,m,T,O){var A=g.size;if(m!==void 0&&(m=m|0),T!==void 0&&(T===1/0?T=A:T=T|0),G(m,T,A))return g;var k=q(m,A),C=z(T,A);if(k!==k||C!==C)return hu(g.toSeq().cacheResult(),m,T,O);var N=C-k,V;N===N&&(V=N<0?0:N);var K=Kt(g);return K.size=V===0?V:g.size&&V||void 0,!O&&st(g)&&V>=0&&(K.get=function(re,le){return re=D(this,re),re>=0&&re<V?g.get(re+k,le):le}),K.__iterateUncached=function(re,le){var de=this;if(V===0)return 0;if(le)return this.cacheResult().__iterate(re,le);var ve=0,_e=!0,Ce=0;return g.__iterate(function($t,Qt){if(!(_e&&(_e=ve++<k)))return Ce++,re($t,O?Qt:Ce-1,de)!==!1&&Ce!==V}),Ce},K.__iteratorUncached=function(re,le){if(V!==0&&le)return this.cacheResult().__iterator(re,le);var de=V!==0&&g.__iterator(re,le),ve=0,_e=0;return new ae(function(){for(;ve++<k;)de.next();if(++_e>V)return ie();var Ce=de.next();return O||re===ee?Ce:re===ue?se(re,_e-1,void 0,Ce):se(re,_e-1,Ce.value[1],Ce)})},K}function B_(g,m,T){var O=Kt(g);return O.__iterateUncached=function(A,k){var C=this;if(k)return this.cacheResult().__iterate(A,k);var N=0;return g.__iterate(function(V,K,re){return m.call(T,V,K,re)&&++N&&A(V,K,C)}),N},O.__iteratorUncached=function(A,k){var C=this;if(k)return this.cacheResult().__iterator(A,k);var N=g.__iterator($,k),V=!0;return new ae(function(){if(!V)return ie();var K=N.next();if(K.done)return K;var re=K.value,le=re[0],de=re[1];return m.call(T,de,le,C)?A===$?K:se(A,le,de,K):(V=!1,ie())})},O}function Ah(g,m,T,O){var A=Kt(g);return A.__iterateUncached=function(k,C){var N=this;if(C)return this.cacheResult().__iterate(k,C);var V=!0,K=0;return g.__iterate(function(re,le,de){if(!(V&&(V=m.call(T,re,le,de))))return K++,k(re,O?le:K-1,N)}),K},A.__iteratorUncached=function(k,C){var N=this;if(C)return this.cacheResult().__iterator(k,C);var V=g.__iterator($,C),K=!0,re=0;return new ae(function(){var le,de,ve;do{if(le=V.next(),le.done)return O||k===ee?le:k===ue?se(k,re++,void 0,le):se(k,re++,le.value[1],le);var _e=le.value;de=_e[0],ve=_e[1],K&&(K=m.call(T,ve,de,N))}while(K);return k===$?le:se(k,de,ve,le)})},A}function T_(g,m){var T=v(g),O=[g].concat(m).map(function(C){return h(C)?T&&(C=y(C)):C=T?ht(C):It(Array.isArray(C)?C:[C]),C}).filter(function(C){return C.size!==0});if(O.length===0)return g;if(O.length===1){var A=O[0];if(A===g||T&&v(A)||o(g)&&o(A))return A}var k=new Ie(O);return T?k=k.toKeyedSeq():o(g)||(k=k.toSetSeq()),k=k.flatten(!0),k.size=O.reduce(function(C,N){if(C!==void 0){var V=N.size;if(V!==void 0)return C+V}},0),k}function Rh(g,m,T){var O=Kt(g);return O.__iterateUncached=function(A,k){var C=0,N=!1;function V(K,re){var le=this;K.__iterate(function(de,ve){return(!m||re<m)&&h(de)?V(de,re+1):A(de,T?ve:C++,le)===!1&&(N=!0),!N},k)}return V(g,0),C},O.__iteratorUncached=function(A,k){var C=g.__iterator(A,k),N=[],V=0;return new ae(function(){for(;C;){var K=C.next();if(K.done!==!1){C=N.pop();continue}var re=K.value;if(A===$&&(re=re[1]),(!m||N.length<m)&&h(re))N.push(C),C=re.__iterator(A,k);else return T?K:se(A,V++,re,K)}return ie()})},O}function O_(g,m,T){var O=Ch(g);return g.toSeq().map(function(A,k){return O(m.call(T,A,k,g))}).flatten(!0)}function A_(g,m){var T=Kt(g);return T.size=g.size&&g.size*2-1,T.__iterateUncached=function(O,A){var k=this,C=0;return g.__iterate(function(N,V){return(!C||O(m,C++,k)!==!1)&&O(N,C++,k)!==!1},A),C},T.__iteratorUncached=function(O,A){var k=g.__iterator(ee,A),C=0,N;return new ae(function(){return(!N||C%2)&&(N=k.next(),N.done)?N:C%2?se(O,C++,m):se(O,C++,N.value,N)})},T}function wn(g,m,T){m||(m=Mh);var O=v(g),A=0,k=g.toSeq().map(function(C,N){return[N,C,A++,T?T(C,N,g):C]}).toArray();return k.sort(function(C,N){return m(C[3],N[3])||C[2]-N[2]}).forEach(O?function(C,N){k[N].length=2}:function(C,N){k[N]=C[1]}),O?Q(k):o(g)?oe(k):pe(k)}function is(g,m,T){if(m||(m=Mh),T){var O=g.toSeq().map(function(A,k){return[A,T(A,k,g)]}).reduce(function(A,k){return Fh(m,A[1],k[1])?k:A});return O&&O[0]}else return g.reduce(function(A,k){return Fh(m,A,k)?k:A})}function Fh(g,m,T){var O=g(T,m);return O===0&&T!==m&&(T==null||T!==T)||O>0}function yu(g,m,T){var O=Kt(g);return O.size=new Ie(T).map(function(A){return A.size}).min(),O.__iterate=function(A,k){for(var C=this.__iterator(ee,k),N,V=0;!(N=C.next()).done&&A(N.value,V++,this)!==!1;);return V},O.__iteratorUncached=function(A,k){var C=T.map(function(K){return K=d(K),te(k?K.reverse():K)}),N=0,V=!1;return new ae(function(){var K;return V||(K=C.map(function(re){return re.next()}),V=K.some(function(re){return re.done})),V?ie():se(A,N++,m.apply(null,K.map(function(re){return re.value})))})},O}function Fe(g,m){return st(g)?m:g.constructor(m)}function kh(g){if(g!==Object(g))throw new TypeError("Expected [K, V] tuple: "+g)}function wh(g){return Bt(g.size),L(g)}function Ch(g){return v(g)?y:o(g)?s:u}function Kt(g){return Object.create((v(g)?Q:o(g)?oe:pe).prototype)}function vu(){return this._iter.cacheResult?(this._iter.cacheResult(),this.size=this._iter.size,this):H.prototype.cacheResult.call(this)}function Mh(g,m){return g>m?1:g<m?-1:0}function xh(g){var m=te(g);if(!m){if(!M(g))throw new TypeError("Expected iterable or array-like: "+g);m=te(d(g))}return m}p(Tt,_r);function Tt(g,m){var T,O=function(C){if(C instanceof O)return C;if(!(this instanceof O))return new O(C);if(!T){T=!0;var N=Object.keys(g);R_(A,N),A.size=N.length,A._name=m,A._keys=N,A._defaultValues=g}this._map=be(C)},A=O.prototype=Object.create(Xe);return A.constructor=O,O}Tt.prototype.toString=function(){return this.__toString(Lh(this)+" {","}")},Tt.prototype.has=function(g){return this._defaultValues.hasOwnProperty(g)},Tt.prototype.get=function(g,m){if(!this.has(g))return m;var T=this._defaultValues[g];return this._map?this._map.get(g,T):T},Tt.prototype.clear=function(){if(this.__ownerID)return this._map&&this._map.clear(),this;var g=this.constructor;return g._empty||(g._empty=ss(this,Wt()))},Tt.prototype.set=function(g,m){if(!this.has(g))throw new Error('Cannot set unknown key "'+g+'" on '+Lh(this));if(this._map&&!this._map.has(g)){var T=this._defaultValues[g];if(m===T)return this}var O=this._map&&this._map.set(g,m);return this.__ownerID||O===this._map?this:ss(this,O)},Tt.prototype.remove=function(g){if(!this.has(g))return this;var m=this._map&&this._map.remove(g);return this.__ownerID||m===this._map?this:ss(this,m)},Tt.prototype.wasAltered=function(){return this._map.wasAltered()},Tt.prototype.__iterator=function(g,m){var T=this;return y(this._defaultValues).map(function(O,A){return T.get(A)}).__iterator(g,m)},Tt.prototype.__iterate=function(g,m){var T=this;return y(this._defaultValues).map(function(O,A){return T.get(A)}).__iterate(g,m)},Tt.prototype.__ensureOwner=function(g){if(g===this.__ownerID)return this;var m=this._map&&this._map.__ensureOwner(g);return g?ss(this,m,g):(this.__ownerID=g,this._map=m,this)};var Xe=Tt.prototype;Xe[_]=Xe.remove,Xe.deleteIn=Xe.removeIn=Se.removeIn,Xe.merge=Se.merge,Xe.mergeWith=Se.mergeWith,Xe.mergeIn=Se.mergeIn,Xe.mergeDeep=Se.mergeDeep,Xe.mergeDeepWith=Se.mergeDeepWith,Xe.mergeDeepIn=Se.mergeDeepIn,Xe.setIn=Se.setIn,Xe.update=Se.update,Xe.updateIn=Se.updateIn,Xe.withMutations=Se.withMutations,Xe.asMutable=Se.asMutable,Xe.asImmutable=Se.asImmutable;function ss(g,m,T){var O=Object.create(Object.getPrototypeOf(g));return O._map=m,O.__ownerID=T,O}function Lh(g){return g._name||g.constructor.name||"Record"}function R_(g,m){try{m.forEach(F_.bind(void 0,g))}catch{}}function F_(g,m){Object.defineProperty(g,m,{get:function(){return this.get(m)},set:function(T){He(this.__ownerID,"Cannot set on an immutable record."),this.set(m,T)}})}p(we,ts);function we(g){return g==null?Su():gu(g)&&!r(g)?g:Su().withMutations(function(m){var T=u(g);Bt(T.size),T.forEach(function(O){return m.add(O)})})}we.of=function(){return this(arguments)},we.fromKeys=function(g){return this(y(g).keySeq())},we.prototype.toString=function(){return this.__toString("Set {","}")},we.prototype.has=function(g){return this._map.has(g)},we.prototype.add=function(g){return _u(this,this._map.set(g,!0))},we.prototype.remove=function(g){return _u(this,this._map.remove(g))},we.prototype.clear=function(){return _u(this,this._map.clear())},we.prototype.union=function(){var g=t.call(arguments,0);return g=g.filter(function(m){return m.size!==0}),g.length===0?this:this.size===0&&!this.__ownerID&&g.length===1?this.constructor(g[0]):this.withMutations(function(m){for(var T=0;T<g.length;T++)u(g[T]).forEach(function(O){return m.add(O)})})},we.prototype.intersect=function(){var g=t.call(arguments,0);if(g.length===0)return this;g=g.map(function(T){return u(T)});var m=this;return this.withMutations(function(T){m.forEach(function(O){g.every(function(A){return A.includes(O)})||T.remove(O)})})},we.prototype.subtract=function(){var g=t.call(arguments,0);if(g.length===0)return this;g=g.map(function(T){return u(T)});var m=this;return this.withMutations(function(T){m.forEach(function(O){g.some(function(A){return A.includes(O)})&&T.remove(O)})})},we.prototype.merge=function(){return this.union.apply(this,arguments)},we.prototype.mergeWith=function(g){var m=t.call(arguments,1);return this.union.apply(this,m)},we.prototype.sort=function(g){return Jt(wn(this,g))},we.prototype.sortBy=function(g,m){return Jt(wn(this,m,g))},we.prototype.wasAltered=function(){return this._map.wasAltered()},we.prototype.__iterate=function(g,m){var T=this;return this._map.__iterate(function(O,A){return g(A,A,T)},m)},we.prototype.__iterator=function(g,m){return this._map.map(function(T,O){return O}).__iterator(g,m)},we.prototype.__ensureOwner=function(g){if(g===this.__ownerID)return this;var m=this._map.__ensureOwner(g);return g?this.__make(m,g):(this.__ownerID=g,this._map=m,this)};function gu(g){return!!(g&&g[Dh])}we.isSet=gu;var Dh="@@__IMMUTABLE_SET__@@",Ot=we.prototype;Ot[Dh]=!0,Ot[_]=Ot.remove,Ot.mergeDeep=Ot.merge,Ot.mergeDeepWith=Ot.mergeWith,Ot.withMutations=Se.withMutations,Ot.asMutable=Se.asMutable,Ot.asImmutable=Se.asImmutable,Ot.__empty=Su,Ot.__make=Gh;function _u(g,m){return g.__ownerID?(g.size=m.size,g._map=m,g):m===g._map?g:m.size===0?g.__empty():g.__make(m)}function Gh(g,m){var T=Object.create(Ot);return T.size=g?g.size:0,T._map=g,T.__ownerID=m,T}var Hh;function Su(){return Hh||(Hh=Gh(Wt()))}p(Jt,we);function Jt(g){return g==null?Pu():Nh(g)?g:Pu().withMutations(function(m){var T=u(g);Bt(T.size),T.forEach(function(O){return m.add(O)})})}Jt.of=function(){return this(arguments)},Jt.fromKeys=function(g){return this(y(g).keySeq())},Jt.prototype.toString=function(){return this.__toString("OrderedSet {","}")};function Nh(g){return gu(g)&&r(g)}Jt.isOrderedSet=Nh;var os=Jt.prototype;os[f]=!0,os.__empty=Pu,os.__make=jh;function jh(g,m){var T=Object.create(os);return T.size=g?g.size:0,T._map=g,T.__ownerID=m,T}var qh;function Pu(){return qh||(qh=jh(as()))}p(Ve,Bn);function Ve(g){return g==null?Iu():Uh(g)?g:Iu().unshiftAll(g)}Ve.of=function(){return this(arguments)},Ve.prototype.toString=function(){return this.__toString("Stack [","]")},Ve.prototype.get=function(g,m){var T=this._head;for(g=D(this,g);T&&g--;)T=T.next;return T?T.value:m},Ve.prototype.peek=function(){return this._head&&this._head.value},Ve.prototype.push=function(){if(arguments.length===0)return this;for(var g=this.size+arguments.length,m=this._head,T=arguments.length-1;T>=0;T--)m={value:arguments[T],next:m};return this.__ownerID?(this.size=g,this._head=m,this.__hash=void 0,this.__altered=!0,this):bi(g,m)},Ve.prototype.pushAll=function(g){if(g=s(g),g.size===0)return this;Bt(g.size);var m=this.size,T=this._head;return g.reverse().forEach(function(O){m++,T={value:O,next:T}}),this.__ownerID?(this.size=m,this._head=T,this.__hash=void 0,this.__altered=!0,this):bi(m,T)},Ve.prototype.pop=function(){return this.slice(1)},Ve.prototype.unshift=function(){return this.push.apply(this,arguments)},Ve.prototype.unshiftAll=function(g){return this.pushAll(g)},Ve.prototype.shift=function(){return this.pop.apply(this,arguments)},Ve.prototype.clear=function(){return this.size===0?this:this.__ownerID?(this.size=0,this._head=void 0,this.__hash=void 0,this.__altered=!0,this):Iu()},Ve.prototype.slice=function(g,m){if(G(g,m,this.size))return this;var T=q(g,this.size),O=z(m,this.size);if(O!==this.size)return Bn.prototype.slice.call(this,g,m);for(var A=this.size-T,k=this._head;T--;)k=k.next;return this.__ownerID?(this.size=A,this._head=k,this.__hash=void 0,this.__altered=!0,this):bi(A,k)},Ve.prototype.__ensureOwner=function(g){return g===this.__ownerID?this:g?bi(this.size,this._head,g,this.__hash):(this.__ownerID=g,this.__altered=!1,this)},Ve.prototype.__iterate=function(g,m){if(m)return this.reverse().__iterate(g);for(var T=0,O=this._head;O&&g(O.value,T++,this)!==!1;)O=O.next;return T},Ve.prototype.__iterator=function(g,m){if(m)return this.reverse().__iterator(g);var T=0,O=this._head;return new ae(function(){if(O){var A=O.value;return O=O.next,se(g,T++,A)}return ie()})};function Uh(g){return!!(g&&g[Wh])}Ve.isStack=Uh;var Wh="@@__IMMUTABLE_STACK__@@",Cn=Ve.prototype;Cn[Wh]=!0,Cn.withMutations=Se.withMutations,Cn.asMutable=Se.asMutable,Cn.asImmutable=Se.asImmutable,Cn.wasAltered=Se.wasAltered;function bi(g,m,T,O){var A=Object.create(Cn);return A.size=g,A._head=m,A.__ownerID=T,A.__hash=O,A.__altered=!1,A}var $h;function Iu(){return $h||($h=bi(0))}function Yt(g,m){var T=function(O){g.prototype[O]=m[O]};return Object.keys(m).forEach(T),Object.getOwnPropertySymbols&&Object.getOwnPropertySymbols(m).forEach(T),g}d.Iterator=ae,Yt(d,{toArray:function(){Bt(this.size);var g=new Array(this.size||0);return this.valueSeq().__iterate(function(m,T){g[T]=m}),g},toIndexedSeq:function(){return new Rn(this)},toJS:function(){return this.toSeq().map(function(g){return g&&typeof g.toJS=="function"?g.toJS():g}).__toJS()},toJSON:function(){return this.toSeq().map(function(g){return g&&typeof g.toJSON=="function"?g.toJSON():g}).__toJS()},toKeyedSeq:function(){return new Dt(this,!0)},toMap:function(){return be(this.toKeyedSeq())},toObject:function(){Bt(this.size);var g={};return this.__iterate(function(m,T){g[T]=m}),g},toOrderedMap:function(){return We(this.toKeyedSeq())},toOrderedSet:function(){return Jt(v(this)?this.valueSeq():this)},toSet:function(){return we(v(this)?this.valueSeq():this)},toSetSeq:function(){return new Fn(this)},toSeq:function(){return o(this)?this.toIndexedSeq():v(this)?this.toKeyedSeq():this.toSetSeq()},toStack:function(){return Ve(v(this)?this.valueSeq():this)},toList:function(){return ke(v(this)?this.valueSeq():this)},toString:function(){return"[Iterable]"},__toString:function(g,m){return this.size===0?g+m:g+" "+this.toSeq().map(this.__toStringMapper).join(", ")+" "+m},concat:function(){var g=t.call(arguments,0);return Fe(this,T_(this,g))},includes:function(g){return this.some(function(m){return Re(m,g)})},entries:function(){return this.__iterator($)},every:function(g,m){Bt(this.size);var T=!0;return this.__iterate(function(O,A,k){if(!g.call(m,O,A,k))return T=!1,!1}),T},filter:function(g,m){return Fe(this,Oh(this,g,m,!0))},find:function(g,m,T){var O=this.findEntry(g,m);return O?O[1]:T},forEach:function(g,m){return Bt(this.size),this.__iterate(m?g.bind(m):g)},join:function(g){Bt(this.size),g=g!==void 0?""+g:",";var m="",T=!0;return this.__iterate(function(O){T?T=!1:m+=g,m+=O!=null?O.toString():""}),m},keys:function(){return this.__iterator(ue)},map:function(g,m){return Fe(this,Th(this,g,m))},reduce:function(g,m,T){Bt(this.size);var O,A;return arguments.length<2?A=!0:O=m,this.__iterate(function(k,C,N){A?(A=!1,O=k):O=g.call(T,O,k,C,N)}),O},reduceRight:function(g,m,T){var O=this.toKeyedSeq().reverse();return O.reduce.apply(O,arguments)},reverse:function(){return Fe(this,pu(this,!0))},slice:function(g,m){return Fe(this,hu(this,g,m,!0))},some:function(g,m){return!this.every(ls(g),m)},sort:function(g){return Fe(this,wn(this,g))},values:function(){return this.__iterator(ee)},butLast:function(){return this.slice(0,-1)},isEmpty:function(){return this.size!==void 0?this.size===0:!this.some(function(){return!0})},count:function(g,m){return L(g?this.toSeq().filter(g,m):this)},countBy:function(g,m){return b_(this,g,m)},equals:function(g){return zt(this,g)},entrySeq:function(){var g=this;if(g._cache)return new Ie(g._cache);var m=g.toSeq().map(w_).toIndexedSeq();return m.fromEntrySeq=function(){return g.toSeq()},m},filterNot:function(g,m){return this.filter(ls(g),m)},findEntry:function(g,m,T){var O=T;return this.__iterate(function(A,k,C){if(g.call(m,A,k,C))return O=[k,A],!1}),O},findKey:function(g,m){var T=this.findEntry(g,m);return T&&T[0]},findLast:function(g,m,T){return this.toKeyedSeq().reverse().find(g,m,T)},findLastEntry:function(g,m,T){return this.toKeyedSeq().reverse().findEntry(g,m,T)},findLastKey:function(g,m){return this.toKeyedSeq().reverse().findKey(g,m)},first:function(){return this.find(U)},flatMap:function(g,m){return Fe(this,O_(this,g,m))},flatten:function(g){return Fe(this,Rh(this,g,!0))},fromEntrySeq:function(){return new kn(this)},get:function(g,m){return this.find(function(T,O){return Re(O,g)},void 0,m)},getIn:function(g,m){for(var T=this,O=xh(g),A;!(A=O.next()).done;){var k=A.value;if(T=T&&T.get?T.get(k,E):E,T===E)return m}return T},groupBy:function(g,m){return E_(this,g,m)},has:function(g){return this.get(g,E)!==E},hasIn:function(g){return this.getIn(g,E)!==E},isSubset:function(g){return g=typeof g.includes=="function"?g:d(g),this.every(function(m){return g.includes(m)})},isSuperset:function(g){return g=typeof g.isSubset=="function"?g:d(g),g.isSubset(this)},keyOf:function(g){return this.findKey(function(m){return Re(m,g)})},keySeq:function(){return this.toSeq().map(k_).toIndexedSeq()},last:function(){return this.toSeq().reverse().first()},lastKeyOf:function(g){return this.toKeyedSeq().reverse().keyOf(g)},max:function(g){return is(this,g)},maxBy:function(g,m){return is(this,m,g)},min:function(g){return is(this,g?Vh(g):Kh)},minBy:function(g,m){return is(this,m?Vh(m):Kh,g)},rest:function(){return this.slice(1)},skip:function(g){return this.slice(Math.max(0,g))},skipLast:function(g){return Fe(this,this.toSeq().reverse().skip(g).reverse())},skipWhile:function(g,m){return Fe(this,Ah(this,g,m,!0))},skipUntil:function(g,m){return this.skipWhile(ls(g),m)},sortBy:function(g,m){return Fe(this,wn(this,m,g))},take:function(g){return this.slice(0,Math.max(0,g))},takeLast:function(g){return Fe(this,this.toSeq().reverse().take(g).reverse())},takeWhile:function(g,m){return Fe(this,B_(this,g,m))},takeUntil:function(g,m){return this.takeWhile(ls(g),m)},valueSeq:function(){return this.toIndexedSeq()},hashCode:function(){return this.__hash||(this.__hash=M_(this))}});var dt=d.prototype;dt[e]=!0,dt[J]=dt.values,dt.__toJS=dt.toArray,dt.__toStringMapper=zh,dt.inspect=dt.toSource=function(){return this.toString()},dt.chain=dt.flatMap,dt.contains=dt.includes,Yt(y,{flip:function(){return Fe(this,Bh(this))},mapEntries:function(g,m){var T=this,O=0;return Fe(this,this.toSeq().map(function(A,k){return g.call(m,[k,A],O++,T)}).fromEntrySeq())},mapKeys:function(g,m){var T=this;return Fe(this,this.toSeq().flip().map(function(O,A){return g.call(m,O,A,T)}).flip())}});var us=y.prototype;us[i]=!0,us[J]=dt.entries,us.__toJS=dt.toObject,us.__toStringMapper=function(g,m){return JSON.stringify(m)+": "+zh(g)},Yt(s,{toKeyedSeq:function(){return new Dt(this,!1)},filter:function(g,m){return Fe(this,Oh(this,g,m,!1))},findIndex:function(g,m){var T=this.findEntry(g,m);return T?T[0]:-1},indexOf:function(g){var m=this.keyOf(g);return m===void 0?-1:m},lastIndexOf:function(g){var m=this.lastKeyOf(g);return m===void 0?-1:m},reverse:function(){return Fe(this,pu(this,!1))},slice:function(g,m){return Fe(this,hu(this,g,m,!1))},splice:function(g,m){var T=arguments.length;if(m=Math.max(m|0,0),T===0||T===2&&!m)return this;g=q(g,g<0?this.count():this.size);var O=this.slice(0,g);return Fe(this,T===1?O:O.concat(w(arguments,2),this.slice(g+m)))},findLastIndex:function(g,m){var T=this.findLastEntry(g,m);return T?T[0]:-1},first:function(){return this.get(0)},flatten:function(g){return Fe(this,Rh(this,g,!1))},get:function(g,m){return g=D(this,g),g<0||this.size===1/0||this.size!==void 0&&g>this.size?m:this.find(function(T,O){return O===g},void 0,m)},has:function(g){return g=D(this,g),g>=0&&(this.size!==void 0?this.size===1/0||g<this.size:this.indexOf(g)!==-1)},interpose:function(g){return Fe(this,A_(this,g))},interleave:function(){var g=[this].concat(w(arguments)),m=yu(this.toSeq(),oe.of,g),T=m.flatten(!0);return m.size&&(T.size=m.size*g.length),Fe(this,T)},keySeq:function(){return De(0,this.size)},last:function(){return this.get(-1)},skipWhile:function(g,m){return Fe(this,Ah(this,g,m,!1))},zip:function(){var g=[this].concat(w(arguments));return Fe(this,yu(this,C_,g))},zipWith:function(g){var m=w(arguments);return m[0]=this,Fe(this,yu(this,g,m))}}),s.prototype[c]=!0,s.prototype[f]=!0,Yt(u,{get:function(g,m){return this.has(g)?g:m},includes:function(g){return this.has(g)},keySeq:function(){return this.valueSeq()}}),u.prototype.has=dt.includes,u.prototype.contains=u.prototype.includes,Yt(Q,y.prototype),Yt(oe,s.prototype),Yt(pe,u.prototype),Yt(_r,y.prototype),Yt(Bn,s.prototype),Yt(ts,u.prototype);function k_(g,m){return m}function w_(g,m){return[m,g]}function ls(g){return function(){return!g.apply(this,arguments)}}function Vh(g){return function(){return-g.apply(this,arguments)}}function zh(g){return typeof g=="string"?JSON.stringify(g):String(g)}function C_(){return w(arguments)}function Kh(g,m){return g<m?1:g>m?-1:0}function M_(g){if(g.size===1/0)return 0;var m=r(g),T=v(g),O=m?1:0,A=g.__iterate(T?m?function(k,C){O=31*O+Jh(Et(k),Et(C))|0}:function(k,C){O=O+Jh(Et(k),Et(C))|0}:m?function(k){O=31*O+Et(k)|0}:function(k){O=O+Et(k)|0});return x_(A,O)}function x_(g,m){return m=gi(m,3432918353),m=gi(m<<15|m>>>-15,461845907),m=gi(m<<13|m>>>-13,5),m=(m+3864292196|0)^g,m=gi(m^m>>>16,2246822507),m=gi(m^m>>>13,3266489909),m=Qo(m^m>>>16),m}function Jh(g,m){return g^m+2654435769+(g<<6)+(g>>2)|0}var L_={Iterable:d,Seq:H,Collection:yt,Map:be,OrderedMap:We,List:ke,Stack:Ve,Set:we,OrderedSet:Jt,Record:Tt,Range:De,Repeat:Le,is:Re,fromJS:mt};return L_})}(oo)),oo.exports}var $n={},Nc;function Oe(){if(Nc)return $n;Nc=1,Object.defineProperty($n,"__esModule",{value:!0}),$n.ImmutableState=void 0;var n=function(){function l(t){this.state=t,this._size=0}return Object.defineProperty(l.prototype,"nextEventOffset",{get:function(){return this.get("nextEventOffset")},enumerable:!1,configurable:!0}),l.prototype.newInstance=function(t){var p=this.constructor;return new p(t)},l.prototype.increment=function(t,p){return p===0?this:this.newInstance(this.state.updateIn([t],function(d){return(d||0)+p}))},l.prototype.incrementIn=function(t,p){return this.newInstance(this.state.updateIn(t,function(d){return(d||0)+p}))},l.prototype.deepSetSize=function(t,p,d){return d===void 0&&(d=void 0),this.updateIn(t,function(y){var s=y.size;return s===p?y:s>p||d===void 0?y.setSize(p):y.withMutations(function(u){for(var h=0;h<p-s;h++)u.push(d)})})},Object.defineProperty(l.prototype,"size",{get:function(){return this._size},enumerable:!1,configurable:!0}),l.prototype.set=function(t,p){return this.newInstance(this.state.set(t,p))},l.prototype.delete=function(t){return this.newInstance(this.state.delete(t))},l.prototype.remove=function(t){return this.newInstance(this.state.remove(t))},l.prototype.clear=function(){return this.newInstance(this.state.clear())},l.prototype.withMutations=function(t){return this.newInstance(this.state.withMutations(t))},l.prototype.asMutable=function(){return this.newInstance(this.state.asMutable())},l.prototype.asImmutable=function(){return this.newInstance(this.state.asImmutable())},l.prototype.equals=function(t){return this.state.equals(t)},l.prototype.hashCode=function(){return this.state.hashCode()},l.prototype.get=function(t,p){return this.state.get(t)},l.prototype.has=function(t){return this.state.has(t)},l.prototype.includes=function(t){return this.state.includes(t)},l.prototype.contains=function(t){return this.state.contains(t)},l.prototype.first=function(){return this.state.first()},l.prototype.last=function(){return this.state.last()},l.prototype.toJS=function(){return this.state.toJS()},l.prototype.toArray=function(){return this.state.toArray()},l.prototype.toObject=function(){return this.state.toObject()},l.prototype.toMap=function(){return this.state.toMap()},l.prototype.toOrderedMap=function(){return this.state.toOrderedMap()},l.prototype.toSet=function(){return this.state.toSet()},l.prototype.toOrderedSet=function(){return this.state.toOrderedSet()},l.prototype.toList=function(){return this.state.toList()},l.prototype.toStack=function(){return this.state.toStack()},l.prototype.toSeq=function(){return this.state.toSeq()},l.prototype.toKeyedSeq=function(){return this.state.toKeyedSeq()},l.prototype.toIndexedSeq=function(){return this.state.toIndexedSeq()},l.prototype.toSetSeq=function(){return this.state.toSetSeq()},l.prototype.keys=function(){return this.state.keys()},l.prototype.values=function(){return this.state.values()},l.prototype.entries=function(){return this.state.entries()},l.prototype.keySeq=function(){return this.state.keySeq()},l.prototype.valueSeq=function(){return this.state.valueSeq()},l.prototype.entrySeq=function(){return this.state.entrySeq()},l.prototype.map=function(t,p){return this.state.map(t,p)},l.prototype.filter=function(t,p){return this.state.filter(t,p)},l.prototype.filterNot=function(t,p){return this.state.filterNot(t,p)},l.prototype.reverse=function(){return this.state.reverse()},l.prototype.sort=function(t){return this.state.sort(t)},l.prototype.sortBy=function(t,p){return this.state.sortBy(t,p)},l.prototype.groupBy=function(t,p){return this.state.groupBy(t,p)},l.prototype.forEach=function(t,p){return this.state.forEach(t,p)},l.prototype.slice=function(t,p){return this.state.slice(t,p)},l.prototype.rest=function(){return this.rest()},l.prototype.butLast=function(){return this.state.butLast()},l.prototype.skip=function(t){return this.state.skip(t)},l.prototype.skipLast=function(t){return this.state.skipLast(t)},l.prototype.skipWhile=function(t,p){return this.state.skipWhile(t,p)},l.prototype.skipUntil=function(t,p){return this.state.skipUntil(t,p)},l.prototype.take=function(t){return this.state.take(t)},l.prototype.takeLast=function(t){return this.state.takeLast(t)},l.prototype.takeWhile=function(t,p){return this.state.takeWhile(t,p)},l.prototype.takeUntil=function(t,p){return this.state.takeUntil(t,p)},l.prototype.concat=function(){for(var t=[],p=0;p<arguments.length;p++)t[p]=arguments[p];return this.state.concat(t)},l.prototype.flatten=function(t,p){return t?this.state.flatten(t):this.state.flatten(p)},l.prototype.flatMap=function(t,p){return this.state.flatMap(t,p)},l.prototype.reduce=function(t,p,d){return this.state.reduce(t,p,d)},l.prototype.reduceRight=function(t,p,d){return this.state.reduceRight(t,p,d)},l.prototype.every=function(t,p){return this.state.every(t,p)},l.prototype.some=function(t,p){return this.state.some(t,p)},l.prototype.join=function(t){return this.state.join(t)},l.prototype.isEmpty=function(){return this.state.isEmpty()},l.prototype.count=function(t,p){return this.state.count(t,p)},l.prototype.countBy=function(t,p){return this.state.countBy(t,p)},l.prototype.find=function(t,p,d){return this.state.find(t,p,d)},l.prototype.findLast=function(t,p,d){return this.state.findLast(t,p,d)},l.prototype.findEntry=function(t,p,d){return this.state.findEntry(t,p,d)},l.prototype.findLastEntry=function(t,p,d){return this.state.findLastEntry(t,p,d)},l.prototype.findKey=function(t,p){return this.state.findKey(t,p)},l.prototype.findLastKey=function(t,p){return this.state.findLastKey(t,p)},l.prototype.keyOf=function(t){return this.state.keyOf(t)},l.prototype.lastKeyOf=function(t){return this.state.lastKeyOf(t)},l.prototype.max=function(t){return this.state.max(t)},l.prototype.maxBy=function(t,p){return this.state.maxBy(t,p)},l.prototype.min=function(t){return this.state.min(t)},l.prototype.minBy=function(t,p){return this.state.minBy(t,p)},l.prototype.isSubset=function(t){return this.state.isSubset(t)},l.prototype.isSuperset=function(t){return this.isSuperset(t)},l.prototype.hasIn=function(t){return this.state.hasIn(t)},l.prototype.getIn=function(t,p){return this.state.getIn(t,p)},l.prototype.update=function(t,p,d){return this.newInstance(this.state.update(t,p,d))},l.prototype.merge=function(t){return this.newInstance(this.state.merge(t))},l.prototype.mergeWith=function(t){return this.newInstance(this.state.mergeWith(t))},l.prototype.mergeDeep=function(t){return this.newInstance(this.state.mergeDeep(t))},l.prototype.mergeIn=function(t,p){return this.newInstance(this.state.mergeIn(t,p))},l.prototype.mergeDeepWith=function(t){return this.newInstance(this.state.mergeDeepWith(t))},l.prototype.mergeDeepIn=function(t,p){return this.newInstance(this.state.mergeDeepIn(t,p))},l.prototype.setIn=function(t,p){return this.newInstance(this.state.setIn(t,p))},l.prototype.deleteIn=function(t){return this.newInstance(this.state.deleteIn(t))},l.prototype.removeIn=function(t){return this.newInstance(this.state.removeIn(t))},l.prototype.updateIn=function(t,p,d){return this.newInstance(this.state.updateIn(t,p,d))},l.prototype.flip=function(){return this.state.flip()},l.prototype.mapKeys=function(t,p){return this.state.mapKeys(t,p)},l.prototype.mapEntries=function(t,p){return this.state.mapEntries(t,p)},l}();return $n.ImmutableState=n,$n}var ge={},uo={},jc;function Rt(){return jc||(jc=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.baseRunningPlayTypeConfigs=n.ballInPlayResultConfigs=n.PitchSpeedProvider=n.PitchResult=n.ReplaceRunnerFlavor=n.BaseballOffensiveLocation=n.BaseballOffensiveRole=void 0,function(l){l.Batter="batter",l.Runner="runner"}(n.BaseballOffensiveRole||(n.BaseballOffensiveRole={})),function(l){l.Batter="batter",l.RunnerOnFirst="runner_first",l.RunnerOnSecond="runner_second",l.RunnerOnThird="runner_third"}(n.BaseballOffensiveLocation||(n.BaseballOffensiveLocation={})),function(l){l.SpecialPinchRunner="special_pinch_runner",l.RetroactiveSubstitution="retroactive_sub"}(n.ReplaceRunnerFlavor||(n.ReplaceRunnerFlavor={})),function(l){l.Ball="ball",l.IntentionalBall="intentional_ball",l.StrikeSwinging="strike_swinging",l.StrikeLooking="strike_looking",l.Foul="foul",l.BallInPlay="ball_in_play",l.IllegalPitch="illegal_pitch",l.FoulTip="foul_tip",l.FoulBunt="foul_bunt"}(n.PitchResult||(n.PitchResult={})),function(l){l.POCKET_RADAR="pocket_radar",l.USER="user"}(n.PitchSpeedProvider||(n.PitchSpeedProvider={})),n.ballInPlayResultConfigs={single:{bases:1,batterOut:!1,error:!1},double:{bases:2,batterOut:!1,error:!1},triple:{bases:3,batterOut:!1,error:!1},home_run:{bases:4,batterOut:!1,error:!1},dropped_third_strike:{bases:1,batterOut:!1,error:!1},dropped_third_strike_batter_out:{bases:1,batterOut:!0,error:!1},fielders_choice:{bases:1,batterOut:!1,error:!1},error:{bases:1,batterOut:!1,error:!0},sacrifice_bunt:{bases:1,batterOut:!1,error:!1},sacrifice_fly:{bases:1,batterOut:!0,error:!1},sacrifice_bunt_error:{bases:1,batterOut:!1,error:!0},sacrifice_fly_error:{bases:1,batterOut:!1,error:!0},batter_out:{bases:0,batterOut:!0,error:!1},batter_out_advance_runners:{bases:1,batterOut:!0,error:!1},offensive_interference:{bases:0,batterOut:!0,error:!1},infield_fly:{bases:0,batterOut:!0,error:!1},other_out:{bases:0,batterOut:!0,error:!1},foul_tip_out:{bases:0,batterOut:!0,error:!1}},n.baseRunningPlayTypeConfigs={offensive_interference:{runnerOut:!0,error:!1},stole_base:{runnerOut:!1,error:!1},defensive_indifference:{runnerOut:!1,error:!1},passed_ball:{runnerOut:!1,error:!1},on_same_pitch:{runnerOut:!1,error:!1},wild_pitch:{runnerOut:!1,error:!1},attempted_pickoff:{runnerOut:!1,error:!1},fielders_choice_attempted_pickoff:{runnerOut:!1,error:!1},advanced_on_error:{runnerOut:!1,error:!0},on_same_error:{runnerOut:!1,error:!1},out_on_appeal:{runnerOut:!0,error:!1},caught_stealing:{runnerOut:!0,error:!1},other_out:{runnerOut:!0,error:!1},other_advance:{runnerOut:!1,error:!1},picked_off:{runnerOut:!0,error:!1},did_not_score:{runnerOut:!1,error:!1},advanced_on_last_play:{runnerOut:!1,error:!1},remained_on_last_play:{runnerOut:!1,error:!1},out_on_last_play:{runnerOut:!0,error:!1}}}(uo)),uo}var qc;function tt(){if(qc)return ge;qc=1,Object.defineProperty(ge,"__esModule",{value:!0}),ge.codeForEvent=ge.isGroundOutResult=ge.isGroundType=ge.isSacrificeResult=ge.isError=ge.isHitResult=ge.isHit=ge.isStrike=ge.isBaseRunningEvent=ge.isEndAtBatEvent=ge.isHomeRunEvent=ge.isBallInPlayEvent=ge.isPitchEvent=ge.isUniquePosition=ge.isMultiPosition=ge.manualInningAdvance=ge.changesInning=ge.eventRelatesToAtBatTeam=ge.baserunningUnrelatedToLastBIP=ge.baserunningRelatedToLastBIP=void 0;var n=X,l=n.__importStar(Pe),t=n.__importStar(Rt());function p(b){return i(b)&&l.contains(["advanced_on_last_play","remained_on_last_play","out_on_last_play","did_not_score"],b.attributes.playType)}ge.baserunningRelatedToLastBIP=p;function d(b){return i(b)&&!p(b)}ge.baserunningUnrelatedToLastBIP=d;function y(b){return l.contains(["pitch","ball_in_play","base_running","end_at_bat"],b.code)}ge.eventRelatesToAtBatTeam=y;function s(b){return b.attributes.inning!==void 0||b.attributes.half!==void 0}ge.changesInning=s;function u(b){return b.code==="end_half"||b.code==="override"&&s(b)}ge.manualInningAdvance=u;function h(b){return l.contains([void 0,"EH","DH"],b)}ge.isMultiPosition=h;function v(b){return!h(b)}ge.isUniquePosition=v;function o(b){return b.code==="pitch"}ge.isPitchEvent=o;function a(b){return b.code==="ball_in_play"}ge.isBallInPlayEvent=a;function r(b){return b.code==="ball_in_play"&&b.attributes.playResult==="home_run"}ge.isHomeRunEvent=r;function e(b){return b.code==="end_at_bat"}ge.isEndAtBatEvent=e;function i(b){return b.code==="base_running"}ge.isBaseRunningEvent=i;function c(b){var R=["strike_looking","strike_swinging","ball_in_play","foul","foul_tip","foul_bunt"];return o(b)&&l.contains(R,b.attributes.result)}ge.isStrike=c;function f(b){return b.code==="ball_in_play"&&_(b.attributes.playResult)}ge.isHit=f;function _(b){return l.contains(["single","double","triple","home_run"],b)}ge.isHitResult=_;function S(b){return b.code==="ball_in_play"&&t.ballInPlayResultConfigs[b.attributes.playResult].error||i(b)&&t.baseRunningPlayTypeConfigs[b.attributes.playType].error||b.code==="foul_error"?!0:!!(e(b)&&b.attributes.reason==="catcher_interference")}ge.isError=S;function P(b){return l.contains(["sacrifice_bunt","sacrifice_fly","sacrifice_bunt_error","sacrifice_fly_error"],b)}ge.isSacrificeResult=P;function I(b){return l.contains(["ground_ball","hard_ground_ball"],b)}ge.isGroundType=I;function E(b,R){return I(b)&&l.contains(["batter_out","batter_out_advance_runners"],R)||b==="bunt"&&R==="sacrifice_bunt"}ge.isGroundOutResult=E;function B(b){if(b!==void 0)return a(b)?b.attributes.playResult:i(b)?b.attributes.playType:b.code}return ge.codeForEvent=B,ge}var Uc;function Ry(){return Uc||(Uc=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.ActionContextEngine=n.ActionContextState=n.IllegalPitchState=void 0;var l=X,t=l.__importStar(Pe),p=l.__importStar(fe()),d=l.__importStar(Ee()),y=l.__importStar(Oe()),s=l.__importStar(tt()),u;(function(o){o.None="none",o.Ball="ball",o.BalkOne="balk_one",o.BalkMany="balk_many"})(u=n.IllegalPitchState||(n.IllegalPitchState={}));var h=function(o){l.__extends(a,o);function a(){return o!==null&&o.apply(this,arguments)||this}return a.prototype.pitchActionContext=function(r,e,i){var c=e.stateAfterEvent(this.nextEventOffset),f=i.stateAfterEvent(this.nextEventOffset).baserunners,_=i.stateAfterEvent(this.nextEventOffset).runnersOnBase,S;return r.enableIllegalPitch?_>1?S=u.BalkMany:_===1?S=u.BalkOne:S=u.Ball:S=u.None,{fieldersChoice:_>0,droppedThirdStrike:c.strikes===2&&(c.outs===2||f[1]===void 0),doublePlay:c.outs<2&&_>0,fieldersChoiceDoublePlay:_>=2&&c.outs<2,triplePlay:_>=2&&c.outs===0,fieldersChoiceTriplePlay:_===3&&c.outs===0,infieldFly:c.outs<2&&f[1]!==void 0&&f[2]!==void 0,sacrificeFly:c.outs<2&&f[3]!==void 0,sacrificeBunt:c.outs<2&&_>0,foulTip:c.strikes===2,balk:_>0&&r.sport==="baseball",placeBatter:c.strikes===0&&c.balls===0&&c.outs===0&&_===0,foulBuntBatterOut:c.strikes===2,illegalPitch:S}},a.prototype.eventWasErrorType=function(r){return!!(s.isBallInPlayEvent(r)&&t.contains(["sacrifice_bunt_error","sacrifice_fly_error","error"],r.attributes.playResult)||s.isEndAtBatEvent(r)&&r.attributes.reason==="catcher_interference"||s.isBaseRunningEvent(r)&&r.attributes.playType==="advanced_on_error"||r.code==="foul_error")},a.prototype.falseBIPFlags=function(){return{hit:!1,batterOut:!1,fieldersChoice:!1,sacrificeFly:!1,sacrificeBunt:!1,sacrificeBuntInclError:!1,sacrificeInclError:!1,sacrifice:!1,groundOut:!1,error:!1,droppedThirdStrike:!1,catchableOut:!1}},a.prototype.bipFlags=function(r,e){return{hit:s.isHitResult(r),batterOut:t.contains(["batter_out","batter_out_advance_runners"],r),fieldersChoice:r==="fielders_choice",sacrificeFly:r==="sacrifice_fly",sacrificeBunt:r==="sacrifice_bunt",sacrificeBuntInclError:t.contains(["sacrifice_bunt","sacrifice_bunt_error"],r),sacrificeInclError:s.isSacrificeResult(r),sacrifice:t.contains(["sacrifice_bunt","sacrifice_fly"],r),groundOut:s.isGroundOutResult(e,r),error:r==="error",droppedThirdStrike:t.contains(["dropped_third_strike","dropped_third_strike_batter_out"],r),catchableOut:t.contains(["batter_out","batter_out_advance_runners"],r)&&t.contains(["fly_ball","pop_fly","line_drive"],e)}},a.prototype.runnerSafeActionContext=function(r,e,i,c,f){var _=i.stateAfterEvent(this.nextEventOffset).baseForPlayer(c);if(_!==void 0){var S=e.stateAfterEvent(this.get("lastPrimaryEventIndex")),P=this.get("playInProgress"),I=r[this.get("lastBaseballEventIndex")],E=r[this.get("lastPrimaryEventIndex")],B=this.eventWasErrorType(E),b=this.get("lastBatterId"),R=this.falseBIPFlags();if(s.isBallInPlayEvent(E)){var F=[E.attributes.playResult,E.attributes.playType],x=F[0],w=F[1];R=this.bipFlags(x,w)}var L=[!1,!1,!1],D=L[0],U=L[1],G=L[2];s.isPitchEvent(E)&&(D=t.contains(["strike_swinging","strike_looking","ball","intentional_ball"],E.attributes.result)),U=S.lastEventWasStrikeout||S.lastEventWasWalk,G=P&&s.isBaseRunningEvent(E)&&E.attributes.playType==="advanced_on_error"&&f>_,G=G||B&&c===b&&f>_;var q=G;return q=q||B&&c!==b&&f>_,q=q||P&&s.isBaseRunningEvent(I)&&I.attributes.playType==="advanced_on_error"&&c!==b&&f>_,{attemptedPickoff:f===_,stoleBase:f>_,defensiveIndifference:f>_&&f!==4,onThrow:!B&&f>_&&(P||R.hit||R.fieldersChoice||R.sacrificeFly),throwingError:!P&&c===b&&f>_,onLastPlay:c!==b&&f>_&&(R.hit||R.fieldersChoice||R.sacrifice||R.droppedThirdStrike||R.error||R.groundOut),taggedUp:c!==b&&f>_&&R.catchableOut,onSamePitch:c!==b&&P&&f>_&&(D||U),wildPitch:c!==b&&!P&&f>_&&(D||U),passedBall:c!==b&&!P&&f>_&&(D||U),onSameError:G,onDifferentError:q,fieldingError:!B&&!(s.isBaseRunningEvent(I)&&I.attributes.playType==="advanced_on_error")&&f>_,didNotAdvance:f<_&&(B||R.hit||R.fieldersChoice||R.sacrificeFly||R.sacrificeBuntInclError||R.error||R.groundOut||S.lastEventWasStrikeout),fieldersChoice:R.fieldersChoice||R.sacrificeBuntInclError||R.droppedThirdStrike||R.error||R.groundOut}}},a.prototype.runnerOutActionContext=function(r,e,i,c){var f=e.stateAfterEvent(this.nextEventOffset).baseForPlayer(i);if(f!==void 0){var _=r[this.get("lastPrimaryEventIndex")],S=this.falseBIPFlags();if(s.isBallInPlayEvent(_)){var P=[_.attributes.playResult,_.attributes.playType],I=P[0],E=P[1];S=this.bipFlags(I,E)}return{caughtStealing:c>f,caughtTaggingUp:c>f&&(S.batterOut||S.sacrifice),didNotTag:c===f&&(S.batterOut||S.fieldersChoice||S.sacrifice),pickedOff:c===f,doubledOff:c===f&&(S.batterOut||S.fieldersChoice||S.sacrifice)||c<f&&(S.error||S.fieldersChoice||S.sacrificeBuntInclError||S.droppedThirdStrike||S.groundOut),outOnLastPlay:S.hit||S.fieldersChoice||S.error||S.sacrificeInclError||c!==f&&(S.fieldersChoice||S.sacrificeBuntInclError||S.droppedThirdStrike||S.error||S.groundOut)||s.isBaseRunningEvent(_)&&_.attributes.playType==="advanced_on_error"||_.code==="foul_error"}}},a}(y.ImmutableState);n.ActionContextState=h;var v=function(o){l.__extends(a,o);function a(r,e,i,c){var f=o.call(this,r)||this;return f.baseEvents=r,f.situation=e,f.lineup=i,f.baserunners=c,f.stateHistory.pop(),f.stateHistory.push(f.initialState()),f}return a.prototype.getBaseEvents=function(){return this.baseEvents},a.prototype.initialState=function(){return new h(p.fromJS({playInProgress:!1,lastBatterId:void 0,lastPrimaryEventIndex:void 0,lastBaseballEventIndex:void 0}))},a.prototype.endPlayInProgressWithLastBatterId=function(r){var e=this.situation.stateBeforeEvent(this.nextEventOffset),i=this.lineup.stateBeforeEvent(this.nextEventOffset);return r.set("playInProgress",!1).set("lastPrimaryEventIndex",this.nextEventOffset).set("lastBatterId",i.currentBatter(e.atBatTeamId))},a.prototype.processOneEvent=function(r,e){switch(e.code){case"ball_in_play":case"end_at_bat":case"pitch":case"end_half":case"balk":case"illegal_pitch_advance":case"foul_error":case"place_batter":case"place_runner":case"replace_runner":case"swap_players":r=this.endPlayInProgressWithLastBatterId(r);break;case"sub_players":var i=e.attributes.applyToBaserunners;if(i)r=this.endPlayInProgressWithLastBatterId(r);else return r;break;case"base_running":var c=e.attributes.playType;s.baserunningRelatedToLastBIP(e)||t.contains(["passed_ball","wild_pitch","on_same_pitch","on_same_error"],c)?r=r.set("playInProgress",!0):c==="advanced_on_error"?r=r.set("playInProgress",!0).set("lastPrimaryEventIndex",this.nextEventOffset):r=this.endPlayInProgressWithLastBatterId(r);break;case"override":s.changesInning(e)&&(r=r.set("playInProgress",!1).set("lastPrimaryEventIndex",this.nextEventOffset));break;default:return r}return r.set("lastBaseballEventIndex",this.nextEventOffset)},a}(d.VersionedStateEngine);n.ActionContextEngine=v}(so)),so}var Vn={},zn={},Kn={},Jn={},Wc;function Ft(){if(Wc)return Jn;Wc=1,Object.defineProperty(Jn,"__esModule",{value:!0}),Jn.BasePlayResolver=void 0;var n=function(){function l(){}return l.prototype.isBackwardsCompatibleResolver=function(){return!1},l.prototype.firstUpdate=function(t,p){return{animationOperations:p,events:[]}},l.prototype.handleUpdate=function(t,p){return{animationOperations:p,events:[]}},l.prototype.markResolution=function(t,p,d){switch(t){case"safe":return this.markSafe(p,d);case"out":return this.markOut(p,d);case"sent_back":return this.markSentBack(p,d);case"violation":return this.markViolation(p,d);default:return{animationOperations:d,events:[]}}},l.prototype.markSafe=function(t,p){return{animationOperations:p,events:[]}},l.prototype.markOut=function(t,p){return{animationOperations:p,events:[]}},l.prototype.markSentBack=function(t,p){return{animationOperations:p,events:[]}},l.prototype.markViolation=function(t,p){return{animationOperations:p,events:[]}},l}();return Jn.BasePlayResolver=n,Jn}var je={},Yn={},$c;function Ge(){if($c)return Yn;$c=1,Object.defineProperty(Yn,"__esModule",{value:!0}),Yn.uuid4=void 0;var n="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx";function l(){return n.replace(/[xy]/g,function(t){var p=Math.random()*16|0,d=t==="x"?p:p&3|8;return d.toString(16)})}return Yn.uuid4=l,Yn}var Vc;function Ke(){if(Vc)return je;Vc=1,Object.defineProperty(je,"__esModule",{value:!0}),je.getPossibleScorers=je.makeBaseRunningEvent=je.numberOfRunnersOnBase=je.isPlayerNotAtBase=je.getPendingOperationForBase=je.getUnresolvedOperationForBase=je.getOperationForBase=je.getOperationForRunnerId=je.changeOperationForRunnerId=void 0;var n=X,l=Ge();function t(a,r,e){var i=p(a,r);if(i===void 0)throw"Could not find runner ".concat(r," in operations ").concat(JSON.stringify(a));return a.map(function(c){return c.playerId===r?n.__assign(n.__assign({},c),e):c})}je.changeOperationForRunnerId=t;function p(a,r){return a.find(function(e){return e.playerId===r})}je.getOperationForRunnerId=p;function d(a,r){return a.find(function(e){return e.toBase===r})}je.getOperationForBase=d;function y(a,r,e){return a.find(function(i){var c=e.has(i.playerId);return i.toBase===r&&!c})}je.getUnresolvedOperationForBase=y;function s(a,r,e){return a.find(function(i){var c=e.has(i.playerId);return i.toBase===r&&c})}je.getPendingOperationForBase=s;function u(a,r,e){var i=p(a,r);return i===void 0?(console.log("Tried to find(".concat(r,") but they were not present in operations.")),!0):i.toBase!==e?(console.log("Tried to find(".concat(r,") but they were at ").concat(i.toBase," instead of ").concat(e,".")),!0):!1}je.isPlayerNotAtBase=u;function h(a){return a.filter(function(r){return(r.result==="safe"||r.result==="resolution_set_violation"||r.result==="resolution_set_back"||r.result==="resolution_set_standard")&&(r.toBase===1||r.toBase===2||r.toBase===3||r.toBase===-3)}).length}je.numberOfRunnersOnBase=h;function v(a,r,e,i){return{id:(0,l.uuid4)(),code:"base_running",attributes:{playType:a,base:r,runnerId:e,playFlavor:i,defenders:[]}}}je.makeBaseRunningEvent=v;function o(a){return a.filter(function(r){return r.toBase===4&&r.result==="scored"}).sort(function(r,e){return r.fromBase-e.fromBase})}return je.getPossibleScorers=o,je}var zc;function Kc(){if(zc)return Kn;zc=1,Object.defineProperty(Kn,"__esModule",{value:!0}),Kn.SingleResolver=void 0;var n=X,l=Ft(),t=Ke(),p=function(d){n.__extends(y,d);function y(s){var u=d.call(this)||this;return u.isViolationAvailable=s,u}return y.prototype.firstUpdate=function(s,u){var h=u.find(function(o){return o.toBase===4&&o.result==="scored"});if(h===void 0)return d.prototype.firstUpdate.call(this,s,u);var v=(0,t.numberOfRunnersOnBase)(u)===3;return v&&this.isViolationAvailable?{animationOperations:(0,t.changeOperationForRunnerId)(u,h.playerId,{result:"resolution_set_violation"}),events:[]}:v?{animationOperations:(0,t.changeOperationForRunnerId)(u,h.playerId,{result:"resolution_set_standard"}),events:[]}:{animationOperations:(0,t.changeOperationForRunnerId)(u,h.playerId,{result:"resolution_set_back"}),events:[]}},y.prototype.markSafe=function(s,u){return s.toBase!==4?{animationOperations:u,events:[]}:{animationOperations:(0,t.changeOperationForRunnerId)(u,s.playerId,{result:"scored"}),events:[]}},y.prototype.markOut=function(s,u){return s.toBase!==4?{animationOperations:u,events:[]}:{animationOperations:(0,t.changeOperationForRunnerId)(u,s.playerId,{result:"safe"}),events:[(0,t.makeBaseRunningEvent)("out_on_last_play",4,s.playerId)]}},y.prototype.markSentBack=function(s,u){if((0,t.numberOfRunnersOnBase)(u)===3)return{animationOperations:u,events:[]};var h=[],v=(0,t.getOperationForBase)(u,3);return v&&h.push((0,t.makeBaseRunningEvent)("remained_on_last_play",2,v.playerId)),h.push((0,t.makeBaseRunningEvent)("remained_on_last_play",3,s.playerId)),{animationOperations:(0,t.changeOperationForRunnerId)(u,s.playerId,{result:"safe"}),events:h}},y.prototype.markViolation=function(s,u){return{animationOperations:(0,t.changeOperationForRunnerId)(u,s.playerId,{result:"safe"}),events:[(0,t.makeBaseRunningEvent)("did_not_score",4,s.playerId)]}},y}(l.BasePlayResolver);return Kn.SingleResolver=p,Kn}var Qn={},Ar={},Jc;function lo(){if(Jc)return Ar;Jc=1,Object.defineProperty(Ar,"__esModule",{value:!0}),Ar.Queue=Ar.assertUnreachable=void 0;function n(t){throw new Error("Unhandled case value ".concat(t))}Ar.assertUnreachable=n;var l=function(){function t(p){p===void 0&&(p=1/0),this.storage=[],this.capacity=p}return t.prototype.enqueue=function(p){if(this.size()===this.capacity)throw Error("Queue has reached max capacity, you cannot add more items");this.storage.push(p)},t.prototype.dequeue=function(){if(this.isEmpty())throw Error("Queue is empty, you cannot dequeue any item");return this.storage.shift()},t.prototype.peek=function(){if(this.isEmpty())throw Error("Queue is empty, you cannot peek any item");return this.storage[0]},t.prototype.isEmpty=function(){return this.storage.length===0},t.prototype.size=function(){return this.storage.length},t.prototype.getValues=function(){return this.storage},t}();return Ar.Queue=l,Ar}var Yc;function Fy(){if(Yc)return Qn;Yc=1,Object.defineProperty(Qn,"__esModule",{value:!0}),Qn.DoubleResolver=void 0;var n=X,l=Ft(),t=Ke(),p=lo(),d=function(y){n.__extends(s,y);function s(){var u=y!==null&&y.apply(this,arguments)||this;return u.playerAtHomeQueue=new p.Queue(1),u}return s.prototype.firstUpdate=function(u,h){this.remainingOuts=u.gameSituation.remainingOuts;var v=(0,t.getPossibleScorers)(h);if(v.length===0)return y.prototype.firstUpdate.call(this,u,h);var o=v.length>1;if(o){var a=v[0].playerId;h=(0,t.changeOperationForRunnerId)(h,a,{toBase:-4,result:"safe"}),this.playerAtHomeQueue.enqueue(a)}var r=(0,t.getOperationForBase)(h,3)===void 0,e=v[v.length-1].playerId;return r&&!o?{animationOperations:(0,t.changeOperationForRunnerId)(h,e,{result:"resolution_set_back"}),events:[]}:{animationOperations:(0,t.changeOperationForRunnerId)(h,e,{result:"resolution_set_standard"}),events:[]}},s.prototype.handleUpdate=function(u,h){if(this.remainingOuts=u.gameSituation.remainingOuts,!this.playerAtHomeQueue.isEmpty()&&(0,t.getOperationForRunnerId)(h,this.playerAtHomeQueue.peek())===void 0){var v=(0,t.getOperationForBase)(h,3)===void 0;u.lastEventInfo.endedInningHalf?h.push({playerId:this.playerAtHomeQueue.dequeue(),result:"removed",fromBase:-4,toBase:-4}):h.push({playerId:this.playerAtHomeQueue.dequeue(),result:v?"resolution_set_back":"resolution_set_standard",fromBase:-4,toBase:4})}return{animationOperations:h,events:[]}},s.prototype.markSafe=function(u,h){if(u.toBase!==4)return{animationOperations:h,events:[]};var v=(0,t.getOperationForBase)(h,-4),o=(0,t.getOperationForBase)(h,3)===void 0;if(v!==void 0){var a=v.playerId;h=(0,t.changeOperationForRunnerId)(h,a,{fromBase:-4,toBase:4,result:o?"resolution_set_back":"resolution_set_standard"}),this.playerAtHomeQueue.dequeue()}return{animationOperations:(0,t.changeOperationForRunnerId)(h,u.playerId,{result:"scored"}),events:[]}},s.prototype.markOut=function(u,h){if(u.toBase!==4)return{animationOperations:h,events:[]};var v=[];return this.remainingOuts===1&&!this.playerAtHomeQueue.isEmpty()&&v.push((0,t.makeBaseRunningEvent)("did_not_score",4,this.playerAtHomeQueue.dequeue(),"inning_ended")),v.push((0,t.makeBaseRunningEvent)("out_on_last_play",4,u.playerId)),{animationOperations:(0,t.changeOperationForRunnerId)(h,u.playerId,{result:"safe"}),events:v}},s.prototype.markSentBack=function(u,h){var v=(0,t.getOperationForBase)(h,3)!==void 0,o=!this.playerAtHomeQueue.isEmpty();if(v||o)return{animationOperations:h,events:[]};var a=[(0,t.makeBaseRunningEvent)("remained_on_last_play",3,u.playerId)];return{animationOperations:(0,t.changeOperationForRunnerId)(h,u.playerId,{result:"safe"}),events:a}},s}(l.BasePlayResolver);return Qn.DoubleResolver=d,Qn}var Xn={},Qc;function ky(){if(Qc)return Xn;Qc=1,Object.defineProperty(Xn,"__esModule",{value:!0}),Xn.FieldersChoiceResolver=void 0;var n=X,l=Ft(),t=Ke(),p=function(d){n.__extends(y,d);function y(){var s=d!==null&&d.apply(this,arguments)||this;return s.resolvedRunnerIds=new Set,s}return y.prototype.firstUpdate=function(s,u){return this.handleUpdate(s,u)},y.prototype.handleUpdate=function(s,u){var h=u.find(function(r){return r.toBase===4&&r.result==="scored"}),v=(0,t.getUnresolvedOperationForBase)(u,2,this.resolvedRunnerIds),o=(0,t.getUnresolvedOperationForBase)(u,3,this.resolvedRunnerIds);if((h===void 0||this.resolvedRunnerIds.has(h.playerId))&&v===void 0&&o===void 0)return d.prototype.handleUpdate.call(this,s,u);if(s.lastEventInfo.endedInningHalf)return d.prototype.handleUpdate.call(this,s,u);if(h&&!this.resolvedRunnerIds.has(h.playerId))return{animationOperations:(0,t.changeOperationForRunnerId)(u,h.playerId,{result:"resolution_set_back"}),events:[]};var a=u;return v&&(a=(0,t.changeOperationForRunnerId)(a,v.playerId,{result:"resolution_set_standard"})),o&&(a=(0,t.changeOperationForRunnerId)(a,o.playerId,{result:"resolution_set_standard"})),{animationOperations:a,events:[]}},y.prototype.markSafeAtHome=function(s,u,h){var v=(0,t.getUnresolvedOperationForBase)(u,3,this.resolvedRunnerIds),o=(0,t.getUnresolvedOperationForBase)(u,2,this.resolvedRunnerIds);if(h.playerId!==s.playerId)return{animationOperations:u,events:[]};this.resolvedRunnerIds.add(s.playerId);var a=(0,t.changeOperationForRunnerId)(u,s.playerId,{result:"scored"});return v&&(a=(0,t.changeOperationForRunnerId)(a,v.playerId,{result:"resolution_set_standard"})),o&&(a=(0,t.changeOperationForRunnerId)(a,o.playerId,{result:"resolution_set_standard"})),{animationOperations:a,events:[]}},y.prototype.markSafeOnBase=function(s,u){if(s.toBase===1||this.resolvedRunnerIds.has(s.playerId))return{animationOperations:u,events:[]};this.resolvedRunnerIds.add(s.playerId);var h=(0,t.changeOperationForRunnerId)(u,s.playerId,{result:"safe"}),v=[],o=(0,t.getUnresolvedOperationForBase)(u,3,this.resolvedRunnerIds),a=(0,t.getUnresolvedOperationForBase)(u,2,this.resolvedRunnerIds),r=u.filter(function(e){return e.toBase===3}).length;if(s.toBase===3&&r===2)v.push((0,t.makeBaseRunningEvent)("remained_on_last_play",2,s.playerId)),a&&(this.resolvedRunnerIds.add(a.playerId),h=(0,t.changeOperationForRunnerId)(h,a.playerId,{result:"safe"}),v.push((0,t.makeBaseRunningEvent)("out_on_last_play",2,a.playerId)));else if(s.toBase===2&&r===2){if(!o)throw Error("Fielders choice: There are two runners on 3rd and both are resolved. Unable to proceed.");this.resolvedRunnerIds.add(o.playerId),h=(0,t.changeOperationForRunnerId)(h,o.playerId,{result:"safe"}),v.push((0,t.makeBaseRunningEvent)("out_on_last_play",3,o.playerId))}return{animationOperations:h,events:v}},y.prototype.markSafe=function(s,u){var h=(0,t.getOperationForBase)(u,4);return h?this.markSafeAtHome(s,u,h):this.markSafeOnBase(s,u)},y.prototype.markOutAtHome=function(s,u,h){return h.playerId!==s.playerId?{animationOperations:u,events:[]}:(this.resolvedRunnerIds.add(s.playerId),{animationOperations:(0,t.changeOperationForRunnerId)(u,s.playerId,{result:"safe"}),events:[(0,t.makeBaseRunningEvent)("out_on_last_play",4,s.playerId)]})},y.prototype.markOutOnBase=function(s,u){return s.toBase===1||this.resolvedRunnerIds.has(s.playerId)?{animationOperations:u,events:[]}:(this.resolvedRunnerIds.add(s.playerId),{animationOperations:(0,t.changeOperationForRunnerId)(u,s.playerId,{result:"safe"}),events:[(0,t.makeBaseRunningEvent)("out_on_last_play",s.toBase,s.playerId)]})},y.prototype.markOut=function(s,u){var h=(0,t.getOperationForBase)(u,4);return h?this.markOutAtHome(s,u,h):this.markOutOnBase(s,u)},y.prototype.markSentBack=function(s,u){return this.resolvedRunnerIds.add(s.playerId),{animationOperations:(0,t.changeOperationForRunnerId)(u,s.playerId,{result:"safe"}),events:[(0,t.makeBaseRunningEvent)("remained_on_last_play",3,s.playerId)]}},y}(l.BasePlayResolver);return Xn.FieldersChoiceResolver=p,Xn}var Zn={},Xc;function wy(){if(Xc)return Zn;Xc=1,Object.defineProperty(Zn,"__esModule",{value:!0}),Zn.FieldersChoiceDoublePlayResolver=void 0;var n=X,l=Ft(),t=Ke(),p=function(d){n.__extends(y,d);function y(){var s=d!==null&&d.apply(this,arguments)||this;return s.outsCollected=0,s}return y.prototype.firstUpdate=function(s,u){if(u.length<3||s.gameSituation.remainingOuts<2)throw new Error("There are not enough operations and/or outs to do a FC DP.");return u.length===3?this.firstUpdateFor2Baserunners(u):this.firstUpdateFor3Baserunners(u)},y.prototype.firstUpdateFor2Baserunners=function(s){var u=s,h=[],v=(0,t.getOperationForBase)(s,4),o=(0,t.getOperationForBase)(s,3),a=(0,t.getOperationForBase)(s,2);return v&&(u=(0,t.changeOperationForRunnerId)(u,v.playerId,{result:"safe"}),h.push((0,t.makeBaseRunningEvent)("out_on_last_play",4,v.playerId))),o&&h.push((0,t.makeBaseRunningEvent)("out_on_last_play",3,o.playerId)),a&&h.push((0,t.makeBaseRunningEvent)("out_on_last_play",2,a.playerId)),this.outsCollected=2,{animationOperations:u,events:h}},y.prototype.firstUpdateFor3Baserunners=function(s){var u=(0,t.getOperationForBase)(s,4);if(u===void 0)throw new Error("FC DP should have a runner at home, but it was not present in animation operations.");return{animationOperations:(0,t.changeOperationForRunnerId)(s,u.playerId,{result:"resolution_set_back"}),events:[]}},y.prototype.handleUpdate=function(s,u){if(this.outsCollected===2)return d.prototype.handleUpdate.call(this,s,u);var h=(0,t.getOperationForBase)(u,3),v=(0,t.getOperationForBase)(u,2);if(h===void 0||v===void 0)throw new Error("FC DP: Expected runners on 2nd and 3rd, but one or both was missing.");var o=(0,t.changeOperationForRunnerId)(u,h.playerId,{result:"resolution_set_standard"});return o=(0,t.changeOperationForRunnerId)(o,v.playerId,{result:"resolution_set_standard"}),{animationOperations:o,events:[]}},y.prototype.markSafeOrSentBackAtHome=function(s,u,h,v){if(v.playerId!==u.playerId)return{animationOperations:h,events:[]};var o=(0,t.getOperationForBase)(h,3),a=(0,t.getOperationForBase)(h,2);if(o===void 0||a===void 0)throw new Error("FC DP: Did not have runners on 2nd and/or 3rd to get out");var r=h,e=[];return s==="safe"?r=(0,t.changeOperationForRunnerId)(r,u.playerId,{result:"scored"}):(r=(0,t.changeOperationForRunnerId)(r,u.playerId,{result:"safe"}),e.push((0,t.makeBaseRunningEvent)("remained_on_last_play",3,u.playerId))),e.push((0,t.makeBaseRunningEvent)("out_on_last_play",3,o.playerId)),e.push((0,t.makeBaseRunningEvent)("out_on_last_play",2,a.playerId)),this.outsCollected=2,{animationOperations:r,events:e}},y.prototype.markSafeOnBase=function(s,u){if(s.toBase!==2&&s.toBase!==3)return{animationOperations:u,events:[]};var h=(0,t.getOperationForBase)(u,s.toBase===2?3:2);if(h===void 0)throw new Error("FC DP: Could not find other runner.");var v=(0,t.changeOperationForRunnerId)(u,s.playerId,{result:"safe"});v=(0,t.changeOperationForRunnerId)(v,h.playerId,{result:"safe"});var o=[(0,t.makeBaseRunningEvent)("out_on_last_play",h.toBase,h.playerId)];return this.outsCollected=2,{animationOperations:v,events:o}},y.prototype.markSafe=function(s,u){var h=(0,t.getOperationForBase)(u,4);return h?this.markSafeOrSentBackAtHome("safe",s,u,h):this.markSafeOnBase(s,u)},y.prototype.markOutAtHome=function(s,u,h){return h.playerId!==s.playerId?{animationOperations:u,events:[]}:(this.outsCollected=1,{animationOperations:(0,t.changeOperationForRunnerId)(u,s.playerId,{result:"safe"}),events:[(0,t.makeBaseRunningEvent)("out_on_last_play",4,s.playerId)]})},y.prototype.markOutOnBase=function(s,u){if(s.toBase!==2&&s.toBase!==3)return{animationOperations:u,events:[]};var h=(0,t.getOperationForBase)(u,s.toBase===2?3:2);if(h===void 0)throw new Error("FC DP: Could not find other runner.");var v=(0,t.changeOperationForRunnerId)(u,s.playerId,{result:"safe"});v=(0,t.changeOperationForRunnerId)(v,h.playerId,{result:"safe"});var o=[(0,t.makeBaseRunningEvent)("out_on_last_play",s.toBase,s.playerId)];return this.outsCollected=2,{animationOperations:v,events:o}},y.prototype.markOut=function(s,u){var h=(0,t.getOperationForBase)(u,4);return h?this.markOutAtHome(s,u,h):this.markOutOnBase(s,u)},y.prototype.markSentBack=function(s,u){return this.markSafeOrSentBackAtHome("sent_back",s,u,s)},y}(l.BasePlayResolver);return Zn.FieldersChoiceDoublePlayResolver=p,Zn}var ea={},Zc;function Cy(){if(Zc)return ea;Zc=1,Object.defineProperty(ea,"__esModule",{value:!0}),ea.FieldersChoiceTriplePlayResolver=void 0;var n=X,l=Ft(),t=Ke(),p=function(d){n.__extends(y,d);function y(){return d!==null&&d.apply(this,arguments)||this}return y.prototype.firstUpdate=function(s,u){if(u.length<4||s.gameSituation.remainingOuts<3)throw new Error("There are not enough operations and/or outs to do a FC TP.");var h=u,v=[],o=(0,t.getOperationForBase)(u,4),a=(0,t.getOperationForBase)(u,3),r=(0,t.getOperationForBase)(u,2);return o&&(h=(0,t.changeOperationForRunnerId)(h,o.playerId,{result:"safe"}),v.push((0,t.makeBaseRunningEvent)("out_on_last_play",4,o.playerId))),a&&v.push((0,t.makeBaseRunningEvent)("out_on_last_play",3,a.playerId)),r&&v.push((0,t.makeBaseRunningEvent)("out_on_last_play",2,r.playerId)),{animationOperations:h,events:v}},y}(l.BasePlayResolver);return ea.FieldersChoiceTriplePlayResolver=p,ea}var ta={},ed;function My(){if(ed)return ta;ed=1,Object.defineProperty(ta,"__esModule",{value:!0}),ta.TripleResolver=void 0;var n=X,l=Ft(),t=lo(),p=Ke(),d=function(y){n.__extends(s,y);function s(){var u=y!==null&&y.apply(this,arguments)||this;return u.playerAtHomeQueue=new t.Queue(2),u}return s.prototype.firstUpdate=function(u,h){this.remainingOuts=u.gameSituation.remainingOuts;var v=(0,p.getPossibleScorers)(h);if(v.length===0)return y.prototype.firstUpdate.call(this,u,h);var o=v.length>1;if(o)for(var a=v.slice(0,v.length-1),r=a.length===2?-5:-4,e=0;e<a.length;e++){var i=a[e].playerId;h=(0,p.changeOperationForRunnerId)(h,i,{toBase:r++,result:"safe"}),this.playerAtHomeQueue.enqueue(a[a.length-1-e].playerId)}var c=v[v.length-1].playerId;return{animationOperations:(0,p.changeOperationForRunnerId)(h,c,{result:"resolution_set_standard"}),events:[]}},s.prototype.handleUpdate=function(u,h){return this.remainingOuts=u.gameSituation.remainingOuts,!this.playerAtHomeQueue.isEmpty()&&(0,p.getOperationForRunnerId)(h,this.playerAtHomeQueue.peek())===void 0&&h.push({playerId:this.playerAtHomeQueue.dequeue(),result:"resolution_set_standard",fromBase:-4,toBase:4}),!this.playerAtHomeQueue.isEmpty()&&(0,p.getOperationForRunnerId)(h,this.playerAtHomeQueue.peek())===void 0&&h.push({playerId:this.playerAtHomeQueue.peek(),result:"safe",fromBase:-5,toBase:-4}),y.prototype.handleUpdate.call(this,u,h)},s.prototype.markSafe=function(u,h){if(u.toBase!==4)return{animationOperations:h,events:[]};if(!this.playerAtHomeQueue.isEmpty()){var v=this.playerAtHomeQueue.dequeue();h=(0,p.changeOperationForRunnerId)(h,v,{fromBase:-4,toBase:4,result:"resolution_set_standard"})}if(!this.playerAtHomeQueue.isEmpty()){var v=this.playerAtHomeQueue.peek();h=(0,p.changeOperationForRunnerId)(h,v,{fromBase:-5,toBase:-4,result:"safe"})}return{animationOperations:(0,p.changeOperationForRunnerId)(h,u.playerId,{result:"scored"}),events:[]}},s.prototype.markOut=function(u,h){if(u.toBase!==4)return{animationOperations:h,events:[]};for(var v=[];this.remainingOuts===1&&!this.playerAtHomeQueue.isEmpty();)v.push((0,p.makeBaseRunningEvent)("did_not_score",4,this.playerAtHomeQueue.dequeue(),"inning_ended"));return v.push((0,p.makeBaseRunningEvent)("out_on_last_play",4,u.playerId)),{animationOperations:(0,p.changeOperationForRunnerId)(h,u.playerId,{result:"safe"}),events:v}},s}(l.BasePlayResolver);return ta.TripleResolver=d,ta}var ra={},td;function xy(){if(td)return ra;td=1,Object.defineProperty(ra,"__esModule",{value:!0}),ra.AirOutResolver=void 0;var n=X,l=Ft(),t=Ke(),p=function(d){n.__extends(y,d);function y(s){var u=d.call(this)||this;return u.requiredOuts=s,u.initialOuts=0,u.outsNeeded=0,u.resolvedRunnerIds=new Set,u}return y.prototype.firstUpdate=function(s,u){return this.initialOuts=s.gameSituation.outs-1,this.handleUpdate(s,u)},y.prototype.handleUpdate=function(s,u){var h=s.gameSituation.outs-this.initialOuts;if(this.outsNeeded=this.requiredOuts-h,this.outsNeeded<=0)return d.prototype.handleUpdate.call(this,s,u);var v=this.getUnresolvedRunnerOperations(u),o=this.getAutomaticOutEvents(v);return o.length>0?{animationOperations:u,events:o}:s.lastEventInfo.endedInningHalf?{animationOperations:u,events:[]}:{animationOperations:this.changeResultOfUnresolvedOperations(u,v,"resolution_set_standard"),events:[]}},y.prototype.getUnresolvedRunnerOperations=function(s){var u=(0,t.getUnresolvedOperationForBase)(s,1,this.resolvedRunnerIds),h=(0,t.getUnresolvedOperationForBase)(s,2,this.resolvedRunnerIds),v=(0,t.getUnresolvedOperationForBase)(s,3,this.resolvedRunnerIds),o=[];return u&&o.push(u),h&&o.push(h),v&&o.push(v),o},y.prototype.getAutomaticOutEvents=function(s){var u=this,h=s.length;return h===this.outsNeeded?(s.forEach(function(v){return u.resolvedRunnerIds.add(v.playerId)}),s.map(function(v){return(0,t.makeBaseRunningEvent)("out_on_last_play",v.toBase,v.playerId)})):[]},y.prototype.changeResultOfUnresolvedOperations=function(s,u,h){for(var v=s,o=0,a=u;o<a.length;o++){var r=a[o];v=(0,t.changeOperationForRunnerId)(v,r.playerId,{result:h})}return v},y.prototype.markSafe=function(s,u){this.resolvedRunnerIds.add(s.playerId);var h=(0,t.changeOperationForRunnerId)(u,s.playerId,{result:"safe"}),v=this.getUnresolvedRunnerOperations(h),o=this.getAutomaticOutEvents(v);return o.length>0?{animationOperations:this.changeResultOfUnresolvedOperations(h,v,"safe"),events:o}:{animationOperations:this.changeResultOfUnresolvedOperations(h,v,"resolution_set_standard"),events:[]}},y.prototype.markOut=function(s,u){this.resolvedRunnerIds.add(s.playerId);var h=(0,t.changeOperationForRunnerId)(u,s.playerId,{result:"safe"}),v=[(0,t.makeBaseRunningEvent)("out_on_last_play",s.toBase,s.playerId)],o=this.getUnresolvedRunnerOperations(h);return h=this.changeResultOfUnresolvedOperations(h,o,this.outsNeeded<=1?"safe":"resolution_set_standard"),{animationOperations:h,events:v}},y}(l.BasePlayResolver);return ra.AirOutResolver=p,ra}var na={},rd;function Ly(){if(rd)return na;rd=1,Object.defineProperty(na,"__esModule",{value:!0}),na.BatterOutAdvanceRunnersResolver=void 0;var n=X,l=Ft(),t=Ke(),p=function(d){n.__extends(y,d);function y(){return d!==null&&d.apply(this,arguments)||this}return y.prototype.firstUpdate=function(s,u){return this.handleUpdate(s,u)},y.prototype.handleUpdate=function(s,u){if(s.lastEventInfo.endedInningHalf)return d.prototype.handleUpdate.call(this,s,u);var h=u.find(function(v){return v.toBase===4&&v.result==="scored"});return h===void 0?d.prototype.handleUpdate.call(this,s,u):{animationOperations:(0,t.changeOperationForRunnerId)(u,h.playerId,{result:"resolution_set_back"}),events:[]}},y.prototype.markSafe=function(s,u){return s.toBase!==4?{animationOperations:u,events:[]}:{animationOperations:(0,t.changeOperationForRunnerId)(u,s.playerId,{result:"scored"}),events:[]}},y.prototype.markOut=function(s,u){return s.toBase!==4?{animationOperations:u,events:[]}:{animationOperations:(0,t.changeOperationForRunnerId)(u,s.playerId,{result:"safe"}),events:[(0,t.makeBaseRunningEvent)("out_on_last_play",4,s.playerId)]}},y.prototype.markSentBack=function(s,u){var h=[],v=(0,t.getOperationForBase)(u,3);if(v){var o=(0,t.getOperationForBase)(u,2);o&&h.push((0,t.makeBaseRunningEvent)("remained_on_last_play",1,o.playerId)),h.push((0,t.makeBaseRunningEvent)("remained_on_last_play",2,v.playerId))}return h.push((0,t.makeBaseRunningEvent)("remained_on_last_play",3,s.playerId)),{animationOperations:(0,t.changeOperationForRunnerId)(u,s.playerId,{result:"safe"}),events:h}},y}(l.BasePlayResolver);return na.BatterOutAdvanceRunnersResolver=p,na}var aa={},nd;function Dy(){if(nd)return aa;nd=1,Object.defineProperty(aa,"__esModule",{value:!0}),aa.SacrificeBuntResolver=void 0;var n=X,l=Ft(),t=Ke(),p=function(d){n.__extends(y,d);function y(){return d!==null&&d.apply(this,arguments)||this}return y.prototype.firstUpdate=function(s,u){var h,v=(0,t.getOperationForBase)(u,1);if(!v)return d.prototype.firstUpdate.call(this,s,u);this.possibleScorer=(0,t.getOperationForBase)(u,4);var o=s.gameSituation.remainingOuts===1;this.possibleScorer&&(u=(0,t.changeOperationForRunnerId)(u,(h=this.possibleScorer)===null||h===void 0?void 0:h.playerId,{result:o?"safe":"resolution_set_back"}));var a=[];return this.possibleScorer&&o&&a.push((0,t.makeBaseRunningEvent)("did_not_score",4,this.possibleScorer.playerId,"inning_ended")),a.push((0,t.makeBaseRunningEvent)("out_on_last_play",1,v.playerId)),{animationOperations:u,events:a}},y.prototype.handleUpdate=function(s,u){if(!this.possibleScorer)return d.prototype.handleUpdate.call(this,s,u);var h=this.possibleScorer.playerId,v=(0,t.getOperationForRunnerId)(u,h)===void 0;return v&&!s.lastEventInfo.endedInningHalf&&u.push({playerId:h,result:"resolution_set_back",fromBase:4,toBase:4}),d.prototype.handleUpdate.call(this,s,u)},y.prototype.markSafe=function(s,u){return s.toBase!==4?{animationOperations:u,events:[]}:{animationOperations:(0,t.changeOperationForRunnerId)(u,s.playerId,{result:"scored"}),events:[]}},y.prototype.markOut=function(s,u){return s.toBase!==4?{animationOperations:u,events:[]}:{animationOperations:(0,t.changeOperationForRunnerId)(u,s.playerId,{result:"safe"}),events:[(0,t.makeBaseRunningEvent)("out_on_last_play",4,s.playerId)]}},y.prototype.markSentBack=function(s,u){for(var h=[],v=0,o=u.sort(function(r,e){return r.toBase-e.toBase});v<o.length;v++){var a=o[v];h.push((0,t.makeBaseRunningEvent)("remained_on_last_play",a.toBase-1,a.playerId)),u=(0,t.changeOperationForRunnerId)(u,a.playerId,{result:"safe"})}return{animationOperations:u,events:h}},y}(l.BasePlayResolver);return aa.SacrificeBuntResolver=p,aa}var ia={},ad;function Gy(){if(ad)return ia;ad=1,Object.defineProperty(ia,"__esModule",{value:!0}),ia.DoublePlayResolver=void 0;var n=X,l=Ft(),t=Ke(),p=function(d){n.__extends(y,d);function y(){var s=d!==null&&d.apply(this,arguments)||this;return s.resolvedRunnerIds=new Set,s.sentBackRunnerOn3rd=!1,s.recordedSecondOut=!1,s.inningWillEndOn2ndOut=!1,s}return y.prototype.firstUpdate=function(s,u){return this.inningWillEndOn2ndOut=s.gameSituation.remainingOuts===1,this.handleUpdate(s,u)},y.prototype.handleUpdate=function(s,u){if(this.recordedSecondOut)return this.deferredOutBatterId?{animationOperations:n.__spreadArray(n.__spreadArray([],u,!0),[{playerId:this.deferredOutBatterId,toBase:1,fromBase:1,result:"out"}],!1),events:[]}:d.prototype.handleUpdate.call(this,s,u);var h=(0,t.getUnresolvedOperationForBase)(u,4,this.resolvedRunnerIds),v=(0,t.getUnresolvedOperationForBase)(u,3,this.resolvedRunnerIds),o=(0,t.getUnresolvedOperationForBase)(u,2,this.resolvedRunnerIds);if(h)return o||v?{animationOperations:(0,t.changeOperationForRunnerId)(u,h.playerId,{result:"resolution_set_back"}),events:[]}:this.automaticallyMarkOutOtherRunner(u,h);if(v&&o){var a=u;return a=(0,t.changeOperationForRunnerId)(a,v.playerId,{result:"resolution_set_standard"}),a=(0,t.changeOperationForRunnerId)(a,o.playerId,{result:"resolution_set_standard"}),{animationOperations:a,events:[]}}else{if(o)return this.automaticallyMarkOutOtherRunner(u,o);if(v)return this.automaticallyMarkOutOtherRunner(u,v)}return d.prototype.handleUpdate.call(this,s,u)},y.prototype.automaticallyMarkOutOtherRunner=function(s,u){this.resolvedRunnerIds.add(u.playerId),this.recordedSecondOut=!0;var h=(0,t.getOperationForBase)(s,1);if(!h)throw new Error("There should have been an operation for the batter at 1st, but it was missing");return this.deferredOutBatterId=h.playerId,s=(0,t.changeOperationForRunnerId)(s,h.playerId,{result:"safe"}),s=(0,t.changeOperationForRunnerId)(s,u.playerId,{result:"safe"}),{animationOperations:s,events:[(0,t.makeBaseRunningEvent)("out_on_last_play",u.toBase,u.playerId)]}},y.prototype.markSafeOrSentBackAtHome=function(s,u,h,v){if(v.playerId!==u.playerId)return{animationOperations:h,events:[]};this.resolvedRunnerIds.add(u.playerId);var o=(0,t.changeOperationForRunnerId)(h,u.playerId,{result:s==="safe"?"scored":"safe"}),a=[];s==="sent_back"&&(this.sentBackRunnerOn3rd=!0,a.push((0,t.makeBaseRunningEvent)("remained_on_last_play",3,u.playerId)));var r=(0,t.getUnresolvedOperationForBase)(h,3,this.resolvedRunnerIds),e=(0,t.getUnresolvedOperationForBase)(h,2,this.resolvedRunnerIds);return e&&r?s==="safe"&&(o=(0,t.changeOperationForRunnerId)(o,e.playerId,{result:"resolution_set_standard"}),o=(0,t.changeOperationForRunnerId)(o,r.playerId,{result:"resolution_set_standard"})):e?(this.resolvedRunnerIds.add(e.playerId),this.recordedSecondOut=!0,a.push((0,t.makeBaseRunningEvent)("out_on_last_play",2,e.playerId))):r&&(this.resolvedRunnerIds.add(r.playerId),this.recordedSecondOut=!0,a.push((0,t.makeBaseRunningEvent)("out_on_last_play",3,r.playerId))),{animationOperations:o,events:a}},y.prototype.markSafeOrOutOnBase=function(s,u,h){if(u.toBase!==2&&u.toBase!==3)return{animationOperations:h,events:[]};var v=(0,t.getUnresolvedOperationForBase)(h,u.toBase===2?3:2,this.resolvedRunnerIds);if(v===void 0)throw new Error("DP: Could not find other runner.");var o=(0,t.changeOperationForRunnerId)(h,u.playerId,{result:"safe"});o=(0,t.changeOperationForRunnerId)(o,v.playerId,{result:"safe"}),this.resolvedRunnerIds.add(u.playerId),this.resolvedRunnerIds.add(v.playerId),this.recordedSecondOut=!0;var a=s==="safe"?u:v,r=s==="safe"?v:u,e=[(0,t.makeBaseRunningEvent)("out_on_last_play",r.toBase,r.playerId)];return this.sentBackRunnerOn3rd&&a.toBase===3&&!this.inningWillEndOn2ndOut&&e.push((0,t.makeBaseRunningEvent)("remained_on_last_play",2,a.playerId)),{animationOperations:o,events:e}},y.prototype.markSafe=function(s,u){var h=(0,t.getOperationForBase)(u,4);return h?this.markSafeOrSentBackAtHome("safe",s,u,h):this.markSafeOrOutOnBase("safe",s,u)},y.prototype.markOutAtHome=function(s,u,h){return h.playerId!==s.playerId?{animationOperations:u,events:[]}:(this.recordedSecondOut=!0,this.resolvedRunnerIds.add(s.playerId),{animationOperations:(0,t.changeOperationForRunnerId)(u,s.playerId,{result:"safe"}),events:[(0,t.makeBaseRunningEvent)("out_on_last_play",4,s.playerId)]})},y.prototype.markOut=function(s,u){var h=(0,t.getOperationForBase)(u,4);return h?this.markOutAtHome(s,u,h):this.markSafeOrOutOnBase("out",s,u)},y.prototype.markSentBack=function(s,u){return this.markSafeOrSentBackAtHome("sent_back",s,u,s)},y}(l.BasePlayResolver);return ia.DoublePlayResolver=p,ia}var sa={},id;function Hy(){if(id)return sa;id=1,Object.defineProperty(sa,"__esModule",{value:!0}),sa.TriplePlayResolver=void 0;var n=X,l=Ft(),t=Ke(),p=function(d){n.__extends(y,d);function y(){var s=d!==null&&d.apply(this,arguments)||this;return s.recordedThirdOut=!1,s}return y.prototype.firstUpdate=function(s,u){var h=(0,t.getOperationForBase)(u,4),v=(0,t.getOperationForBase)(u,3),o=(0,t.getOperationForBase)(u,2);if(h&&v&&o)return{animationOperations:(0,t.changeOperationForRunnerId)(u,h.playerId,{result:"resolution_set_back"}),events:[]};var a=(0,t.getOperationForBase)(u,1);if(!a)throw new Error("There should have been an operation for the batter at 1st, but it was missing");this.deferredOutBatterId=a.playerId;var r=[],e=u;return e=(0,t.changeOperationForRunnerId)(e,a.playerId,{result:"safe"}),h&&(r.push((0,t.makeBaseRunningEvent)("out_on_last_play",4,h.playerId)),e=(0,t.changeOperationForRunnerId)(e,h.playerId,{result:"safe"})),v&&r.push((0,t.makeBaseRunningEvent)("out_on_last_play",3,v.playerId)),o&&r.push((0,t.makeBaseRunningEvent)("out_on_last_play",2,o.playerId)),this.recordedThirdOut=!0,{animationOperations:e,events:r}},y.prototype.handleUpdate=function(s,u){if(this.recordedThirdOut)return this.deferredOutBatterId?{animationOperations:n.__spreadArray(n.__spreadArray([],u,!0),[{playerId:this.deferredOutBatterId,toBase:1,fromBase:1,result:"out"}],!1),events:[]}:d.prototype.handleUpdate.call(this,s,u);var h=(0,t.getOperationForBase)(u,3),v=(0,t.getOperationForBase)(u,2);if(!h||!v)throw new Error("TP: Should have had two runners in handleUpdate, but one or both is missing.");var o=u;return o=(0,t.changeOperationForRunnerId)(o,h.playerId,{result:"resolution_set_standard"}),o=(0,t.changeOperationForRunnerId)(o,v.playerId,{result:"resolution_set_standard"}),{animationOperations:o,events:[]}},y.prototype.markSafeOrSentBackAtHome=function(s,u,h,v){if(v.playerId!==u.playerId)return{animationOperations:h,events:[]};var o=(0,t.changeOperationForRunnerId)(h,u.playerId,{result:s==="safe"?"scored":"safe"}),a=[];s==="sent_back"&&a.push((0,t.makeBaseRunningEvent)("remained_on_last_play",3,u.playerId));var r=(0,t.getOperationForBase)(h,3),e=(0,t.getOperationForBase)(h,2);if(!r||!e)throw new Error("TP: Should have had two other runners in markSafeAtHome, but one or both is missing.");return o=(0,t.changeOperationForRunnerId)(o,e.playerId,{result:"safe"}),o=(0,t.changeOperationForRunnerId)(o,r.playerId,{result:"safe"}),a.push((0,t.makeBaseRunningEvent)("out_on_last_play",2,e.playerId)),a.push((0,t.makeBaseRunningEvent)("out_on_last_play",3,r.playerId)),this.recordedThirdOut=!0,{animationOperations:o,events:a}},y.prototype.markSafeOrOutOnBase=function(s,u,h){if(u.toBase!==2&&u.toBase!==3)return{animationOperations:h,events:[]};var v=(0,t.getOperationForBase)(h,u.toBase===2?3:2);if(v===void 0)throw new Error("TP: Could not find other runner.");var o=(0,t.changeOperationForRunnerId)(h,u.playerId,{result:"safe"});o=(0,t.changeOperationForRunnerId)(o,v.playerId,{result:"safe"}),this.recordedThirdOut=!0;var a=s==="safe"?v:u,r=[(0,t.makeBaseRunningEvent)("out_on_last_play",a.toBase,a.playerId)];return{animationOperations:o,events:r}},y.prototype.markSafe=function(s,u){var h=(0,t.getOperationForBase)(u,4);return h?this.markSafeOrSentBackAtHome("safe",s,u,h):this.markSafeOrOutOnBase("safe",s,u)},y.prototype.markOutAtHome=function(s,u,h){return h.playerId!==s.playerId?{animationOperations:u,events:[]}:{animationOperations:(0,t.changeOperationForRunnerId)(u,s.playerId,{result:"safe"}),events:[(0,t.makeBaseRunningEvent)("out_on_last_play",4,s.playerId)]}},y.prototype.markOut=function(s,u){var h=(0,t.getOperationForBase)(u,4);return h?this.markOutAtHome(s,u,h):this.markSafeOrOutOnBase("out",s,u)},y.prototype.markSentBack=function(s,u){return this.markSafeOrSentBackAtHome("sent_back",s,u,s)},y}(l.BasePlayResolver);return sa.TriplePlayResolver=p,sa}var oa={},sd;function Ny(){if(sd)return oa;sd=1,Object.defineProperty(oa,"__esModule",{value:!0}),oa.DroppedThirdStrikeResolver=void 0;var n=X,l=Kc(),t=Ke(),p=function(d){n.__extends(y,d);function y(s,u){var h=d.call(this,s)||this;return h.cause=u,h.shouldResolveOtherRunners=!1,h}return y.prototype.firstUpdate=function(s,u){if(u.length<=1||this.cause!=="unspecified")return d.prototype.firstUpdate.call(this,s,u);var h=[],v=u.filter(function(r){return r.toBase>1});if(v.length===1){var o=v[0];return h.push((0,t.makeBaseRunningEvent)("out_on_last_play",o.toBase,o.playerId)),{animationOperations:(0,t.changeOperationForRunnerId)(u,o.playerId,{result:"safe"}),events:h}}var a=u.find(function(r){return r.toBase===4})!==void 0;return a?d.prototype.firstUpdate.call(this,s,u):{animationOperations:u.map(function(r){return n.__assign(n.__assign({},r),{result:r.toBase>1?"resolution_set_standard":r.result})}),events:[]}},y.prototype.handleUpdate=function(s,u){return this.cause==="unspecified"&&this.shouldResolveOtherRunners&&!s.lastEventInfo.endedInningHalf?{animationOperations:u.map(function(h){var v=h.toBase<4&&h.toBase>1;return n.__assign(n.__assign({},h),{result:v?"resolution_set_standard":h.result})}),events:[]}:d.prototype.handleUpdate.call(this,s,u)},y.prototype.markSafe=function(s,u){var h=d.prototype.markSafe.call(this,s,u);if(this.cause==="unspecified"){var v=u.filter(function(a){return a.toBase>1&&a.toBase<4&&a.toBase!==s.toBase});if(v.length===1){var o=v[0];h.events.push((0,t.makeBaseRunningEvent)("out_on_last_play",o.toBase,o.playerId)),h.animationOperations=u.map(function(a){var r=a.playerId===s.playerId&&s.toBase===4;return n.__assign(n.__assign({},a),{result:r?"scored":"safe"})})}else h.animationOperations=h.animationOperations.map(function(a){var r=a.toBase<4&&a.toBase>1;return n.__assign(n.__assign({},a),{result:r?"resolution_set_standard":a.result})})}return h},y.prototype.markOut=function(s,u){return{animationOperations:u.map(function(h){return n.__assign(n.__assign({},h),{result:"safe"})}),events:[(0,t.makeBaseRunningEvent)("out_on_last_play",s.toBase,s.playerId)]}},y.prototype.markSentBack=function(s,u){var h=d.prototype.markSentBack.call(this,s,u),v=u.find(function(o){return o.toBase>1&&o.toBase<4});return v&&this.cause==="unspecified"&&h.events.push((0,t.makeBaseRunningEvent)("out_on_last_play",v.toBase,v.playerId)),h},y.prototype.markViolation=function(s,u){var h=d.prototype.markViolation.call(this,s,u);if(this.cause==="unspecified"){var v=u.filter(function(a){return a.toBase>1&&a.toBase<4&&a.toBase!==s.toBase});if(this.shouldResolveOtherRunners=v.length>0,v.length===1){var o=v[0];h.events.push((0,t.makeBaseRunningEvent)("out_on_last_play",o.toBase,o.playerId))}h.animationOperations=u.map(function(a){return n.__assign(n.__assign({},a),{result:"safe"})})}return h},y}(l.SingleResolver);return oa.DroppedThirdStrikeResolver=p,oa}var ua={},la={},od;function Ui(){if(od)return la;od=1,Object.defineProperty(la,"__esModule",{value:!0}),la.BaseBackwardsCompatibleResolver=void 0;var n=X,l=Ft(),t=Ke(),p=function(d){n.__extends(y,d);function y(){var s=d!==null&&d.apply(this,arguments)||this;return s.pendingRunnerIds=new Set,s.remainingOuts=3,s.cachedOperations=[],s.decisions={out:[],remained:[]},s}return y.prototype.isBackwardsCompatibleResolver=function(){return!0},y.prototype.firstUpdate=function(s,u){var h=u.filter(function(a){return a.toBase!==1}).map(function(a){return a.playerId});this.pendingRunnerIds=new Set(h),this.remainingOuts=s.gameSituation.remainingOuts;var v=u.find(function(a){return a.toBase===4&&a.result==="scored"});if(!v)throw new Error("base_bc_resolver firstUpdate was called with no runner at home.");var o=(0,t.changeOperationForRunnerId)(u,v.playerId,{result:"resolution_set_back"});return this.cacheAnimationOperations(o),{animationOperations:o,events:[]}},y.prototype.handleUpdate=function(s,u){if(this.pendingRunnerIds.size>0)throw console.log(this.pendingRunnerIds),new Error("base_bc_resolver handleUpdate was called with pending runners remaining");var h=this.cachedOperations;return s.lastEventInfo.endedInningHalf&&(h=h.map(function(v){return n.__assign(n.__assign({},v),{result:"removed"})})),{animationOperations:h,events:[]}},y.prototype.cacheAnimationOperations=function(s){this.cachedOperations=s.filter(function(u){return u.result!=="out"&&u.result!=="scored"}).map(function(u){return n.__assign(n.__assign({},u),{fromBase:u.toBase})})},y.prototype.generateEventsIfNeeded=function(s){if(this.pendingRunnerIds.size>0)return{animationOperations:s,events:[]};var u=[];return this.remainingOuts>0?(u.push.apply(u,this.decisions.out.map(function(h){return(0,t.makeBaseRunningEvent)("out_on_last_play",h.toBase,h.playerId)})),u.push.apply(u,this.decisions.remained.sort(function(h,v){return h.toBase-v.toBase}).map(function(h){return(0,t.makeBaseRunningEvent)("remained_on_last_play",h.toBase,h.playerId)}))):(u.push.apply(u,this.decisions.remained.filter(function(h){return h.toBase===3}).map(function(h){return(0,t.makeBaseRunningEvent)("did_not_score",h.toBase,h.playerId)})),u.push.apply(u,this.decisions.out.map(function(h){return(0,t.makeBaseRunningEvent)("out_on_last_play",h.toBase,h.playerId)}))),{animationOperations:s,events:u}},y}(l.BasePlayResolver);return la.BaseBackwardsCompatibleResolver=p,la}var ud;function jy(){if(ud)return ua;ud=1,Object.defineProperty(ua,"__esModule",{value:!0}),ua.BCFieldersChoiceResolver=void 0;var n=X,l=Ke(),t=Ui(),p=function(d){n.__extends(y,d);function y(){return d!==null&&d.apply(this,arguments)||this}return y.prototype.markSafeAtHome=function(s,u,h){if(h.playerId!==s.playerId)return{animationOperations:u,events:[]};this.pendingRunnerIds.delete(s.playerId);var v=(0,l.getOperationForBase)(u,3),o=(0,l.getOperationForBase)(u,2),a=(0,l.changeOperationForRunnerId)(u,s.playerId,{result:"scored"});return v&&(a=(0,l.changeOperationForRunnerId)(a,v.playerId,{result:"resolution_set_standard"})),o&&(a=(0,l.changeOperationForRunnerId)(a,o.playerId,{result:"resolution_set_standard"})),this.cacheAnimationOperations(a),{animationOperations:a,events:[]}},y.prototype.markSafeOnBase=function(s,u){if(s.toBase===1||!this.pendingRunnerIds.has(s.playerId))return{animationOperations:u,events:[]};this.pendingRunnerIds.delete(s.playerId);var h=(0,l.changeOperationForRunnerId)(u,s.playerId,{result:"safe"}),v=(0,l.getPendingOperationForBase)(u,3,this.pendingRunnerIds),o=(0,l.getPendingOperationForBase)(u,2,this.pendingRunnerIds),a=u.filter(function(r){return r.toBase===3}).length;if(s.toBase===3&&a===2)o&&(this.pendingRunnerIds.delete(o.playerId),this.decisions.out.push({playerId:o.playerId,toBase:2}),this.remainingOuts-=1,h=(0,l.changeOperationForRunnerId)(h,o.playerId,{result:"out"})),this.decisions.remained.push({playerId:s.playerId,toBase:2}),h=(0,l.changeOperationForRunnerId)(h,s.playerId,{toBase:2});else if(s.toBase===2&&a===2){if(!v)throw Error("Fielders choice: There are two runners on 3rd and both are resolved. Unable to proceed.");this.pendingRunnerIds.delete(v.playerId),this.decisions.out.push({playerId:v.playerId,toBase:3}),this.remainingOuts-=1,h=(0,l.changeOperationForRunnerId)(h,v.playerId,{result:"out"})}return this.cacheAnimationOperations(h),this.generateEventsIfNeeded(h)},y.prototype.markSafe=function(s,u){var h=(0,l.getOperationForBase)(this.cachedOperations,4);return h?this.markSafeAtHome(s,this.cachedOperations,h):this.markSafeOnBase(s,this.cachedOperations)},y.prototype.markOutAtHome=function(s,u,h){if(h.playerId!==s.playerId)return{animationOperations:u,events:[]};this.pendingRunnerIds.delete(s.playerId),this.remainingOuts-=1,this.decisions.out.push({playerId:s.playerId,toBase:4});var v=(0,l.changeOperationForRunnerId)(u,s.playerId,{result:"out"});if(this.remainingOuts>0){var o=(0,l.getPendingOperationForBase)(u,3,this.pendingRunnerIds),a=(0,l.getPendingOperationForBase)(u,2,this.pendingRunnerIds);o&&(v=(0,l.changeOperationForRunnerId)(v,o.playerId,{result:"resolution_set_standard"})),a&&(v=(0,l.changeOperationForRunnerId)(v,a.playerId,{result:"resolution_set_standard"}))}else this.pendingRunnerIds.clear();return this.cacheAnimationOperations(v),this.generateEventsIfNeeded(v)},y.prototype.markOutOnBase=function(s,u){if(s.toBase===1||!this.pendingRunnerIds.has(s.playerId))return{animationOperations:u,events:[]};this.pendingRunnerIds.delete(s.playerId),this.decisions.out.push({playerId:s.playerId,toBase:s.toBase}),this.remainingOuts-=1;var h=(0,l.changeOperationForRunnerId)(u,s.playerId,{result:"out"});return this.remainingOuts===0&&this.pendingRunnerIds.clear(),this.cacheAnimationOperations(h),this.generateEventsIfNeeded(h)},y.prototype.markOut=function(s,u){var h=(0,l.getOperationForBase)(u,4);return h?this.markOutAtHome(s,u,h):this.markOutOnBase(s,u)},y.prototype.markSentBack=function(s,u){this.pendingRunnerIds.delete(s.playerId),this.decisions.remained.push({playerId:s.playerId,toBase:3});var h=(0,l.changeOperationForRunnerId)(u,s.playerId,{result:"safe",toBase:3}),v=(0,l.getPendingOperationForBase)(u,3,this.pendingRunnerIds),o=(0,l.getPendingOperationForBase)(u,2,this.pendingRunnerIds);return v&&(h=(0,l.changeOperationForRunnerId)(h,v.playerId,{result:"resolution_set_standard"})),o&&(h=(0,l.changeOperationForRunnerId)(h,o.playerId,{result:"resolution_set_standard"})),this.cacheAnimationOperations(h),this.generateEventsIfNeeded(h)},y}(t.BaseBackwardsCompatibleResolver);return ua.BCFieldersChoiceResolver=p,ua}var ca={},ld;function qy(){if(ld)return ca;ld=1,Object.defineProperty(ca,"__esModule",{value:!0}),ca.BCDoublePlayResolver=void 0;var n=X,l=Ke(),t=Ui(),p=function(d){n.__extends(y,d);function y(){return d!==null&&d.apply(this,arguments)||this}return y.prototype.firstUpdate=function(s,u){var h=d.prototype.firstUpdate.call(this,s,u),v=h.animationOperations,o=h.events;return this.pendingRunnerIds.size===1?this.automaticallyMarkOutOtherRunner(u):{animationOperations:v,events:o}},y.prototype.automaticallyMarkOutOtherRunner=function(s){var u=this.pendingRunnerIds.values().next().value,h=(0,l.getOperationForRunnerId)(s,u);if(!h)throw new Error("There should have been an operation for ".concat(u,", but it was missing"));return this.pendingRunnerIds.clear(),this.decisions.out.push({playerId:h.playerId,toBase:h.toBase}),this.remainingOuts-=1,s=(0,l.changeOperationForRunnerId)(s,h.playerId,{result:"out"}),this.cacheAnimationOperations(s),this.generateEventsIfNeeded(s)},y.prototype.markSafeAtHome=function(s,u,h){if(h.playerId!==s.playerId)return{animationOperations:u,events:[]};this.pendingRunnerIds.delete(s.playerId);var v=(0,l.changeOperationForRunnerId)(u,s.playerId,{result:"scored"});if(this.pendingRunnerIds.size===1)return this.automaticallyMarkOutOtherRunner(v);var o=(0,l.getOperationForBase)(u,3),a=(0,l.getOperationForBase)(u,2);return o&&(v=(0,l.changeOperationForRunnerId)(v,o.playerId,{result:"resolution_set_standard"})),a&&(v=(0,l.changeOperationForRunnerId)(v,a.playerId,{result:"resolution_set_standard"})),this.cacheAnimationOperations(v),{animationOperations:v,events:[]}},y.prototype.markSafeOnBase=function(s,u){if(s.toBase===1||!this.pendingRunnerIds.has(s.playerId))return{animationOperations:u,events:[]};var h=(0,l.changeOperationForRunnerId)(u,s.playerId,{result:"safe"}),v=(0,l.getPendingOperationForBase)(u,3,this.pendingRunnerIds),o=(0,l.getPendingOperationForBase)(u,2,this.pendingRunnerIds);if(!o||!v)throw new Error("bc_double_play_resolver: There should have been runners on 2nd and 3rd, but one or both is missing.");this.pendingRunnerIds.delete(s.playerId);var a;if(s.toBase===2)a=v;else if(s.toBase===3)a=o;else throw new Error("bc_dp_resolver: markSafeOnBase. runnerOperation should be for 2nd or 3rd, but was ".concat(s.toBase));this.pendingRunnerIds.delete(a.playerId),this.decisions.out.push({playerId:a.playerId,toBase:a.toBase}),this.remainingOuts-=1,h=(0,l.changeOperationForRunnerId)(h,a.playerId,{result:"out"});var r=u.filter(function(e){return e.toBase===3}).length;return s.toBase===3&&r===2&&(this.decisions.remained.push({playerId:s.playerId,toBase:2}),h=(0,l.changeOperationForRunnerId)(h,s.playerId,{toBase:2})),this.cacheAnimationOperations(h),this.generateEventsIfNeeded(h)},y.prototype.markSafe=function(s,u){var h=(0,l.getOperationForBase)(this.cachedOperations,4);return h?this.markSafeAtHome(s,this.cachedOperations,h):this.markSafeOnBase(s,this.cachedOperations)},y.prototype.markOutAtHome=function(s,u,h){if(h.playerId!==s.playerId)return{animationOperations:u,events:[]};this.pendingRunnerIds.delete(s.playerId),this.remainingOuts-=1,this.decisions.out.push({playerId:s.playerId,toBase:4});var v=(0,l.changeOperationForRunnerId)(u,s.playerId,{result:"out"});return this.pendingRunnerIds.clear(),this.cacheAnimationOperations(v),this.generateEventsIfNeeded(v)},y.prototype.markOutOnBase=function(s,u){if(s.toBase===1||!this.pendingRunnerIds.has(s.playerId))return{animationOperations:u,events:[]};this.pendingRunnerIds.delete(s.playerId),this.decisions.out.push({playerId:s.playerId,toBase:s.toBase}),this.remainingOuts-=1;var h=(0,l.changeOperationForRunnerId)(u,s.playerId,{result:"out"});this.pendingRunnerIds.forEach(function(a){return h=(0,l.changeOperationForRunnerId)(h,a,{result:"safe"})});var v=h.filter(function(a){return a.toBase===3&&a.result==="safe"}).length;if(s.toBase===2&&v===2){var o=(0,l.getPendingOperationForBase)(u,3,this.pendingRunnerIds);if(!o)throw new Error("bc_dp_resolver: Could not find expected pending runner on 3rd");this.decisions.remained.push({playerId:o.playerId,toBase:2}),h=(0,l.changeOperationForRunnerId)(h,o.playerId,{toBase:2,result:"safe"}),this.pendingRunnerIds.delete(o.playerId)}return this.pendingRunnerIds.clear(),this.cacheAnimationOperations(h),this.generateEventsIfNeeded(h)},y.prototype.markOut=function(s,u){var h=(0,l.getOperationForBase)(u,4);return h?this.markOutAtHome(s,u,h):this.markOutOnBase(s,u)},y.prototype.markSentBack=function(s,u){this.pendingRunnerIds.delete(s.playerId),this.decisions.remained.push({playerId:s.playerId,toBase:3});var h=(0,l.changeOperationForRunnerId)(u,s.playerId,{result:"safe",toBase:3});if(this.pendingRunnerIds.size===1)return this.automaticallyMarkOutOtherRunner(h);var v=(0,l.getPendingOperationForBase)(u,3,this.pendingRunnerIds),o=(0,l.getPendingOperationForBase)(u,2,this.pendingRunnerIds);return v&&(h=(0,l.changeOperationForRunnerId)(h,v.playerId,{result:"resolution_set_standard"})),o&&(h=(0,l.changeOperationForRunnerId)(h,o.playerId,{result:"resolution_set_standard"})),this.cacheAnimationOperations(h),this.generateEventsIfNeeded(h)},y}(t.BaseBackwardsCompatibleResolver);return ca.BCDoublePlayResolver=p,ca}var da={},cd;function Uy(){if(cd)return da;cd=1,Object.defineProperty(da,"__esModule",{value:!0}),da.BCTriplePlayResolver=void 0;var n=X,l=Ke(),t=Ui(),p=function(d){n.__extends(y,d);function y(){return d!==null&&d.apply(this,arguments)||this}return y.prototype.firstUpdate=function(s,u){var h=d.prototype.firstUpdate.call(this,s,u),v=h.animationOperations,o=h.events;return this.pendingRunnerIds.size===2?this.automaticallyMarkOutOtherRunners(u):{animationOperations:v,events:o}},y.prototype.automaticallyMarkOutOtherRunners=function(s){var u=this;return this.pendingRunnerIds.forEach(function(h){var v=(0,l.getOperationForRunnerId)(s,h);if(!v)throw new Error("There should have been an operation for ".concat(h,", but it was missing"));u.decisions.out.push({playerId:v.playerId,toBase:v.toBase}),s=(0,l.changeOperationForRunnerId)(s,v.playerId,{result:"out"}),u.remainingOuts-=1}),this.pendingRunnerIds.clear(),this.cacheAnimationOperations(s),this.generateEventsIfNeeded(s)},y.prototype.markSafeAtHome=function(s,u,h){if(h.playerId!==s.playerId)return{animationOperations:u,events:[]};this.pendingRunnerIds.delete(s.playerId);var v=(0,l.changeOperationForRunnerId)(u,s.playerId,{result:"scored"});if(this.pendingRunnerIds.size===2)return this.automaticallyMarkOutOtherRunners(v);throw new Error("bc_tp_resolver. Should have been two other pending runners.")},y.prototype.markSafeOnBase=function(s,u){if(s.toBase===1||!this.pendingRunnerIds.has(s.playerId))return{animationOperations:u,events:[]};var h=(0,l.changeOperationForRunnerId)(u,s.playerId,{result:"safe"}),v=(0,l.getPendingOperationForBase)(u,3,this.pendingRunnerIds),o=(0,l.getPendingOperationForBase)(u,2,this.pendingRunnerIds);if(!o||!v)throw new Error("bc_triple_play_resolver: There should have been runners on 2nd and 3rd, but one or both is missing.");this.pendingRunnerIds.delete(s.playerId);var a;if(s.toBase===2)a=v;else if(s.toBase===3)a=o;else throw new Error("bc_tp_resolver: markSafeOnBase. runnerOperation should be for 2nd or 3rd, but was ".concat(s.toBase));return this.pendingRunnerIds.delete(a.playerId),this.decisions.out.push({playerId:a.playerId,toBase:a.toBase}),this.remainingOuts-=1,h=(0,l.changeOperationForRunnerId)(h,a.playerId,{result:"out"}),this.cacheAnimationOperations(h),this.generateEventsIfNeeded(h)},y.prototype.markSafe=function(s,u){var h=(0,l.getOperationForBase)(this.cachedOperations,4);return h?this.markSafeAtHome(s,this.cachedOperations,h):this.markSafeOnBase(s,this.cachedOperations)},y.prototype.markOutAtHome=function(s,u,h){if(h.playerId!==s.playerId)return{animationOperations:u,events:[]};this.pendingRunnerIds.delete(s.playerId),this.remainingOuts-=1,this.decisions.out.push({playerId:s.playerId,toBase:4});var v=(0,l.changeOperationForRunnerId)(u,s.playerId,{result:"out"});return this.pendingRunnerIds.forEach(function(o){v=(0,l.changeOperationForRunnerId)(v,o,{result:"resolution_set_standard"})}),this.cacheAnimationOperations(v),this.generateEventsIfNeeded(v)},y.prototype.markOutOnBase=function(s,u){if(s.toBase===1||!this.pendingRunnerIds.has(s.playerId))return{animationOperations:u,events:[]};this.pendingRunnerIds.delete(s.playerId),this.decisions.out.push({playerId:s.playerId,toBase:s.toBase}),this.remainingOuts-=1;var h=(0,l.changeOperationForRunnerId)(u,s.playerId,{result:"out"});return this.pendingRunnerIds.forEach(function(v){return h=(0,l.changeOperationForRunnerId)(h,v,{result:"safe"})}),this.pendingRunnerIds.clear(),this.cacheAnimationOperations(h),this.generateEventsIfNeeded(h)},y.prototype.markOut=function(s,u){var h=(0,l.getOperationForBase)(u,4);return h?this.markOutAtHome(s,u,h):this.markOutOnBase(s,u)},y.prototype.markSentBack=function(s,u){this.pendingRunnerIds.delete(s.playerId),this.decisions.remained.push({playerId:s.playerId,toBase:3});var h=(0,l.changeOperationForRunnerId)(u,s.playerId,{result:"safe",toBase:3});return this.automaticallyMarkOutOtherRunners(h)},y}(t.BaseBackwardsCompatibleResolver);return da.BCTriplePlayResolver=p,da}var fa={},dd;function Wy(){if(dd)return fa;dd=1,Object.defineProperty(fa,"__esModule",{value:!0}),fa.BCFCDoublePlayResolver=void 0;var n=X,l=Ke(),t=Ui(),p=function(d){n.__extends(y,d);function y(){return d!==null&&d.apply(this,arguments)||this}return y.prototype.firstUpdate=function(s,u){var h=d.prototype.firstUpdate.call(this,s,u),v=h.animationOperations,o=h.events;return this.pendingRunnerIds.size===2?this.automaticallyMarkOutOtherRunners(u):{animationOperations:v,events:o}},y.prototype.automaticallyMarkOutOtherRunners=function(s){var u=this;return this.pendingRunnerIds.forEach(function(h){var v=(0,l.getOperationForRunnerId)(s,h);if(!v)throw new Error("There should have been an operation for ".concat(h,", but it was missing"));u.decisions.out.push({playerId:v.playerId,toBase:v.toBase}),s=(0,l.changeOperationForRunnerId)(s,v.playerId,{result:"out"}),u.remainingOuts-=1}),this.pendingRunnerIds.clear(),this.cacheAnimationOperations(s),this.generateEventsIfNeeded(s)},y.prototype.markSafeAtHome=function(s,u,h){if(h.playerId!==s.playerId)return{animationOperations:u,events:[]};this.pendingRunnerIds.delete(s.playerId);var v=(0,l.changeOperationForRunnerId)(u,s.playerId,{result:"scored"});if(this.pendingRunnerIds.size===2)return this.automaticallyMarkOutOtherRunners(v);throw new Error("bc_fc_dp_resolver. Should have been two other pending runners.")},y.prototype.markSafeOnBase=function(s,u){if(s.toBase===1||!this.pendingRunnerIds.has(s.playerId))return{animationOperations:u,events:[]};var h=(0,l.changeOperationForRunnerId)(u,s.playerId,{result:"safe"}),v=(0,l.getPendingOperationForBase)(u,3,this.pendingRunnerIds),o=(0,l.getPendingOperationForBase)(u,2,this.pendingRunnerIds);if(!o||!v)throw new Error("bc_fc_double_play_resolver: There should have been runners on 2nd and 3rd, but one or both is missing.");this.pendingRunnerIds.delete(s.playerId);var a;if(s.toBase===2)a=v;else if(s.toBase===3)a=o;else throw new Error("bc_fc_dp_resolver: markSafeOnBase. runnerOperation should be for 2nd or 3rd, but was ".concat(s.toBase));this.pendingRunnerIds.delete(a.playerId),this.decisions.out.push({playerId:a.playerId,toBase:a.toBase}),this.remainingOuts-=1,h=(0,l.changeOperationForRunnerId)(h,a.playerId,{result:"out"});var r=u.filter(function(e){return e.toBase===3}).length;return s.toBase===3&&r===2&&(this.decisions.remained.push({playerId:s.playerId,toBase:2}),h=(0,l.changeOperationForRunnerId)(h,s.playerId,{toBase:2})),this.cacheAnimationOperations(h),this.generateEventsIfNeeded(h)},y.prototype.markSafe=function(s,u){var h=(0,l.getOperationForBase)(this.cachedOperations,4);return h?this.markSafeAtHome(s,this.cachedOperations,h):this.markSafeOnBase(s,this.cachedOperations)},y.prototype.markOutAtHome=function(s,u,h){if(h.playerId!==s.playerId)return{animationOperations:u,events:[]};this.pendingRunnerIds.delete(s.playerId),this.remainingOuts-=1,this.decisions.out.push({playerId:s.playerId,toBase:4});var v=(0,l.changeOperationForRunnerId)(u,s.playerId,{result:"out"});return this.pendingRunnerIds.forEach(function(o){v=(0,l.changeOperationForRunnerId)(v,o,{result:"resolution_set_standard"})}),this.cacheAnimationOperations(v),this.generateEventsIfNeeded(v)},y.prototype.markOutOnBase=function(s,u){if(s.toBase===1||!this.pendingRunnerIds.has(s.playerId))return{animationOperations:u,events:[]};this.pendingRunnerIds.delete(s.playerId),this.decisions.out.push({playerId:s.playerId,toBase:s.toBase}),this.remainingOuts-=1;var h=(0,l.changeOperationForRunnerId)(u,s.playerId,{result:"out"});this.pendingRunnerIds.forEach(function(a){return h=(0,l.changeOperationForRunnerId)(h,a,{result:"safe"})});var v=h.filter(function(a){return a.toBase===3&&a.result==="safe"}).length;if(s.toBase===2&&v===2){var o=(0,l.getPendingOperationForBase)(u,3,this.pendingRunnerIds);if(!o)throw new Error("bc_dp_resolver: Could not find expected pending runner on 3rd");this.decisions.remained.push({playerId:o.playerId,toBase:2}),h=(0,l.changeOperationForRunnerId)(h,o.playerId,{toBase:2,result:"safe"}),this.pendingRunnerIds.delete(o.playerId)}return this.pendingRunnerIds.clear(),this.cacheAnimationOperations(h),this.generateEventsIfNeeded(h)},y.prototype.markOut=function(s,u){var h=(0,l.getOperationForBase)(u,4);return h?this.markOutAtHome(s,u,h):this.markOutOnBase(s,u)},y.prototype.markSentBack=function(s,u){this.pendingRunnerIds.delete(s.playerId),this.decisions.remained.push({playerId:s.playerId,toBase:3});var h=(0,l.changeOperationForRunnerId)(u,s.playerId,{result:"safe",toBase:3});if(this.pendingRunnerIds.size===2)return this.automaticallyMarkOutOtherRunners(h);throw new Error("bc_fc_dp_resolver. Could not find expected two other base runners")},y}(t.BaseBackwardsCompatibleResolver);return fa.BCFCDoublePlayResolver=p,fa}var fd;function $y(){if(fd)return zn;fd=1,Object.defineProperty(zn,"__esModule",{value:!0}),zn.BasePlayResolverFactory=void 0;var n=Kc(),l=Fy(),t=ky(),p=wy(),d=Cy(),y=My(),s=xy(),u=Ly(),h=Dy(),v=Gy(),o=Hy(),a=Ny(),r=jy(),e=qy(),i=Uy(),c=Wy(),f=function(){function _(){}return _.create=function(S,P,I,E,B){var b=S;switch(b.attributes.playResult){case"single":case"sacrifice_bunt_error":case"sacrifice_fly_error":case"error":return new n.SingleResolver(E);case"double":return new l.DoubleResolver;case"triple":return new y.TripleResolver;case"sacrifice_bunt":return b.attributes.extendedPlayResult==="batter_safe"?new n.SingleResolver(E):new h.SacrificeBuntResolver;case"dropped_third_strike":var R=S;return new a.DroppedThirdStrikeResolver(E,R.attributes.cause);case"fielders_choice":switch(b.attributes.extendedPlayResult){case"double_play":if(this.isValidFieldersChoiceDoublePlayState(P,I))return this.shouldUseBackwardsCompatibleResolver(P,B)?new c.BCFCDoublePlayResolver:new p.FieldersChoiceDoublePlayResolver;break;case"triple_play":if(this.isValidFieldersChoiceTriplePlayState(P,I))return new d.FieldersChoiceTriplePlayResolver;break}return this.shouldUseBackwardsCompatibleResolver(P,B)?new r.BCFieldersChoiceResolver:new t.FieldersChoiceResolver;case"batter_out":var F=1;switch(b.attributes.extendedPlayResult){case"double_play":this.isValidDoublePlayState(P,I)&&(F=2);break;case"triple_play":this.isValidTriplePlayState(P,I)&&(F=3);break}return new s.AirOutResolver(F);case"batter_out_advance_runners":switch(b.attributes.extendedPlayResult){case"double_play":if(this.isValidDoublePlayState(P,I))return this.shouldUseBackwardsCompatibleResolver(P,B)?new e.BCDoublePlayResolver:new v.DoublePlayResolver;break;case"triple_play":if(this.isValidTriplePlayState(P,I))return this.shouldUseBackwardsCompatibleResolver(P,B)?new i.BCTriplePlayResolver:new o.TriplePlayResolver;break}return new u.BatterOutAdvanceRunnersResolver;default:return}},_.isValidFieldersChoiceDoublePlayState=function(S,P){return S.gameSituation.remainingOuts>=2&&P.length>=3},_.isValidFieldersChoiceTriplePlayState=function(S,P){return S.gameSituation.remainingOuts>=3&&P.length>=4},_.isValidDoublePlayState=function(S,P){return(S.gameSituation.remainingOuts===1||S.gameSituation.remainingOuts===2)&&P.length>=2},_.isValidTriplePlayState=function(S,P){return S.gameSituation.remainingOuts===2&&P.length>=3},_.shouldUseBackwardsCompatibleResolver=function(S,P){return S.scoredOnLastEvent.length!==0&&P},_}();return zn.BasePlayResolverFactory=f,zn}var pd;function Vy(){if(pd)return Vn;pd=1,Object.defineProperty(Vn,"__esModule",{value:!0}),Vn.BaserunnerResolver=void 0;var n=X,l=$y(),t=Ke(),p=function(){function d(y,s){this.isViolationAvailable=y,this.backwardsCompatibleSentBackRunner=s,this.cachedAnimationOperations=[]}return d.prototype.isUsingBackwardsCompatibleResolver=function(){var y,s;return(s=(y=this.resolver)===null||y===void 0?void 0:y.isBackwardsCompatibleResolver())!==null&&s!==void 0?s:!1},d.prototype.pushScratchEvents=function(y,s,u){var h,v;if(this.resolver!==void 0){var o=this.resolver.handleUpdate(s,u);return this.updateCachedAnimationOperations(o.animationOperations),o}var a=y.find(function(e){return e.code==="ball_in_play"});if(a===void 0)return{animationOperations:u,events:[]};this.resolver=l.BasePlayResolverFactory.create(a,s,u,this.isViolationAvailable,this.backwardsCompatibleSentBackRunner);var r=(v=(h=this.resolver)===null||h===void 0?void 0:h.firstUpdate(s,u))!==null&&v!==void 0?v:{animationOperations:u,events:[]};return this.updateCachedAnimationOperations(r.animationOperations),r},d.prototype.updateCachedAnimationOperations=function(y){this.cachedAnimationOperations=y.filter(function(s){switch(s.result){case"removed":case"out":case"scored":case"subbedOut":case"poof":return!1;case"resolution_set_back":case"resolution_set_standard":case"resolution_set_violation":case"safe":case"subbedIn":return!0;default:throw"Unknown operation result ".concat(s.result)}}).map(function(s){return n.__assign(n.__assign({},s),{fromBase:s.toBase})})},d.prototype.markResolution=function(y,s){var u,h,v=(0,t.getOperationForRunnerId)(this.cachedAnimationOperations,s);if(!this.isValidResolution(y,v))return{animationOperations:this.cachedAnimationOperations,events:[]};var o=(h=(u=this.resolver)===null||u===void 0?void 0:u.markResolution(y,v,this.cachedAnimationOperations))!==null&&h!==void 0?h:{animationOperations:[],events:[]};return this.updateCachedAnimationOperations(o.animationOperations),o},d.prototype.isValidResolution=function(y,s){return s===void 0?!1:y==="violation"||y==="sent_back"?s.toBase===4:!0},d}();return Vn.BaserunnerResolver=p,Vn}var Rr={},_t={},hd;function Fr(){if(hd)return _t;hd=1,Object.defineProperty(_t,"__esModule",{value:!0}),_t.inRange=_t.getRandomInt=_t.xor=_t.bin=_t.safeSum=void 0;var n=X,l=n.__importStar(Pe);function t(){for(var u=[],h=0;h<arguments.length;h++)u[h]=arguments[h];return l.reduce(u,function(v,o){return v+(o||0)},0)}_t.safeSum=t;function p(u){return u?1:0}_t.bin=p;var d=function(u,h){return!u&&h||u&&!h};_t.xor=d;function y(u){return Math.floor(Math.random()*u)}_t.getRandomInt=y;function s(u,h,v){return(u-h)*(u-v)<=0}return _t.inRange=s,_t}var yd;function zy(){if(yd)return Rr;yd=1,Object.defineProperty(Rr,"__esModule",{value:!0}),Rr.BaserunnerEngine=Rr.BaserunnerState=void 0;var n=X,l=n.__importStar(fe()),t=n.__importStar(Rt()),p=n.__importStar(Ee()),d=n.__importStar(Oe()),y=Fr(),s=Ge(),u=function(v){n.__extends(o,v);function o(){return v!==null&&v.apply(this,arguments)||this}return o.prototype.playerAtBase=function(a){return this.getIn(["bases",a])},o.prototype.baseForPlayer=function(a){for(var r=0,e=[1,2,3,-3,-2];r<e.length;r++){var i=e[r];if(this.playerAtBase(i)===a)return i}},o.prototype.globalAtBatIdForPlayer=function(a){return this.getIn(["globalAtBatIds",a])},o.prototype.setGlobalAtBatIdForPlayer=function(a,r){return this.setIn(["globalAtBatIds",a],r)},o.prototype.deleteGlobalAtBatIdForPlayer=function(a){return this.deleteIn(["globalAtBatIds",a])},Object.defineProperty(o.prototype,"scoresImmutable",{get:function(){return this.get("scores").mergeDeep(this.get("scoreEdits"))},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"scores",{get:function(){return this.scoresImmutable.toJS()},enumerable:!1,configurable:!0}),o.prototype.scoreForTeam=function(a){return this.scoresImmutable.get(a)},Object.defineProperty(o.prototype,"baserunnersImmutable",{get:function(){return this.get("bases")},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"baserunners",{get:function(){return this.get("bases").toJS()},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"runnersScoredOnLastEvent",{get:function(){return this.get("scoredOnLastEvent").toJS()},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"runnersUnscoredOnLastEvent",{get:function(){return this.get("unscoredOnLastEvent").toJS()},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"runnersOnBase",{get:function(){var a=this.baserunners,r=0;return r+=(0,y.bin)(a[1]!==void 0),r+=(0,y.bin)(a[2]!==void 0),r+=(0,y.bin)(a[3]!==void 0),r},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"leftOnBaserunners",{get:function(){return this.get("left_bases").toJS()},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"runnersLeftOnBase",{get:function(){var a=this.leftOnBaserunners,r=0;return r+=(0,y.bin)(a[1]!==void 0),r+=(0,y.bin)(a[2]!==void 0),r+=(0,y.bin)(a[3]!==void 0),r},enumerable:!1,configurable:!0}),o.prototype.copyBasesToLeft=function(){return this.withMutations(function(a){a.set("left_bases",l.Map()),a.setIn(["left_bases",1],a.getIn(["bases",1])),a.setIn(["left_bases",2],a.getIn(["bases",2])),a.setIn(["left_bases",3],a.getIn(["bases",3]))})},o.prototype.addAnimationOperationsToRemoveAllRunners=function(){for(var a=this,r=1;r<4;r+=1)a=a.addAnimationOperation(this.playerAtBase(r),"removed",r,r);return a=a.addAnimationOperation(this.playerAtBase(-3),"removed",3,3).addAnimationOperation(this.playerAtBase(-2),"removed",2,2),a},o.prototype.resetBases=function(){return this.set("bases",l.Map()).setIn(["bases",1],void 0).setIn(["bases",2],void 0).setIn(["bases",3],void 0).setIn(["bases",-3],void 0).setIn(["bases",-2],void 0)},o.prototype.clearGlobalAtBatIds=function(){return this.set("globalAtBatIds",this.get("globalAtBatIds").clear())},o.prototype.removePlayerFromBases=function(a){var r=this.baseForPlayer(a);return r===void 0?this:this.setIn(["bases",r],void 0)},o.prototype.incrementScore=function(a,r){return this.incrementIn(["scores",r],a)},o.prototype.setScore=function(a,r){return this.setIn(["scores",r],a)},o.prototype.scoreRunner=function(a,r){return this.incrementScore(1,a).update("scoredOnLastEvent",function(e){return e.push(r)})},o.prototype.unscoreRunner=function(a,r){return this.incrementScore(-1,a).update("unscoredOnLastEvent",function(e){return e.push(r)})},o.prototype.clearRunnerLists=function(){return this.update("scoredOnLastEvent",function(a){return a.clear()}).update("unscoredOnLastEvent",function(a){return a.clear()})},o.prototype.addRunnerToBase=function(a,r,e){return a>=4?this.scoreRunner(e,r):this.setIn(["bases",a],r)},o.prototype.reconcileSentBackRunner=function(a,r){var e=this.playerAtBase(a);if(!e)return this;var i=this.playerAtBase(-a);return i?this:this.removePlayerFromBases(e).addRunnerToBase(-a,e,r)},o.prototype.resetAnimationOperations=function(){return this.set("animationOperations",l.List())},o.prototype.addAnimationOperation=function(a,r,e,i,c){return a===void 0?this:this.update("animationOperations",function(f){return c?f.push({playerId:a,result:i>=4&&r==="safe"?"scored":r,fromBase:e,toBase:i>=4?4:i,inverseResult:c}):f.push({playerId:a,result:i>=4&&r==="safe"?"scored":r,fromBase:e,toBase:i>=4?4:i})})},o.prototype.animationOperations=function(){return this.get("animationOperations").toJS()},o}(d.ImmutableState);Rr.BaserunnerState=u;var h=function(v){n.__extends(o,v);function o(a,r,e){var i=v.call(this,a)||this;return i.baseEvents=a,i.situation=r,i.lineup=e,i}return o.prototype.initialState=function(){var a=new u(l.fromJS({bases:{},scores:{},scoreEdits:{},left_bases:{},scoredOnLastEvent:[],unscoredOnLastEvent:[],globalAtBatIds:{},animationOperations:[]}));return a.resetBases()},o.prototype.processOneEvent=function(a,r){switch(a=a.clearRunnerLists().resetAnimationOperations(),r.code){case"set_teams":a=this.setTeams(a,r);break;case"end_half":a=this.endHalf(a);break;case"replace_runner":a=this.replaceRunner(a,r);break;case"swap_players":a=this.swapPlayers(a,r);break;case"sub_players":a=this.subPlayers(a,r);break;case"end_at_bat":a=this.endAtBat(a,r);break;case"balk":a=this.balk(a);break;case"illegal_pitch_advance":a=this.illegalPitchAdvance(a);break;case"ball_in_play":a=this.ballInPlay(a,r);break;case"base_running":a=this.baseRunning(a,r);break;case"place_batter":a=this.placeBatter(a,r);break;case"place_runner":a=this.placeRunner(a,r);break;case"override":a=this.override(a,r);break;case"pitch":a=this.pitch(a,r);break;case"team_stat_edit":a=this.teamStatEdit(a,r);break;case"clear_all_edits":a=this.clearAllEdits(a);break}return a=a.copyBasesToLeft(),a=this.reconcileOuts(a),this.reconcileSentBackRunners(a)},o.prototype.teamStatEdit=function(a,r){return r.statName==="R"&&r.category==="offense"&&(a=a.setIn(["scoreEdits",r.teamId],r.statValue)),a},o.prototype.clearAllEdits=function(a){return a.update("scoreEdits",function(r){return r.clear()})},Object.defineProperty(o.prototype,"lastLineupState",{get:function(){return this.lineup.stateBeforeEvent(this.nextEventOffset)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"lastSituationState",{get:function(){return this.situation.stateBeforeEvent(this.nextEventOffset)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"nextSituationState",{get:function(){return this.situation.stateBeforeEvent(this.nextEventOffset+1)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"currentBatter",{get:function(){return this.lastLineupState.currentBatter(this.lastSituationState.atBatTeamId)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"battingTeam",{get:function(){return this.lastSituationState.atBatTeamId},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"outsBeforePlay",{get:function(){return this.lastSituationState.outs},enumerable:!1,configurable:!0}),o.prototype.reconcileOuts=function(a){return this.nextSituationState.lastEventEndedInning?a.addAnimationOperationsToRemoveAllRunners().resetBases().clearGlobalAtBatIds():a},o.prototype.reconcileSentBackRunners=function(a){return this.nextSituationState.lastEventEndedInning?a:a.reconcileSentBackRunner(-3,this.battingTeam).reconcileSentBackRunner(-2,this.battingTeam)},o.prototype.walk=function(a){var r;for(r=1;r<=4&&a.playerAtBase(r)!==void 0;r+=1);for(var e=r;e>1;e-=1){var i=a.playerAtBase(e-1);a=a.addAnimationOperation(i,"safe",e-1,e).addRunnerToBase(e,a.playerAtBase(e-1),this.battingTeam)}var c=this.lastLineupState.currentBatter(this.lastSituationState.atBatTeamId);return a=a.addAnimationOperation(c,"safe",0,1).addRunnerToBase(1,c,this.battingTeam),a.setGlobalAtBatIdForPlayer(c,this.lastLineupState.globalAtBatId)},o.prototype.strikeout=function(a){return a.addAnimationOperation(this.currentBatter,"out",0,0)},o.prototype.advanceRunners=function(a,r){if(r===0)return a;for(var e=3;e>=1;e-=1){var i=a.playerAtBase(e);i!==void 0&&(a=a.addAnimationOperation(i,"safe",e,e+r).addRunnerToBase(e+r,i,this.battingTeam),a=a.addRunnerToBase(e,void 0,this.battingTeam))}return a},o.prototype.setTeams=function(a,r){return a.setIn(["scores",r.attributes.homeId],0).setIn(["scores",r.attributes.awayId],0)},o.prototype.endHalf=function(a){return a.addAnimationOperationsToRemoveAllRunners().resetBases()},o.prototype.replaceRunner=function(a,r){var e=r.attributes,i=e.incomingPlayerId,c=e.outgoingPlayerId,f=a.baseForPlayer(c);return f===void 0?a:a.addAnimationOperation(c,"subbedOut",f,f).addAnimationOperation(i,"subbedIn",f,f).removePlayerFromBases(c).addRunnerToBase(f,i,this.battingTeam).setGlobalAtBatIdForPlayer(i,a.globalAtBatIdForPlayer(c)).deleteGlobalAtBatIdForPlayer(c)},o.prototype.swapPlayers=function(a,r){var e=r.attributes,i=e.firstPlayerId,c=e.secondPlayerId,f=a.baseForPlayer(i),_=a.baseForPlayer(c),S=a.globalAtBatIdForPlayer(i),P=a.globalAtBatIdForPlayer(c);return a=a.removePlayerFromBases(i).removePlayerFromBases(c).deleteGlobalAtBatIdForPlayer(i).deleteGlobalAtBatIdForPlayer(c),f!==void 0&&(a=a.addAnimationOperation(i,"subbedOut",f,f).addAnimationOperation(c,"subbedIn",f,f).addRunnerToBase(f,c,this.battingTeam).setGlobalAtBatIdForPlayer(c,S)),_!==void 0&&(a=a.addAnimationOperation(c,"subbedOut",_,_).addAnimationOperation(i,"subbedIn",_,_).addRunnerToBase(_,i,this.battingTeam).setGlobalAtBatIdForPlayer(i,P)),a},o.prototype.subPlayers=function(a,r){var e=r.attributes,i=e.incomingPlayerId,c=e.outgoingPlayerId,f=e.applyToBaserunners;if(f!==!0)return a;var _=a.baseForPlayer(c),S=a.baseForPlayer(i);return a=a.removePlayerFromBases(i).removePlayerFromBases(c),_===void 0?a:(a=a.addAnimationOperation(c,"subbedOut",_,_),S!==void 0&&(a=a.addAnimationOperation(i,"subbedOut",S,S)),a.addAnimationOperation(i,"subbedIn",_,_).addRunnerToBase(_,i,this.battingTeam).setGlobalAtBatIdForPlayer(i,a.globalAtBatIdForPlayer(c)).deleteGlobalAtBatIdForPlayer(c))},o.prototype.endAtBat=function(a,r){switch(r.attributes.reason){case"walk":case"hit_by_pitch":case"catcher_interference":return this.walk(a);case"strikeout":return this.strikeout(a)}return a},o.prototype.balk=function(a){return this.advanceRunners(a,1)},o.prototype.illegalPitchAdvance=function(a){return a=this.advanceRunners(a,1),this.nextSituationState.lastEventWasWalk?a.addAnimationOperation(this.currentBatter,"safe",0,1).addRunnerToBase(1,this.currentBatter,this.battingTeam).setGlobalAtBatIdForPlayer(this.currentBatter,this.lastLineupState.globalAtBatId):a},o.prototype.ballInPlay=function(a,r){var e=r.attributes.playResult,i=t.ballInPlayResultConfigs[e],c=i.batterOut&&(this.outsBeforePlay===2||r.attributes.playResult==="dropped_third_strike_batter_out");return c||(a=this.advanceRunners(a,i.bases)),i.batterOut?a.addAnimationOperation(this.currentBatter,"out",0,i.bases):a.addAnimationOperation(this.currentBatter,"safe",0,i.bases).addRunnerToBase(i.bases,this.currentBatter,this.battingTeam).setGlobalAtBatIdForPlayer(this.currentBatter,this.lastLineupState.globalAtBatId)},o.prototype.baseRunning=function(a,r){var e,i=r.attributes,c=i.playType,f=i.runnerId,_=i.base,S=i.playFlavor,P=t.baseRunningPlayTypeConfigs[c],I=(e=a.baseForPlayer(f))!==null&&e!==void 0?e:4;return I===4?a=a.unscoreRunner(this.battingTeam,f):a=a.removePlayerFromBases(f),P.runnerOut?a=a.addAnimationOperation(f,"out",I,_):!P.runnerOut&&c!=="did_not_score"?I===4&&_===3?a=a.addAnimationOperation(f,"safe",I,_).addRunnerToBase(-3,f,this.battingTeam):I===3&&_===2?a=a.addAnimationOperation(f,"safe",I,_).addRunnerToBase(-2,f,this.battingTeam):a=a.addAnimationOperation(f,"safe",I,_).addRunnerToBase(_,f,this.battingTeam):c==="did_not_score"&&(S==="inning_ended"?a=a.addAnimationOperation(f,"removed",_,_):a=a.addAnimationOperation(f,"poof",_,_)),a},o.prototype.placeBatter=function(a,r){return a.addAnimationOperation(this.currentBatter,"safe",0,r.attributes.base).addRunnerToBase(r.attributes.base,this.currentBatter,this.battingTeam).setGlobalAtBatIdForPlayer(this.currentBatter,this.lastLineupState.globalAtBatId)},o.prototype.placeRunner=function(a,r){return a.addAnimationOperation(r.attributes.runnerId,"safe",r.attributes.base,r.attributes.base,"removed").addRunnerToBase(r.attributes.base,r.attributes.runnerId,this.battingTeam).setGlobalAtBatIdForPlayer(r.attributes.runnerId,(0,s.uuid4)())},o.prototype.override=function(a,r){if((r.attributes.inning!==void 0||r.attributes.half!==void 0)&&(a=a.addAnimationOperationsToRemoveAllRunners().resetBases()),r.attributes.scores!==void 0)for(var e=0,i=r.attributes.scores;e<i.length;e++){var c=i[e],f=c.teamId,_=c.score;a=a.setScore(_,f)}return a},o.prototype.pitch=function(a,r){return r.attributes.advancesRunners&&(a=this.advanceRunners(a,1)),this.nextSituationState.lastEventWasWalk?this.walk(a):this.nextSituationState.lastEventWasStrikeout?this.strikeout(a):a},o}(p.VersionedStateEngine);return Rr.BaserunnerEngine=h,Rr}var co={},St={},vd;function gd(){if(vd)return St;vd=1,Object.defineProperty(St,"__esModule",{value:!0}),St.valueFromMaybe=St.maybeIsSet=St.unsetMaybe=St.maybeWithValue=St.Nothing=void 0;var n=function(){function y(){}return y}();St.Nothing=n;function l(y){return{value:y,isSet:!0}}St.maybeWithValue=l;function t(){return{value:void 0,isSet:!1}}St.unsetMaybe=t;function p(y){return y.isSet}St.maybeIsSet=p;function d(y){return y.isSet?y.value:new n}return St.valueFromMaybe=d,St}var _d;function Ky(){return _d||(_d=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.EarnedRunEngine=n.EarnedRunState=n.Runner=n.runnerRecord=void 0;var l=X,t=l.__importStar(Pe),p=l.__importStar(fe()),d=l.__importStar(Ee()),y=l.__importStar(Oe()),s=l.__importStar(Rt()),u=l.__importStar(gd());n.runnerRecord=p.Record({runnerId:void 0,pitcherId:void 0,qualified:!1,earnedBase:void 0,leadoff:!1,walked:!1,reachedOnCatcherInterference:!1,out:!1,didNotScore:!1,scoredOnEventIndex:void 0,unscoredOnEventIndex:void 0,effectivelyOutOnEventIndex:void 0,placed:!1});var h=function(a){l.__extends(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return Object.defineProperty(r.prototype,"isEffectivelyOut",{get:function(){return this.reachedOnCatcherInterference?this.out:this.qualified===!1&&this.placed!==!0||this.earnedBase===void 0},enumerable:!1,configurable:!0}),r}(n.runnerRecord);n.Runner=h;var v=function(a){l.__extends(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.clear=function(){var e=this.update("runners",function(i){return i.clear()});return e.set("lastBallInPlay",{}).set("currentPlayIsError",!1).set("nextBatterIsLeadoff",!0)},Object.defineProperty(r.prototype,"runners",{get:function(){return this.get("runners").toJS()},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"walkOwnerId",{get:function(){return this.get("walkOwnerId")},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"lastBallInPlay",{get:function(){return this.get("lastBallInPlay")},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"currentPlayIsError",{get:function(){return this.get("currentPlayIsError")},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"effectiveOutsForTeam",{get:function(){return Math.min(3,this.get("runners").reduce(function(e,i){return i.isEffectivelyOut&&e++,e},0))},enumerable:!1,configurable:!0}),r.prototype.effectiveOutsForPitcher=function(e){var i=!1,c=!0;return Math.min(3,this.get("runners").reduce(function(f,_){return _.out===!0?f++:_.pitcherId===e?(i=!0,c&&_.isEffectivelyOut&&f++):i&&(c=!1),f},0))},r.prototype.currentRunner=function(e){return this.get("runners").find(function(i){return i.runnerId===e&&!i.out})},r.prototype.currentRunnerIndex=function(e){return this.get("runners").findIndex(function(i){return i.runnerId===e&&!i.out})},r.prototype.mostRecentRunner=function(e){return this.get("runners").find(function(i){return i.runnerId===e})},r.prototype.runnersScoredOnEventIndex=function(e){return this.get("runners").filter(function(i){return i.scoredOnEventIndex===e}).toJS()},r.prototype.runnersUnscoredOnEventIndex=function(e){return this.get("runners").filter(function(i){return i.unscoredOnEventIndex===e}).toJS()},r.prototype.runnersEffectivelyOutOnEventIndex=function(e){return this.get("runners").filter(function(i){return i.effectivelyOutOnEventIndex===e}).toJS()},r.prototype.reconcileRunners=function(e){var i=1;return this.update("runners",function(c){return c.map(function(f){var _=f;return _.isEffectivelyOut||(i>_.earnedBase&&(_.earnedBase<4&&i===4&&(_=_.set("scoredOnEventIndex",e)),_=_.set("earnedBase",i)),i=Math.min(4,_.earnedBase+1)),_}).toList()})},r.prototype.addRunner=function(e,i){var c=this.update("runners",function(f){return f.unshift(e)});return c.reconcileRunners(i)},r.prototype.placeRunnerManually=function(e,i){return this.addRunner(e,i)},r.prototype.addRunnerFromBatting=function(e,i){var c=this;return this.get("nextBatterIsUnqualified")===!0&&(e=e.set("qualified",!1).set("earnedBase",void 0),c=c.set("nextBatterIsUnqualified",!1)),this.get("nextBatterIsLeadoff")===!0&&(e=e.set("leadoff",!0),c=c.set("nextBatterIsLeadoff",!1)),e.isEffectivelyOut&&(e=e.set("effectivelyOutOnEventIndex",i)),c.addRunner(e,i)},r.prototype.advanceRunner=function(e,i,c){return this.update("runners",function(f){return f.map(function(_){var S=_;if(S.runnerId===e){var P=Math.min(S.earnedBase+i,4);P===4&&S.earnedBase<4?S=S.set("scoredOnEventIndex",c):P<4&&S.earnedBase===4&&(S=S.set("unscoredOnEventIndex",c)),S=S.set("earnedBase",P)}return S}).toList()}).reconcileRunners(c)},r.prototype.advanceAllRunners=function(e,i){return this.update("runners",function(c){return c.map(function(f){var _=f;if(!_.isEffectivelyOut){var S=Math.min(4,_.earnedBase+e);S===4&&_.earnedBase<4&&(_=_.set("scoredOnEventIndex",i)),_=_.set("earnedBase",S)}return _}).toList()})},r.prototype.swapRunners=function(e,i){var c=this.currentRunnerIndex(e),f=this.currentRunnerIndex(i);return c===-1&&f===-1?this:c!==-1&&f!==-1?c>f?this.replaceRunner(e,i).replaceRunner(i,e):this.replaceRunner(i,e).replaceRunner(e,i):c!==-1?this.replaceRunner(e,i):this.replaceRunner(i,e)},r.prototype.replaceRunner=function(e,i){var c=!1;return this.update("runners",function(f){return f.map(function(_){var S=_;return!c&&S.runnerId===e&&!S.out&&(S=S.set("runnerId",i),c=!0),S}).toList()})},r.prototype.setQualified=function(e,i){return this.setNonOutRunnerProperty(e,"qualified",i)},r.prototype.setReachedOnCatcherInterference=function(e,i){return this.setNonOutRunnerProperty(e,"reachedOnCatcherInterference",i)},r.prototype.setPitcher=function(e,i){return this.setNonOutRunnerProperty(e,"pitcherId",i)},r.prototype.setEarnedBase=function(e,i){return this.setNonOutRunnerProperty(e,"earnedBase",i)},r.prototype.setDidNotScore=function(e,i){return this.setNonOutRunnerProperty(e,"didNotScore",i)},r.prototype.setScoredOnEventIndex=function(e,i){return this.setNonOutRunnerProperty(e,"scoredOnEventIndex",i)},r.prototype.setUnscoredOnEventIndex=function(e,i){return this.setNonOutRunnerProperty(e,"unscoredOnEventIndex",i)},r.prototype.setOut=function(e,i){return this.setNonOutRunnerProperty(e,"out",i)},r.prototype.setEffectivelyOutOnEventIndexIfUnset=function(e,i){return this.setNonOutRunnerProperty(e,"effectivelyOutOnEventIndex",i,!0)},r.prototype.setNonOutRunnerProperty=function(e,i,c,f){var _=!1;return this.update("runners",function(S){return S.map(function(P){var I=P;return!_&&I.runnerId===e&&!I.out&&(f!==!0||I.get(i)===void 0)&&(I=I.set(i,c),_=!0),I}).toList()})},r}(y.ImmutableState);n.EarnedRunState=v;var o=function(a){l.__extends(r,a);function r(e,i,c,f,_){var S=a.call(this,e)||this;return S.baseEvents=e,S.situation=i,S.lineup=c,S.fielders=f,S.baserunners=_,S}return r.prototype.processOneEvent=function(e,i){switch(e=this.reconcileInning(e),e=this.updateWalkOwner(e),i.code){case"pitch":e=this.pitch(e,i);break;case"end_at_bat":e=this.endAtBat(e,i);break;case"ball_in_play":t.contains(["dropped_third_strike","dropped_third_strike_batter_out"],i.attributes.playResult)?e=this.droppedThirdStrike(e,i):e=this.ballInPlay(e,i);break;case"base_running":e=this.baseRunning(e,i);break;case"place_batter":e=this.placeBatter(e,i);break;case"place_runner":e=this.placeRunner(e,i);break;case"balk":e=this.balk(e);break;case"illegal_pitch_advance":e=this.illegalPitchAdvance(e);break;case"end_half":e=e.clear();break;case"replace_runner":e=this.replaceRunner(e,i);break;case"swap_players":e=this.swapPlayers(e,i);break;case"sub_players":e=this.subPlayers(e,i);break;case"foul_error":e=this.foulError(e);break}return e},r.prototype.initialState=function(){var e=new v(p.fromJS({runners:[],lastBallInPlay:{},currentPlayIsError:!1,nextBatterIsUnqualified:!1,nextBatterIsLeadoff:!0,walkOwnerId:u.unsetMaybe()}));return e},Object.defineProperty(r.prototype,"situationBeforeEvent",{get:function(){return this.situation.stateBeforeEvent(this.nextEventOffset)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"situationAfterEvent",{get:function(){return this.situation.stateAfterEvent(this.nextEventOffset)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"lineupBeforeEvent",{get:function(){return this.lineup.stateBeforeEvent(this.nextEventOffset)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"fieldersBeforeEvent",{get:function(){return this.fielders.stateBeforeEvent(this.nextEventOffset)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"baserunnersBeforeEvent",{get:function(){return this.baserunners.stateBeforeEvent(this.nextEventOffset)},enumerable:!1,configurable:!0}),r.prototype.updateWalkOwner=function(e){return this.situationBeforeEvent.pitchesThisAtBat===0?e=e.set("walkOwnerId",u.unsetMaybe()):!u.maybeIsSet(e.walkOwnerId)&&this.situationAfterEvent.balls>=2&&this.situationAfterEvent.balls>this.situationAfterEvent.strikes&&(e=e.set("walkOwnerId",u.maybeWithValue(this.fieldersBeforeEvent.playerForPosition(this.situationBeforeEvent.inFieldTeamId,"P")))),e},r.prototype.reconcileInning=function(e){return this.situationBeforeEvent.lastEventEndedInning?e.clear():e},r.prototype.pitcherIdForWalk=function(e){return u.maybeIsSet(e.walkOwnerId)?u.valueFromMaybe(e.walkOwnerId):this.fieldersBeforeEvent.playerForPosition(this.situationBeforeEvent.inFieldTeamId,"P")},r.prototype.pitch=function(e,i){return i.attributes.advancesRunners&&(e=e.advanceAllRunners(1,this.nextEventOffset)),this.situationAfterEvent.lastEventWasWalk?e.addRunnerFromBatting(new h({runnerId:this.lineupBeforeEvent.currentBatter(this.situationBeforeEvent.atBatTeamId),pitcherId:this.pitcherIdForWalk(e),qualified:!0,earnedBase:1,walked:!0}),this.nextEventOffset):this.situationAfterEvent.lastEventWasStrikeout?e.addRunnerFromBatting(new h({runnerId:this.lineupBeforeEvent.currentBatter(this.situationBeforeEvent.atBatTeamId),pitcherId:this.fieldersBeforeEvent.playerForPosition(this.situationBeforeEvent.inFieldTeamId,"P"),qualified:!0,earnedBase:void 0,walked:!1,out:!0,effectivelyOutOnEventIndex:this.nextEventOffset}),this.nextEventOffset):e},r.prototype.endAtBat=function(e,i){var c=i.attributes.reason==="strikeout",f=i.attributes.reason!=="catcher_interference",_=c||!f&&i.attributes.reason!=="catcher_interference"?this.nextEventOffset:void 0,S;return i.attributes.reason!=="walk"?S=this.fieldersBeforeEvent.playerForPosition(this.situationBeforeEvent.inFieldTeamId,"P"):S=this.pitcherIdForWalk(e),e.addRunnerFromBatting(new h({runnerId:this.lineupBeforeEvent.currentBatter(this.situationBeforeEvent.atBatTeamId),pitcherId:S,qualified:f,earnedBase:c||!f?void 0:1,walked:i.attributes.reason==="walk",reachedOnCatcherInterference:i.attributes.reason==="catcher_interference",out:c,effectivelyOutOnEventIndex:_}),this.nextEventOffset)},r.prototype.updateStateForBallInPlay=function(e,i){var c=s.ballInPlayResultConfigs[i.attributes.playResult];return e.set("lastBallInPlay",{batterId:this.lineupBeforeEvent.currentBatter(this.situationBeforeEvent.atBatTeamId),ownerId:this.fieldersBeforeEvent.playerForPosition(this.situationBeforeEvent.inFieldTeamId,"P"),playResult:i.attributes.playResult}).set("currentPlayIsError",c.error)},r.prototype.advanceRunnersForBallInPlay=function(e,i,c){if(c&&e.get("nextBatterIsUnqualified")!==!0){var f=s.ballInPlayResultConfigs[i.attributes.playResult];return e.advanceAllRunners(f.bases,this.nextEventOffset)}return e},r.prototype.droppedThirdStrike=function(e,i){var c=!1;if(i.attributes.cause==="wild_pitch"){for(var f=void 0,_=0,S=[1,2,3];_<S.length;_++){var P=S[_];if(f=this.baserunnersBeforeEvent.playerAtBase(P),f!==void 0)break}if(f===void 0)c=!0;else{var I=e.currentRunner(f);I.qualified?I.qualified&&I.earnedBase>1&&(c=!0):c=!0}}return e=this.advanceRunnersForBallInPlay(e,i,i.attributes.cause==="wild_pitch"),e=e.addRunnerFromBatting(new h({runnerId:this.lineupBeforeEvent.currentBatter(this.situationBeforeEvent.atBatTeamId),pitcherId:this.fieldersBeforeEvent.playerForPosition(this.situationBeforeEvent.inFieldTeamId,"P"),qualified:c,earnedBase:!c||i.attributes.playResult==="dropped_third_strike_batter_out"?void 0:1,walked:!1,out:i.attributes.playResult==="dropped_third_strike_batter_out",effectivelyOutOnEventIndex:!c||i.attributes.playResult==="dropped_third_strike_batter_out"?this.nextEventOffset:void 0}),this.nextEventOffset),this.updateStateForBallInPlay(e,i)},r.prototype.ballInPlay=function(e,i){var c=s.ballInPlayResultConfigs[i.attributes.playResult],f=!c.error;return e=this.advanceRunnersForBallInPlay(e,i,f),e=e.addRunnerFromBatting(new h({runnerId:this.lineupBeforeEvent.currentBatter(this.situationBeforeEvent.atBatTeamId),pitcherId:this.fieldersBeforeEvent.playerForPosition(this.situationBeforeEvent.inFieldTeamId,"P"),qualified:f,earnedBase:!f||c.batterOut?void 0:c.bases,walked:!1,out:c.batterOut,scoredOnEventIndex:f&&c.bases===4?this.nextEventOffset:void 0,effectivelyOutOnEventIndex:!f||c.batterOut?this.nextEventOffset:void 0}),this.nextEventOffset),this.updateStateForBallInPlay(e,i)},r.prototype.baseRunning=function(e,i){if(e.currentPlayIsError&&t.contains(["advanced_on_last_play","remained_on_last_play","on_same_pitch"],i.attributes.playType))return e;if(i.attributes.playType==="did_not_score")return e=e.setDidNotScore(i.attributes.runnerId,!0),e.currentRunner(i.attributes.runnerId).scoredOnEventIndex!==void 0&&(e=e.setUnscoredOnEventIndex(i.attributes.runnerId,this.nextEventOffset)),e;var c=s.baseRunningPlayTypeConfigs[i.attributes.playType];if((c.error||i.attributes.playType==="passed_ball")&&(e=e.set("currentPlayIsError",!0)),c.runnerOut){if(i.attributes.playType==="out_on_last_play"&&e.lastBallInPlay.playResult==="fielders_choice"&&e.lastBallInPlay.batterId!==i.attributes.runnerId){var f=e.currentRunner(i.attributes.runnerId);f.qualified?e=e.setPitcher(e.lastBallInPlay.batterId,e.currentRunner(i.attributes.runnerId).pitcherId):e=e.setQualified(e.lastBallInPlay.batterId,!1).setEarnedBase(e.lastBallInPlay.batterId,void 0).setEffectivelyOutOnEventIndexIfUnset(e.lastBallInPlay.batterId,this.nextEventOffset)}e.currentRunner(i.attributes.runnerId).earnedBase===4&&(e=e.setUnscoredOnEventIndex(i.attributes.runnerId,this.nextEventOffset)),e=e.setEarnedBase(i.attributes.runnerId,void 0).setEffectivelyOutOnEventIndexIfUnset(i.attributes.runnerId,this.nextEventOffset).setOut(i.attributes.runnerId,!0)}else{var _=this.baserunnersBeforeEvent.baseForPlayer(i.attributes.runnerId),S=i.attributes.base-(_===void 0?4:_);S!==0&&!t.contains(["advanced_on_error","on_same_error","passed_ball"],i.attributes.playType)&&(e=e.advanceRunner(i.attributes.runnerId,S,this.nextEventOffset))}return e},r.prototype.placeBatter=function(e,i){return e.placeRunnerManually(new h({runnerId:this.lineupBeforeEvent.currentBatter(this.situationBeforeEvent.atBatTeamId),pitcherId:this.fieldersBeforeEvent.playerForPosition(this.situationBeforeEvent.inFieldTeamId,"P"),qualified:!1,earnedBase:i.attributes.base,walked:!1,out:!1,placed:!0}),this.nextEventOffset)},r.prototype.placeRunner=function(e,i){return e.placeRunnerManually(new h({runnerId:i.attributes.runnerId,pitcherId:this.fieldersBeforeEvent.playerForPosition(this.situationBeforeEvent.inFieldTeamId,"P"),qualified:!1,earnedBase:i.attributes.base,walked:!1,out:!1,placed:!0}),this.nextEventOffset)},r.prototype.balk=function(e){return e.advanceAllRunners(1,this.nextEventOffset)},r.prototype.illegalPitchAdvance=function(e){return e=e.advanceAllRunners(1,this.nextEventOffset),this.situationAfterEvent.lastEventWasWalk&&(e=e.addRunnerFromBatting(new h({runnerId:this.lineupBeforeEvent.currentBatter(this.situationBeforeEvent.atBatTeamId),pitcherId:this.pitcherIdForWalk(e),qualified:!0,earnedBase:1,walked:!0}),this.nextEventOffset)),e},r.prototype.replaceRunner=function(e,i){return e.replaceRunner(i.attributes.outgoingPlayerId,i.attributes.incomingPlayerId)},r.prototype.swapPlayers=function(e,i){return e.swapRunners(i.attributes.firstPlayerId,i.attributes.secondPlayerId)},r.prototype.subPlayers=function(e,i){return i.attributes.applyToBaserunners&&(e=e.replaceRunner(i.attributes.outgoingPlayerId,i.attributes.incomingPlayerId)),e},r.prototype.foulError=function(e){return e.set("nextBatterIsUnqualified",!0)},r}(d.VersionedStateEngine);n.EarnedRunEngine=o}(co)),co}var kr={},Sd;function Jy(){if(Sd)return kr;Sd=1,Object.defineProperty(kr,"__esModule",{value:!0}),kr.FieldersEngine=kr.FielderState=void 0;var n=X,l=n.__importStar(Pe),t=n.__importStar(fe()),p=n.__importStar(Ee()),d=n.__importStar(Oe()),y=tt(),s="EH",u=function(v){n.__extends(o,v);function o(){return v!==null&&v.apply(this,arguments)||this}return o.prototype.playerForPosition=function(a,r){if((0,y.isMultiPosition)(r))throw"Programming error: playerForPosition is undefined for multi-player positions like ".concat(r);return this.getIn([a,"positions",r])},o.prototype.positionForPlayer=function(a,r){var e=void 0;if(r!==void 0)e=this.getIn([r,"players",a]);else for(var i=0,c=this.keySeq().toArray();i<c.length;i++){var f=c[i];if(e=this.getIn([f,"players",a]),e!==void 0)break}return e||s},o.prototype.setPositionForPlayer=function(a,r,e){return this.setIn([a,"players",r],e)},o.prototype.ensurePositionForPlayer=function(a,r){return this.getIn([a,"players",r])!==void 0?this:this.setPositionForPlayer(a,r,s)},o.prototype.setPlayerForPosition=function(a,r,e){if((0,y.isMultiPosition)(r))throw"Programming error: setPlayerForPosition is undefined for multi-player positions like ".concat(r);return this.setIn([a,"positions",r],e)},o.prototype.positionsMapForTeam=function(a){var r=this.getIn([a,"positions"]);return r===void 0?{}:r.toJS()},o.prototype.playersMapForTeam=function(a){var r=this.getIn([a,"players"]);return r===void 0?{}:r.toJS()},Object.defineProperty(o.prototype,"positionsMap",{get:function(){for(var a={},r=0,e=this.keySeq().toArray();r<e.length;r++){var i=e[r];this.getIn([i,"positions"])!==void 0&&(a[i]=this.positionsMapForTeam(i))}return a},enumerable:!1,configurable:!0}),o}(d.ImmutableState);kr.FielderState=u;var h=function(v){n.__extends(o,v);function o(a,r){var e=v.call(this,a)||this;return e.baseEvents=a,e.situation=r,e}return o.prototype.initialState=function(){return new u(t.Map({}))},Object.defineProperty(o.prototype,"situationBeforeEvent",{get:function(){return this.situation.stateBeforeEvent(this.nextEventOffset)},enumerable:!1,configurable:!0}),o.prototype.processOneEvent=function(a,r){switch(r.code){case"set_teams":return this.setTeams(a,r);case"fill_position":return this.handleFillPosition(a,r);case"clear_position_by_id":return this.handleClearPositionById(a,r);case"swap_players":return this.handleSwapPlayers(a,r);case"sub_players":return this.handleSubPlayers(a,r);case"clear_all_positions":return this.handleClearAllPositions(a,r);case"fill_lineup_index":return this.fillLineupIndex(a,r);case"fill_lineup":return this.fillLineup(a,r);case"replace_runner":return this.replaceRunner(a,r);case"place_runner":return this.placeRunner(a,r);default:return a}},o.prototype.setTeams=function(a,r){for(var e=0,i=[r.attributes.homeId,r.attributes.awayId];e<i.length;e++){var c=i[e];a=a.set(c,t.Map({positions:t.Map({}),players:t.Map({})}))}return a},o.prototype.handleFillUniquePosition=function(a,r){var e=r.attributes,i=e.teamId,c=e.playerId,f=r.attributes.position,_=a.positionForPlayer(c,i);(0,y.isUniquePosition)(_)&&(a=a.setPlayerForPosition(i,_,void 0));var S=a.playerForPosition(i,f);return S!==void 0&&(a=a.setPositionForPlayer(i,S,s)),a=a.setPositionForPlayer(i,c,f),f!==void 0&&(a=a.setPlayerForPosition(i,f,c)),a},o.prototype.handleFillMultiPosition=function(a,r){var e=r.attributes,i=e.teamId,c=e.playerId,f=r.attributes.position,_=a.positionForPlayer(c,i);return(0,y.isUniquePosition)(_)&&(a=a.setPlayerForPosition(i,_,void 0)),a.setPositionForPlayer(i,c,f||s)},o.prototype.handleFillPosition=function(a,r){return(0,y.isUniquePosition)(r.attributes.position)?this.handleFillUniquePosition(a,r):this.handleFillMultiPosition(a,r)},o.prototype.clearPlayerForTeam=function(a,r,e){var i=a.positionForPlayer(e,r);return a=a.setPositionForPlayer(r,e,s),(0,y.isUniquePosition)(i)&&(a=a.setPlayerForPosition(r,i,void 0)),a},o.prototype.handleClearPositionById=function(a,r){var e=r.attributes,i=e.teamId,c=e.playerId;return this.clearPlayerForTeam(a,i,c)},o.prototype.handleSwapPlayers=function(a,r){var e=r.attributes,i=e.teamId,c=e.firstPlayerId,f=e.secondPlayerId;a=a.ensurePositionForPlayer(i,c),a=a.ensurePositionForPlayer(i,f);var _=a.positionForPlayer(c,i),S=a.positionForPlayer(f,i);return a=a.setPositionForPlayer(i,c,S).setPositionForPlayer(i,f,_),(0,y.isUniquePosition)(_)&&(a=a.setPlayerForPosition(i,_,f)),(0,y.isUniquePosition)(S)&&(a=a.setPlayerForPosition(i,S,c)),a},o.prototype.handleSubPlayers=function(a,r){var e=r.attributes,i=e.teamId,c=e.incomingPlayerId,f=e.outgoingPlayerId;a=a.ensurePositionForPlayer(i,c);var _=a.positionForPlayer(c,i),S=a.positionForPlayer(f,i);return(0,y.isUniquePosition)(_)&&(a=a.setPlayerForPosition(i,_,void 0)),(0,y.isUniquePosition)(S)&&(a=a.setPlayerForPosition(i,S,c)),a.setPositionForPlayer(i,c,S).setPositionForPlayer(i,f,s)},o.prototype.handleClearAllPositions=function(a,r){var e=r.attributes.teamId;a=a.setIn([e,"positions"],t.Map());for(var i={},c=0,f=l.keys(a.playersMapForTeam(e));c<f.length;c++){var _=f[c];i[_]=s}return a.mergeIn([e,"players"],i)},o.prototype.fillLineupIndex=function(a,r){var e=r.attributes,i=e.teamId,c=e.playerId;return a.ensurePositionForPlayer(i,c)},o.prototype.fillLineup=function(a,r){var e=r.attributes,i=e.teamId,c=e.playerId;return a.ensurePositionForPlayer(i,c)},o.prototype.replaceRunner=function(a,r){var e=r.attributes,i=e.teamId,c=e.incomingPlayerId;return a.ensurePositionForPlayer(i,c)},o.prototype.placeRunner=function(a,r){var e=this.situationBeforeEvent.atBatTeamId;return a.ensurePositionForPlayer(e,r.attributes.runnerId)},o}(p.VersionedStateEngine);return kr.FieldersEngine=h,kr}var fo={},Pd;function Yy(){return Pd||(Pd=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.HistoryEngine=n.HistoryState=n.CourtesyRunnerHistoryRecord=n.courtesyRunnerHistoryRecord=n.PositionHistoryRecord=n.positionHistoryRecord=n.FielderHistoryRecord=n.fielderHistoryRecord=n.PitcherHistoryRecord=n.pitcherHistoryRecord=n.BattingHistoryRecord=n.battingHistoryRecord=void 0;var l=X,t=l.__importStar(Pe),p=l.__importStar(fe()),d=l.__importStar(Ee()),y=l.__importStar(Oe());n.battingHistoryRecord=p.Record({batterId:void 0,inning:void 0,firstAppearance:!1,position:void 0});var s=function(e){l.__extends(i,e);function i(){return e!==null&&e.apply(this,arguments)||this}return i}(n.battingHistoryRecord);n.BattingHistoryRecord=s,n.pitcherHistoryRecord=p.Record({pitcherId:void 0,inning:void 0,firstAppearance:!1});var u=function(e){l.__extends(i,e);function i(){return e!==null&&e.apply(this,arguments)||this}return i}(n.pitcherHistoryRecord);n.PitcherHistoryRecord=u,n.fielderHistoryRecord=p.Record({position:void 0,inning:void 0,eventId:void 0});var h=function(e){l.__extends(i,e);function i(){return e!==null&&e.apply(this,arguments)||this}return i}(n.fielderHistoryRecord);n.FielderHistoryRecord=h,n.positionHistoryRecord=p.Record({fielderId:void 0,inning:void 0,eventId:void 0});var v=function(e){l.__extends(i,e);function i(){return e!==null&&e.apply(this,arguments)||this}return i}(n.positionHistoryRecord);n.PositionHistoryRecord=v,n.courtesyRunnerHistoryRecord=p.Record({incomingId:void 0,outgoingId:void 0});var o=function(e){l.__extends(i,e);function i(){return e!==null&&e.apply(this,arguments)||this}return i}(n.courtesyRunnerHistoryRecord);n.CourtesyRunnerHistoryRecord=o;var a=function(e){l.__extends(i,e);function i(){return e!==null&&e.apply(this,arguments)||this}return i.prototype.pitcherHistory=function(c){return this.getIn([c,"pitcherHistory"]).toJS()},i.prototype.fielderHistory=function(c){return this.getIn([c,"fielderHistory"]).toJS()},i.prototype.positionHistory=function(c){return this.getIn([c,"positionHistory"]).toJS()},i.prototype.battingHistory=function(c){return this.getIn([c,"battingHistory"]).toJS()},i.prototype.courtesyRunnerHistory=function(c){return this.getIn([c,"courtesyRunnerHistory"]).toJS()},i.prototype.orderedPlayersNotInHistory=function(c,f){var _=this.getIn([f,"battersInHistory"]),S=c.stateAfterEvent(this.nextEventOffset).battersImmutable(f);return S.filter(function(P){return P!==void 0&&!_.includes(P)}).toJS()},i.prototype.addedBatters=function(c){return this.getIn([c,"addedBatter"]).toJS()},i.prototype.removedBatters=function(c){return this.getIn([c,"removedBatter"])},i.prototype.addedPitchers=function(c){return this.getIn([c,"addedPitcher"]).toJS()},i.prototype.playerOrderForBoxscore=function(c,f){for(var _=[],S=c.stateAfterEvent(this.nextEventOffset).batters(f),P=this.battingHistory(f),I=this.removedBatters(f),E=new Set,B=0;B<Math.max(P.length,S.length);B++){_.push([]);var b=P[B];if(b!==void 0)for(var R=0,F=b;R<F.length;R++){var x=F[R];x.firstAppearance&&!I.contains(x.batterId)&&(_[B].push(x.batterId),E.add(x.batterId))}}for(var w=0,L=this.orderedPlayersNotInHistory(c,f);w<L.length;w++){var D=L[w];if(!I.contains(D)){var U=S.indexOf(D);_[U].push(D),E.add(D)}}return this.addedBatters(f).forEach(function(G){E.has(G)||_.push([G])}),_},i.prototype.orderedPitchersForBoxscore=function(c){var f=this.getIn([c,"removedPitcher"]),_=[],S=new Set;return this.pitcherHistory(c).forEach(function(P){f.contains(P.pitcherId)||(_.push(P),S.add(P.pitcherId))}),this.addedPitchers(c).forEach(function(P){S.has(P)||_.push({pitcherId:P,inning:1,firstAppearance:!0})}),_},i.prototype.courtesyRunnerOrderForBoxscore=function(c,f){return this.courtesyRunnerHistory(f).reduce(function(_,S){var P=_.indexOf(S.incomingId);return P>=0&&_.splice(P,1),t.contains(c,S.incomingId)||_.push(S.incomingId),_},[])},i.prototype.initializeForTeam=function(c){var f=this.set(c,p.Map({pitcherHistory:p.List(),fielderHistory:p.Map({}),positionHistory:p.Map({}),battingHistory:p.List(),courtesyRunnerHistory:p.List(),addedBatter:p.List(),removedBatter:p.Set(),addedPitcher:p.List(),removedPitcher:p.Set()}));return f.setIn([c,"battersInHistory"],p.Set())},i.prototype.batterIsInHistory=function(c,f){return this.getIn([c,"battersInHistory"]).includes(f)},i.prototype.addBatterToHistory=function(c,f,_,S,P){var I=this;this.getIn([c,"battingHistory"]).size<P+1&&(I=I.deepSetSize([c,"battingHistory"],P+1,p.List()));var E=I.get(c);return E=E.update("battingHistory",function(B){var b=B.get(P);b===void 0&&(b=p.List());var R=b.last();return(R===void 0||R.batterId!==f||R.position!==_)&&(b=b.push(new s({batterId:f,inning:S,firstAppearance:!E.get("battersInHistory").includes(f),position:_}))),B.set(P,b)}),E=E.update("battersInHistory",function(B){return B.add(f)}),I.set(c,E)},i.prototype.addCourtesyRunnerToHistory=function(c,f,_){var S=this,P=S.get(c);return P=P.update("courtesyRunnerHistory",function(I){return I.push(new o({outgoingId:f,incomingId:_}))}),S.set(c,P)},i.prototype.replaceLastPositionForBatterInHistory=function(c,f,_,S){var P=this,I=P.get(c);return I=I.update("battingHistory",function(E){if(S===void 0)return E;var B=E.get(S);if(B===void 0)return E;var b=B.last();return b===void 0||b.batterId!==f?E:(B=B.update(B.size-1,function(R){return R.set("position",_)}),E.set(S,B))}),P.set(c,I)},i.prototype.addStatEditPlayer=function(c,f,_){var S=this,P=S.getIn([c,"added".concat(_)]),I=S.getIn([c,"removed".concat(_)]);return P.includes(f)||(P=P.push(f),S=S.setIn([c,"added".concat(_)],P)),I.includes(f)&&(I=I.delete(f),S=S.setIn([c,"removed".concat(_)],I)),S},i.prototype.removeStatEditPlayer=function(c,f,_){var S=this,P=S.getIn([c,"removed".concat(_)]),I=S.getIn([c,"added".concat(_)]);P.includes(f)||(P=P.add(f),S=S.setIn([c,"removed".concat(_)],P));var E=I.indexOf(f);return E!==-1&&(S=S.deleteIn([c,"added".concat(_),E])),S},i}(y.ImmutableState);n.HistoryState=a;var r=function(e){l.__extends(i,e);function i(c,f,_,S){var P=e.call(this,c)||this;return P.baseEvents=c,P.situation=f,P.lineup=_,P.fielders=S,P}return i.prototype.processOneEvent=function(c,f){switch(f.code){case"set_teams":c=this.setTeams(c,f);break;case"pitch":c=this.pitch(c,f);break;case"sub_players":c=this.subPlayers(c,f);break;case"fill_position":c=this.fillPosition(c,f);break;case"replace_runner":c=this.addCourtesyRunnerToHistory(c,f);break;case"end_at_bat":case"ball_in_play":case"place_batter":c=this.addLastBatterToHistory(c);break;case"player_stat_edit":c=this.handlePlayerStatEdit(c,f);break}return c},i.prototype.initialState=function(){return new a(p.Map({}))},Object.defineProperty(i.prototype,"situationBeforeEvent",{get:function(){return this.situation.stateBeforeEvent(this.nextEventOffset)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"lineupBeforeEvent",{get:function(){return this.lineup.stateBeforeEvent(this.nextEventOffset)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"fieldersBeforeEvent",{get:function(){return this.fielders.stateBeforeEvent(this.nextEventOffset)},enumerable:!1,configurable:!0}),i.prototype.setTeams=function(c,f){return c.initializeForTeam(f.attributes.awayId).initializeForTeam(f.attributes.homeId)},i.prototype.addCourtesyRunnerToHistory=function(c,f){var _=this.situationBeforeEvent.atBatTeamId;return c.addCourtesyRunnerToHistory(_,f.attributes.outgoingPlayerId,f.attributes.incomingPlayerId)},i.prototype.addLastBatterToHistory=function(c){var f=this.situationBeforeEvent.atBatTeamId,_=this.lineupBeforeEvent.currentBatter(f);return c.addBatterToHistory(f,_,this.fieldersBeforeEvent.positionForPlayer(_,f),this.situationBeforeEvent.inning,this.lineupBeforeEvent.lineupIndex(f))},i.prototype.pushFielderHistories=function(c,f){var _=this.situationBeforeEvent.inFieldTeamId,S=this.fieldersBeforeEvent.playersMapForTeam(_);for(var P in S)if(S.hasOwnProperty(P)){var I=S[P];if(!t.contains([void 0,"EH"],I)){var E=c.getIn([_,"fielderHistory",P]);E===void 0&&(E=p.List()),!(E.last()!==void 0&&E.last().position===I)&&(E=E.push(new h({inning:this.situationBeforeEvent.inning,position:I,eventId:f})),c=c.setIn([_,"fielderHistory",P],E))}}return c},i.prototype.pushPitcherHistory=function(c){var f=this.situationBeforeEvent.inFieldTeamId,_=this.situationBeforeEvent.inning,S=this.fieldersBeforeEvent.playerForPosition(f,"P"),P=c.getIn([f,"pitcherHistory"]);if(S===void 0)return c;var I=P.last();if(I!==void 0&&I.pitcherId===S)return c;var E=P.find(function(B){return(B==null?void 0:B.pitcherId)===S})===void 0;return c.updateIn([f,"pitcherHistory"],function(B){return B.push(new u({pitcherId:S,inning:_,firstAppearance:E}))})},i.prototype.pitch=function(c,f){return c=this.pushFielderHistories(c,f.id),c=this.pushPitcherHistory(c),this.addLastBatterToHistory(c)},i.prototype.subPlayers=function(c,f){var _=f.attributes,S=_.teamId,P=_.incomingPlayerId,I=_.outgoingPlayerId,E=this.lineupBeforeEvent.indexOfPlayer(S,I);if(E===void 0)return c;var B=this.fieldersBeforeEvent.positionForPlayer(I,S);return B!==void 0&&(c=this.pushPositionHistory(c,S,P,B,f.id)),c.addBatterToHistory(S,P,B,this.situationBeforeEvent.inning,E)},i.prototype.pushPositionHistory=function(c,f,_,S,P){var I=this.situationBeforeEvent.inning,E=c.getIn([f,"positionHistory",S]);E===void 0&&(E=p.List());var B=E.last();return(B===void 0||B.fielderId!==_)&&(E=E.push(new v({fielderId:_,inning:I,eventId:P}))),c.setIn([f,"positionHistory",S],E)},i.prototype.fillPosition=function(c,f){var _=f.attributes,S=_.teamId,P=_.playerId,I=_.position;return I==="EH"||(c=this.pushPositionHistory(c,S,P,I,f.id),!t.contains([void 0,"EH"],this.fieldersBeforeEvent.positionForPlayer(P,S)))?c:c.replaceLastPositionForBatterInHistory(S,P,I,this.lineupBeforeEvent.indexOfPlayer(S,P))},i.prototype.updateStatEditPlayer=function(c,f,_,S,P){return P===0?c.removeStatEditPlayer(f,_,S):c.addStatEditPlayer(f,_,S)},i.prototype.handlePlayerStatEdit=function(c,f){switch(f.category){case"offense":if(f.statName==="GP")return this.updateStatEditPlayer(c,f.teamId,f.playerId,"Batter",f.statValue);break;case"defense":switch(f.statName){case"GP:P":return this.updateStatEditPlayer(c,f.teamId,f.playerId,"Pitcher",f.statValue)}break}return c},i}(d.VersionedStateEngine);n.HistoryEngine=r}(fo)),fo}var er={},ut={},Id;function Qy(){if(Id)return ut;Id=1,Object.defineProperty(ut,"__esModule",{value:!0}),ut.eventEndedInning=ut.eventIsFromLegacyAndroid=ut.isNewLineup=ut.getParticipants=ut.getEventLineupIndex=ut.teamForLineupIndexKey=void 0;var n=X,l=n.__importStar(Pe);function t(h,v){var o=v==="home"?"away":"home";return s(h)?v:o}ut.teamForLineupIndexKey=t;function p(h,v,o){var a=o[h];if(a!==void 0){var r="".concat(t(o,v),"_lineupindex");return a.situation!==void 0&&a.situation[r]!==void 0?a.situation[r]:a[r]}}ut.getEventLineupIndex=p;function d(h,v){return l.filter(v.participants,function(o){return l.intersection(o.roles,h).length===h.length})}ut.getParticipants=d;function y(h){return h.batters!==void 0}ut.isNewLineup=y;function s(h){return h["~va"]!==void 0&&h["~vc"]===void 0}ut.eventIsFromLegacyAndroid=s;function u(h){var v=h.setting,o=h.result;return!!(v!=null&&v.situation)&&!!(o!=null&&o.situation)&&v.situation.half!==o.situation.half}return ut.eventEndedInning=u,ut}Object.defineProperty(er,"__esModule",{value:!0}),er.Transcoder=er.transcoderConfigFromStream=er.TranscoderState=void 0;var wr=X,he=wr.__importStar(Pe),po=wr.__importStar(Rt()),md=wr.__importStar(gt()),Be=wr.__importStar(Qy()),pa=Mc(),Xy=$e(),yr=Rt(),Zy={BK:"balk",IP:"illegal_pitch_advance",SO:"end_at_bat",BB:"end_at_bat",HB:"end_at_bat",CI:"end_at_bat","1B":"ball_in_play","2B":"ball_in_play","3B":"ball_in_play",HR:"ball_in_play",E:"ball_in_play",BT:"ball_in_play",FC:"ball_in_play",OI:"ball_in_play",K:"ball_in_play",OG:"ball_in_play",OL:"ball_in_play",OF:"ball_in_play",IF:"ball_in_play",DP:"ball_in_play",TP:"ball_in_play",KO:"ball_in_play",SHB:"ball_in_play","SHB+E":"ball_in_play",SHF:"ball_in_play","SHF+E":"ball_in_play","F+E":"foul_error",OO:"ball_in_play",FT:"ball_in_play",rTU:"base_running",rRF:"base_running",rCT:"base_running",rOA:"base_running",rRS:"base_running",rBT:"base_running",rOI:"base_running",rDT:"base_running",rSB:"base_running",rDI:"base_running",rPB:"base_running",rWP:"base_running",rAP:"base_running",rFC:"base_running",rAE:"base_running",rOOA:"base_running",rCS:"base_running",rOO:"base_running",rPO:"base_running",rDO:"base_running",rCR:"base_running",rTH:"base_running",rET:"base_running"},ev={FB:"fastball",CB:"curveball",SL:"slider",CH:"changeup",CT:"cutter",RB:"riseball",DB:"dropball",SB:"screwball",DC:"drop_curve",KB:"knuckleball",KC:"knuckle_curve","--":void 0},tv=function(n){wr.__extends(l,n);function l(t,p){return n.call(this,"Player id: ".concat(t," is not part of teams: ").concat(p.join(", ")))||this}return l}(Error),bd=function(n){wr.__extends(l,n);function l(){var t=n!==null&&n.apply(this,arguments)||this;return t.nextEventOffset=0,t.lineupsInitialized={},t.seedFieldersOnNextEligibleEvent={},t.pitcherAndCatcherSeededForTeam={},t}return l.prototype.restoreFromSnapshot=function(t){n.prototype.restoreFromSnapshot.call(this,t),this.nextEventOffset=t.nextEventOffset,this.lineupsInitialized=t.lineupsInitialized,this.seedFieldersOnNextEligibleEvent=t.seedFieldersOnNextEligibleEvent,this.pitcherAndCatcherSeededForTeam=t.pitcherAndCatcherSeededForTeam,this.playerTeamMembership=t.playerTeamMembership},l.prototype.safePlayerTeamMembership=function(t){var p=this.playerTeamMembership[t];if(p)return p;var d=Array.from(new Set(Object.values(this.playerTeamMembership)));throw new tv(t,d)},l}(md.TranscoderState);er.TranscoderState=bd;function rv(n,l,t,p,d){var y={homeTeamId:p,awayTeamId:d,playerTeamMembership:{}};if(n.sal!==void 0&&n.sal.batters!==void 0)for(var s=0,u=n.sal.batters;s<u.length;s++){var h=u[s];y.playerTeamMembership[h.curr_id]=y.awayTeamId}for(var v=0,o=l;v<o.length;v++){var a=o[v];y.playerTeamMembership[a]=y.homeTeamId}if(n.shl!==void 0&&n.shl.batters!==void 0)for(var r=0,e=n.shl.batters;r<e.length;r++){var h=e[r];y.playerTeamMembership[h.curr_id]=y.homeTeamId}for(var i=0,c=t;i<c.length;i++){var f=c[i];y.playerTeamMembership[f]=y.awayTeamId}return y}er.transcoderConfigFromStream=rv;var nv=function(n){wr.__extends(l,n);function l(t,p,d,y,s,u){var h=n.call(this,p)||this;return h.config=t,h.baseEvents=p,h.situation=d,h.lineup=y,h.fielders=s,h.baserunners=u,h.state.playerTeamMembership=t.playerTeamMembership,h.processToLatestEvent(),h}return l.prototype.initialState=function(){var t=new bd;return this.config!==void 0&&(t.playerTeamMembership=this.config.playerTeamMembership),t},l.prototype.inputEventById=function(t){return this.baseEvents[this.state.idToInputIndex[t]]},l.prototype.addWriteInDescription=function(t,p){t.note!==void 0&&(p.description=t.note)},l.prototype.processOneEvent=function(t,p){if(this._eventCounter=-1,p.passThrough===!0){this.state.outStream.push(p);return}var d=this.currentStateOfEngine(this.situation).atBatTeamId,y=this.currentStateOfEngine(this.situation).inFieldTeamId;this.updateTeamMembershipFromEvent(p),!this.state.lineupsInitialized[d]&&this.eventIsEligibleToInitializeLineup(p)&&p.result!==void 0&&p.result.lineup!==void 0&&(this.seedLineupForTeam(p,d,p.result.lineup),this.state.seedFieldersOnNextEligibleEvent[y]=!0,this.state.lineupsInitialized[d]=!0),this.state.seedFieldersOnNextEligibleEvent[y]&&p.fielders!==void 0&&(this.seedFieldersForTeam(y,p.fielders,p),this.state.seedFieldersOnNextEligibleEvent[y]=!1),y!==void 0&&this.state.pitcherAndCatcherSeededForTeam[y]!==!0&&p.code==="pitch"&&(this.seedPitcherAndCatcherFromPitch(y,p),this.state.pitcherAndCatcherSeededForTeam[y]=!0),this.state.outStream.push.apply(this.state.outStream,this.inferredPlayEditingSubsForEvent(p)),this.state.outStream.push.apply(this.state.outStream,this.scoreOverridesForEvent(p)),this.state.outStream.push.apply(this.state.outStream,this.transcodeEvent(p)),this.state.outStream.push.apply(this.state.outStream,this.batterIndexOverridesForEvent(p)),this.state.nextEventOffset++},l.prototype.pushEventsFromCompletedStream=function(t){this.state.outStream.push.apply(this.state.outStream,this.generateDecisionEvents(t))},l.prototype.nextEventIdForEvent=function(t){return this._eventCounter++,"".concat(t._id,"_").concat(this._eventCounter)},l.prototype.eventIsEligibleToInitializeLineup=function(t){return t.code==="pitch"?!0:!he.contains(["over","rename","swaphome","tov","undh","dh","deact","act","sub","reord","pos","skp","newplayer","clear","crn"],t.code)},l.prototype.seedPitcherAndCatcherFromPitch=function(t,p){if(p.participants!==void 0)for(var d=0,y=p.participants;d<y.length;d++){var s=y[d],u=void 0,h=s.roles;if(h&&he.contains(h,"pitcher"))u="P";else if(he.contains(h??[],"catcher"))u="C";else continue;this.state.outStream.push({code:"fill_position",id:this.nextEventIdForEvent(p),attributes:{teamId:t,playerId:s.player.$id,position:u}})}},l.prototype.seedFieldersForTeam=function(t,p,d){for(var y in p)if(p.hasOwnProperty(y)){var s=p[y],u={code:"fill_position",id:this.nextEventIdForEvent(d),attributes:{teamId:t,playerId:s,position:y}};this.state.outStream.push(u)}},l.prototype.seedLineupForTeam=function(t,p,d){if(Be.isNewLineup(d)){for(var y in d.positions)if(d.positions.hasOwnProperty(y)){var s=d.positions[y];if(s.curr_id!==void 0){var u={code:"fill_position",id:this.nextEventIdForEvent(t),attributes:{teamId:p,playerId:s.curr_id,position:y}};this.state.outStream.push(u)}}}else for(var h=0;h<this.lineupLength(d);h++){var v={code:"fill_position",id:this.nextEventIdForEvent(t),attributes:{teamId:p,playerId:this.playerIdAtLineupIndex(d,h),position:d.entries[h].position}};this.state.outStream.push(v)}if(Be.isNewLineup(d)){for(var o in d.dhs)if(d.dhs.hasOwnProperty(o)){var a=[d.dhs[o].b_id,d.dhs[o].f_id],r=a[0],e=a[1];this.state.outStream.push({code:"fill_position",id:this.nextEventIdForEvent(t),attributes:{teamId:p,playerId:r,position:"DH"}}),this.state.outStream.push({code:"assign_dh",id:this.nextEventIdForEvent(t),attributes:{teamId:p,dhId:r,fielderId:e}})}}for(var h=0;h<this.lineupLength(d);h++){var i=this.playerIdAtLineupIndex(d,h);i!==void 0&&this.state.outStream.push({code:"fill_lineup_index",id:this.nextEventIdForEvent(t),attributes:{teamId:p,playerId:i,index:h}})}var c=p===this.config.homeTeamId?"home":"away",f=Be.getEventLineupIndex("setting",c,t);f!==void 0&&f!==this.currentStateOfEngine(this.lineup).lineupIndex(p)&&this.state.outStream.push({code:"goto_lineup_index",id:this.nextEventIdForEvent(t),attributes:{teamId:p,index:f}})},l.prototype.updateTeamMembershipFromEvent=function(t){if(t.participants&&he.contains(["act","pos","crn","sub","dh"],t.code))for(var p=0,d=t.participants;p<d.length;p++){var y=d[p],s=y.player.$id;this.state.playerTeamMembership[s]===void 0&&y.team_id!==void 0&&(this.state.playerTeamMembership[s]=y.team_id)}},l.prototype.generateDecisionEvents=function(t){var p=[];if(t.state===void 0||t.state.decisions===void 0||t.status!=="CPT")return p;var d=t.state.decisions;d.win!==void 0&&p.push({code:"pitcher_decision",id:this.nextEventIdForEvent(t),attributes:{teamId:this.state.safePlayerTeamMembership(d.win.$id),pitcherId:d.win.$id,decision:"win"}}),d.loss!==void 0&&p.push({code:"pitcher_decision",id:this.nextEventIdForEvent(t),attributes:{teamId:this.state.safePlayerTeamMembership(d.loss.$id),pitcherId:d.loss.$id,decision:"loss"}}),d.save!==void 0&&p.push({code:"pitcher_decision",id:this.nextEventIdForEvent(t),attributes:{teamId:this.state.safePlayerTeamMembership(d.save.$id),pitcherId:d.save.$id,decision:"save"}});for(var y=(d.wbs||[]).concat(d.lbs||[]),s=0,u=y;s<u.length;s++){var h=u[s];p.push({code:"pitcher_decision",id:this.nextEventIdForEvent(t),attributes:{teamId:this.state.safePlayerTeamMembership(h.$id),pitcherId:h.$id,decision:"blown_save"}})}return p},l.prototype.scoreOverridesForEvent=function(t){if(t.setting===void 0||t.setting.score===void 0||t.setting.score.away===void 0||t.setting.score.home===void 0)return[];var p=[],d=this.currentStateOfEngine(this.baserunners).scoreForTeam(this.config.homeTeamId),y=this.currentStateOfEngine(this.baserunners).scoreForTeam(this.config.awayTeamId),s=t.setting.score.home,u=t.setting.score.away;return d!==s&&p.push({teamId:this.config.homeTeamId,score:s}),y!==u&&p.push({teamId:this.config.awayTeamId,score:u}),p.length!==0?[{code:"override",id:this.nextEventIdForEvent(t),attributes:{scores:p}}]:[]},l.prototype.batterIndexOverridesForEvent=function(t){var p=this.currentStateOfEngine(this.lineup).lineupIndex(this.config.homeTeamId),d=this.currentStateOfEngine(this.lineup).lineupIndex(this.config.awayTeamId),y=this.currentStateOfEngine(this.lineup).numberOfBatters(this.config.homeTeamId),s=this.currentStateOfEngine(this.lineup).numberOfBatters(this.config.awayTeamId),u=Be.getEventLineupIndex("result","home",t),h=Be.getEventLineupIndex("result","away",t);if(u===void 0||h===void 0)return[];var v=[];return p!==u&&u!==y&&(v.push({code:"goto_lineup_index",id:this.nextEventIdForEvent(t),attributes:{teamId:this.config.homeTeamId,index:u}}),(p>=5||p===void 0)&&u===0&&v.push({code:"confirm_end_of_lineup",id:this.nextEventIdForEvent(t),attributes:{teamId:this.config.homeTeamId}})),d!==h&&h!==s&&(v.push({code:"goto_lineup_index",id:this.nextEventIdForEvent(t),attributes:{teamId:this.config.awayTeamId,index:h}}),(d>=5||d===void 0)&&h===0&&v.push({code:"confirm_end_of_lineup",id:this.nextEventIdForEvent(t),attributes:{teamId:this.config.awayTeamId}})),v},l.prototype.inferredPlayEditingSubsForEvent=function(t){if(t.participants===void 0)return[];if(he.contains(["SO","act","deact","clear","pos","reord","skp","dh","undh"],t.code))return[];if(t.code==="BB"&&this.currentStateOfEngine(this.situation).lastEventWasWalk)return[];if(he.contains(["crn","sub"],t.code)&&t.setting!==void 0&&t.setting.situation!==void 0){for(var p=[],d=0,y=t.setting.situation.bases||[];d<y.length;d++){var s=y[d];s.player.$id!==this.currentStateOfEngine(this.baserunners).playerAtBase(s.base)&&p.push({code:"place_runner",id:this.nextEventIdForEvent(t),attributes:{runnerId:s.player.$id,base:s.base}})}return p}var u=this.participantMismatches(t),h=this.playEditingParticipantSubsExcludingBaserunners(t,u);he.contains(["PROB","XS"],t.code)||(h=h.concat(this.playEditingParticipantSubsForBaserunners(t)));var v=this.fillUnsetPlayers(t,u),o=he.uniq(h,!1,function(a){var r,e=void 0;if(a.code==="swap_players"){var i=a;r=i.attributes.secondPlayerId<i.attributes.firstPlayerId?i.attributes.secondPlayerId+i.attributes.firstPlayerId:i.attributes.firstPlayerId+i.attributes.secondPlayerId,e=i.attributes.teamId}else{var c=a;r=c.attributes.incomingPlayerId+c.attributes.outgoingPlayerId,e=c.attributes.teamId}return a.code+e+r});return o.concat(he.uniq(this.playEditingFielderPositionSubs(t),!1,function(a){return a.code+a.attributes.teamId+a.attributes.playerId+a.attributes.position})).concat(v)},l.prototype.playEditingFielderPositionSubs=function(t){var p=[];if(t.fielders!==void 0){var d=this.currentStateOfEngine(this.situation).inFieldTeamId;for(var y in t.fielders)if(t.fielders.hasOwnProperty(y)){var s=this.currentStateOfEngine(this.fielders).playerForPosition(d,y),u=t.fielders[y];if(s!==u){var h={code:"fill_position",id:this.nextEventIdForEvent(t),attributes:{teamId:d,playerId:u,position:y}};pa.debug&&(h.debug={cause:"play_edit",type:"fielder"}),p.push(h)}}return p}},l.prototype.participantMismatches=function(t){for(var p,d,y=[],s=0,u=t.participants||[];s<u.length;s++){var h=u[s];if(h.roles!==void 0){var v=void 0,o=void 0,a=void 0,r=this.currentStateOfEngine(this.situation).atBatTeamId,e=this.currentStateOfEngine(this.situation).inFieldTeamId,i="",c=void 0;if(he.contains(h.roles,"batter")&&t.parent_play===void 0){var f=((d=(p=t.setting)===null||p===void 0?void 0:p.situation)===null||d===void 0?void 0:d.half)===0?"away":"home",_=Be.getEventLineupIndex("setting",f,t),S=this.currentStateOfEngine(this.lineup).getPlayerAtIndex(r,_);S!==h.player.$id&&(v=r,o=S,i="batter",a=_)}else if(he.contains(h.roles,"pitcher")){var P=this.currentStateOfEngine(this.fielders).playerForPosition(e,"P");P!==h.player.$id&&(v=e,o=P,i="pitcher",c="P")}else if(he.contains(h.roles,"catcher")){var I=this.currentStateOfEngine(this.fielders).playerForPosition(e,"C");I!==h.player.$id&&(v=e,o=I,i="catcher",c="C")}else if(he.contains(h.roles,"fielder"))for(var E=0,B=h.roles;E<B.length;E++){var b=B[E];if(b.substr(0,8)==="defender"){var R=Number(b.substr(9,1/0))-1;c=this.deriveDefendersFromEvent(t)[R].position;var F=this.currentStateOfEngine(this.fielders).playerForPosition(e,c);F!==h.player.$id&&(v=e,o=F,i="fielder");break}}if(v!==void 0){var x={expectedPlayerId:o,actualPlayerId:h.player.$id,teamId:v};c!==void 0?(x.code="fielder",x.position=c):(x.code="batter",x.batterIndex=a),pa.debug&&(x.debug={cause:"play_edit",type:i}),y.push(x)}}}return y},l.prototype.playEditingParticipantSubsExcludingBaserunners=function(t,p){for(var d=[],y=0,s=p;y<s.length;y++){var u=s[y];if(u.expectedPlayerId!==void 0){var h=void 0;u.code==="batter"?h={code:"sub_players",id:this.nextEventIdForEvent(t),attributes:{teamId:u.teamId,incomingPlayerId:u.actualPlayerId,outgoingPlayerId:u.expectedPlayerId}}:(h={code:"swap_players",id:this.nextEventIdForEvent(t),attributes:{teamId:u.teamId,firstPlayerId:u.actualPlayerId,secondPlayerId:u.expectedPlayerId}},pa.debug&&(h.debug=u.debug)),d.push(h)}}return d},l.prototype.fillUnsetPlayers=function(t,p){for(var d=[],y=0,s=p;y<s.length;y++){var u=s[y];if(u.expectedPlayerId===void 0)switch(u.code){case"batter":d.push({code:"fill_lineup_index",id:this.nextEventIdForEvent(t),attributes:{teamId:u.teamId,playerId:u.actualPlayerId,index:u.batterIndex}}),this.currentStateOfEngine(this.lineup).lineupIndex(u.teamId)!==u.batterIndex&&d.push({code:"goto_lineup_index",id:this.nextEventIdForEvent(t),attributes:{index:u.batterIndex,teamId:u.teamId}});break;case"fielder":u.position!==void 0&&d.push({code:"fill_position",id:this.nextEventIdForEvent(t),attributes:{teamId:u.teamId,playerId:u.actualPlayerId,position:u.position}});break}}return d},l.prototype.playEditingParticipantSubsForBaserunners=function(t){for(var p=[],d=1,y={1:[],2:[],3:[],4:[]},s={},u=0,h=t.participants||[];u<h.length;u++){var v=h[u];v.properties!==void 0&&v.properties.base!==void 0&&(y[v.properties.base].push(v),s[v.player.$id]=!0)}if(t.result!==void 0&&t.result.situation!==void 0&&t.setting!==void 0&&t.setting.situation!==void 0){var o=void 0,a=void 0;if(Be.eventEndedInning(t)?(o=t.setting.situation.bases,a=(t.properties||{}).bases||0):(o=t.result.situation.bases,a=0),o!==void 0)for(var r=0,e=o;r<e.length;r++){var i=e[r];if(s[i.player.$id]===void 0){var c=Math.min(4,i.base+a);y[c].push({player:i.player,properties:{base:c},roles:["runner","safe"]})}}}for(var f=0,_=y[1].concat(y[2],y[3]);f<_.length;f++){var S=_[f];if(!(he.contains(S.roles,"batter")&&t.parent_play===void 0))for(;d<4;){var P=this.currentStateOfEngine(this.baserunners).playerAtBase(d);if(d++,P!==void 0){if(S.player.$id!==P){var I={code:"swap_players",id:this.nextEventIdForEvent(t),attributes:{teamId:this.currentStateOfEngine(this.situation).atBatTeamId,secondPlayerId:P,firstPlayerId:S.player.$id}};pa.debug&&(I.debug={cause:"play_edit",type:"baserunner on 1-3"}),p.push(I)}break}}}var E=[];for(var B in p)if(p.hasOwnProperty(B)){var b=p[B],R=!1;for(var F in p)if(!(!p.hasOwnProperty(F)||B===F)){var x=p[F];if(he.intersection([b.attributes.firstPlayerId,b.attributes.secondPlayerId],[x.attributes.firstPlayerId,x.attributes.secondPlayerId]).length===2){R=!0;break}}R||E.push(b)}p=E;for(var w=[];d<4;d++){var L=this.currentStateOfEngine(this.baserunners).playerAtBase(d);L!==void 0&&w.push(L)}for(var D=0,U=y[4];D<U.length;D++){var S=U[D];if(!he.contains(S.roles,"batter"))if(he.contains(w,S.player.$id))w=he.without(w,S.player.$id);else{var I={code:"swap_players",id:this.nextEventIdForEvent(t),attributes:{teamId:this.currentStateOfEngine(this.situation).atBatTeamId,secondPlayerId:w.shift(),firstPlayerId:S.player.$id}};pa.debug&&(I.debug={cause:"play_edit",type:"baserunner on 4"}),p.push(I)}}return p},l.prototype.stateUnchangedUnclearEvent=function(t){var p,d,y,s,u,h,v,o,a,r;if(t.description==="Unclear"){var e=t.setting,i=t.result,c=((p=e==null?void 0:e.count)===null||p===void 0?void 0:p.balls)===((d=i==null?void 0:i.count)===null||d===void 0?void 0:d.balls)&&((y=e==null?void 0:e.count)===null||y===void 0?void 0:y.strikes)===((s=i==null?void 0:i.count)===null||s===void 0?void 0:s.strikes)&&((u=e==null?void 0:e.count)===null||u===void 0?void 0:u.outs)===((h=i==null?void 0:i.count)===null||h===void 0?void 0:h.outs)&&((v=e==null?void 0:e.situation)===null||v===void 0?void 0:v.inning)===((o=i==null?void 0:i.situation)===null||o===void 0?void 0:o.inning)&&((a=e==null?void 0:e.situation)===null||a===void 0?void 0:a.half)===((r=i==null?void 0:i.situation)===null||r===void 0?void 0:r.half),f=(e==null?void 0:e.lineup)!==void 0&&(i==null?void 0:i.lineup)!==void 0&&e.lineup.batters!==void 0&&i.lineup.batters!==void 0;if(c)if(f){var _=e==null?void 0:e.lineup,S=i==null?void 0:i.lineup;return _.batters===S.batters&&_.positions===S.positions}else return!0}return!1},l.prototype.transcodeEvent=function(t){var p=[];if(this.stateUnchangedUnclearEvent(t))return[];switch(t.code){case"act":p=this.transcodeActEvent(t);break;case"deact":p=this.transcodeDeactEvent(t);break;case"clear":p=this.transcodeClearEvent(t);break;case"pos":p=this.transcodePosEvent(t);break;case"reord":p=this.transcodeReordEvent(t);break;case"skp":p=[];break;case"newplayer":p=[];break;case"rename":p=[];break;case"dh":p=this.transcodeDHEvent(t);break;case"undh":p=this.transcodeUnDHEvent(t);break;case"crn":p=this.transcodeCrnEvent(t);break;case"sub":p=this.transcodeSubEvent(t);break;case"pitch":p=this.transcodePitchEvent(t);break;case"PROB":p=this.transcodeProbEvent(t);break;case"XS":p=this.transcodeXsEvent(t);break;case"over":p=this.transcodeOverEvent(t);break;case"endhalf":p=this.transcodeEndHalfEvent(t);break;case"msg":p=this.transcodeMsgEvent(t);break}switch(Zy[t.code]){case"end_at_bat":p=this.transcodeToEndAtBatEvent(t);break;case"balk":p=this.transcodeToBalkEvent(t);break;case"illegal_pitch_advance":p=this.transcodeToIllegalPitchAdvanceEvent(t);break;case"ball_in_play":p=this.transcodeToBallInPlayEvent(t);break;case"base_running":p=this.transcodeToBaseRunningEvent(t);break;case"foul_error":p=this.transcodeToFoulErrorEvent(t);break}return p.length!==0&&this.addWriteInDescription(t,p[0]),p},l.prototype.transcodeActEvent=function(t){var p,d,y=[],s;switch((p=t.properties)===null||p===void 0?void 0:p.index){case-2:s="none";break;case void 0:case-1:s="append";break;default:s="replace";break}var u="",h=Be.getParticipants(["subin"],t);if(h.length!==1)return console.log("WARNING: Act event violated exactly one subin participant invariant. Bailing out of transcode."),[];for(var v=0,o=h;v<o.length;v++){var a=o[v],r=a.player.$id;switch(u=this.state.safePlayerTeamMembership(r),s){case"append":this.currentStateOfEngine(this.lineup).indexOfPlayer(u,r)===void 0&&y.push({code:"fill_lineup",id:this.nextEventIdForEvent(t),attributes:{playerId:r,teamId:u}});break;case"replace":y.push({code:"fill_lineup_index",id:this.nextEventIdForEvent(t),attributes:{playerId:r,teamId:u,index:t.properties.index}});break}}if(!((d=t.properties)===null||d===void 0)&&d.pos){var r=h[0].player.$id,e=this.state.safePlayerTeamMembership(r);y.push({code:"fill_position",id:this.nextEventIdForEvent(t),attributes:{teamId:e,playerId:r,position:t.properties.pos}})}if(he.contains(["append","replace"],s)&&t.result!==void 0&&(Be.getEventLineupIndex("result","away",t)||Be.getEventLineupIndex("result","home",t))){var i=void 0;u===this.config.homeTeamId?i=Be.getEventLineupIndex("result","home",t):i=Be.getEventLineupIndex("result","away",t),(s==="append"||s==="replace"&&i===t.properties.index)&&y.push({code:"goto_lineup_index",id:this.nextEventIdForEvent(t),attributes:{index:i,teamId:u}})}return y},l.prototype.transcodeDeactEvent=function(t){var p,d,y,s,u=[],h,v;if(((p=t.participants)===null||p===void 0?void 0:p.length)===1)h=t.participants[0].player.$id,v="simple";else if(((d=t.participants)===null||d===void 0?void 0:d.length)===2){var o=(y=t.participants)===null||y===void 0?void 0:y[1].roles;if(o&&he.contains(o,"dh"))h=t.participants[0].player.$id,v="sitFielder";else if(o&&he.contains(o,"dhFielder"))h=t.participants[1].player.$id,v="sitDH";else return console.log("WARNING: Unexpected two-participant format for deact event: "+t),u}else return console.log("WARNING: Could not determine participants for deact event: "+t),u;var a=this.state.playerTeamMembership[h];if(a===void 0)return u;switch(v){case"simple":((s=t.properties)===null||s===void 0?void 0:s.index)!==void 0&&this.currentStateOfEngine(this.lineup).numberOfBatters(a)>t.properties.index&&u.push({code:"clear_lineup_index",id:this.nextEventIdForEvent(t),attributes:{teamId:a,index:t.properties.index}}),u.push({code:"clear_position_by_id",id:this.nextEventIdForEvent(t),attributes:{teamId:a,playerId:h}});break;case"sitFielder":u.push({code:"clear_position_by_id",id:this.nextEventIdForEvent(t),attributes:{teamId:a,playerId:h}});break;case"sitDH":u.push({code:"fill_lineup_index",id:this.nextEventIdForEvent(t),attributes:{teamId:a,playerId:h,index:t.properties.index}});break}return u},l.prototype.eventsForPartialLineupSquash=function(t){var p,d;if(t.properties.index!==void 0)d=t.properties.index;else{var y=t.properties.former_lineup,s=(p=t.result)===null||p===void 0?void 0:p.lineup;if(y!==void 0&&s!==void 0&&Be.isNewLineup(y)&&Be.isNewLineup(s)){if(d=he.findIndex(he.zip(y.batters,s.batters),function(h){var v=h[0],o=h[1];return v.curr_id!==o.curr_id||v.hide!==o.hide}),d===-1){console.log("WARNING: Got a clear SQH event that did not have any indication of what to squash. Former lineup and result batters were identicle.");return}}else return}var u=this.teamIdFromEventProperties(t);return u===void 0?[]:this.currentStateOfEngine(this.lineup).numberOfBatters(u)>d?[{code:"squash_lineup_index",id:this.nextEventIdForEvent(t),attributes:{teamId:u,index:d}}]:[]},l.prototype.transcodeClearEvent=function(t){var p=[],d=this.teamIdFromEventProperties(t);return d===void 0||(t.short_description==="SQH"?p.push.apply(p,this.eventsForPartialLineupSquash(t)):p.push({code:"clear_entire_lineup",id:this.nextEventIdForEvent(t),attributes:{teamId:d}},{code:"clear_all_positions",id:this.nextEventIdForEvent(t),attributes:{teamId:d}}),t.setting!==void 0&&t.setting.situation!==void 0&&t.setting.situation.away_lineupindex!==void 0&&t.setting.situation.home_lineupindex!==void 0&&t.result!==void 0&&t.result.situation!==void 0&&t.result.situation.away_lineupindex!==void 0&&t.result.situation.home_lineupindex!==void 0&&(t.setting.situation.away_lineupindex!==t.result.situation.away_lineupindex&&(d=Be.teamForLineupIndexKey(t,"away")==="away"?this.config.awayTeamId:this.config.homeTeamId,p.push({code:"goto_lineup_index",id:this.nextEventIdForEvent(t),attributes:{teamId:d,index:t.result.situation.away_lineupindex}})),t.setting.situation.home_lineupindex!==t.result.situation.home_lineupindex&&(d=Be.teamForLineupIndexKey(t,"home")==="home"?this.config.homeTeamId:this.config.awayTeamId,p.push({code:"goto_lineup_index",id:this.nextEventIdForEvent(t),attributes:{teamId:d,index:t.result.situation.home_lineupindex}})))),p},l.prototype.transcodePosEvent=function(t){var p=[];if(t.properties.strategy==="swap dp/flex"){var d=he.first(Be.getParticipants(["flex"],t)),y=he.first(Be.getParticipants(["dp"],t));d!==void 0&&y!==void 0&&p.push({code:"swap_players",id:this.nextEventIdForEvent(t),attributes:{teamId:this.state.safePlayerTeamMembership(d.player.$id),secondPlayerId:d.player.$id,firstPlayerId:y.player.$id}})}else for(var s=0,u=t.participants||[];s<u.length;s++){var h=u[s];h.roles&&he.contains(h.roles,"moving")&&p.push({code:"fill_position",id:this.nextEventIdForEvent(t),attributes:{teamId:this.state.safePlayerTeamMembership(h.player.$id),playerId:h.player.$id,position:t.properties.newpos}}),h.roles&&he.contains(h.roles,"displaced")&&(t.properties.oldpos!==void 0?p.push({code:"fill_position",id:this.nextEventIdForEvent(t),attributes:{teamId:this.state.safePlayerTeamMembership(h.player.$id),playerId:h.player.$id,position:t.properties.oldpos}}):p.push({code:"clear_position_by_id",id:this.nextEventIdForEvent(t),attributes:{teamId:this.state.safePlayerTeamMembership(h.player.$id),playerId:h.player.$id}}))}return p},l.prototype.lineupIndexOfPlayer=function(t,p){for(var d=0;d<this.lineupLength(t);d++)if(this.playerIdAtLineupIndex(t,d)===p)return d},l.prototype.lineupLength=function(t){return Be.isNewLineup(t)?t.batters.length:t.entries.length},l.prototype.playerIdAtLineupIndex=function(t,p){return Be.isNewLineup(t)?t.batters[p].curr_id:t.entries[p].player.$id},l.prototype.isValidTeamId=function(t){return he.contains([this.config.awayTeamId,this.config.homeTeamId],t)},l.prototype.teamIdFromEventProperties=function(t){var p=t.properties;if("team_id"in p&&p.team_id&&this.isValidTeamId(p.team_id))return p.team_id;if("team"in p&&p.team!==void 0&&this.isValidTeamId(p.team.$id))return p.team.$id;if(!Be.isNewLineup(p.former_lineup)&&this.isValidTeamId(p.former_lineup.team_id))return p.former_lineup.team_id},l.prototype.transcodeReordEvent=function(t){var p,d=[];if(t.result.lineup===void 0)return d;var y=this.teamIdFromEventProperties(t);if(y===void 0)return console.log("WARNING: Could not find valid team ID for reord event"),d;if(t.participants&&t.participants.length>0){var s=t.participants[0].player.$id,u=this.lineupIndexOfPlayer(t.properties.former_lineup,s),h=this.lineupIndexOfPlayer(t.result.lineup,s);if(u!==void 0&&h!==void 0){var v=this.currentStateOfEngine(this.lineup).numberOfBatters(y);(v-1>u||v-1>h)&&d.push({code:"reorder_lineup",id:this.nextEventIdForEvent(t),attributes:{teamId:y,fromIndex:u,toIndex:h}})}else console.log("WARNING: Could not derive swap from reord event: ",t)}else{for(var o=t.properties.former_lineup,a=t.result.lineup,u=void 0,h=void 0,r=0;r<this.lineupLength(o)-1;r++)if(this.playerIdAtLineupIndex(o,r)!==this.playerIdAtLineupIndex(a,r)){h=r;break}if(h===void 0)return d;for(var r=h+1;r<this.lineupLength(o);r++)this.playerIdAtLineupIndex(o,r)!==this.playerIdAtLineupIndex(a,r)&&(u=r);u===void 0&&(u=this.lineupLength(o)-1),this.playerIdAtLineupIndex(o,u)!==this.playerIdAtLineupIndex(a,h)&&(p=[u,h],h=p[0],u=p[1]),d.push({code:"reorder_lineup",id:this.nextEventIdForEvent(t),attributes:{teamId:y,fromIndex:u,toIndex:h}})}return d},l.prototype.transcodeDHEvent=function(t){var p=[t.participants[0],t.participants[1]],d=p[0],y=p[1];return[{code:"assign_dh",id:this.nextEventIdForEvent(t),attributes:{teamId:this.state.safePlayerTeamMembership(d.player.$id),dhId:y.player.$id,fielderId:d.player.$id}}]},l.prototype.transcodeUnDHEvent=function(t){var p=t.participants[1];return[{code:"remove_dh",id:this.nextEventIdForEvent(t),attributes:{teamId:this.state.safePlayerTeamMembership(p.player.$id),dhId:p.player.$id}}]},l.prototype.transcodeCrnEvent=function(t){var p=[t.participants[0],t.participants[1]],d=p[0],y=p[1],s={teamId:this.state.safePlayerTeamMembership(d.player.$id),incomingPlayerId:d.player.$id,outgoingPlayerId:y.player.$id};return t.short_description==="Special"&&(s.flavor=yr.ReplaceRunnerFlavor.SpecialPinchRunner),[{code:"replace_runner",id:this.nextEventIdForEvent(t),attributes:s}]},l.prototype.transcodeSubEvent=function(t){var p=he.first(Be.getParticipants(["subin"],t)),d=he.first(Be.getParticipants(["subout"],t));return[{code:"sub_players",id:this.nextEventIdForEvent(t),attributes:{teamId:this.state.safePlayerTeamMembership(p.player.$id),incomingPlayerId:p.player.$id,outgoingPlayerId:d.player.$id,applyToBaserunners:t.short_description==="Pinch"}}]},l.prototype.transcodePitchEvent=function(t){var p=void 0;if(t.properties.pitch==="ball"&&t.properties.illegal===!0)p=yr.PitchResult.IllegalPitch;else if(t.properties.pitch==="ball")p=t.properties.intentional?yr.PitchResult.IntentionalBall:yr.PitchResult.Ball;else if(t.properties.pitch==="strike")switch(t.properties.swing){case"hit":p=yr.PitchResult.BallInPlay;break;case"take":p=yr.PitchResult.StrikeLooking;break;case"miss":p=yr.PitchResult.StrikeSwinging;break;case"foul":p=yr.PitchResult.Foul;break;default:return console.log("Unrecognized swing result ".concat(t.properties.swing)),[]}var d={code:"pitch",id:this.nextEventIdForEvent(t),attributes:{result:p}};if(t.properties.style!==void 0){var y=ev[t.properties.style];y!==void 0&&(d.attributes.style=y)}return t.properties.speed!==void 0&&(d.attributes.speed=t.properties.speed),p!=="ball_in_play"&&t.setting!==void 0&&t.setting.count!==void 0&&t.result!==void 0&&t.result.count!==void 0&&he.isEqual(t.setting.count,t.result.count)&&(d.attributes.advancesCount=!1),[d]},l.prototype.transcodeProbEvent=function(t){return[{code:"place_runner",id:this.nextEventIdForEvent(t),attributes:{base:t.properties.bases,runnerId:t.participants[0].player.$id}}]},l.prototype.transcodeXsEvent=function(t){var p={code:"place_batter",id:this.nextEventIdForEvent(t),attributes:{base:t.properties.bases}};return[p]},l.prototype.transcodeOverEvent=function(t){var p,d,y,s,u={code:"override",id:this.nextEventIdForEvent(t),attributes:{}};if(["balls","outs","strikes"].forEach(function(v){t.setting.count[v]!==t.result.count[v]&&(u.attributes[v]=t.result.count[v])}),!((p=t.setting)===null||p===void 0)&&p.situation&&(!((d=t.result)===null||d===void 0)&&d.situation)&&(t.setting.situation.inning!==t.result.situation.inning&&(u.attributes.inning=t.result.situation.inning),t.setting.situation.half!==t.result.situation.half&&(u.attributes.half=t.result.situation.half===0?"top":"bottom")),!((y=t.setting)===null||y===void 0)&&y.score&&(!((s=t.result)===null||s===void 0)&&s.score)){var h=[];t.setting.score.home!==t.result.score.home&&h.push({teamId:this.config.homeTeamId,score:t.result.score.home}),t.setting.score.away!==t.result.score.away&&h.push({teamId:this.config.awayTeamId,score:t.result.score.away}),h.length!==0&&(u.attributes.scores=h)}return[u]},l.prototype.transcodeEndHalfEvent=function(t){return[{code:"end_half",id:this.nextEventIdForEvent(t)}]},l.prototype.transcodeToEndAtBatEvent=function(t){var p;switch(t.code){case"SO":p="strikeout";break;case"BB":p="walk";break;case"HB":p="hit_by_pitch";break;case"CI":p="catcher_interference";break;default:return console.log("Unrecognized end at bat reason ".concat(t.code)),[]}var d={reason:p};return p==="walk"&&t.properties.intentional&&(d.intentional=!0),[{code:"end_at_bat",id:this.nextEventIdForEvent(t),attributes:d}]},l.prototype.transcodeToBalkEvent=function(t){return[{code:"balk",id:this.nextEventIdForEvent(t)}]},l.prototype.transcodeToIllegalPitchAdvanceEvent=function(t){return[{code:"illegal_pitch_advance",id:this.nextEventIdForEvent(t),attributes:{advancesCount:!0}}]},l.prototype.translateLocation=function(t){var p=t.split("x"),d=p[0],y=p[1];return{x:Number(d),y:Number(y)}},l.prototype.deriveDefendersFromEvent=function(t){var p=[];if(t.properties.sequential_defenders!==void 0)for(var d in t.properties.sequential_defenders)t.properties.sequential_defenders.hasOwnProperty(d)&&p.push({position:t.properties.sequential_defenders[d],location:this.translateLocation(t.properties.sequential_locations[d]),error:!1});else t.properties.defender!==void 0&&p.push({position:t.properties.defender,location:this.translateLocation(t.properties.location),error:!1});if(t.properties.error_on!==void 0)for(var y=0,s=p;y<s.length;y++){var u=s[y];if(u.position===t.properties.error_on){u.error=!0;break}}return p},l.prototype.playAttributesForBallInPlay=function(t){var p,d;switch(t.properties.hit_type){case"fly":p="fly_ball";break;case"line":p="line_drive";break;case"ground":p="ground_ball";break;case"hground":p="hard_ground_ball";break;case"pop":p="pop_fly";break;case"bunt":p="bunt";break}switch(t.code){case"1B":d="single";break;case"2B":d="double";break;case"3B":d="triple";break;case"HR":d="home_run";break;case"E":d="error";break;case"BT":d="single";break;case"FC":d="fielders_choice";break;case"OI":d="offensive_interference";break;case"K":d="dropped_third_strike";break;case"OG":break;case"OL":d="batter_out";break;case"OF":d="batter_out";break;case"IF":d="infield_fly";break;case"DP":break;case"TP":break;case"KO":d="dropped_third_strike_batter_out";break;case"SHB":d="sacrifice_bunt";break;case"SHB+E":d="sacrifice_bunt_error";break;case"SHF":d="sacrifice_fly";break;case"SHF+E":d="sacrifice_fly_error";break;case"OO":d="other_out";break;case"FT":d="foul_tip_out",p="foul_tip";break}if(t.code==="OG"&&(d=this.currentStateOfEngine(this.situation).outs<2?"batter_out_advance_runners":"batter_out"),he.contains(["DP","TP"],t.code))if(t.participants!==void 0){d="fielders_choice";var y=he.first(Be.getParticipants(["batter","out"],t)),s=he.first(Be.getParticipants(["scorer"],t));y!==void 0&&s===void 0&&(t.code==="TP"||this.currentStateOfEngine(this.situation).outs!==0||!he.contains(["ground","hground"],t.properties.hit_type))?d="batter_out":y!==void 0&&(d="batter_out_advance_runners")}else d="batter_out";return[p,d]},l.prototype.primaryEventForBallInPlay=function(t,p,d,y){var s={playType:p,playResult:d,defenders:y};switch(t.properties.foul===1&&(s.playFlavor="in_foul_territory"),d){case"home_run":var u=s;switch(t.properties.hr){case"RF":u.hrLocation="right_field";break;case"CF":u.hrLocation="center_field";break;case"LF":u.hrLocation="left_field";break;default:u.hrLocation="in_the_park";break}return u.hrLocation!=="in_the_park"&&(s.defenders=[]),{code:"ball_in_play",id:this.nextEventIdForEvent(t),attributes:s};case"dropped_third_strike_batter_out":case"dropped_third_strike":var h=void 0;t.properties.cause!==void 0?h=t.properties.cause==="wp"?"wild_pitch":"passed_ball":h="unspecified";var v={playResult:d,defenders:y,cause:h};return{code:"ball_in_play",id:this.nextEventIdForEvent(t),attributes:v};default:return{code:"ball_in_play",id:this.nextEventIdForEvent(t),attributes:s}}},l.prototype.sortUnexpectedBaserunnerMovementEvents=function(t,p){for(var d=[],y=p.length,s=he.invert(t),u=0;d.length!==y&&u<10;){u++;for(var h in p)if(p.hasOwnProperty(h)){var v=p[h],o=v.attributes.base,a=v.attributes.runnerId;if(o===4||v.attributes.playType==="out_on_last_play"){d.push(v),p.splice(Number(h),1),t[s[a]]=void 0,s[a]=4;break}else if(t[o]===void 0){d.push(v),p.splice(Number(h),1),t[s[a]]=void 0,s[a]=o;break}}}return d.length!==y&&(console.log("WARNING: Something went horribly wrong in sortUnexpectedBaserunnerMovementEvent"),console.log(p)),d},l.prototype.expectedBaseData=function(t,p,d){if(t.setting===void 0||t.setting.situation===void 0||t.setting.situation.bases===void 0)return[];var y=[];if(p.code==="ball_in_play"){var s=p,u=po.ballInPlayResultConfigs[s.attributes.playResult],h=he.first(Be.getParticipants(["batter"],t));u.batterOut||y.push({playerId:h.player.$id,base:u.bases})}for(var v=po.ballInPlayResultConfigs[d].bases,o=0,a=t.setting.situation.bases;o<a.length;o++){var r=a[o],e=Math.min(4,r.base+v);e!==4&&y.push({playerId:r.player.$id,base:e})}return y},l.prototype.expectedBaseStateByPlayer=function(t,p,d){for(var y=this.expectedBaseData(t,p,d),s={},u=0,h=y;u<h.length;u++){var v=h[u];s[v.playerId]=v.base}return s},l.prototype.expectedBaseStateByBase=function(t,p,d){for(var y=this.expectedBaseData(t,p,d),s={},u=0,h=y;u<h.length;u++){var v=h[u];s[v.base]=v.playerId}return s},l.prototype.unexpectedBaserunnerMovementForBallInPlay=function(t,p,d){var y=[];if(t.setting!==void 0&&t.setting.situation!==void 0&&t.setting.situation.bases!==void 0&&t.result!==void 0&&t.result.situation!==void 0&&t.result.situation.bases!==void 0){var s=this.expectedBaseStateByPlayer(t,p,d)||{},u=void 0;if(Be.eventEndedInning(t)){u=[];var h=he.find(t.setting.situation.bases,function(x){return x.base===3});if(h!==void 0){var v=he.first(Be.getParticipants(["scorer"],t));v!==void 0&&v.player.$id===h.player.$id?u=[]:u=[{base:h.base,player:h.player}]}}else u=t.result.situation.bases;if(Be.eventEndedInning(t)){for(var o in s)if(s.hasOwnProperty(o)){var a=!0;if(t.participants!==void 0)for(var r=0,e=t.participants;r<e.length;r++){var i=e[r];if(i.player.$id===o){a=!1;break}}a&&s[o]===void 0&&u.push({base:3,player:{$id:o,$ref:"player"}})}}for(var c=he.first(Be.getParticipants(["batter"],t)),f=c===void 0?void 0:c.player.$id,_=he.map(Be.getParticipants(["out"],t),function(x){return x.player.$id}),S=0,P=u;S<P.length;S++){var I=P[S],E=[I.base,s[I.player.$id]],B=E[0],b=E[1];if(I.player.$id!==f&&B!==b){var R=void 0,F=void 0;if(he.contains(_,I.player.$id))continue;Be.eventEndedInning(t)&&b===void 0&&B<4?(R="did_not_score",F=4):(R=B>b?"advanced_on_last_play":"remained_on_last_play",F=B),y.push({code:"base_running",id:this.nextEventIdForEvent(t),attributes:{playType:R,base:F,runnerId:I.player.$id,defenders:[]}})}}}return y},l.prototype.poofRuleEventsForBallInPlay=function(t){var p=[];if(t.participants!==void 0)for(var d=0,y=t.participants;d<y.length;d++){var s=y[d];if(s.roles!==void 0&&he.contains(s.roles,"poof")){p.push({code:"base_running",id:this.nextEventIdForEvent(t),attributes:{playType:"did_not_score",base:4,runnerId:s.player.$id,defenders:[]}});break}}return p},l.prototype.baserunnerOutsForBallInPlay=function(t,p){var d,y=[],s=po.ballInPlayResultConfigs[p];if(t.participants!==void 0)for(var u=0,h=t.participants;u<h.length;u++){var v=h[u];v.roles&&he.contains(v.roles,"out")&&(!s.batterOut||!he.contains(v.roles,"batter"))&&y.push({code:"base_running",id:this.nextEventIdForEvent(t),attributes:{playType:"out_on_last_play",base:((d=v.properties)===null||d===void 0?void 0:d.base)||0,runnerId:v.player.$id,defenders:[]}})}return y},l.prototype.transcodeToBallInPlayEvent=function(t){var p=[],d=this.playAttributesForBallInPlay(t),y=d[0],s=d[1],u=this.deriveDefendersFromEvent(t),h=this.primaryEventForBallInPlay(t,y,s,u);p.push(h);var v=this.unexpectedBaserunnerMovementForBallInPlay(t,h,s);v.push.apply(v,this.poofRuleEventsForBallInPlay(t)),v.push.apply(v,this.baserunnerOutsForBallInPlay(t,s));var o=this.expectedBaseStateByBase(t,h,s)||{};return p.push.apply(p,this.sortUnexpectedBaserunnerMovementEvents(o,v)),p},l.prototype.transcodeToBaseRunningEvent=function(t){var p,d,y,s=void 0,u=void 0;switch(t.code){case"rTU":s="advanced_on_last_play",u="tagged_up";break;case"rRF":break;case"rCT":s="out_on_last_play",u="caught_tagging";break;case"rOA":break;case"rRS":break;case"rBT":s="out_on_last_play",u="caught_backtracking";break;case"rOI":s="offensive_interference";break;case"rDT":s="out_on_last_play",u="did_not_tag";break;case"rSB":s="stole_base";break;case"rDI":s="defensive_indifference";break;case"rPB":s="passed_ball";break;case"rWP":s="wild_pitch";break;case"rAP":s="attempted_pickoff";break;case"rFC":s="fielders_choice_attempted_pickoff";break;case"rAE":s="advanced_on_error";break;case"rOOA":s="out_on_appeal";break;case"rCS":s="caught_stealing";break;case"rOO":s="other_out";break;case"rPO":s="picked_off";break;case"rDO":s="out_on_last_play",u="doubled_off";break;case"rCR":s="out_on_last_play",u="caught_running";break;case"rTH":s="advanced_on_last_play",u="on_the_throw";break;case"rET":s="advanced_on_error";break}for(var h=0,v=(p=t.participants)!==null&&p!==void 0?p:[];h<v.length;h++){var o=v[h];if(!(o.roles&&!he.contains(o.roles,"runner"))){var a=he.contains((d=o.roles)!==null&&d!==void 0?d:[],"out");if(t.code==="rOA")s=a?"other_out":"other_advance";else if(he.contains(["rRF","rRS"],t.code)){s=t.code==="rRF"?"advanced_on_last_play":"remained_on_last_play";var r=void 0;(0,Xy.isDBRef)(t.parent_play)?r=this.inputEventById(t.parent_play.$id):r=t.parent_play,r!==void 0&&(r.code==="pitch"?s="on_same_pitch":r.code==="rAE"&&(s="on_same_error"))}var e={playType:s,base:(y=o.properties)===null||y===void 0?void 0:y.base,runnerId:o.player.$id,defenders:this.deriveDefendersFromEvent(t)};return u!==void 0&&(e.playFlavor=u),[{code:"base_running",id:this.nextEventIdForEvent(t),attributes:e}]}}},l.prototype.transcodeToFoulErrorEvent=function(t){return[{code:"foul_error",id:this.nextEventIdForEvent(t),attributes:{defenders:this.deriveDefendersFromEvent(t),advancesCount:!0}}]},l.prototype.transcodeMsgEvent=function(t){var p=void 0,d=/\"(.*)\" \(via (.*)\)/,y=t.description.match(d)||[];return y.length===3?p=y[1]:p=t.description,[{code:"message",id:this.nextEventIdForEvent(t),attributes:{content:p}}]},l}(md.SnapshottedTranscoder);er.Transcoder=nv;var Cr={},Ed;function av(){if(Ed)return Cr;Ed=1,Object.defineProperty(Cr,"__esModule",{value:!0}),Cr.LineupEngine=Cr.LineupState=void 0;var n=X,l=n.__importStar(fe()),t=n.__importStar(Ee()),p=n.__importStar(Oe()),d=tt(),y=Ge(),s=l.Record({temporaryBatterId:"",advanceLineupIndexAfterAtBat:!0}),u=function(o){n.__extends(a,o);function a(){return o!==null&&o.apply(this,arguments)||this}return a}(s),h=function(o){n.__extends(a,o);function a(){return o!==null&&o.apply(this,arguments)||this}return Object.defineProperty(a.prototype,"globalAtBatId",{get:function(){return this.get("globalAtBatId")},enumerable:!1,configurable:!0}),a.prototype.refreshAtBatGlobalId=function(){return this.set("globalAtBatId",(0,y.uuid4)())},a.prototype.getPlayerAtIndex=function(r,e){return this.getIn([r,"batters",e])},a.prototype.numberOfBatters=function(r){return this.getIn([r,"batters"]).size},a.prototype.battersImmutable=function(r){return this.getIn([r,"batters"])},a.prototype.batters=function(r){var e=this.battersImmutable(r);return e!==void 0?e.toJS():[]},a.prototype.designatedHitterForPlayer=function(r,e){var i=this.getIn([r,"dhs"]);return i.findKey(function(c){return c===e})},a.prototype.designatedHitteeForPlayer=function(r,e){return this.getIn([r,"dhs",e])},a.prototype.dpFlexAssignmentsForTeam=function(r){return{dp:this.getIn([r,"dp"]),flex:this.getIn([r,"flex"])}},a.prototype.lineupIndex=function(r){return this.getIn([r,"currentIndex"])},a.prototype.currentBatter=function(r){var e=this.temporaryBatter(r);return e||this.getPlayerAtIndex(r,this.lineupIndex(r))},a.prototype.temporaryBatter=function(r){return this.getIn([r,"temporaryBatterState","temporaryBatterId"])},a.prototype.indexOfPlayer=function(r,e){var i=this.getIn([r,"batters"]).findIndex(function(c){return c===e});return i===-1?void 0:i},a.prototype.ensureTeamLineup=function(r){return this.get(r)!==void 0?this:this.set(r,l.fromJS({batters:[],dhs:{},dp:void 0,flex:void 0,currentIndex:0,confirmedEndOfLineup:!1}))},a.prototype.ensureLineupLengthAtLeast=function(r,e){return this.updateIn([r,"batters"],function(i){return i.setSize(Math.max(i.size,e))})},a.prototype.fillIndex=function(r,e,i){var c=this.ensureLineupLengthAtLeast(r,i);return c.setIn([r,"batters",i],e)},a.prototype.swapDesignatedHitterReferences=function(r,e,i){return this.updateIn([r,"dhs"],function(c){return l.Map().withMutations(function(f){for(var _=0,S=c.keySeq().toArray();_<S.length;_++){var P=S[_],I=c.get(P),E=void 0,B=void 0;P===e?E=i:P===i?E=e:E=P,I===e?B=i:I===i?B=e:B=I,f.set(E,B)}})})},a.prototype.swapDPFlexReferences=function(r,e,i){var c=this.dpFlexAssignmentsForTeam(r),f=[c.dp,c.flex],_=f[0],S=f[1],P=[_,S],I=P[0],E=P[1];return e===_&&(I=i),e===S&&(E=i),i===_&&(I=e),i===S&&(E=e),this.setIn([r,"dp"],I).setIn([r,"flex"],E)},a.prototype.teamIds=function(){for(var r=[],e=0,i=this.keySeq().toArray();e<i.length;e++){var c=i[e];this.getIn([c,"batters"])!==void 0&&r.push(c)}return r},Object.defineProperty(a.prototype,"fullLineups",{get:function(){for(var r={},e=0,i=this.teamIds();e<i.length;e++){var c=i[e];r[c]={batters:this.batters(c),currentIndex:this.lineupIndex(c)}}return r},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"dhsMap",{get:function(){for(var r={},e=0,i=this.teamIds();e<i.length;e++){var c=i[e],f=this.getIn([c,"dhs"]);f!==void 0&&(r[c]=f.toJS())}return r},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"dpFlexMap",{get:function(){for(var r={},e=0,i=this.teamIds();e<i.length;e++){var c=i[e];r[c]=this.dpFlexAssignmentsForTeam(c)}return r},enumerable:!1,configurable:!0}),a}(p.ImmutableState);Cr.LineupState=h;var v=function(o){n.__extends(a,o);function a(r,e){var i=o.call(this,r)||this;return i.baseEvents=r,i.situation=e,i}return a.prototype.initialState=function(){return new h(l.Map({globalAtBatId:(0,y.uuid4)()}))},a.prototype.processOneEvent=function(r,e){switch(e.code){case"set_teams":return this.setTeams(r,e);case"fill_lineup":return this.fill(r,e);case"fill_lineup_index":return this.fillIndex(r,e);case"reorder_lineup":return this.reorderLineup(r,e);case"goto_lineup_index":return this.gotoIndex(r,e);case"clear_lineup_index":return this.clearIndex(r,e);case"clear_entire_lineup":return this.clearEntire(r,e);case"squash_lineup_index":return this.squashIndex(r,e);case"swap_players":return this.swapPlayers(r,e);case"sub_players":return this.subPlayers(r,e);case"assign_dh":return this.assignDH(r,e);case"remove_dh":return this.removeDH(r,e);case"fill_position":return this.fillPosition(r,e);case"clear_position_by_id":return this.clearPositionById(r,e);case"clear_all_positions":return this.clearAllPositions(r,e);case"assign_flex":return this.assignFlex(r,e);case"clear_flex":return this.clearFlex(r,e);case"assign_dp":return this.assignDP(r,e);case"clear_dp":return this.clearDP(r,e);case"swap_dp_flex":return this.swapDPFlex(r,e);case"illegal_pitch_advance":return this.illegalPitchAdvance(r);case"end_at_bat":case"ball_in_play":case"place_batter":return this.incrementLineupIndex(r);case"pitch":return this.handlePitch(r);case"confirm_end_of_lineup":return this.confirmEndOfLineup(r,e);case"courtesy_batter":return this.courtesyBatter(r,e);case"replace_batter":return this.replaceBatter(r,e);case"base_running":case"end_half":case"override":default:return this.situationAfterEvent.lastEventEndedInning?this.clearTemporaryBatterState(r):r}},Object.defineProperty(a.prototype,"situationBeforeEvent",{get:function(){return this.situation.stateBeforeEvent(this.nextEventOffset)},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"situationAfterEvent",{get:function(){return this.situation.stateAfterEvent(this.nextEventOffset)},enumerable:!1,configurable:!0}),a.prototype.setTeams=function(r,e){var i=e.attributes,c=i.homeId,f=i.awayId;return r.ensureTeamLineup(c).ensureTeamLineup(f)},a.prototype.fill=function(r,e){var i=e.attributes,c=i.teamId,f=i.playerId;return r.updateIn([c,"batters"],function(_){for(var S=0;S<_.size;S++)if(_.get(S)===void 0)return _.set(S,f);return _.push(f)})},a.prototype.fillIndex=function(r,e){var i=e.attributes,c=i.teamId,f=i.playerId,_=i.index;return r.fillIndex(c,f,_)},a.prototype.reorderLineup=function(r,e){var i=e.attributes,c=i.teamId,f=i.fromIndex,_=i.toIndex;return r=r.ensureLineupLengthAtLeast(c,_),r.updateIn([c,"batters"],function(S){return S.withMutations(function(P){var I=P.get(f);if(f>_)for(var E=f;E>=_;E--)E===_?P.set(E,I):P.set(E,P.get(E-1));else for(var E=f;E<=_;E++)E===_?P.set(E,I):P.set(E,P.get(E+1));return P})})},a.prototype.gotoIndex=function(r,e){var i=e.attributes,c=i.teamId,f=i.index;return r=r.ensureLineupLengthAtLeast(c,f),r.setIn([c,"currentIndex"],f)},a.prototype.clearIndex=function(r,e){var i=e.attributes,c=i.teamId,f=i.index;return r.batters(c).length>f&&(r=r.setIn([c,"batters",f],void 0)),r},a.prototype.clearEntire=function(r,e){var i=e.attributes.teamId;return r.setIn([i,"batters"],l.List([])).setIn([i,"currentIndex"],0)},a.prototype.squashIndex=function(r,e){var i=e.attributes,c=i.teamId,f=i.index;if(r.batters(c).length>f){var _=r.getIn([c,"batters"]),S=r.getIn([c,"currentIndex"]),P=void 0,I=r.batters(c).length-1;I!==0?P=(S-(f<S?1:0))%I:P=0,r=r.setIn([c,"currentIndex"],P),r=r.setIn([c,"batters"],_.splice(f,1))}return r},a.prototype.swapPlayers=function(r,e){var i=e.attributes,c=i.teamId,f=i.firstPlayerId,_=i.secondPlayerId;r=r.swapDesignatedHitterReferences(c,f,_),r=r.swapDPFlexReferences(c,f,_);var S=r.indexOfPlayer(c,f),P=r.indexOfPlayer(c,_);return S!==void 0&&(r=r.fillIndex(c,_,S)),P!==void 0&&(r=r.fillIndex(c,f,P)),r},a.prototype.subPlayers=function(r,e){var i=e.attributes,c=i.teamId,f=i.incomingPlayerId,_=i.outgoingPlayerId;r=r.swapDesignatedHitterReferences(c,f,_),r=r.swapDPFlexReferences(c,f,_);var S=r.indexOfPlayer(c,f),P=r.indexOfPlayer(c,_);return P===void 0?r:(S!==void 0&&(r=r.fillIndex(c,void 0,S)),r.fillIndex(c,f,P))},a.prototype.assignDH=function(r,e){var i=e.attributes,c=i.teamId,f=i.dhId,_=i.fielderId;r=r.setIn([c,"dhs",f],_);var S=r.indexOfPlayer(c,_);return S!==void 0&&(r=r.fillIndex(c,f,S)),r},a.prototype.removeDH=function(r,e){var i=e.attributes,c=i.teamId,f=i.dhId,_=r.getIn([c,"dhs",f]);r=r.setIn([c,"dhs",f],void 0);var S=r.indexOfPlayer(c,f);return S!==void 0&&(r=r.fillIndex(c,_,S)),r},a.prototype.fillPosition=function(r,e){var i=e.attributes,c=i.teamId,f=i.playerId,_=i.position,S=r.designatedHitterForPlayer(c,f);return _!=="DH"&&(r=r.removeIn([c,"dhs",f])),S!==void 0&&(0,d.isMultiPosition)(_)&&(r=r.setIn([c,"dhs",S],void 0)),_==="DH"&&(r=r.setIn([c,"dhs",f],void 0)),r},a.prototype.clearPositionById=function(r,e){var i=e.attributes,c=i.teamId,f=i.playerId;r.hasIn([c,"dhs",f])&&(r=r.removeIn([c,"dhs",f]));var _=r.designatedHitterForPlayer(c,f);return _!==void 0&&(r=r.setIn([c,"dhs",_],void 0)),r},a.prototype.clearAllPositions=function(r,e){var i=e.attributes.teamId;return r.setIn([i,"dhs"],l.fromJS({}))},a.prototype.assignFlex=function(r,e){var i=e.attributes,c=i.teamId,f=i.playerId;return r.setIn([c,"flex"],f)},a.prototype.clearFlex=function(r,e){return r.setIn([e.attributes.teamId,"flex"],void 0)},a.prototype.assignDP=function(r,e){var i=e.attributes,c=i.teamId,f=i.playerId;return r.setIn([c,"dp"],f)},a.prototype.clearDP=function(r,e){return r.setIn([e.attributes.teamId,"dp"],void 0)},a.prototype.swapDPFlex=function(r,e){var i=e.attributes.teamId,c=r.dpFlexAssignmentsForTeam(i),f=[c.dp,c.flex],_=f[0],S=f[1];if(_===void 0||S===void 0)return r;var P=[r.indexOfPlayer(i,_),r.indexOfPlayer(i,S)],I=P[0],E=P[1];return I===void 0&&E===void 0||(I!==void 0&&(r=r.setIn([i,"batters",I],S)),E!==void 0&&(r=r.setIn([i,"batters",E],_))),r},a.prototype.illegalPitchAdvance=function(r){return this.situationAfterEvent.lastEventWasWalk?this.incrementLineupIndex(r):r},a.prototype.clearTemporaryBatterState=function(r){var e=this.situationBeforeEvent.atBatTeamId;return r.deleteIn([e,"temporaryBatterState"])},a.prototype.incrementLineupIndex=function(r){var e=this.situationBeforeEvent.atBatTeamId,i=r.getIn([e,"confirmedEndOfLineup"]),c=r.getIn([e,"temporaryBatterState"]);return r=r.deleteIn([e,"temporaryBatterState"]),(!c||c.advanceLineupIndexAfterAtBat)&&(r=r.ensureLineupLengthAtLeast(e,1),r=r.updateIn([e,"currentIndex"],function(f){var _=r.numberOfBatters(e);if(!(!i&&f+1===_))return(f+1)%_})),r.refreshAtBatGlobalId()},a.prototype.handlePitch=function(r){return this.situationAfterEvent.lastEventWasStrikeout||this.situationAfterEvent.lastEventWasWalk?this.incrementLineupIndex(r):r},a.prototype.confirmEndOfLineup=function(r,e){return r.setIn([e.attributes.teamId,"confirmedEndOfLineup"],!0)},a.prototype.courtesyBatter=function(r,e){return this.setTemporaryBatter(r,e.attributes.teamId,e.attributes.incomingPlayerId,!1)},a.prototype.replaceBatter=function(r,e){return this.setTemporaryBatter(r,e.attributes.teamId,e.attributes.incomingPlayerId,!0)},a.prototype.setTemporaryBatter=function(r,e,i,c){var f=new u({temporaryBatterId:i,advanceLineupIndexAfterAtBat:c});return r.setIn([e,"temporaryBatterState"],f)},a}(t.VersionedStateEngine);return Cr.LineupEngine=v,Cr}var ho={},Bd;function iv(){return Bd||(Bd=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.PerInningEngine=n.PerInningStats=n.PerInningDefenseRecord=n.PerInningOffenseRecord=n.perInningDefenseRecord=n.perInningOffenseRecord=n.PitchingRecord=n.pitchingRecord=n.InningTeamStats=n.PerInningTeamStats=void 0;var l=X,t=l.__importStar(fe()),p=l.__importStar(Ee()),d=l.__importStar(Oe()),y=tt(),s=t.Record({offense:t.List(),defense:t.List(),total1BEdit:void 0,total2BEdit:void 0,total3BEdit:void 0,totalHREdit:void 0,totalRunsEdit:void 0,totalErrorsEdit:void 0}),u=function(f){l.__extends(_,f);function _(){return f!==null&&f.apply(this,arguments)||this}return _}(s),h=function(){function f(){}return f}();n.PerInningTeamStats=h;var v=function(){function f(){}return f}();n.InningTeamStats=v,n.pitchingRecord=t.Record({pitches:0,strikes:0,strikePercentage:0});var o=function(f){l.__extends(_,f);function _(){return f!==null&&f.apply(this,arguments)||this}return Object.defineProperty(_.prototype,"strikePercentage",{get:function(){return this.pitches>0?this.strikes/this.pitches:0},enumerable:!1,configurable:!0}),_.prototype.toJS=function(){return{pitches:this.pitches,strikes:this.strikes,strikePercentage:this.strikePercentage}},_}(n.pitchingRecord);n.PitchingRecord=o;var a=t.Map();n.perInningOffenseRecord=t.Record({hits1B:0,hits2B:0,hits3B:0,hitsHR:0,hits:0,runs:0,lob:0}),n.perInningDefenseRecord=t.Record({errors:0,pitches:0,pitchers:a});var r=function(f){l.__extends(_,f);function _(){return f!==null&&f.apply(this,arguments)||this}return _}(n.perInningOffenseRecord);n.PerInningOffenseRecord=r;var e=function(f){l.__extends(_,f);function _(){return f!==null&&f.apply(this,arguments)||this}return _}(n.perInningDefenseRecord);n.PerInningDefenseRecord=e;var i=function(f){l.__extends(_,f);function _(){return f!==null&&f.apply(this,arguments)||this}return Object.defineProperty(_.prototype,"linescore",{get:function(){return this.get("stats").toSeq().map(function(S){return S.offense}).map(function(S){return S==null?void 0:S.map(function(P){return P.runs})}).toMap().toJS()},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"fullPerInningStats",{get:function(){return this.getIn(["stats"]).toJS()},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"summedPerInningStats",{get:function(){var S={};return this.get("stats").forEach(function(P,I){var E,B,b,R,F,x;S[I]={totalRuns:0,totalHits:0,total1B:0,total2B:0,total3B:0,totalHR:0,totalErrors:0},P.get("offense").forEach(function(w){S[I].totalRuns+=w.runs,S[I].total1B+=w.hits1B,S[I].total2B+=w.hits2B,S[I].total3B+=w.hits3B,S[I].totalHR+=w.hitsHR}),P.get("defense").forEach(function(w){S[I].totalErrors+=w.errors}),S[I].totalRuns=(E=P.get("totalRunsEdit"))!==null&&E!==void 0?E:S[I].totalRuns,S[I].total1B=(B=P.get("total1BEdit"))!==null&&B!==void 0?B:S[I].total1B,S[I].total2B=(b=P.get("total2BEdit"))!==null&&b!==void 0?b:S[I].total2B,S[I].total3B=(R=P.get("total3BEdit"))!==null&&R!==void 0?R:S[I].total3B,S[I].totalHR=(F=P.get("totalHREdit"))!==null&&F!==void 0?F:S[I].totalHR,S[I].totalHits=S[I].total1B+S[I].total2B+S[I].total3B+S[I].totalHR,S[I].totalErrors=(x=P.get("totalErrorsEdit"))!==null&&x!==void 0?x:S[I].totalErrors}),S},enumerable:!1,configurable:!0}),_.prototype.statsForInning=function(S){return this.get("stats").toSeq().map(function(P){var I=S>P.offense.size?void 0:P.offense.get(S-1).toJS(),E=S>P.defense.size?void 0:P.defense.get(S-1).toJS();return{offense:I,defense:E}}).toMap().toJS()},_.prototype.incrementRunsForInning=function(S,P,I){return this.incrementIn(["stats",S,"offense",P-1,"runs"],I)},_.prototype.incrementHitsForInning=function(S,P,I,E){return this.incrementIn(["stats",S,"offense",P-1,"hits".concat(I)],E).incrementIn(["stats",S,"offense",P-1,"hits"],E)},_.prototype.incrementErrorsForInning=function(S,P,I){return this.incrementIn(["stats",S,"defense",P-1,"errors"],I)},_.prototype.incrementTotalPitchesForInning=function(S,P,I){return this.incrementIn(["stats",S,"defense",P-1,"pitches"],I)},_.prototype.incrementPitchingStatForInning=function(S,P,I,E,B){var b=["stats",P,"defense",E-1,"pitchers",I],R=this.hasIn(b)?this:this.setIn(b,new o);return R.incrementIn(b.concat([S]),B)},_.prototype.setLeftOnBaseForInning=function(S,P,I){return this.setIn(["stats",S,"offense",P-1,"lob"],I)},_.prototype.setTotalRunsEdit=function(S,P){return this.setIn(["stats",S,"totalRunsEdit"],P)},_.prototype.setTotalHitsEdit=function(S,P,I){return this.setIn(["stats",S,"total".concat(P,"Edit")],I)},_.prototype.setTotalErrorsEdit=function(S,P){return this.setIn(["stats",S,"totalErrorsEdit"],P)},_.prototype.initialize=function(S,P){return this.setIn(["stats",S],new u).setIn(["stats",P],new u).initializeToInningHalf(1,"top",S)},_.prototype.initializeToInningHalf=function(S,P,I){for(var E=this,B=this.get("stats").keySeq().toArray(),b=function(w){E=E.updateIn(["stats",w,"offense"],function(L){return L.withMutations(function(D){var U=S;P==="top"&&w===I&&U--;for(var G=D.size;G<U;G++)D.push(new r({}))})}),E=E.updateIn(["stats",w,"defense"],function(L){return L.withMutations(function(D){var U=S;P==="top"&&w!==I&&U--;for(var G=D.size;G<U;G++)D.push(new e({}))})})},R=0,F=B;R<F.length;R++){var x=F[R];b(x)}return E},_}(d.ImmutableState);n.PerInningStats=i;var c=function(f){l.__extends(_,f);function _(S,P,I,E){var B=f.call(this,S)||this;return B.baseEvents=S,B.situation=P,B.baserunners=I,B.fielders=E,B}return Object.defineProperty(_.prototype,"lastSituationState",{get:function(){return this.situation.stateBeforeEvent(this.nextEventOffset)},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"nextSituationState",{get:function(){return this.situation.stateBeforeEvent(this.nextEventOffset+1)},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"lastBaserunnerState",{get:function(){return this.baserunners.stateBeforeEvent(this.nextEventOffset)},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"nextBaserunnerState",{get:function(){return this.baserunners.stateBeforeEvent(this.nextEventOffset+1)},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"lastFieldersState",{get:function(){return this.fielders.stateBeforeEvent(this.nextEventOffset)},enumerable:!1,configurable:!0}),_.prototype.processOneEvent=function(S,P){switch(P.code!=="pitcher_decision"&&(S=S.initializeToInningHalf(this.lastSituationState.inning,this.lastSituationState.half,this.lastSituationState.homeId)),P.code){case"set_teams":var I=P;S=S.initialize(I.attributes.homeId,I.attributes.awayId);break;case"override":S=this.overrideForLinescore(S,P);break;case"team_stat_edit":S=this.handleTeamStatEdit(S,P);break}return S=this.reconcileStats(S,P),S},_.prototype.initialState=function(){return new i(t.fromJS({stats:{}}))},_.prototype.handleTeamStatEdit=function(S,P){switch(P.category){case"offense":switch(P.statName){case"R":return S.setTotalRunsEdit(P.teamId,P.statValue);case"1B":return S.setTotalHitsEdit(P.teamId,"1B",P.statValue);case"2B":return S.setTotalHitsEdit(P.teamId,"2B",P.statValue);case"3B":return S.setTotalHitsEdit(P.teamId,"3B",P.statValue);case"HR":return S.setTotalHitsEdit(P.teamId,"HR",P.statValue)}break;case"defense":switch(P.statName){case"E":return S.setTotalErrorsEdit(P.teamId,P.statValue)}break}return S},_.prototype.reconcileStats=function(S,P){var I=this.lastSituationState.inning,E=this.lastSituationState.atBatTeamId,B=this.lastSituationState.inFieldTeamId,b=this.nextBaserunnerState.runnersScoredOnLastEvent.length-this.nextBaserunnerState.runnersUnscoredOnLastEvent.length;if(b!==0&&(S=S.incrementRunsForInning(E,I,b)),(0,y.isHit)(P))switch(P.attributes.playResult){case"single":S=S.incrementHitsForInning(E,I,"1B",1);break;case"double":S=S.incrementHitsForInning(E,I,"2B",1);break;case"triple":S=S.incrementHitsForInning(E,I,"3B",1);break;case"home_run":S=S.incrementHitsForInning(E,I,"HR",1);break}if((0,y.isError)(P)&&(S=S.incrementErrorsForInning(B,I,1)),(0,y.isPitchEvent)(P)){S=S.incrementTotalPitchesForInning(B,I,1);var R=this.lastFieldersState.playerForPosition(B,"P");R!==void 0&&(S=S.incrementPitchingStatForInning("pitches",B,R,I,1),(0,y.isStrike)(P)&&(S=S.incrementPitchingStatForInning("strikes",B,R,I,1)))}return this.nextSituationState.lastEventEndedInning&&(S=S.setLeftOnBaseForInning(E,I,this.nextBaserunnerState.runnersLeftOnBase)),S},_.prototype.overrideForLinescore=function(S,P){var I=this.nextSituationState.homeId,E=this.nextSituationState.awayId;if((this.lastSituationState.inning!==this.nextSituationState.inning||this.lastSituationState.half!==this.nextSituationState.half)&&(S=S.initializeToInningHalf(this.nextSituationState.inning,this.nextSituationState.half,I)),P.attributes.scores===void 0)return S;for(var B=[0,0],b=B[0],R=B[1],F=0,x=P.attributes.scores;F<x.length;F++){var w=x[F],L=w.teamId,D=w.score;L===E?b=D-this.lastBaserunnerState.scoreForTeam(L):R=D-this.lastBaserunnerState.scoreForTeam(L)}var U=[this.lastSituationState.inning,this.lastSituationState.half],G=U[0],q=U[1];if(b!==0&&(S=S.incrementRunsForInning(E,G,b)),R!==0){var z=q==="bottom"?G:Math.max(1,G-1);z===1&&(S=S.initializeToInningHalf(z,"bottom",I)),S=S.incrementRunsForInning(I,z,R)}return S},_}(p.VersionedStateEngine);n.PerInningEngine=c}(ho)),ho}var Mr={},Td;function sv(){if(Td)return Mr;Td=1,Object.defineProperty(Mr,"__esModule",{value:!0}),Mr.PitchDataEngine=Mr.PitchDataState=void 0;var n=X,l=n.__importStar(fe()),t=n.__importStar(Ee()),p=n.__importStar(Oe()),d=function(s){n.__extends(u,s);function u(){return s!==null&&s.apply(this,arguments)||this}return Object.defineProperty(u.prototype,"pitchData",{get:function(){return this.get("teams").toJS()},enumerable:!1,configurable:!0}),u.prototype.pitchDataForPlayer=function(h,v){var o=this.getIn(["teams",h,v]);return o!==void 0?o.toJS():void 0},u.prototype.initializeForTeam=function(h){return this.setIn(["teams",h],l.Map({}))},u.prototype.addPitchDataItem=function(h,v,o,a){return a===void 0?this:this.updateIn(["teams",o,a],function(r){return r===void 0&&(r=l.List()),r.push({inning:h,result:v.attributes.result,style:v.attributes.style,speed:v.attributes.speed})})},u}(p.ImmutableState);Mr.PitchDataState=d;var y=function(s){n.__extends(u,s);function u(h,v,o){var a=s.call(this,h)||this;return a.baseEvents=h,a.situation=v,a.fielders=o,a}return Object.defineProperty(u.prototype,"lastSituationState",{get:function(){return this.situation.stateBeforeEvent(this.nextEventOffset)},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"lastFielderState",{get:function(){return this.fielders.stateBeforeEvent(this.nextEventOffset)},enumerable:!1,configurable:!0}),u.prototype.initialState=function(){return new d(l.fromJS({teams:{}}))},u.prototype.processOneEvent=function(h,v){switch(v.code){case"set_teams":return this.setTeams(h,v);case"pitch":return this.pitch(h,v)}return h},u.prototype.setTeams=function(h,v){return h.initializeForTeam(v.attributes.homeId).initializeForTeam(v.attributes.awayId)},u.prototype.pitch=function(h,v){var o=this.lastSituationState.inFieldTeamId;return h.addPitchDataItem(this.lastSituationState.inning,v,o,this.lastFielderState.playerForPosition(o,"P"))},u}(t.VersionedStateEngine);return Mr.PitchDataEngine=y,Mr}var xr={},ha={},Od;function ov(){if(Od)return ha;Od=1,Object.defineProperty(ha,"__esModule",{value:!0}),ha.MetadataTracker=void 0;var n=X,l=n.__importStar(Pe),t=function(){function p(d,y,s,u,h){h===void 0&&(h=[]),this.situation=d,this.lineup=y,this.fielders=s,this.baserunners=u,this.trackMetadata={};for(var v=0,o=h;v<o.length;v++){var a=o[v];this.trackMetadata[a]=!0}this.metadataFunctions={at_bat_batter_changed:this.currentAtBatBatterChanged.bind(this),at_bat_pitcher_changed:this.currentAtBatPitcherChanged.bind(this),baserunner_changed:this.baserunnerChanged.bind(this)}}return p.prototype.currentAtBatBatterChanged=function(d,y){return l.contains(["clear_entire_lineup","fill_lineup","fill_lineup_index","reorder_lineup","clear_lineup_index","squash_lineup_index","swap_players","sub_players","goto_lineup_index","assign_dh","remove_dh","place_batter"],d.code)?this.lineup.stateBeforeEvent(y).currentBatter(this.situation.stateBeforeEvent(y).atBatTeamId)!==this.lineup.stateAfterEvent(y).currentBatter(this.situation.stateAfterEvent(y).atBatTeamId):!1},p.prototype.currentAtBatPitcherChanged=function(d,y){return l.contains(["clear_all_positions","fill_position","clear_position_by_id","swap_players","sub_players"],d.code)?this.fielders.stateBeforeEvent(y).playerForPosition(this.situation.stateBeforeEvent(y).inFieldTeamId,"P")!==this.fielders.stateAfterEvent(y).playerForPosition(this.situation.stateAfterEvent(y).inFieldTeamId,"P"):!1},p.prototype.baserunnerChanged=function(d,y){return l.contains(["sub_players","swap_players","replace_runner"],d.code)?!l.isEqual(this.baserunners.stateBeforeEvent(y).baserunners,this.baserunners.stateAfterEvent(y).baserunners):!1},p.prototype.metadataForEvent=function(d,y){var s={};for(var u in this.trackMetadata)this.trackMetadata[u]===!0&&(s[u]=this.metadataFunctions[u](d,y));return s},p}();return ha.MetadataTracker=t,ha}var Lr={},yo={},Ad;function tr(){return Ad||(Ad=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.AtBatRecord=n.atBatRecord=n.BaseRunningOnPlayRecord=n.baseRunningOnPlayRecord=n.ChildEventRecord=n.childEventRecord=n.PlayResultRecord=n.playResultRecord=n.ParticipantRecord=n.participantRecord=n.allWithRole=n.firstParticipantWithIdToJS=n.firstParticipantWithId=n.firstFielderByFieldingOrder=n.firstFielderWithError=n.firstFielderWithPositionToJS=n.firstFielderWithPosition=n.firstWithRoleToJS=n.firstWithRole=n.PlaySituationRecord=n.playSituationRecord=n.isCompoundPlayType=void 0;var l=X,t=l.__importStar(Pe),p=l.__importStar(fe());function d(I){return t.contains(["double_play","triple_play","fielders_choice_double_play"],I)}n.isCompoundPlayType=d,n.playSituationRecord=p.Record({inning:void 0,half:void 0,balls:void 0,strikes:void 0,outs:void 0,bases:p.Map(),homeScore:0,awayScore:0});var y=function(I){l.__extends(E,I);function E(){return I!==null&&I.apply(this,arguments)||this}return E}(n.playSituationRecord);n.PlaySituationRecord=y;function s(I,E){return I.find(function(B){return B.role===E})}n.firstWithRole=s;function u(I,E){return I.find(function(B){return B.role===E})}n.firstWithRoleToJS=u;function h(I,E){return I.find(function(B){return B.role==="fielder"&&B.position===E})}n.firstFielderWithPosition=h;function v(I,E){return I.find(function(B){return B.role==="fielder"&&B.position===E})}n.firstFielderWithPositionToJS=v;function o(I){return I.find(function(E){return E.role==="fielder"&&E.committedError===!0})}n.firstFielderWithError=o;function a(I){return I.find(function(E){return E.role==="fielder"&&E.fieldingOrder.contains(0)})}n.firstFielderByFieldingOrder=a;function r(I,E){return I.find(function(B){return B.playerId===E})}n.firstParticipantWithId=r;function e(I,E){return I.find(function(B){return B.playerId===E})}n.firstParticipantWithIdToJS=e;function i(I,E){return I.filter(function(B){return B.role===E}).toArray()}n.allWithRole=i,n.participantRecord=p.Record({playerId:void 0,globalAtBatId:void 0,role:void 0,position:void 0,fieldingOrder:p.List(),committedError:!1,base:void 0,out:!1,scored:!1,baseChanged:!0,slot:void 0,template:void 0,perspective:void 0});var c=function(I){l.__extends(E,I);function E(){return I!==null&&I.apply(this,arguments)||this}return E}(n.participantRecord);n.ParticipantRecord=c,n.playResultRecord=p.Record({createdAt:void 0,playType:void 0,lastPitchResult:void 0,eventId:void 0,writeInDescription:void 0,situation:new y});var f=function(I){l.__extends(E,I);function E(){return I!==null&&I.apply(this,arguments)||this}return E}(n.playResultRecord);n.PlayResultRecord=f,n.childEventRecord=p.Record({createdAt:void 0,beforePitchIndex:void 0,eventId:void 0,code:void 0,participants:p.List(),headline:void 0,template:void 0,writeInDescription:void 0,situation:new y,metadata:void 0,baseRunningPlayType:void 0});var _=function(I){l.__extends(E,I);function E(){return I!==null&&I.apply(this,arguments)||this}return E}(n.childEventRecord);n.ChildEventRecord=_,n.baseRunningOnPlayRecord=p.Record({createdAt:void 0,eventId:void 0,playType:void 0,participants:p.List(),headline:void 0,template:void 0,writeInDescription:void 0,situation:new y});var S=function(I){l.__extends(E,I);function E(){return I!==null&&I.apply(this,arguments)||this}return E}(n.baseRunningOnPlayRecord);n.BaseRunningOnPlayRecord=S,n.atBatRecord=p.Record({pitches:p.List(),result:new f,participants:p.List(),headline:"",template:"",childEvents:p.List(),baseRunningOnPlayEvents:p.List(),initialSituation:new y({inning:1,half:"top",balls:0,strikes:0,outs:0,bases:[],homeScore:0,awayScore:0}),firstSignificantEventId:void 0});var P=function(I){l.__extends(E,I);function E(){return I!==null&&I.apply(this,arguments)||this}return Object.defineProperty(E.prototype,"orderedEventIds",{get:function(){var B=this,b=[],R=0;return this.pitches.forEach(function(F,x){B.childEvents.forEach(function(w){w.beforePitchIndex===x&&(b.push(w.eventId),R++)}),b.push(F.eventId)}),this.childEvents.slice(R).forEach(function(F){b.push(F.eventId)}),this.result.eventId!==void 0&&!t.contains(b,this.result.eventId)&&b.push(this.result.eventId),this.baseRunningOnPlayEvents.forEach(function(F){b.push(F.eventId)}),t.uniq(b)},enumerable:!1,configurable:!0}),E}(n.atBatRecord);n.AtBatRecord=P}(yo)),yo}var ya={},Rd;function Fd(){if(Rd)return ya;Rd=1,Object.defineProperty(ya,"__esModule",{value:!0}),ya.findLocationData=void 0;var n=X,l=n.__importStar(Pe),t=n.__importStar(tt());function p(d){var y,s;t.isBallInPlayEvent(d)&&(s=d.attributes.playType,d.attributes.defenders!==void 0&&d.attributes.defenders.length!==0&&(y=l.first(d.attributes.defenders).location));var u;return t.isHomeRunEvent(d)&&(u=d.attributes.hrLocation),{fieldedLocation:y,ballInPlayType:s,hrLocation:u}}return ya.findLocationData=p,ya}var kd;function wd(){if(kd)return Lr;kd=1,Object.defineProperty(Lr,"__esModule",{value:!0}),Lr.renderForScorebook=Lr.lookupMapForEvents=void 0;var n=X,l=n.__importStar(Pe),t=n.__importStar(tt()),p=n.__importStar(tr()),d=Fd(),y,s={single:"1B",double:"2B",triple:"3B",home_run:"HR",dropped_third_strike:"Kd3",dropped_third_strike_batter_out:"K",fielders_choice:"FC",error:"E",sacrifice_bunt:"SAC",sacrifice_fly:"SF",sacrifice_bunt_error:"E",sacrifice_fly_error:"E",offensive_interference:"OI",infield_fly:"IF",other_out:"Out",foul_tip_out:"K",stole_base:"SB",defensive_indifference:"DI",passed_ball:"PB",wild_pitch:"WP",on_same_pitch:"Pitch",advanced_on_error:"E",on_same_error:"E",out_on_appeal:"OOA",caught_stealing:"CS",other_advance:"OA",picked_off:"PO",did_not_score:"X",tagged_up:"TU",caught_tagging:"CT",caught_backtracking:"BT",did_not_tag:"DT",doubled_off:"DO",caught_running:"CR",on_the_throw:"THR",strikeout:"K",strikeout_looking:"KL",walk:"BB",hit_by_pitch:"HBP",catcher_interference:"CI",double_play:"DP",triple_play:"TP",fielders_choice_double_play:"FC",place_batter:"PROB",baserunning_ended_inning:"Out",next_half:"over",inning_override:"over",ground_out:"G",fly_out:"F",pop_out:"F",line_out:"L",place_runner:"MAN",balk:"BK",illegal_pitch_advance:"IP"};function u(c){for(var f={},_=0,S=c;_<S.length;_++){var P=S[_];f[P.id]=P}return f}Lr.lookupMapForEvents=u;function h(c){var f=c.baseRunningOnPlayEvents.find(function(_){return _.playType==="advanced_on_error"||_.playType==="on_same_error"});return f?" + ".concat(v(f.playType)):""}function v(c){return s[c]||"?"}function o(c,f,_,S){S.participants.forEach(function(P){var I=P.globalAtBatId;if(I!==void 0&&(c[I]===void 0&&(c[I]=[]),!!l.some([P.scored,P.out,P.baseChanged]))){var E=f[S.eventId],B;t.isBaseRunningEvent(E)?(B=E.attributes.playFlavor||E.attributes.playType,B==="on_same_pitch"?B=y||"on_same_pitch":l.contains(["wild_pitch","passed_ball"],B)?y=B:y=void 0):t.isPitchEvent(E)&&E.attributes.result==="illegal_pitch"?B="illegal_pitch_advance":B=E.code;var b=_.initialSituation.half==="top"?S.situation.awayScore:S.situation.homeScore;c[I].push({reason:B,reasonCode:v(B),fieldedLocation:void 0,hrLocation:void 0,ballInPlayType:void 0,base:P==null?void 0:P.base,outNumber:P.out?S.situation.outs||3:void 0,runNumber:P.scored?b:void 0})}})}function a(c){var f={},_=[0,0],S=_[0],P=_[1];if(c.childEvents.size!==0){var I=c.childEvents.last();S=I.situation.outs,P=c.initialSituation.half==="top"?I.situation.awayScore:I.situation.homeScore}else S=c.initialSituation.outs,P=c.initialSituation.half==="top"?c.initialSituation.awayScore:c.initialSituation.homeScore;var E=p.allWithRole(c.participants,"runner"),B=p.firstWithRole(c.participants,"batter");B!==void 0&&E.push(B);for(var b=0,R=E;b<R.length;b++){var F=R[b],x={};F.out&&(x.outNumber=++S),F.scored&&(x.runNumber=++P),l.isEmpty(x)||(f[F.globalAtBatId]=x)}return f}function r(c,f,_){if(_.childEvents.forEach(function(P){o(c,f,_,P)}),_.result.playType!=="baserunning_ended_inning"){var S=a(_);_.participants.forEach(function(P){var I=P,E=I.globalAtBatId,B=I.scored,b=I.out,R=I.baseChanged,F=I.role;if(E!==void 0&&(c[E]===void 0&&(c[E]=[]),!!l.some([B,b,R]))){var x=f[_.result.eventId],w=_.result.playType;if(!p.isCompoundPlayType(_.result.playType)&&t.isBallInPlayEvent(x)&&l.contains(["batter_out","batter_out_advance_runners"],x.attributes.playResult))switch(x.attributes.playType){case"bunt":case"ground_ball":case"hard_ground_ball":w="ground_out";break;case"fly_ball":w="fly_out";break;case"pop_fly":w="pop_out";break;case"line_drive":w="line_out";break;case"foul_tip":w="strikeout";break}if(t.isPitchEvent(x)){var L=_.result;switch(L.lastPitchResult){case"strike_looking":w="strikeout_looking";break}}var D=(0,d.findLocationData)(x),U=S[E]||{};c[E].push({reason:w,reasonCode:v(w)+h(_),fieldedLocation:F==="batter"?D.fieldedLocation:void 0,hrLocation:F==="batter"?D.hrLocation:void 0,ballInPlayType:D.ballInPlayType,base:P==null?void 0:P.base,outNumber:U.outNumber,runNumber:U.runNumber})}})}}function e(c,f,_,S){var P={};P[c]=[],P[f]=[];var I={};I[c]={},I[f]={};var E={};return E[c]={},E[f]={},S.forEach(function(B){var b=B,R=b.initialSituation,F=R.half,x=R.inning,w=b.result.eventId,L=b.participants,D=F==="top"?f:c,U=x-1,G=p.firstWithRole(L,"batter"),q=w!==void 0;if(!(q&&G===void 0)){var z;q?z=G.slot:z=_;var ne=E[D][U]||0,ue=I[D][U],ee;for(ue===void 0?(ee=!0,I[D][U]={}):(ee=!1,I[D][U][z]!==void 0&&(ne++,I[D][U]={})),E[D][U]=ne,I[D][U][z]=!0;P[D].length<=U;)P[D].push([]);for(;P[D][U].length<=ne;)P[D][U].push([]);for(;P[D][U][ne].length<=z;)P[D][U][ne].push(void 0);var $=B==null?void 0:B.toJS();$.firstAtBatOfInning=ee,P[D][U][ne][z]=$}}),P}function i(c,f,_,S,P){var I={},E=u(S);return P.forEach(function(B){r(I,E,B)}),{atBatProgressMap:I,atBatsByInningColumnSlot:e(c,f,_,P)}}return Lr.renderForScorebook=i,Lr}var vo={},rr={},Cd;function Wi(){if(Cd)return rr;Cd=1,Object.defineProperty(rr,"__esModule",{value:!0}),rr.pluralSuffix=rr.ordinalNumber=rr.stubbify=void 0;function n(p){return p?"${"+p+"}":""}rr.stubbify=n;function l(p){var d={1:"st",2:"nd",3:"rd"},y="th";return(p<4||p>20)&&(y=d[p%10]||"th"),"".concat(p).concat(y)}rr.ordinalNumber=l;function t(p,d){return p<=0?"no ".concat(d,"s"):p===1?"1 ".concat(d):"".concat(p," ").concat(d,"s")}return rr.pluralSuffix=t,rr}var Md;function uv(){return Md||(Md=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.templateForChildBaseRunning=n.defendersInfo=n.replacePlayerIdInPerspective=n.stubbify=n.perspectivesForAtBat=n.templateForChildEvent=n.headlineForChildEvent=n.headlineForBaseRunningChildEvent=n.shortTemplateForBaserunner=n.templateForBaseRunningOnPlayEvent=n.templateForAtBat=n.headlineForAtBat=n.templateForPitch=void 0;var l=X,t=l.__importStar(Pe),p=Rt(),d=l.__importStar(tt()),y=Wi();Object.defineProperty(n,"stubbify",{enumerable:!0,get:function(){return y.stubbify}});var s=l.__importStar(tr()),u=lo();function h(j,te){var Z=v(j.attributes.result,te),M=j.attributes.style?o(j.attributes.style):void 0,H=j.attributes.speed?"".concat(j.attributes.speed," MPH"):void 0;if(M||H){var Q=t.compact([H,M]).join(" ");Z+=" (".concat(Q,")")}return Z}n.templateForPitch=h;function v(j,te){switch(j){case p.PitchResult.StrikeSwinging:return"Strike ".concat(te.resultingStrikes," swinging");case p.PitchResult.StrikeLooking:return"Strike ".concat(te.resultingStrikes," looking");case p.PitchResult.Ball:return"Ball ".concat(te.resultingBalls);case p.PitchResult.IntentionalBall:return"Ball ".concat(te.resultingBalls," (intentional)");case p.PitchResult.Foul:return"Foul";case p.PitchResult.IllegalPitch:return"Illegal pitch";case p.PitchResult.FoulTip:return"Foul tip";case p.PitchResult.FoulBunt:return"Foul bunt";case p.PitchResult.BallInPlay:return"In play";default:(0,u.assertUnreachable)(j)}}function o(j){switch(j){case"fastball":return"Fastball";case"curveball":return"Curveball";case"slider":return"Slider";case"riseball":return"Riseball";case"dropball":return"Dropball";case"screwball":return"Screwball";case"drop_curve":return"Drop Curve";case"cutter":return"Cutter";case"knuckleball":return"Knuckleball";case"knuckle_curve":return"Knuckle Curve";case"changeup":return"Changeup";default:(0,u.assertUnreachable)(j)}}function a(j,te){switch(te.result.playType){case"single":return"Single";case"double":return"Double";case"triple":return"Triple";case"home_run":return"Home Run";case"foul_tip_out":return"Foul Tip Out";case"dropped_third_strike":case"dropped_third_strike_batter_out":return"Dropped 3rd Strike";case"fielders_choice":return"Fielder's Choice";case"error":return"Error";case"sacrifice_bunt_error":return"Error";case"sacrifice_bunt":return"Sacrifice Bunt";case"sacrifice_fly_error":return"Error";case"sacrifice_fly":return"Sacrifice Fly";case"offensive_interference":return"Offensive Interference";case"infield_fly":return"Infield Fly";case"other_out":return"Batter Out";case"fielders_choice_double_play":case"double_play":return"Double Play";case"triple_play":return"Triple Play";case"batter_out":case"batter_out_advance_runners":switch(j.attributes.playType){case"bunt":case"ground_ball":case"hard_ground_ball":return"Ground Out";case"fly_ball":return"Fly Out";case"pop_fly":return"Pop Out";case"line_drive":return"Line Out";case"foul_tip":return"Strikeout"}return"Batter Out";default:return"Ball In Play"}}function r(j,te){switch(te.result.playType){case"next_half":return"Inning Ended";case"inning_override":return"Inning Changed by Scorekeeper";case"strikeout":return"Strikeout";case"walk":return d.isEndAtBatEvent(j)&&j.attributes.intentional||d.isPitchEvent(j)&&j.attributes.result==="intentional_ball"?"Intentional Walk":"Walk";case"hit_by_pitch":return"Hit By Pitch";case"catcher_interference":return"Catcher's Interference";case"place_batter":return"Batter Put on Base";case"baserunning_ended_inning":return"Runner Out";case"double_play":return"Double Play";case"triple_play":return"Triple Play";case"fielders_choice_double_play":return"FC Double Play";default:return a(j,te)}}n.headlineForAtBat=r;function e(j,te){switch(te.result.playType){case"next_half":return ne();case"inning_override":return ue();case"strikeout":case"walk":case"hit_by_pitch":case"catcher_interference":return G(j,te);case"place_batter":return q(te);case"baserunning_ended_inning":return z();case"double_play":case"triple_play":case"fielders_choice_double_play":default:return U(j,te)}}n.templateForAtBat=e;function i(j,te){var Z=s.firstWithRole(te.participants,"runner"),M=(0,y.stubbify)(Z.playerId),H=b(Z.base),Q="";if(j.attributes.playFlavor!==void 0)switch(j.attributes.playFlavor){case"tagged_up":j.attributes.base===4?Q="".concat(M," scores after tagging up"):Q="".concat(M," advances to ").concat(H," after tagging up");break;case"caught_tagging":Q="".concat(M," out at ").concat(H," advancing after tag up");break;case"did_not_tag":Q="".concat(M," out at ").concat(H,", failing to tag up");break;case"doubled_off":Q="".concat(M," doubled off at ").concat(H);break;case"caught_running":Q="".concat(M," out at ").concat(H,", caught running");break;case"on_the_throw":j.attributes.base===4?Q="".concat(M," scores on the throw"):Q="".concat(M," advances to ").concat(H," on the throw");break}if(Q==="")switch(j.attributes.playType){case"advanced_on_last_play":Q=Z.scored?"".concat(M," scores"):"".concat(M," advances to ").concat(H);break;case"remained_on_last_play":Q="".concat(M," held up at ").concat(H);break;case"out_on_last_play":Q="".concat(M," out advancing to ").concat(H);break;case"did_not_score":Q="".concat(M," did not score");break;case"advanced_on_error":Q=Z.scored?"".concat(M," scores on error"):"".concat(M," advances to ").concat(H," on error");break;case"on_same_error":Q=Z.scored?"".concat(M," scores on the same error"):"".concat(M," advances to ").concat(H," on the same error");break}if(j.attributes.playType==="advanced_on_error"){var oe=w(te.participants);return"".concat(Q).concat(oe)}return Q}n.templateForBaseRunningOnPlayEvent=i;function c(j,te,Z){var M=(0,y.stubbify)(j);return Z===4?"".concat(M," scores"):Z>te?"".concat(M," advances to ").concat(b(Z)):Z<=te?"".concat(M," remains at ").concat(b(Z)):""}n.shortTemplateForBaserunner=c;function f(j){return j.attributes.result==="illegal_pitch"?"Illegal Pitch":"On The Pitch"}function _(j){switch(j.attributes.playFlavor){case"tagged_up":return"Tagged Up";case"caught_tagging":return"Caught Tagging Up";case"caught_backtracking":return"Caught Backtracking";case"did_not_tag":return"Did Not Tag Up";case"doubled_off":return"Doubled Off";case"caught_running":return"Caught Running";case"on_the_throw":return"On Throw"}switch(j.attributes.playType){case"offensive_interference":return"Offensive Interference";case"stole_base":return j.attributes.base===4?"Steals Home":"Steals ".concat(b(j.attributes.base));case"defensive_indifference":return"On Defensive Indifference";case"passed_ball":return"On Passed Ball";case"wild_pitch":return"On Wild Pitch";case"on_same_pitch":return"On Same Pitch";case"attempted_pickoff":return"Pickoff Attempt";case"fielders_choice_attempted_pickoff":return"Fielder's Choice";case"advanced_on_error":return"On Error";case"on_same_error":return"On Same Error";case"out_on_appeal":return"Out on Appeal";case"caught_stealing":return"Caught Stealing";case"other_out":switch(j.attributes.playFlavor){case"left_base_early":return"Left Base Early";default:return"Out (other)"}case"other_advance":return"Advanced (other)";case"picked_off":return"Picked Off";case"did_not_score":return"Did Not Score";case"advanced_on_last_play":return"On Last Play";case"remained_on_last_play":return"Remained on Last Play";case"out_on_last_play":return"On Last Play"}return"Base Running"}n.headlineForBaseRunningChildEvent=_;function S(j){switch(j.code){case"pitch":return f(j);case"base_running":return _(j);case"end_half":return"End Half";case"override":return"Manual Override";case"fill_position":return"Fill Position";case"clear_position_by_id":return"Clear Position";case"clear_all_positions":return"Clear Positions";case"fill_lineup_index":return"Add to Lineup";case"fill_lineup":return"Add to Lineup";case"reorder_lineup":return"Reorder Lineup";case"clear_lineup_index":return"Clear Batter";case"clear_entire_lineup":return"Clear Lineup";case"replace_runner":return"Courtesy Runner";case"swap_players":return"Swap Players";case"sub_players":return"Substitution";case"goto_lineup_index":return"Skip to Batter";case"confirm_end_of_lineup":return"Confirm End of Lineup";case"squash_lineup_index":return"Squash Lineup";case"assign_dh":return"Assign DH";case"remove_dh":return"Remove DH";case"assign_flex":return"Assign Flex";case"clear_flex":return"Clear Flex";case"assign_dp":return"Assign DP";case"clear_dp":return"Clear DP";case"swap_dp_flex":return"Swap DP/Flex";case"balk":return"Balk";case"illegal_pitch_advance":return"Illegal Pitch";case"foul_error":return"Foul Error";case"place_batter":return"Place Batter";case"place_runner":return"Place Runner";case"pitcher_decision":return"Pitcher Decision";case"message":return"Scorekeeper Note"}return""}n.headlineForChildEvent=S;function P(j,te){switch(j.code){case"base_running":return ee(j,te);case"override":return $(j,te)}var Z=te.participants.first(),M=Z!==void 0?(0,y.stubbify)(Z.playerId):"",H,Q,oe=j.code;switch(d.isPitchEvent(j)&&j.attributes.advancesRunners&&(j.attributes.result==="illegal_pitch"?oe="illegal_pitch_advance":oe="other_pitch_advance"),oe){case"balk":return M!==""?"Balk by pitcher ".concat(M):"Balk";case"illegal_pitch_advance":return M!==""?"Runners advance on illegal pitch by ".concat(M):"Runners advance on illegal pitch";case"other_pitch_advance":return M!==""?"Runners advance on pitch by ".concat(M):"Runners advance on pitch";case"foul_error":var pe=s.firstWithRole(te.participants,"fielder"),ce=pe!==void 0?" ".concat((0,y.stubbify)(pe.playerId)):"";return pe!==void 0?"Error by ".concat(R(pe.position)).concat(ce," on foul ball"):"Error on foul ball";case"fill_position":var Ie=j.attributes.position;return"Lineup changed: ".concat(M," in at ").concat(R(Ie));case"clear_position_by_id":return"Lineup changed: ".concat(M," sat from the field");case"clear_all_positions":return H=(0,y.stubbify)(j.attributes.teamId),"Lineup changed: Removed all players for ".concat(H," from the field");case"fill_lineup_index":return Q=j.attributes.index,"Lineup changed: ".concat(M," activated, batting ").concat((0,y.ordinalNumber)(Q+1));case"goto_lineup_index":return Q=j.attributes.index,M!==""?"Lineup changed: Scorekeeper skipped to ".concat(M,", batting ").concat((0,y.ordinalNumber)(Q+1)):"Lineup changed: Scorekeeper skipped to ".concat((0,y.ordinalNumber)(Q+1)," lineup spot (currently empty)");case"fill_lineup":return"Lineup changed: ".concat(M," activated");case"reorder_lineup":var Te=j;return M!==""?"Lineup changed: Moved ".concat(M," to ").concat(Te.attributes.toIndex+1,"-hole"):"Lineup changed: Moved empty ".concat(Te.attributes.fromIndex+1," slot to position ").concat(Te.attributes.toIndex+1);case"clear_entire_lineup":return H=(0,y.stubbify)(j.attributes.teamId),"Lineup changed: Cleared entire lineup for ".concat(H);case"replace_runner":var me=j,qe=void 0;switch(me.attributes.flavor){case p.ReplaceRunnerFlavor.SpecialPinchRunner:{qe="Special pinch runner";break}case p.ReplaceRunnerFlavor.RetroactiveSubstitution:{qe="(Play Edit)";break}default:{qe="Courtesy runner";break}}return"".concat(qe," ").concat((0,y.stubbify)(me.attributes.incomingPlayerId)," in for ").concat((0,y.stubbify)(me.attributes.outgoingPlayerId));case"swap_players":var st=j;return"".concat((0,y.stubbify)(st.attributes.firstPlayerId)," swapped positions and lineup order with ").concat((0,y.stubbify)(st.attributes.secondPlayerId));case"sub_players":var Ue=j,Qe=Ue.attributes.outgoingPlayerId,ht=s.firstParticipantWithId(te.participants,Qe),It="";return ht!==void 0&&ht.position!==void 0&&(It=R(ht.position)+" "),"Lineup changed: ".concat((0,y.stubbify)(Ue.attributes.incomingPlayerId)," in for ").concat(It).concat((0,y.stubbify)(Ue.attributes.outgoingPlayerId));case"squash_lineup_index":var wt=j;return H=(0,y.stubbify)(wt.attributes.teamId),"Lineup changed: Squashed empty lineup position ".concat(wt.attributes.index+1," for ").concat(H);case"assign_dh":var Ct=j;return"Lineup changed: ".concat((0,y.stubbify)(Ct.attributes.dhId)," in as designated hitter for ").concat((0,y.stubbify)(Ct.attributes.fielderId));case"remove_dh":var Vt=j;return"Lineup changed: ".concat((0,y.stubbify)(Vt.attributes.dhId)," no longer designated hitting");case"assign_dp":var Mt=j;return"Lineup changed: ".concat((0,y.stubbify)(Mt.attributes.playerId)," assigned to DP");case"clear_dp":return"Lineup changed: Scorekeeper unassigned the DP";case"assign_flex":var mt=j;return"Lineup changed: ".concat((0,y.stubbify)(mt.attributes.playerId)," assigned to Flex");case"clear_flex":return"Lineup changed: Scorekeeper unassigned the Flex";case"swap_dp_flex":return"Lineup changed: DP and Flex players swap positions";case"place_runner":var xt=j;return"".concat(M," gets placed on ").concat(b(xt.attributes.base));case"pitcher_decision":var bt=j.attributes.decision;switch(bt){case"win":return"".concat(M," is the winning pitcher");case"loss":return"".concat(M," is the losing pitcher");case"save":return"".concat(M," credited with the save");case"blown_save":return"".concat(M," charged with a blown save")}return"";case"message":var Lt=j;return"".concat(Lt.attributes.content)}return""}n.templateForChildEvent=P;function I(j,te){var Z=te.result.playType,M=void 0,H=s.firstFielderByFieldingOrder(te.participants);H!==void 0&&(M=H.position);for(var Q=s.allWithRole(te.participants,"runner"),oe={},pe=0,ce=Q;pe<ce.length;pe++){var Ie=ce[pe];oe[Ie.playerId]=Ie}return{batter:J(Z,M,j),error:ie(Z,M,j),pitcher:ae(Z,M,j),fielder:se(Z,M,j),runners:t.mapObject(oe,t.partial(ye,Z,M,j))}}n.perspectivesForAtBat=I;function E(j,te){return j.replace("${playerId}",(0,y.stubbify)(te))}n.replacePlayerIdInPerspective=E;function B(j){return j===void 0?j:j.replace(/_/g," ")}function b(j){switch(j){case 1:return"1st";case 2:return"2nd";case 3:return"3rd";case 4:return"home";default:return String(j)}}function R(j){switch(j){case"1B":return"first baseman";case"2B":return"second baseman";case"3B":return"third baseman";case"P":return"pitcher";case"C":return"catcher";case"CF":return"center fielder";case"LF":return"left fielder";case"RF":return"right fielder";case"SF":return"short fielder";case"SS":return"shortstop";case"EH":return"extra hitter";case"DH":return"designated hitter";case"F10":return"F10";default:return"other"}}function F(j){return B(j)}function x(j){switch(j){case"ground_ball":case"hard_ground_ball":return"grounds";case"fly_ball":return"flies";case"pop_fly":return"pops";case"foul_tip":return"tips";case"line_drive":return"lines";case"bunt":return"bunts";default:return""}}function w(j){var te="",Z=s.firstFielderWithError(j);if(Z!==void 0){var M=R(Z.position),H=(0,y.stubbify)(Z.playerId);te+=" by ".concat(M),H!==""&&(te+=" ".concat(H))}return te}function L(j){var te="",Z=s.allWithRole(j,"fielder");if(Z.length===0)return{template:"",totalDefenders:0};for(var M=t.reduce(t.pluck(Z,"fieldingOrder"),function(Ue,Qe){return Ue+Qe.size},0),H=new Array(M),Q=function(Ue){Ue.fieldingOrder.forEach(function(Qe){H.splice(Qe,1,Ue)})},oe=0,pe=Z;oe<pe.length;oe++){var ce=pe[oe];Q(ce)}var Ie;switch(H.length){case 1:Ie="one";break;case 2:Ie="two";break;default:Ie="many";break}for(var Te=0;Te<H.length;Te++){var ce=H[Te],me=Te===H.length-1,qe=R(ce.position),st=(0,y.stubbify)(ce.playerId);switch(st!==""&&(st=" "+st),Ie){case"one":case"two":case"many":te+="".concat(qe).concat(st),me||(te+=" to ");break}}return{template:te,totalDefenders:H.length}}n.defendersInfo=L;function D(j){var te=j.attributes.hrLocation;switch(te){case"left_field":case"center_field":case"right_field":return"to "+B(te);case"in_the_park":return"inside the park";default:return""}}function U(j,te){var Z,M=s.firstWithRole(te.participants,"batter"),H=(0,y.stubbify)(M==null?void 0:M.playerId),Q=F(j.attributes.playType),oe=x(j.attributes.playType),pe,ce="";if(d.isBallInPlayEvent(j)&&j.attributes.playFlavor==="in_foul_territory"&&(ce=" in foul territory"),t.contains(["dropped_third_strike","dropped_third_strike_batter_out"],te.result.playType)){var Ie=j.attributes.cause;pe=B(Ie)}switch(te.result.playType){case"single":Z="".concat(H," singles on a ").concat(Q);break;case"double":Z="".concat(H," doubles on a ").concat(Q);break;case"triple":Z="".concat(H," triples on a ").concat(Q);break;case"home_run":var Te=D(j);Te==="inside the park"?Z="".concat(H," hits an inside the park home run on a ").concat(Q):Z="".concat(H," homers on a ").concat(Q," ").concat(Te);break;case"dropped_third_strike":pe!=="unspecified"?Z="".concat(H," reaches on dropped 3rd strike (").concat(pe,")"):Z="".concat(H," reaches on dropped 3rd strike");break;case"dropped_third_strike_batter_out":pe!=="unspecified"?Z="".concat(H," out at first on dropped 3rd strike (").concat(pe,")"):Z="".concat(H," out at first on dropped 3rd strike");break;case"fielders_choice":Z="".concat(H," ").concat(oe," into fielder's choice");break;case"error":Q==="bunt"?Z="".concat(H," bunts and reaches on an error"):Z="".concat(H," hits a ").concat(Q," and reaches on an error");break;case"sacrifice_bunt":Z="".concat(H," sacrifices");break;case"sacrifice_fly":Z="".concat(H," out on sacrifice fly");break;case"sacrifice_bunt_error":Z="".concat(H," sacrifices and reaches on an error");break;case"sacrifice_fly_error":Z="".concat(H," hits a sacrifice fly and reaches on an error");break;case"batter_out":case"batter_out_advance_runners":Z="".concat(H," ").concat(oe," out").concat(ce);break;case"offensive_interference":Z="".concat(H," out due to batter interference");break;case"infield_fly":Z="".concat(H," out on infield fly");break;case"other_out":Z="".concat(H," out (other)");break;case"foul_tip_out":Z="".concat(H," out on foul tip");break;case"double_play":Z="".concat(H," ").concat(oe," into a double play");break;case"fielders_choice_double_play":Z="".concat(H," ").concat(oe," into a fielder's choice double play");break;case"triple_play":Z="".concat(H," ").concat(oe," into a triple play");break}if(t.contains(["dropped_third_strike","dropped_third_strike_batter_out","offensive_interference"],te.result.playType))return Z;if(t.contains(["error","sacrifice_bunt_error","sacrifice_fly_error"],te.result.playType)){var me=w(te.participants);return"".concat(Z).concat(me)}var qe=L(te.participants);switch(qe.totalDefenders){case 0:return Z;case 1:return"".concat(Z," to ").concat(qe.template);default:return"".concat(Z,", ").concat(qe.template)}}function G(j,te){var Z=s.firstWithRole(te.participants,"batter"),M=s.firstWithRole(te.participants,"pitcher"),H=s.firstFielderWithPosition(te.participants,"C"),Q=(0,y.stubbify)(Z==null?void 0:Z.playerId),oe=(0,y.stubbify)(M==null?void 0:M.playerId),pe=H!==void 0?(0,y.stubbify)(H.playerId):"",ce=oe!==""?", ".concat(oe," pitching"):"",Ie=pe!==""?" by ".concat(pe):"",Te=te.result.lastPitchResult,me;switch(te.result.playType){case"strikeout":Te==="strike_swinging"?me="".concat(Q," strikes out swinging").concat(ce):Te==="strike_looking"?me="".concat(Q," strikes out looking").concat(ce):Te==="foul_tip"?me="".concat(Q," is out on foul tip").concat(ce):Te==="foul_bunt"?me="".concat(Q," is out on foul bunt").concat(ce):me="".concat(Q," strikes out").concat(ce);break;case"walk":Te==="intentional_ball"||d.isEndAtBatEvent(j)&&j.attributes.intentional?me="".concat(Q," is intentionally walked").concat(ce):me="".concat(Q," walks").concat(ce);break;case"hit_by_pitch":me="".concat(Q," is hit by pitch").concat(ce);break;case"catcher_interference":me="".concat(Q," reaches on catcher's interference").concat(Ie);break}return me}function q(j){var te=s.firstWithRole(j.participants,"batter"),Z=(0,y.stubbify)(te==null?void 0:te.playerId),M=b(te==null?void 0:te.base);return"".concat(Z," gets placed on ").concat(M)}function z(){return"Half-inning ended by out on the base paths"}function ne(){return"Half-inning ended by scorekeeper"}function ue(){return"Current inning overridden by scorekeeper"}function ee(j,te){var Z=s.firstWithRole(te.participants,"runner"),M=(0,y.stubbify)(Z==null?void 0:Z.playerId),H=b(Z==null?void 0:Z.base),Q="",oe=!0;switch(j.attributes.playType){case"offensive_interference":Q="".concat(M," out due to offensive interference"),oe=!1;break;case"attempted_pickoff":Q="Pickoff attempt at ".concat(H);break;case"fielders_choice_attempted_pickoff":Q="".concat(M," safe at ").concat(H," on fielder's choice");break;case"out_on_appeal":Q="".concat(M," out on appeal at ").concat(H),oe=!1;break;case"caught_stealing":Q="".concat(M," caught stealing ").concat(H);break;case"other_out":switch(j.attributes.playFlavor){case"left_base_early":Q="".concat(M," out at ").concat(H," due to leaving base early"),oe=!1;break;default:Q="".concat(M," out at ").concat(H);break}break;case"picked_off":Q="".concat(M," picked off at ").concat(H);break}if(Z!=null&&Z.scored)switch(j.attributes.playType){case"stole_base":Q="".concat(M," scores on steal of home");break;case"defensive_indifference":Q="".concat(M," scores on defensive indifference");break;case"passed_ball":Q="".concat(M," scores on passed ball");break;case"wild_pitch":Q="".concat(M," scores on wild pitch");break;case"on_same_pitch":Q="".concat(M," scores on the same pitch");break;case"advanced_on_error":Q="".concat(M," scores on error");break;case"on_same_error":Q="".concat(M," scores on the same error");break;case"other_advance":Q="".concat(M," scores");break}else switch(j.attributes.playType){case"stole_base":Q="".concat(M," steals ").concat(H);break;case"defensive_indifference":Q="".concat(M," advances to ").concat(H," on defensive indifference");break;case"passed_ball":Q="".concat(M," advances to ").concat(H," on passed ball");break;case"wild_pitch":Q="".concat(M," advances to ").concat(H," on wild pitch");break;case"on_same_pitch":Q="".concat(M," advances to ").concat(H," on the same pitch");break;case"advanced_on_error":Q="".concat(M," advances to ").concat(H," on error");break;case"on_same_error":Q="".concat(M," advances to ").concat(H," on the same error");break;case"other_advance":Q="".concat(M," advances to ").concat(H);break}if(j.attributes.playType==="advanced_on_error"){var pe=w(te.participants);return"".concat(Q).concat(pe)}var ce=L(te.participants);return ce.totalDefenders===0||!oe?Q:"".concat(Q,", ").concat(ce.template)}n.templateForChildBaseRunning=ee;function $(j,te){var Z=["","",""],M=Z[0],H=Z[1],Q=Z[2];(j.attributes.balls!==void 0||j.attributes.strikes!==void 0)&&(M="Count changed to ".concat(te.situation.balls,"-").concat(te.situation.strikes)),j.attributes.outs!==void 0&&(H="Outs changed to ".concat(j.attributes.outs)),j.attributes.scores!==void 0&&(Q="Score changed to ".concat(te.situation.awayScore,"-").concat(te.situation.homeScore));for(var oe="",pe=0,ce=[M,H,Q];pe<ce.length;pe++){var Ie=ce[pe];Ie!==""&&(oe!==""&&(oe+=". "),oe+="".concat(Ie))}return oe}function Y(j,te){var Z=j!==void 0?" to ".concat(j):"";return d.isHomeRunEvent(te)&&(Z=" ".concat(D(te))),Z}function W(j){if(d.isPitchEvent(j))switch(j.attributes.result){case"ball":return"";case"intentional_ball":return" on intentional ball";case"strike_swinging":return" swinging";case"strike_looking":return" looking";case"foul":return" foul";case"illegal_pitch":return" on illegal pitch";case"foul_tip":return" on foul tip";case"foul_bunt":return" on foul bunt"}return""}function J(j,te,Z){var M="${playerId}",H=Y(te,Z),Q=W(Z);switch(j){case"single":return"".concat(M," singles").concat(H);case"double":return"".concat(M," doubles").concat(H);case"triple":return"".concat(M," triples").concat(H);case"home_run":return"".concat(M," homers").concat(H);case"dropped_third_strike":return"".concat(M," reaches on a dropped third strike");case"dropped_third_strike_batter_out":return"".concat(M," out after a dropped third strike");case"fielders_choice":return"".concat(M," hits into a fielder's choice");case"error":return"".concat(M," reaches on an error");case"sacrifice_bunt_error":case"sacrifice_bunt":return"".concat(M," sacrifice bunts").concat(H);case"sacrifice_fly_error":case"sacrifice_fly":return"".concat(M," hits a sacrifice fly").concat(H);case"batter_out":case"batter_out_advance_runners":var oe=Z;switch(oe.attributes.playType){case"ground_ball":return"".concat(M," grounds out").concat(H);case"hard_ground_ball":return"".concat(M," grounds out hard").concat(H);case"fly_ball":return"".concat(M," flies out").concat(H);case"pop_fly":return"".concat(M," pops out").concat(H);case"line_drive":return"".concat(M," lines out").concat(H);case"bunt":return"".concat(M," out on a bunt");case"foul_tip":return"".concat(M," out on a foul tip")}return"".concat(M," out on ball in play");case"offensive_interference":return"".concat(M," out on offensive interference");case"infield_fly":return"".concat(M," out on an infield fly");case"other_out":return"".concat(M," out");case"foul_tip_out":return"".concat(M," out on a foul tip");case"strikeout":return"".concat(M," strikes out").concat(Q);case"walk":return"".concat(M," walks").concat(Q);case"hit_by_pitch":return"".concat(M," hit by pitch");case"catcher_interference":return"".concat(M," reaches on catcher's interference");case"double_play":return"".concat(M," hits into a double play");case"triple_play":return"".concat(M," hits into a triple play");case"fielders_choice_double_play":return"".concat(M," hits into a fielder's choice double play");case"place_batter":case"baserunning_ended_inning":case"next_half":case"inning_override":default:return""}}function ae(j,te,Z){var M="${playerId}",H=Y(te,Z),Q=W(Z);switch(j){case"single":return"".concat(M," gives up a single").concat(H);case"double":return"".concat(M," gives up a double").concat(H);case"triple":return"".concat(M," gives up a triple").concat(H);case"home_run":return"".concat(M," gives up a home run").concat(H);case"dropped_third_strike":return"The batter facing ".concat(M," reaches on a dropped third strike");case"dropped_third_strike_batter_out":return"The batter facing ".concat(M," is out after a dropped third strike");case"fielders_choice":return"The batter facing ".concat(M," hit into a fielder's choice");case"error":return"The batter facing ".concat(M," reaches on an error");case"sacrifice_bunt_error":case"sacrifice_bunt":return"".concat(M," gives up a sacrifice bunt").concat(H);case"sacrifice_fly_error":case"sacrifice_fly":return"".concat(M," gives up a sacrifice fly").concat(H);case"batter_out":case"batter_out_advance_runners":var oe=Z;switch(oe.attributes.playType){case"ground_ball":return"".concat(M," gets the batter to ground out").concat(H);case"hard_ground_ball":return"".concat(M," gets the batter to ground out hard").concat(H);case"fly_ball":return"".concat(M," gets the batter to fly out").concat(H);case"pop_fly":return"".concat(M," gets the batter to pop out").concat(H);case"line_drive":return"".concat(M," gets the batter to line out").concat(H);case"bunt":return"".concat(M," gets the batter to bunt out").concat(H);case"foul_tip":return"".concat(M," gets the batter out on a foul tip")}return"The batter facing ".concat(M," is out on a ball in play");case"offensive_interference":return"The batter facing ".concat(M," is out on offensive interference");case"infield_fly":return"".concat(M," gets the batter out on an infield fly");case"other_out":return"".concat(M," gets the batter out");case"foul_tip_out":return"".concat(M," gets the batter out on a foul tip");case"strikeout":return"".concat(M," strikes the batter out").concat(Q);case"walk":return"".concat(M," walks the batter").concat(Q," ");case"hit_by_pitch":return"".concat(M," hits the batter with a pitch");case"catcher_interference":return"The batter facing ".concat(M," reaches on catcher's interference");case"double_play":return"The batter facing ".concat(M," hits into a double play");case"triple_play":return"The batter facing ".concat(M," hits into a triple play");case"fielders_choice_double_play":return"The batter facing ".concat(M," hits into a fielder's choice double play");case"place_batter":case"baserunning_ended_inning":case"next_half":case"inning_override":default:return""}}function se(j,te,Z){var M="${playerId}",H=Y(te,Z);switch(j){case"single":return"".concat(M," fields a single").concat(H);case"double":return"".concat(M," fields a double").concat(H);case"triple":return"".concat(M," fields a triple").concat(H);case"home_run":return"".concat(M," fields an inside-the-park home run");case"dropped_third_strike":return"".concat(M," fields a dropped third strike");case"dropped_third_strike_batter_out":return"".concat(M," fields a dropped third strike, batter is out");case"fielders_choice":return"".concat(M," fields a fielder's choice");case"error":return"Batter reaches on error, ".concat(M," fielding");case"sacrifice_bunt_error":case"sacrifice_bunt":return"".concat(M," fields a sacrifice bunt").concat(H);case"sacrifice_fly_error":case"sacrifice_fly":return"".concat(M," fields a sacrifice fly").concat(H);case"batter_out":case"batter_out_advance_runners":var Q=Z;switch(Q.attributes.playType){case"ground_ball":return"".concat(M," fields a ground ball").concat(H,", batter out");case"hard_ground_ball":return"".concat(M," fields a hard ground ball").concat(H,", batter out");case"fly_ball":return"".concat(M," fields a fly ball").concat(H,", batter out");case"pop_fly":return"".concat(M," fields a pop fly").concat(H,", batter out");case"line_drive":return"".concat(M," fields a line drive").concat(H,", batter out");case"bunt":return"".concat(M," fields a bunt").concat(H,", batter out");case"foul_tip":return"Batter is out on foul tip, ".concat(M," fielding")}return"Batter is out, ".concat(M," fielding");case"offensive_interference":return"Batter is out on offensive interference, ".concat(M," fielding");case"infield_fly":return"".concat(M," fields an infield fly").concat(H,", batter out");case"other_out":return"Batter out, ".concat(M," fielding");case"foul_tip_out":return"Batter is out on foul tip, ".concat(M," fielding");case"catcher_interference":return"Batter reaches on catcher's interference by ".concat(M);case"double_play":return"".concat(M," turns a double play");case"triple_play":return"".concat(M," turns a triple play");case"fielders_choice_double_play":return"".concat(M," turns a fielder's choice double play");case"strikeout":case"walk":case"hit_by_pitch":case"place_batter":case"baserunning_ended_inning":case"next_half":case"inning_override":default:return""}}function ie(j,te,Z){var M="${playerId}",H=Y(te,Z);switch(j){case"single":return"".concat(M," commits an error fielding a single").concat(H);case"double":return"".concat(M," commits an error fielding a double").concat(H);case"triple":return"".concat(M," commits an error fielding a triple").concat(H);case"home_run":return"".concat(M," commits an error fielding an inside-the-park home run");case"dropped_third_strike":return"".concat(M," commits an error on a dropped third strike");case"dropped_third_strike_batter_out":return"".concat(M," commits an error on a dropped third strike, batter out");case"fielders_choice":return"".concat(M," commits an error on a fielder's choice").concat(H);case"error":return"".concat(M," commits an error on a ball in play").concat(H);case"sacrifice_bunt_error":case"sacrifice_bunt":return"".concat(M," commits an error on a sacrifice bunt");case"sacrifice_fly_error":case"sacrifice_fly":return"".concat(M," commits an error on a sacrifice fly");case"batter_out":case"batter_out_advance_runners":var Q=Z;switch(Q.attributes.playType){case"ground_ball":return"".concat(M," commits an error on a ground ball").concat(H,", batter out");case"hard_ground_ball":return"".concat(M," commits an error on a hard ground ball").concat(H,", batter out");case"fly_ball":return"".concat(M," commits an error on a fly ball").concat(H,", batter out");case"pop_fly":return"".concat(M," commits an error on a pop fly").concat(H,", batter out");case"line_drive":return"".concat(M," commits an error on a line drive").concat(H,", batter out");case"bunt":return"".concat(M," commits an error on a bunt").concat(H,", batter out");case"foul_tip":return"".concat(M," commits an error on a foul tip, batter out")}return"".concat(M," commits an error, batter is out");case"offensive_interference":return"".concat(M," commits an error, batter is out on offensive interference");case"infield_fly":return"".concat(M," commits an error on an infield fly");case"other_out":return"Batter is out, ".concat(M," errors on the play");case"foul_tip_out":return"".concat(M," commits an error on a foul tip, batter out");case"catcher_interference":return"".concat(M," commits an error, catcher's interference");case"double_play":return"".concat(M," commits an error during a double play");case"triple_play":return"".concat(M," commits an error during a triple play");case"fielders_choice_double_play":return"".concat(M," commits an error during a fielder's choice double play");case"strikeout":case"walk":case"hit_by_pitch":case"place_batter":case"baserunning_ended_inning":case"next_half":case"inning_override":default:return""}}function ye(j,te,Z,M){var H="${playerId}",Q=Y(te,Z),oe=b(M.base),pe=M.out?"out":"safe",ce="".concat(pe," at ").concat(oe);switch(M.scored?ce="scores":M.base===4&&!M.out&&!M.scored&&(ce="does not score"),j){case"single":return"Batter singles".concat(Q,", ").concat(H," ").concat(ce);case"double":return"Batter doubles".concat(Q,", ").concat(H," ").concat(ce);case"triple":return"Batter triples".concat(Q,", ").concat(H," ").concat(ce);case"home_run":return"Batter homers".concat(Q,", ").concat(H," ").concat(ce);case"dropped_third_strike":case"dropped_third_strike_batter_out":return"".concat(H," ").concat(ce," on a dropped third strike");case"fielders_choice":return"Fielder's choice, ".concat(H," ").concat(ce);case"error":return"Error, ".concat(H," ").concat(ce);case"sacrifice_bunt_error":case"sacrifice_bunt":return"".concat(H," ").concat(ce," on a sacrifice bunt");case"sacrifice_fly_error":case"sacrifice_fly":return"".concat(H," ").concat(ce," on a sacrifice fly");case"batter_out":case"batter_out_advance_runners":var Ie=Z;switch(Ie.attributes.playType){case"ground_ball":return"Batter grounds out".concat(Q,", ").concat(H," ").concat(ce);case"hard_ground_ball":return"Batter grounds out hard".concat(Q,", ").concat(H," ").concat(ce);case"fly_ball":return"Batter flies out".concat(Q,", ").concat(H," ").concat(ce);case"pop_fly":return"Batter pops out".concat(Q,", ").concat(H," ").concat(ce);case"line_drive":return"Batter lines out".concat(Q,", ").concat(H," ").concat(ce);case"bunt":return"Batter out on bunt".concat(Q,", ").concat(H," ").concat(ce);case"foul_tip":return"Batter out on foul tip, ".concat(H," ").concat(ce)}return"Batter out on ball in play, ".concat(H," ").concat(ce);case"offensive_interference":return"Batter out on offensive interference, ".concat(H," ").concat(ce);case"infield_fly":return"Infield fly, ".concat(H," ").concat(ce);case"other_out":return"Batter out, ".concat(H," ").concat(ce);case"foul_tip_out":return"Batter out on foul tip, ".concat(H," ").concat(ce);case"catcher_interference":return"Batter reaches on catcher's interference, ".concat(H," ").concat(ce);case"double_play":return"Double play, ".concat(H," ").concat(ce);case"triple_play":return"Triple play, ".concat(H," ").concat(ce);case"fielders_choice_double_play":return"Fielder's choice double play, ".concat(H," ").concat(ce);case"walk":return M.baseChanged?"Batter walked, ".concat(H," advances to ").concat(oe):"Batter walked, ".concat(H," remains at ").concat(oe);case"hit_by_pitch":return M.baseChanged?"Batter hit by pitch, ".concat(H," advances to ").concat(oe):"Batter hit by pitch, ".concat(H," remains at ").concat(oe);case"strikeout":case"place_batter":case"baserunning_ended_inning":case"next_half":case"inning_override":default:return""}}}(vo)),vo}var Dr={},xd;function lv(){if(xd)return Dr;xd=1,Object.defineProperty(Dr,"__esModule",{value:!0}),Dr.tabularizeFullPlayByPlay=Dr.exportTabularPlayByPlay=void 0;var n=X,l=n.__importStar(fe()),t=wd(),p=Fd(),d=n.__importStar(tr());function y(h){return h?"".concat(h.x.toFixed(2),",").concat(h.y.toFixed(2)):void 0}function s(h,v,o){var a=(0,t.lookupMapForEvents)(o);return u(h,v,a)}Dr.exportTabularPlayByPlay=s;function u(h,v,o){for(var a,r,e,i,c=[],f=[],_=[],S=[],P=[],I=[],E=[],B=[],b=0,R=0,F=0,x=h;F<x.length;F++){var w=x[F];b+=1,_.push({atBatIndex:b,initialInning:w.initialSituation.inning,initialHalf:w.initialSituation.half,initialOuts:w.initialSituation.outs,initial1stBase:w.initialSituation.bases[1],initial2ndBase:w.initialSituation.bases[2],initial3rdBase:w.initialSituation.bases[3],initialHomeScore:w.initialSituation.homeScore,initialAwayScore:w.initialSituation.awayScore,resultingInning:w.result.situation.inning,resultingHalf:w.result.situation.half,resultingOuts:w.result.situation.outs,resulting1stBase:w.result.situation.bases[1],resulting2ndBase:w.result.situation.bases[2],resulting3rdBase:w.result.situation.bases[3],resultingHomeScore:w.result.situation.homeScore,resultingAwayScore:w.result.situation.awayScore});for(var L=0,D=void 0,U=0,G=w.pitches;U<G.length;U++){var q=G[U];L+=1,f.push({atBatIndex:b,pitchIndex:L,pitchResult:q.result,pitchSpeed:q.speed,pitchType:q.style,occurredAt:q.createdAt?new Date(q.createdAt).toISOString():void 0,initialBalls:D!==void 0?D.resultingBalls:0,initialStrikes:D!==void 0?D.resultingStrikes:0,initial1stBase:w.initialSituation.bases[1],initial2ndBase:w.initialSituation.bases[2],initial3rdBase:w.initialSituation.bases[3],initialOuts:w.initialSituation.outs,initialHomeScore:w.initialSituation.homeScore,initialAwayScore:w.initialSituation.awayScore,resultingBalls:q.resultingBalls,resultingStrikes:q.resultingStrikes}),D=q}for(var z=l.fromJS(w.initialSituation.bases),ne=[0,0,0],ue=ne[0],ee=ne[1],$=ne[2],Y=0,W=w.childEvents;Y<W.length;Y++){var J=W[Y];if(L=J.beforePitchIndex+1,$!==L&&(ue=0,ee=0,$=L),["base_running","balk","foul_error"].includes(J.code)){J.code==="base_running"&&(ee+=1,R+=1);for(var ae=0,se=J.participants;ae<se.length;ae++){var ie=se[ae];if(ie.role==="runner")ue+=1,R+=1,S.push({atBatIndex:b,pitchIndex:L,advancementIndex:ue,runnerId:ie.playerId,playType:J.headline,out:ie.out,scored:ie.scored,startBase:(a=z.keyOf(ie.playerId))!==null&&a!==void 0?a:0,endBase:ie.base,sequence:R}),z=l.fromJS(J.situation.bases),f[J.beforePitchIndex]!==void 0&&(f[J.beforePitchIndex].initialAwayScore=J.situation.awayScore,f[J.beforePitchIndex].initialHomeScore=J.situation.homeScore,f[J.beforePitchIndex].initialOuts=J.situation.outs,f[J.beforePitchIndex].initial1stBase=z[1],f[J.beforePitchIndex].initial2ndBase=z[2],f[J.beforePitchIndex].initial3rdBase=z[3]);else if(ie.role==="fielder")for(var ye=0,j=ie.fieldingOrder;ye<j.length;ye++){var te=j[ye];R+=1,P.push({atBatIndex:b,pitchIndex:L,fieldingIndex:ee,fieldingOrder:te,fielderId:ie.playerId,position:ie.position,committedError:ie.committedError,sequence:R})}}}if(J.code==="fill_position"){var Z=o[J.eventId];I.push({atBatIndex:b,pitchIndex:L,playerId:Z.attributes.playerId,teamId:Z.attributes.teamId,position:Z.attributes.position,code:J.code})}if(J.code==="clear_position_by_id"){var M=o[J.eventId];I.push({atBatIndex:b,pitchIndex:L,playerId:M.attributes.playerId,teamId:M.attributes.teamId,code:J.code})}if(J.code==="clear_all_positions"){var H=o[J.eventId];I.push({atBatIndex:b,pitchIndex:L,teamId:H.attributes.teamId,code:J.code})}if(J.code==="replace_runner"){var Q=o[J.eventId];I.push({atBatIndex:b,pitchIndex:L,playerId:Q.attributes.incomingPlayerId,teamId:Q.attributes.teamId,code:"replace_runner_in"}),I.push({atBatIndex:b,pitchIndex:L,playerId:Q.attributes.outgoingPlayerId,teamId:Q.attributes.teamId,code:"replace_runner_out"})}if(J.code==="sub_players"){var oe=o[J.eventId],pe=d.firstParticipantWithIdToJS(J.participants,oe.attributes.outgoingPlayerId);pe!==void 0&&pe.position!==void 0&&(I.push({atBatIndex:b,pitchIndex:L,playerId:oe.attributes.incomingPlayerId,teamId:oe.attributes.teamId,position:pe.position,code:"sub_player_in"}),I.push({atBatIndex:b,pitchIndex:L,playerId:pe.playerId,teamId:oe.attributes.teamId,position:pe.position,code:"sub_player_out"})),pe!==void 0&&pe.slot!==void 0&&(E.push({atBatIndex:b,pitchIndex:L,playerId:oe.attributes.incomingPlayerId,teamId:oe.attributes.teamId,lineupPosition:pe.slot,code:"sub_player_in"}),E.push({atBatIndex:b,pitchIndex:L,playerId:oe.attributes.outgoingPlayerId,teamId:oe.attributes.teamId,lineupPositionFrom:pe.slot,code:"sub_player_out"}))}if(J.code==="fill_lineup_index"){var ce=o[J.eventId];E.push({atBatIndex:b,pitchIndex:L,playerId:ce.attributes.playerId,teamId:ce.attributes.teamId,lineupPosition:ce.attributes.index,code:J.code})}if(J.code==="fill_lineup"){var Ie=o[J.eventId];E.push({atBatIndex:b,pitchIndex:L,playerId:Ie.attributes.playerId,teamId:Ie.attributes.teamId,code:J.code})}if(J.code==="reorder_lineup"){var Te=o[J.eventId];E.push({atBatIndex:b,pitchIndex:L,teamId:Te.attributes.teamId,lineupPosition:Te.attributes.toIndex,lineupPositionFrom:Te.attributes.fromIndex,code:J.code})}if(J.code==="clear_lineup_index"){var me=o[J.eventId];E.push({atBatIndex:b,pitchIndex:L,teamId:me.attributes.teamId,code:J.code,lineupPosition:me.attributes.index})}if(J.code==="clear_entire_lineup"){var qe=o[J.eventId];E.push({atBatIndex:b,pitchIndex:L,teamId:qe.attributes.teamId,code:J.code})}}for(var st="",Ue=NaN,Qe="",ht=0,It=w.participants;ht<It.length;ht++){var ie=It[ht];if(ie.role==="fielder")for(var wt=0,Ct=ie.fieldingOrder;wt<Ct.length;wt++){var te=Ct[wt];R+=1,P.push({atBatIndex:b,pitchIndex:L,fieldingIndex:1,fieldingOrder:te,fielderId:ie.playerId,position:ie.position,committedError:ie.committedError,sequence:R})}else ie.role==="batter"?(st=ie.playerId,Ue=ie.slot):ie.role==="pitcher"?Qe=ie.playerId:ie.role==="runner"&&ie.scored&&(ue+=1,R+=1,S.push({atBatIndex:b,pitchIndex:L,advancementIndex:ue,runnerId:ie.playerId,playType:"base_running",out:ie.out,scored:ie.scored,startBase:(r=z.keyOf(ie.playerId))!==null&&r!==void 0?r:0,endBase:ie.base,sequence:R}))}var Vt=o[w.result.eventId],Mt=(0,p.findLocationData)(Vt);c.push({atBatIndex:b,batterId:st,battingOrder:Ue,pitcherId:Qe,resultingPlay:w.result.playType,occurredAt:w.result.createdAt?new Date(w.result.createdAt).toISOString():void 0,xy:y(Mt.fieldedLocation),ballInPlayType:Mt.ballInPlayType,hrLocation:Mt.hrLocation});for(var mt=0,xt=w.baseRunningOnPlayEvents;mt<xt.length;mt++)for(var bt=xt[mt],Lt=0,Re=bt.participants;Lt<Re.length;Lt++){var ie=Re[Lt];ie.role==="runner"&&(ue+=1,R+=1,S.push({atBatIndex:b,pitchIndex:L,advancementIndex:ue,runnerId:ie.playerId,playType:bt.playType,out:ie.out,scored:ie.scored,startBase:(e=z.keyOf(ie.playerId))!==null&&e!==void 0?e:0,endBase:ie.base,sequence:R}),z=l.fromJS(bt.situation.bases))}}var zt=l.fromJS(v.initialSituation.bases),Le=0;b+=1,R=0;for(var Ut=0,He=v.childEvents;Ut<He.length;Ut++){var J=He[Ut];if(J.code==="pitcher_decision"){var De=o[J.eventId];B.push({teamId:De.attributes.teamId,pitcherId:De.attributes.pitcherId,decision:De.attributes.decision})}if(["base_running","balk","foul_error"].includes(J.code))for(var ur=0,yt=J.participants;ur<yt.length;ur++){var ie=yt[ur];ie.role==="runner"&&(Le+=1,R+=1,S.push({atBatIndex:b,pitchIndex:0,advancementIndex:Le,runnerId:ie.playerId,playType:J.headline,out:ie.out,scored:ie.scored,startBase:(i=zt.keyOf(ie.playerId))!==null&&i!==void 0?i:0,endBase:ie.base,sequence:R}),zt=l.fromJS(J.situation.bases))}}return{plays:c,pitches:f,playsOverview:_,baseAdvance:S,fielding:P,positions:I,lineups:E,pitcherDecisions:B}}return Dr.tabularizeFullPlayByPlay=u,Dr}var Ld;function cv(){if(Ld)return xr;Ld=1,Object.defineProperty(xr,"__esModule",{value:!0}),xr.PlayByPlayEngine=xr.PlayByPlayState=void 0;var n=X,l=n.__importStar(Pe),t=n.__importStar(fe()),p=n.__importStar(Ee()),d=n.__importStar(Oe()),y=n.__importStar(Rt()),s=tt(),u=ov(),h=wd(),v=n.__importStar(tr()),o=n.__importStar(uv()),a=lv(),r=function(i){n.__extends(c,i);function c(){return i!==null&&i.apply(this,arguments)||this}return Object.defineProperty(c.prototype,"currentAtBat",{get:function(){var f=this.currentAtBatImmutable,_=f.toJS();return _.index=void 0,_.orderedEventIds=f.orderedEventIds,_},enumerable:!1,configurable:!0}),c.prototype.renderForScorebook=function(f,_,S){var P=_.stateAfterEvent(this.nextEventOffset).homeId,I=_.stateAfterEvent(this.nextEventOffset).awayId,E=_.stateAfterEvent(this.nextEventOffset).atBatTeamId,B=S.stateAfterEvent(this.nextEventOffset).lineupIndex(E);return(0,h.renderForScorebook)(P,I,B,f,this.allAtBatsImmutable)},c.prototype.exportTabularPlayByPlay=function(f){return(0,a.exportTabularPlayByPlay)(this.completedAtBats,this.currentAtBat,f)},Object.defineProperty(c.prototype,"lastCompletedAtBat",{get:function(){return this.completedAtBatAtIndex(this.get("completedAtBats").size-1)},enumerable:!1,configurable:!0}),c.prototype.recentCompletedAtBats=function(f){var _=this.get("completedAtBats");return _.slice(-f).map(function(S,P){var I=S.toJS();return I.index=_.size-(f-P),I.orderedEventIds=S.orderedEventIds,I}).toJS()},c.prototype.completedAtBatContainingEvent=function(f){var _=this.getIn(["idToAtBatIndexMap",f]);return this.completedAtBatAtIndex(_)},c.prototype.atBatContainingEvent=function(f){var _=this.completedAtBatContainingEvent(f);if(_)return _;for(var S=0,P=this.currentAtBat.orderedEventIds;S<P.length;S++){var I=P[S];if(f===I)return this.currentAtBat}},c.prototype.completedAtBatAtIndex=function(f){var _=this.getIn(["completedAtBats",f]);if(_!==void 0){var S=_.toJS();return S.index=f,S.orderedEventIds=_.orderedEventIds,S}},c.prototype.completedAtBatsForBatter=function(f){var _=this,S=this.getIn(["batterIdToAtBatIndicesMap",f])||t.List();return S.map(function(P){return _.getIn(["completedAtBats",P])}).toJS()},Object.defineProperty(c.prototype,"completedAtBats",{get:function(){return this.get("completedAtBats").toJS()},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"completedAnnotatedAtBats",{get:function(){for(var f=this.get("completedAtBats").size,_=[],S=0;S<f;S++)_.push(this.completedAtBatAtIndex(S));return _},enumerable:!1,configurable:!0}),c.prototype.possiblyMutatedAtBats=function(f){var _=this.earliestPossiblyMutatedAtBatIndex(f);_===void 0&&(_=0);for(var S={completedAtBats:[],startingIndex:_,currentAtBat:this.currentAtBat},P=this.completedAtBatsSize,I=_;I<P;I++){var E=this.completedAtBatAtIndex(I);E!==void 0&&S.completedAtBats.push(E)}return S},c.prototype.earliestPossiblyMutatedAtBatIndex=function(f){var _=this.idToAtBatIndexMap[f];return _===void 0?l.contains(this.currentAtBatImmutable.orderedEventIds,f)?Math.max(this.completedAtBatsSize-1,0):void 0:Math.max(_-1,0)},Object.defineProperty(c.prototype,"completedAtBatsSize",{get:function(){return this.get("completedAtBats").size},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"currentAtBatImmutable",{get:function(){return this.get("currentAtBat")},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"lastCompletedAtBatImmutable",{get:function(){var f=this.get("completedAtBats");if(f.size!==0)return f.last()},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"completedAtBatsImmutable",{get:function(){return this.get("completedAtBats")},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"allAtBatsImmutable",{get:function(){return this.completedAtBatsImmutable.concat(t.List.of(this.currentAtBatImmutable)).toList()},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"idToAtBatIndexMap",{get:function(){return this.get("idToAtBatIndexMap").toJS()},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"batterIdToAtBatIndicesMap",{get:function(){return this.get("batterIdToAtBatIndicesMap").toJS()},enumerable:!1,configurable:!0}),c.prototype.pushPitch=function(f,_){var S=this.set("lastPitchResult",f.attributes.result);return S.updateIn(["currentAtBat","pitches"],function(P){var I={result:f.attributes.result,eventId:f.id,writeInDescription:f.description,resultingBalls:_.resultingBalls,resultingStrikes:_.resultingStrikes,resultingOuts:_.resultingOuts,speed:f.attributes.speed,style:f.attributes.style,template:void 0,createdAt:f.createdAt};return I.template=o.templateForPitch(f,I),P.push(I)})},c.prototype.setResult=function(f,_,S,P){return f.set("result",new v.PlayResultRecord({playType:S,lastPitchResult:this.get("lastPitchResult"),eventId:_.id,writeInDescription:_.description,createdAt:_.createdAt,situation:P}))},c.prototype.setResultForCurrentAtBat=function(f,_,S){var P=this;return this.update("currentAtBat",function(I){return P.setResult(I,f,_,S)})},c.prototype.updateLastCompletedAtBat=function(f){var _=this.get("completedAtBats").size-1;return this.updateIn(["completedAtBats",_],f)},c.prototype.updatePerspectivesForTopLevelParticipants=function(f,_){var S=o.perspectivesForAtBat(f,_);return _.update("participants",function(P){return P.map(function(I){var E,B=I;if(B.playerId===void 0)return B;var b;return B.role==="runner"?b=(E=S.runners)===null||E===void 0?void 0:E[B.playerId]:b=B.committedError?S.error:S[B.role],b===void 0?B:B.set("perspective",o.replacePlayerIdInPerspective(b,B.playerId))}).toList()})},c.prototype.reconcileAtBatPlayTypeWithExtraBaseRunning=function(f){return f.update("result",function(_){var S=_.playType,P=v.firstWithRole(f.participants,"batter"),I=P==null?void 0:P.out,E=I?1:0;return f.baseRunningOnPlayEvents.forEach(function(B){B.participants.forEach(function(b){b.out&&(b.playerId===(P==null?void 0:P.playerId)?(I||E++,I=!0):E++)})}),E===2?S=I?"double_play":"fielders_choice_double_play":E===3&&(S="triple_play"),_.set("playType",S)})},c.prototype.updateAtBatRunnerParticipantStateFromExtraBaseRunning=function(f,_){var S=f.get("participants").findKey(function(I){return I.playerId===_.attributes.runnerId});if(S===void 0)return f;var P=y.baseRunningPlayTypeConfigs[_.attributes.playType];return f.updateIn(["participants",S],function(I){return I.merge({base:_.attributes.base,out:P.runnerOut,scored:_.attributes.base===4&&!P.runnerOut&&_.attributes.playType!=="did_not_score",baseChanged:I.baseChanged||P.runnerOut||_.attributes.base!==I.base})})},c.prototype.reconcileLastAtBatWithExtraBaseRunning=function(f,_,S){var P=this,I=this.updateLastCompletedAtBat(function(E){E=P.reconcileAtBatPlayTypeWithExtraBaseRunning(E).setIn(["result","situation"],S),E=P.updateAtBatRunnerParticipantStateFromExtraBaseRunning(E,_),E=E.set("template",o.templateForAtBat(f,E)),E=E.set("headline",o.headlineForAtBat(f,E));var B=l.partial(P.updatePerspectivesForTopLevelParticipants,f);return E.update(B)});return I.setIn(["currentAtBat","initialSituation"],S)},c.prototype.cycleAtBat=function(f){var _=this.get("currentAtBat"),S=this.get("completedAtBats").size,P=l.pluck(_.pitches.toArray(),"eventId").concat(l.pluck(_.childEvents.toArray(),"eventId"),[_.result.eventId]),I=this.update("idToAtBatIndexMap",function(B){return B.withMutations(function(b){for(var R=0,F=P;R<F.length;R++){var x=F[R];b.set(x,S)}})}),E=v.firstWithRole(_.participants,"batter");return E!==void 0&&(I=I.updateIn(["batterIdToAtBatIndicesMap",E.playerId],t.List(),function(B){return B.push(S)})),I.update("completedAtBats",function(B){return B.push(_)}).set("currentAtBat",new v.AtBatRecord({initialSituation:f}))},c.prototype.pushChildEvent=function(f,_,S,P){var I=this;P===void 0&&(P=t.List());var E;return f.code==="base_running"&&(E=f.attributes.playType),this.updateIn(["currentAtBat","childEvents"],function(B){var b=new v.ChildEventRecord({beforePitchIndex:I.getIn(["currentAtBat","pitches"]).size,eventId:f.id,writeInDescription:f.description,code:f.code,createdAt:f.createdAt,situation:_,participants:P,baseRunningPlayType:E});return l.isEmpty(S)||(b=b.set("metadata",t.fromJS(S))),b=b.set("template",o.templateForChildEvent(f,b)).set("headline",o.headlineForChildEvent(f)),B.push(b)})},c.prototype.setSignificantEventId=function(f){return this.getIn(["currentAtBat","firstSignificantEventId"])===void 0?this.setIn(["currentAtBat","firstSignificantEventId"],f):this},c.prototype.pushSimpleChildEvent=function(f,_,S,P,I,E){for(var B=[],b=6;b<arguments.length;b++)B[b-6]=arguments[b];if(B.length!==0){var R=t.List().withMutations(function(F){for(var x=0,w=B;x<w.length;x++){var L=w[x];F.push(new v.ParticipantRecord({playerId:L,position:S.positionForPlayer(L),slot:E!==void 0?P.indexOfPlayer(E,L):void 0}))}});return this.pushChildEvent(f,_,I,R)}return this.pushChildEvent(f,_,I)},c.prototype.pushBaseRunningOnPlayEvent=function(f,_,S){S===void 0&&(S=t.List());var P=this.get("completedAtBats").size-1,I=this.setIn(["idToAtBatIndexMap",f.id],P);return I.updateIn(["completedAtBats",P,"baseRunningOnPlayEvents"],function(E){var B=new v.BaseRunningOnPlayRecord({eventId:f.id,writeInDescription:f.description,playType:f.attributes.playType,createdAt:f.createdAt,situation:_,participants:S});return B=B.set("headline",o.headlineForChildEvent(f)),E.push(B.set("template",o.templateForBaseRunningOnPlayEvent(f,B)))})},c}(d.ImmutableState);xr.PlayByPlayState=r;var e=function(i){n.__extends(c,i);function c(f,_,S,P,I,E){var B=i.call(this,f)||this;return B.baseEvents=f,B.context=_,B.situation=S,B.lineup=P,B.fielders=I,B.baserunners=E,B.metadataTracker=new u.MetadataTracker(S,P,I,E,B.context.playByPlayMetadataKeys||[]),B}return c.prototype.initialState=function(){return new r(t.fromJS({completedAtBats:[],currentAtBat:new v.AtBatRecord,idToAtBatIndexMap:{},batterIdToAtBatIndicesMap:{},lastPitchResult:void 0}))},Object.defineProperty(c.prototype,"lastSituationState",{get:function(){return this.situation.stateBeforeEvent(this.nextEventOffset)},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"nextSituationState",{get:function(){return this.situation.stateAfterEvent(this.nextEventOffset)},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"lastLineupState",{get:function(){return this.lineup.stateBeforeEvent(this.nextEventOffset)},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"lastFieldersState",{get:function(){return this.fielders.stateBeforeEvent(this.nextEventOffset)},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"lastBaserunnersState",{get:function(){return this.baserunners.stateBeforeEvent(this.nextEventOffset)},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"nextBaserunnersState",{get:function(){return this.baserunners.stateAfterEvent(this.nextEventOffset)},enumerable:!1,configurable:!0}),c.prototype.situationRecordForNextEvent=function(){return new v.PlaySituationRecord({inning:this.nextSituationState.inning,half:this.nextSituationState.half,balls:this.nextSituationState.balls,strikes:this.nextSituationState.strikes,outs:this.nextSituationState.outs,bases:this.nextBaserunnersState.baserunnersImmutable,homeScore:this.nextBaserunnersState.scoreForTeam(this.nextSituationState.homeId),awayScore:this.nextBaserunnersState.scoreForTeam(this.nextSituationState.awayId)})},c.prototype.pushParticipantForPitcher=function(f){var _=this.lastSituationState.inFieldTeamId;return f.push(new v.ParticipantRecord({playerId:this.lastFieldersState.playerForPosition(_,"P"),role:"pitcher"}))},c.prototype.pushParticipantForCatcher=function(f){var _=this.lastSituationState.inFieldTeamId;return f.push(new v.ParticipantRecord({playerId:this.lastFieldersState.playerForPosition(_,"C"),role:"fielder",position:"C"}))},c.prototype.pushParticipantsForNonBatterBaserunners=function(f){for(var _=this,S=this.lastSituationState.atBatTeamId,P=this.lastLineupState.currentBatter(S),I=f,E=this.nextBaserunnersState.runnersScoredOnLastEvent,B=0,b=E;B<b.length;B++){var R=b[B];if(R!==P){var F=this.lastBaserunnersState.baseForPlayer(R);I=I.push(new v.ParticipantRecord({playerId:R,globalAtBatId:this.lastBaserunnersState.globalAtBatIdForPlayer(R),role:"runner",base:4,scored:!0,template:o.shortTemplateForBaserunner(R,F,4)}))}}var x=this.nextBaserunnersState.baserunners;return[3,2,1].forEach(function(w){if(x[w]!==void 0){var L=_.nextBaserunnersState.playerAtBase(Number(w));if(!(L===void 0||L===P)){var D=_.lastBaserunnersState.baseForPlayer(L);I=I.push(new v.ParticipantRecord({playerId:L,globalAtBatId:_.lastBaserunnersState.globalAtBatIdForPlayer(L),role:"runner",base:Number(w),baseChanged:D!==Number(w),template:o.shortTemplateForBaserunner(L,D,Number(w))}))}}}),I},c.prototype.updatesForFieldingParticipants=function(f,_,S){for(var P={},I=-1,E={},B=void 0,b=0,R=0,F=v.allWithRole(f,"fielder");R<F.length;R++){var x=F[R];E[x.position]=!0,x.fieldingOrder.last()>I&&(I=x.fieldingOrder.last(),B=x.position)}for(var w=0,L=S;w<L.length;w++){for(var D=L[w],U=!1,G=[],q=0;q<_.attributes.defenders.length;q++)_.attributes.defenders[q].position===D&&(B===D&&q===0?b++:G.push(q+I+1-b),_.attributes.defenders[q].error&&(U=!0));P[D]={fieldingOrder:G,committedError:U}}return P},c.prototype.updateParticipantsForDefenders=function(f,_){for(var S=f,P=this.lastSituationState.inFieldTeamId,I=l.uniq(l.pluck(_.attributes.defenders,"position")),E=this.updatesForFieldingParticipants(f,_,I),B=function(w){var L,D,U=void 0,G=void 0,q=S.findEntry(function(ne){return ne.position===w});if(q!==void 0&&(L=[q[0],q[1]],U=L[0],G=L[1]),U!==void 0){var z=function(ne){return ne=ne.update("fieldingOrder",function(ue){return ue.push.apply(ue,E[w].fieldingOrder)}),ne.set("committedError",E[w].committedError||ne.committedError)};S=S.set(U,G.update(z))}else S=S.push(new v.ParticipantRecord({playerId:b.lastFieldersState.playerForPosition(P,w),role:"fielder",position:w,committedError:E[w].committedError,fieldingOrder:(D=t.List).of.apply(D,E[w].fieldingOrder)}))},b=this,R=0,F=I;R<F.length;R++){var x=F[R];B(x)}return S},c.prototype.updateParticipantsForSpecificBaseRunningPlays=function(f,_){switch(_.attributes.playType){case"stole_base":case"wild_pitch":case"passed_ball":this.pushParticipantForPitcher(f),this.pushParticipantForCatcher(f);break}},c.prototype.processOneEvent=function(f,_){switch(_.code){case"pitch":f=this.pitch(f,_);break;case"ball_in_play":f=this.ballInPlay(f,_);break;case"end_at_bat":f=this.endAtBat(f,_);break;case"base_running":f=this.baseRunning(f,_);break;case"end_half":f=this.endHalf(f,_);break;case"override":f=this.override(f,_);break;case"clear_lineup_index":f=this.clearLineupIndex(f,_);break;case"goto_lineup_index":f=this.gotoLineupIndex(f,_);break;case"balk":f=this.balk(f,_);break;case"illegal_pitch_advance":f=this.illegalPitchAdvance(f,_);break;case"foul_error":f=this.foulError(f,_);break;case"place_batter":f=this.placeBatter(f,_);break;case"place_runner":f=this.placeRunner(f,_);break;case"pitcher_decision":f=this.pitcherDecision(f,_);break;case"swap_dp_flex":f=this.swapDPFlex(f,_);break;case"clear_all_positions":case"clear_entire_lineup":case"squash_lineup_index":case"message":f=f.pushSimpleChildEvent(_,this.situationRecordForNextEvent(),this.lastFieldersState,this.lastLineupState,this.metadataTracker.metadataForEvent(_,this.nextEventOffset));break;case"fill_position":f=f.pushSimpleChildEvent(_,this.situationRecordForNextEvent(),this.lastFieldersState,this.lastLineupState,this.metadataTracker.metadataForEvent(_,this.nextEventOffset),_.attributes.teamId,_.attributes.playerId);break;case"clear_position_by_id":f=f.pushSimpleChildEvent(_,this.situationRecordForNextEvent(),this.lastFieldersState,this.lastLineupState,this.metadataTracker.metadataForEvent(_,this.nextEventOffset),_.attributes.teamId,_.attributes.playerId);break;case"fill_lineup_index":f=f.pushSimpleChildEvent(_,this.situationRecordForNextEvent(),this.lastFieldersState,this.lastLineupState,this.metadataTracker.metadataForEvent(_,this.nextEventOffset),_.attributes.teamId,_.attributes.playerId);break;case"fill_lineup":f=f.pushSimpleChildEvent(_,this.situationRecordForNextEvent(),this.lastFieldersState,this.lastLineupState,this.metadataTracker.metadataForEvent(_,this.nextEventOffset),_.attributes.teamId,_.attributes.playerId);break;case"reorder_lineup":var S=_,P=this.lastLineupState.getPlayerAtIndex(S.attributes.teamId,S.attributes.fromIndex);P!==void 0?f=f.pushSimpleChildEvent(_,this.situationRecordForNextEvent(),this.lastFieldersState,this.lastLineupState,this.metadataTracker.metadataForEvent(_,this.nextEventOffset),S.attributes.teamId,P):f=f.pushSimpleChildEvent(_,this.situationRecordForNextEvent(),this.lastFieldersState,this.lastLineupState,this.metadataTracker.metadataForEvent(_,this.nextEventOffset));break;case"replace_runner":f=f.pushSimpleChildEvent(_,this.situationRecordForNextEvent(),this.lastFieldersState,this.lastLineupState,this.metadataTracker.metadataForEvent(_,this.nextEventOffset),_.attributes.teamId,_.attributes.incomingPlayerId,_.attributes.outgoingPlayerId);break;case"swap_players":f=f.pushSimpleChildEvent(_,this.situationRecordForNextEvent(),this.lastFieldersState,this.lastLineupState,this.metadataTracker.metadataForEvent(_,this.nextEventOffset),_.attributes.teamId,_.attributes.firstPlayerId,_.attributes.secondPlayerId);break;case"sub_players":f=f.pushSimpleChildEvent(_,this.situationRecordForNextEvent(),this.lastFieldersState,this.lastLineupState,this.metadataTracker.metadataForEvent(_,this.nextEventOffset),_.attributes.teamId,_.attributes.incomingPlayerId,_.attributes.outgoingPlayerId);break;case"assign_dh":f=f.pushSimpleChildEvent(_,this.situationRecordForNextEvent(),this.lastFieldersState,this.lastLineupState,this.metadataTracker.metadataForEvent(_,this.nextEventOffset),_.attributes.teamId,_.attributes.dhId,_.attributes.fielderId);break;case"remove_dh":f=f.pushSimpleChildEvent(_,this.situationRecordForNextEvent(),this.lastFieldersState,this.lastLineupState,this.metadataTracker.metadataForEvent(_,this.nextEventOffset),_.attributes.teamId,_.attributes.dhId);break;case"assign_flex":f=f.pushSimpleChildEvent(_,this.situationRecordForNextEvent(),this.lastFieldersState,this.lastLineupState,this.metadataTracker.metadataForEvent(_,this.nextEventOffset),_.attributes.teamId,_.attributes.playerId);break;case"clear_flex":f=f.pushSimpleChildEvent(_,this.situationRecordForNextEvent(),this.lastFieldersState,this.lastLineupState,this.metadataTracker.metadataForEvent(_,this.nextEventOffset));break;case"assign_dp":f=f.pushSimpleChildEvent(_,this.situationRecordForNextEvent(),this.lastFieldersState,this.lastLineupState,this.metadataTracker.metadataForEvent(_,this.nextEventOffset),_.attributes.teamId,_.attributes.playerId);break;case"clear_dp":f=f.pushSimpleChildEvent(_,this.situationRecordForNextEvent(),this.lastFieldersState,this.lastLineupState,this.metadataTracker.metadataForEvent(_,this.nextEventOffset));break;case"player_stat_edit":f=f.pushSimpleChildEvent(_,this.situationRecordForNextEvent(),this.lastFieldersState,this.lastLineupState,this.metadataTracker.metadataForEvent(_,this.nextEventOffset),_.teamId,_.playerId);break;case"team_stat_edit":f=f.pushSimpleChildEvent(_,this.situationRecordForNextEvent(),this.lastFieldersState,this.lastLineupState,this.metadataTracker.metadataForEvent(_,this.nextEventOffset));break}return f},c.prototype.getBaseEvents=function(){return this.baseEvents},c.prototype.finishAtBatFromEvent=function(f,_,S,P){return f=f.setResultForCurrentAtBat(_,S,this.situationRecordForNextEvent()),f=f.setSignificantEventId(_.id),P!==void 0&&(f=f.updateIn(["currentAtBat","participants"],function(I){return I.withMutations(P)})),f=f.setIn(["currentAtBat","template"],o.templateForAtBat(_,f.get("currentAtBat"))),f=f.setIn(["currentAtBat","headline"],o.headlineForAtBat(_,f.get("currentAtBat"))),f=f.update("currentAtBat",l.partial(f.updatePerspectivesForTopLevelParticipants,_)),f.cycleAtBat(this.situationRecordForNextEvent())},c.prototype.pitch=function(f,_){var S=this;if(f=f.pushPitch(_,this.nextSituationState),f=f.setSignificantEventId(_.id),this.lastBaserunnersState.runnersOnBase!==0&&_.attributes.advancesRunners){var P=t.List().withMutations(function(b){S.pushParticipantForPitcher(b),S.pushParticipantsForNonBatterBaserunners(b)});f=f.pushChildEvent(_,this.situationRecordForNextEvent(),this.metadataTracker.metadataForEvent(_,this.nextEventOffset),P)}if(this.nextSituationState.lastEventWasStrikeout||this.nextSituationState.lastEventWasWalk){var I=this.lastSituationState.atBatTeamId,E=this.lastLineupState.currentBatter(I),B=this.nextSituationState.lastEventWasStrikeout?"strikeout":"walk";f=this.finishAtBatFromEvent(f,_,B,function(b){b.clear(),b.push(new v.ParticipantRecord({playerId:E,globalAtBatId:S.lastLineupState.globalAtBatId,role:"batter",base:B==="strikeout"?void 0:1,out:B==="strikeout",scored:!1,slot:S.lastLineupState.lineupIndex(I)})),S.pushParticipantForPitcher(b),S.pushParticipantsForNonBatterBaserunners(b)})}return f},c.prototype.ballInPlay=function(f,_){var S=this;return this.finishAtBatFromEvent(f,_,_.attributes.playResult,function(P){P.clear();var I=S.lastSituationState.atBatTeamId,E=S.lastLineupState.currentBatter(I),B=y.ballInPlayResultConfigs[_.attributes.playResult];P.push(new v.ParticipantRecord({playerId:E,globalAtBatId:S.lastLineupState.globalAtBatId,role:"batter",base:B.bases===0?void 0:B.bases,out:B.batterOut,scored:B.bases===4,slot:S.lastLineupState.lineupIndex(I)})),S.pushParticipantForPitcher(P),S.updateParticipantsForDefenders(P,_),S.pushParticipantsForNonBatterBaserunners(P)})},c.prototype.endAtBat=function(f,_){var S=this,P=this.lastSituationState.atBatTeamId,I=this.lastLineupState.currentBatter(P),E=this.lastSituationState.inFieldTeamId;return this.finishAtBatFromEvent(f,_,_.attributes.reason,function(B){B.clear(),B.push(new v.ParticipantRecord({playerId:I,globalAtBatId:S.lastLineupState.globalAtBatId,role:"batter",base:_.attributes.reason==="strikeout"?void 0:1,out:_.attributes.reason==="strikeout",scored:!1,slot:S.lastLineupState.lineupIndex(P)})),_.attributes.reason==="catcher_interference"&&B.push(new v.ParticipantRecord({playerId:S.lastFieldersState.playerForPosition(E,"C"),role:"fielder",position:"C",fieldingOrder:t.List.of(0)})),S.pushParticipantForPitcher(B),S.pushParticipantsForNonBatterBaserunners(B)})},c.prototype.baserunningIsErrorImmediatelyAfterLastBIP=function(f,_){var S,P,I=(P=(S=_.lastCompletedAtBat)===null||S===void 0?void 0:S.result)===null||P===void 0?void 0:P.playType,E=I==="walk"||I==="place_batter"||I==="hit_by_pitch"||I==="catcher_interference",B=f.attributes.playType==="advanced_on_error"||f.attributes.playType==="on_same_error",b=_.currentAtBat.pitches.length===0,R=_.currentAtBat.childEvents.length===0;return!E&&B&&b&&R},c.prototype.baseRunning=function(f,_){var S=this,P,I,E=t.List(),B=y.baseRunningPlayTypeConfigs[_.attributes.playType];if(E=E.withMutations(function(F){F.push(new v.ParticipantRecord({playerId:_.attributes.runnerId,globalAtBatId:S.lastBaserunnersState.globalAtBatIdForPlayer(_.attributes.runnerId),role:"runner",base:_.attributes.base,out:B.runnerOut,scored:_.attributes.base===4&&!B.runnerOut&&_.attributes.playType!=="did_not_score",baseChanged:S.lastBaserunnersState.baseForPlayer(_.attributes.runnerId)!==_.attributes.base})),S.updateParticipantsForDefenders(F,_),S.updateParticipantsForSpecificBaseRunningPlays(F,_)}),(0,s.baserunningRelatedToLastBIP)(_)||this.baserunningIsErrorImmediatelyAfterLastBIP(_,f)){f=f.pushBaseRunningOnPlayEvent(_,this.situationRecordForNextEvent(),E),f=f.updateLastCompletedAtBat(function(F){return F.update("participants",function(x){return x.withMutations(function(w){S.updateParticipantsForDefenders(w,_)})})});var b=(I=(P=f.lastCompletedAtBat)===null||P===void 0?void 0:P.result)===null||I===void 0?void 0:I.eventId,R=this.baseEvents[this.idToIndexMap[b]];return f.reconcileLastAtBatWithExtraBaseRunning(R,_,this.situationRecordForNextEvent())}return f=f.pushChildEvent(_,this.situationRecordForNextEvent(),this.metadataTracker.metadataForEvent(_,this.nextEventOffset),E),this.nextSituationState.lastEventEndedInning?this.finishAtBatFromEvent(f,_,"baserunning_ended_inning",function(F){var x=S.lastSituationState.atBatTeamId,w=S.lastLineupState.currentBatter(x);F.push(new v.ParticipantRecord({playerId:w,role:"batter",slot:S.lastLineupState.lineupIndex(x)}));for(var L=0,D=E.toSeq().toArray();L<D.length;L++){var U=D[L];F.push(U)}}):f},c.prototype.endHalf=function(f,_){return this.finishAtBatFromEvent(f,_,"next_half")},c.prototype.override=function(f,_){return l.intersection(l.keys(_.attributes),["scores","outs","balls","strikes"]).length!==0&&(f=f.pushChildEvent(_,this.situationRecordForNextEvent(),this.metadataTracker.metadataForEvent(_,this.nextEventOffset))),(0,s.changesInning)(_)?this.finishAtBatFromEvent(f,_,"inning_override"):f},c.prototype.clearLineupIndex=function(f,_){var S=this.lastLineupState.getPlayerAtIndex(_.attributes.teamId,_.attributes.index),P=new v.ParticipantRecord({playerId:S});return f.pushChildEvent(_,this.situationRecordForNextEvent(),this.metadataTracker.metadataForEvent(_,this.nextEventOffset),t.List.of(P))},c.prototype.gotoLineupIndex=function(f,_){var S=this.lastLineupState.getPlayerAtIndex(_.attributes.teamId,_.attributes.index);if(S!==void 0){var P=new v.ParticipantRecord({playerId:S});return f.pushChildEvent(_,this.situationRecordForNextEvent(),this.metadataTracker.metadataForEvent(_,this.nextEventOffset),t.List.of(P))}return f.pushChildEvent(_,this.situationRecordForNextEvent(),this.metadataTracker.metadataForEvent(_,this.nextEventOffset))},c.prototype.balk=function(f,_){var S=this,P=t.List().withMutations(function(I){S.pushParticipantForPitcher(I),S.pushParticipantsForNonBatterBaserunners(I)});return f=f.setSignificantEventId(_.id),f.pushChildEvent(_,this.situationRecordForNextEvent(),this.metadataTracker.metadataForEvent(_,this.nextEventOffset),P)},c.prototype.illegalPitchAdvance=function(f,_){var S=this,P=t.List().withMutations(function(B){S.pushParticipantForPitcher(B),S.pushParticipantsForNonBatterBaserunners(B)});if(f=f.pushChildEvent(_,this.situationRecordForNextEvent(),this.metadataTracker.metadataForEvent(_,this.nextEventOffset),P),f=f.setSignificantEventId(_.id),this.nextSituationState.lastEventWasWalk){var I=this.lastSituationState.atBatTeamId,E=this.lastLineupState.currentBatter(I);f=this.finishAtBatFromEvent(f,_,"walk",function(B){B.clear(),B.push(new v.ParticipantRecord({playerId:E,globalAtBatId:S.lastLineupState.globalAtBatId,role:"batter",base:1,out:!1,scored:!1,slot:S.lastLineupState.lineupIndex(I)})),S.pushParticipantForPitcher(B),S.pushParticipantsForNonBatterBaserunners(B)})}return f},c.prototype.foulError=function(f,_){var S=this,P=this.lastSituationState.atBatTeamId,I=this.lastLineupState.currentBatter(P),E=t.List().withMutations(function(B){B.push(new v.ParticipantRecord({playerId:I,globalAtBatId:S.lastLineupState.globalAtBatId,role:"batter",base:void 0,baseChanged:!1,out:!1,scored:!1,slot:S.lastLineupState.lineupIndex(P)})),S.pushParticipantForPitcher(B),S.updateParticipantsForDefenders(B,_)});return f=f.setSignificantEventId(_.id),f.pushChildEvent(_,this.situationRecordForNextEvent(),this.metadataTracker.metadataForEvent(_,this.nextEventOffset),E)},c.prototype.placeBatter=function(f,_){var S=this,P=this.lastSituationState.atBatTeamId,I=this.lastLineupState.currentBatter(P);return this.finishAtBatFromEvent(f,_,"place_batter",function(E){E.push(new v.ParticipantRecord({playerId:I,globalAtBatId:S.lastLineupState.globalAtBatId,role:"batter",base:_.attributes.base,out:!1,scored:!1,slot:S.lastLineupState.lineupIndex(P)}))})},c.prototype.placeRunner=function(f,_){var S=new v.ParticipantRecord({playerId:_.attributes.runnerId,role:"runner",base:_.attributes.base,out:!1,scored:!1});return f.pushChildEvent(_,this.situationRecordForNextEvent(),this.metadataTracker.metadataForEvent(_,this.nextEventOffset),t.List.of(S))},c.prototype.pitcherDecision=function(f,_){var S=new v.ParticipantRecord({playerId:_.attributes.pitcherId,role:"pitcher"});return f.pushChildEvent(_,this.situationRecordForNextEvent(),this.metadataTracker.metadataForEvent(_,this.nextEventOffset),t.List.of(S))},c.prototype.swapDPFlex=function(f,_){var S=this.lastLineupState.dpFlexAssignmentsForTeam(_.attributes.teamId),P=t.List();return S.dp!==void 0&&S.flex!==void 0&&(P=P.push(new v.ParticipantRecord({playerId:S.dp})),P=P.push(new v.ParticipantRecord({playerId:S.flex}))),f.pushChildEvent(_,this.situationRecordForNextEvent(),this.metadataTracker.metadataForEvent(_,this.nextEventOffset),P)},c}(p.VersionedStateEngine);return xr.PlayByPlayEngine=e,xr}var va={},Nt={},Dd;function $i(){if(Dd)return Nt;Dd=1,Object.defineProperty(Nt,"__esModule",{value:!0}),Nt.makeReplaceMetaEvent=Nt.makeInsertAfterMetaEvent=Nt.makeInsertBeforeMetaEvent=Nt.makeEditGroupMetaEvent=void 0;var n=Ge(),l=io();function t(s){return{id:(0,n.uuid4)(),code:"edit_group",events:(0,l.stripNulls)(s)}}Nt.makeEditGroupMetaEvent=t;function p(s,u){return{id:(0,n.uuid4)(),code:"insert",beforeId:s,events:(0,l.stripNulls)([u])}}Nt.makeInsertBeforeMetaEvent=p;function d(s,u){return{id:(0,n.uuid4)(),code:"insert",afterId:s,events:(0,l.stripNulls)([u])}}Nt.makeInsertAfterMetaEvent=d;function y(s,u){return{id:(0,n.uuid4)(),code:"replace",deleteIds:s,events:(0,l.stripNulls)(u)}}return Nt.makeReplaceMetaEvent=y,Nt}var Gd;function dv(){if(Gd)return va;Gd=1,Object.defineProperty(va,"__esModule",{value:!0}),va.DefensivePlayEdit=void 0;var n=Ge(),l=$i(),t=function(){function p(d,y,s,u,h,v,o){this.eventId=d,this.eventIndexMap=y,this.events=s,this.teamId=u,this.position=h,this.positionHistory=v,this.outgoingPlayerId=o}return p.prototype.makeEditResult=function(d,y){var s=this.makeSummary(d,y);return{summary:s,event:this.makeDefensiveEditEvent(d,s)}},p.prototype.makeFillPosition=function(d,y){return{id:(0,n.uuid4)(),code:"fill_position",createdAt:d.createdAt,attributes:{teamId:this.teamId,playerId:y,position:this.position}}},p.prototype.makeDefensiveEditEvent=function(d,y){var s=[],u=this.events[this.eventIndexMap[this.eventId]];if(s.push((0,l.makeInsertBeforeMetaEvent)(this.eventId,this.makeFillPosition(u,d))),y.positionRecord!==void 0){var h=y.positionRecord.eventId,v=this.events[this.eventIndexMap[h]];if(v.code==="sub_players"){var o=y.positionRecord.fielderId;s.push((0,l.makeInsertAfterMetaEvent)(h,this.makeFillPosition(v,o)))}}return(0,l.makeEditGroupMetaEvent)(s)},p.prototype.makeSummary=function(d,y){var s=this.eventIndexMap[this.eventId],u=this.nextFieldingRecordAfterEventIndex(y,s),h=this.nextPositionRecordAfterEventIndex(s),v={incomingId:d,outgoingId:this.outgoingPlayerId,position:this.position,playerRecord:void 0,positionRecord:void 0};return u!==void 0&&h!==void 0?this.eventIndexMap[u.eventId]<this.eventIndexMap[h.eventId]?v.playerRecord=u:v.positionRecord=h:u!==void 0?v.playerRecord=u:h!==void 0&&(v.positionRecord=h),v},p.prototype.nextFieldingRecordAfterEventIndex=function(d,y){var s=this;return d===void 0&&(d=[]),d.filter(function(u){var h=s.eventIndexMap[u.eventId];return h>=y})[0]},p.prototype.nextPositionRecordAfterEventIndex=function(d){var y=this;if(this.positionHistory!==void 0)return this.positionHistory.filter(function(s){var u=y.eventIndexMap[s.eventId];return u>=d})[0]},p}();return va.DefensivePlayEdit=t,va}var go={},Hd;function Nd(){return Hd||(Hd=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.OffensivePlayEdit=n.getIneligiblePlayers=n.IneligibilityReason=void 0;var l=X,t=l.__importStar(Pe),p=fe(),d=Rt(),y=Ge(),s=tr(),u=$i(),h;(function(r){r.IsBatter="is_batter",r.OnFirst="on_first",r.OnSecond="on_second",r.OnThird="on_third",r.InLineup="in_lineup"})(h=n.IneligibilityReason||(n.IneligibilityReason={}));function v(r,e,i,c){c&&!t.contains(i,c)&&(e.push({playerId:c,reason:r}),i.push(c))}function o(r,e,i,c,f,_){for(var S=[],P=[],I=r;I<=e;I++){var E=f.stateBeforeEvent(I).currentBatter(c),B=_.stateBeforeEvent(I).baserunners;v(h.IsBatter,P,S,E),v(h.OnFirst,P,S,B[1]),v(h.OnSecond,P,S,B[2]),v(h.OnThird,P,S,B[3])}for(var I=e+1;I<=i;I++){var B=_.stateBeforeEvent(I).baserunners;v(h.OnFirst,P,S,B[1]),v(h.OnSecond,P,S,B[2]),v(h.OnThird,P,S,B[3])}return P}n.getIneligiblePlayers=o;var a=function(){function r(e,i,c,f,_,S,P,I){this.targetEvent=e,this.events=i,this.eventIndexMap=c,this.atBat=f,this.teamId=_,this.location=S,this.outgoingPlayerId=P,this.incomingPlayerId=I}return r.prototype.makeEditResult=function(){return{summary:this.makeSummary(),event:this.makeEditGroupEvent()}},r.prototype.makeSummary=function(){return{incomingId:this.incomingPlayerId,outgoingId:this.outgoingPlayerId,location:this.location}},r.prototype.makeEditGroupEvent=function(){switch(this.location){case d.BaseballOffensiveLocation.Batter:return this.handleBatter();case d.BaseballOffensiveLocation.RunnerOnFirst:case d.BaseballOffensiveLocation.RunnerOnSecond:case d.BaseballOffensiveLocation.RunnerOnThird:return this.handleBaseRunner();default:throw"Unknown location ".concat(this.location)}},r.prototype.handleBatter=function(){var e=[];return e.push((0,u.makeInsertBeforeMetaEvent)(this.targetEvent.id,this.makeReplaceBatterEvent(this.incomingPlayerId))),this.isPlayerStillOnBase(this.outgoingPlayerId)&&!this.didHalfInningEnd()&&e.push((0,u.makeInsertAfterMetaEvent)(this.getTerminatingEventId(),this.makeReplaceRunnerEvent(this.incomingPlayerId,this.outgoingPlayerId))),e=e.concat(this.replaceRunnerInBaserunningEvents()),(0,u.makeEditGroupMetaEvent)(e)},r.prototype.handleBaseRunner=function(){switch(this.targetEvent.code){case"base_running":return this.handleBaseRunnerManualAdvance();default:return this.handleBaseRunnerBatterAdvance()}},r.prototype.handleBaseRunnerManualAdvance=function(){var e=this.targetEvent,i=e.attributes.playType,c=d.baseRunningPlayTypeConfigs[i];if(c===void 0)throw"Could not find a play type config for ".concat(i);var f=!c.runnerOut&&e.attributes.base!==4,_=[];return _.push((0,u.makeInsertBeforeMetaEvent)(e.id,this.makeReplaceRunnerEvent(this.outgoingPlayerId,this.incomingPlayerId))),_.push(this.replaceRunnerInBaserunningEvent(this.outgoingPlayerId,this.incomingPlayerId,e,f)),(0,u.makeEditGroupMetaEvent)(_)},r.prototype.getTerminatingEventId=function(){return this.atBat.orderedEventIds[this.atBat.orderedEventIds.length-1]},r.prototype.findParticipantRecordForPlayer=function(e){var i=(0,s.firstParticipantWithIdToJS)(p.List.of.apply(p.List,this.atBat.participants),e);if(i===void 0)throw"was not able to find participant record for ".concat(e);return i},r.prototype.isPlayerStillOnBase=function(e){var i=this.findParticipantRecordForPlayer(e);return!i.out&&!i.scored},r.prototype.didHalfInningEnd=function(){return this.atBat.initialSituation.inning<this.atBat.result.situation.inning||this.atBat.initialSituation.half==="top"&&this.atBat.result.situation.half==="bottom"},r.prototype.handleBaseRunnerBatterAdvance=function(){var e=[];return e.push((0,u.makeInsertBeforeMetaEvent)(this.targetEvent.id,this.makeReplaceRunnerEvent(this.outgoingPlayerId,this.incomingPlayerId))),this.isPlayerStillOnBase(this.outgoingPlayerId)&&!this.didHalfInningEnd()&&e.push((0,u.makeInsertAfterMetaEvent)(this.getTerminatingEventId(),this.makeReplaceRunnerEvent(this.incomingPlayerId,this.outgoingPlayerId))),e=e.concat(this.replaceRunnerInBaserunningEvents()),(0,u.makeEditGroupMetaEvent)(e)},r.prototype.makeReplaceBatterEvent=function(e){return{id:(0,y.uuid4)(),code:"replace_batter",attributes:{teamId:this.teamId,incomingPlayerId:e}}},r.prototype.makeReplaceRunnerEvent=function(e,i){return{id:(0,y.uuid4)(),code:"replace_runner",attributes:{teamId:this.teamId,incomingPlayerId:i,outgoingPlayerId:e,flavor:d.ReplaceRunnerFlavor.RetroactiveSubstitution}}},r.prototype.replaceRunnerInBaserunningEvent=function(e,i,c,f){if(c.attributes.runnerId!==e)throw"outgoingId ".concat(e," did not match runner ").concat(c.attributes.runnerId," in event ").concat(c.id);var _=[];return _.push({id:(0,y.uuid4)(),code:"base_running",createdAt:c.createdAt,attributes:{playType:c.attributes.playType,playFlavor:c.attributes.playFlavor,base:c.attributes.base,runnerId:i,defenders:c.attributes.defenders}}),f&&_.push(this.makeReplaceRunnerEvent(i,e)),(0,u.makeReplaceMetaEvent)([c.id],_)},r.prototype.replaceRunnerInBaserunningEvents=function(){var e=this,i=[];return this.atBat.baseRunningOnPlayEvents.forEach(function(c){var f=e.events[e.eventIndexMap[c.eventId]];f.attributes.runnerId===e.outgoingPlayerId&&i.push(e.replaceRunnerInBaserunningEvent(e.outgoingPlayerId,e.incomingPlayerId,f,!1))}),i},r}();n.OffensivePlayEdit=a}(go)),go}var ga={},jd;function fv(){if(jd)return ga;jd=1,Object.defineProperty(ga,"__esModule",{value:!0}),ga.PitchEditor=void 0;var n=X,l=Ge(),t=$i(),p=function(){function d(y){this.pitchEvent=y}return d.prototype.makeEditEvent=function(y){var s={};y.style!==void 0&&(s.style=y.style===null?void 0:y.style),y.speed!==void 0&&(s.speed=y.speed===null?void 0:y.speed),y.speedProvider!==void 0&&(s.speedProvider=y.speedProvider===null?void 0:y.speedProvider);var u=n.__assign(n.__assign({},this.pitchEvent),{id:(0,l.uuid4)(),attributes:n.__assign(n.__assign({},this.pitchEvent.attributes),s)});return(0,t.makeReplaceMetaEvent)([this.pitchEvent.id],[u])},d}();return ga.PitchEditor=p,ga}var _a={},qd;function pv(){if(qd)return _a;qd=1,Object.defineProperty(_a,"__esModule",{value:!0}),_a.PlayerReplacementEdit=void 0;var n=Ge(),l=function(){function t(p,d,y){this.events=p,this.existingPlayerId=d,this.replacementPlayerId=y}return t.prototype.makeEditEvent=function(){return{summary:{existingPlayerId:this.existingPlayerId,replacementPlayerId:this.replacementPlayerId},events:this.makeEditGroupEvents()}},t.prototype.makeEditGroupEvents=function(){for(var p,d,y=[],s=[],u=[],h=0,v=this.events;h<v.length;h++){var o=v[h],a=this.replacePlayerInEvent(o);if(a){var r=this.makeReplaceMetaEvent(o.id,[a]);((p=o.compactorAttributes)===null||p===void 0?void 0:p.stream)==="head"?y.push(r):((d=o.compactorAttributes)===null||d===void 0?void 0:d.stream)==="tail"?u.push(r):s.push(r)}}var e=[];return y.length>0&&e.push(this.makeEditGroupMetaEvent(y,"head")),s.length>0&&e.push(this.makeEditGroupMetaEvent(s,"main")),u.length>0&&e.push(this.makeEditGroupMetaEvent(u,"tail")),e},t.prototype.replacePlayerInEvent=function(p){var d=JSON.stringify(p),y=new RegExp('"'.concat(this.existingPlayerId,'"'),"gi"),s=d.replace(y,'"'.concat(this.replacementPlayerId,'"'));if(d!==s){var u=JSON.parse(s);return u.id=(0,n.uuid4)(),u}},t.prototype.makeEditGroupMetaEvent=function(p,d){return{id:(0,n.uuid4)(),code:"edit_group",events:p,compactorAttributes:{stream:d}}},t.prototype.makeReplaceMetaEvent=function(p,d){return{id:(0,n.uuid4)(),code:"replace",deleteIds:[p],events:d}},t}();return _a.PlayerReplacementEdit=l,_a}var Sa={},Ud;function hv(){if(Ud)return Sa;Ud=1,Object.defineProperty(Sa,"__esModule",{value:!0}),Sa.getIllegalEvents=void 0;var n=Nd();function l(u,h,v,o,a,r){return d(u,h,v,o,a).concat(s(h,v,o,r))}Sa.getIllegalEvents=l;function t(u,h,v){if(u===h)return{playerId:u,reason:n.IneligibilityReason.IsBatter};if(u===v[1])return{playerId:u,reason:n.IneligibilityReason.OnFirst};if(u===v[2])return{playerId:u,reason:n.IneligibilityReason.OnSecond};if(u===v[3])return{playerId:u,reason:n.IneligibilityReason.OnThird}}function p(u,h){if(h.includes(u))return{playerId:u,reason:n.IneligibilityReason.InLineup}}function d(u,h,v,o,a){for(var r=o.baseEvents.length,e=[],i=0;i<r;i++){var c=[],f=o.stateAfterEvent(i).currentBatter(u),_=a.stateAfterEvent(i).baserunners,S=t(h,f,_),P=t(v,f,_);S&&P&&c.push(S,P);var I=o.stateAfterEvent(i).batters(u),E=p(h,I),B=p(v,I);E&&B&&c.push(E,B),c.length&&e.push({eventIndex:i,reason:c})}return e}function y(u,h,v){var o=v.positionForPlayer(u);if(o==="EH")for(var a=h.dhsMap,r=0,e=Object.keys(a);r<e.length;r++){var i=e[r];if(Object.keys(a[i]).includes(u))return"DH"}else return o}function s(u,h,v,o){for(var a=o.baseEvents.length,r=[],e=0;e<a;e++){var i=v.stateAfterEvent(e),c=o.stateAfterEvent(e),f=y(u,i,c),_=y(h,i,c);f&&_&&r.push({eventIndex:e,reason:[{playerId:u,reason:f},{playerId:h,reason:_}]})}return r}return Sa}var Gr={},Wd;function yv(){if(Wd)return Gr;Wd=1,Object.defineProperty(Gr,"__esModule",{value:!0}),Gr.PlaysEngine=Gr.PlaysEngineState=void 0;var n=X,l=n.__importStar(fe()),t=tt(),p=n.__importStar(Ee()),d=n.__importStar(Oe()),y=function(u){n.__extends(h,u);function h(){return u!==null&&u.apply(this,arguments)||this}return Object.defineProperty(h.prototype,"eventIndexInPlay",{get:function(){return this.get("eventIndexInPlay")},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"eventStartsNewPlay",{get:function(){return this.get("eventStartsNewPlay")},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"isPartOfPlay",{get:function(){return this.get("isPartOfPlay")},enumerable:!1,configurable:!0}),h}(d.ImmutableState);Gr.PlaysEngineState=y;var s=function(u){n.__extends(h,u);function h(v,o){var a=u.call(this,v)||this;return a.situation=o,a}return h.prototype.initialState=function(){return new y(l.fromJS({eventIndexInPlay:0,eventStartsNewPlay:!1,isPartOfPlay:!1}))},h.prototype.processOneEvent=function(v,o){if(!(0,t.eventRelatesToAtBatTeam)(o))v=v.set("isPartOfPlay",!1);else if((0,t.baserunningRelatedToLastBIP)(o))v=v.set("eventIndexInPlay",v.eventIndexInPlay+1),v=v.set("eventStartsNewPlay",!1),v=v.set("isPartOfPlay",!0);else if((0,t.isPitchEvent)(o)){var a=this.situation.stateAfterEvent(this.nextEventOffset).lastEventWasStrikeout;v=v.set("isPartOfPlay",a),v=v.set("eventStartsNewPlay",a)}else((0,t.isBallInPlayEvent)(o)||(0,t.isEndAtBatEvent)(o)||(0,t.baserunningUnrelatedToLastBIP)(o))&&(v=v.set("eventIndexInPlay",0),v=v.set("eventStartsNewPlay",!0),v=v.set("isPartOfPlay",!0));return v},h}(p.VersionedStateEngine);return Gr.PlaysEngine=s,Gr}var Hr={},$d;function vv(){if($d)return Hr;$d=1,Object.defineProperty(Hr,"__esModule",{value:!0}),Hr.SituationEngine=Hr.SituationState=void 0;var n=X,l=n.__importStar(Pe),t=n.__importStar(fe()),p=n.__importStar(Ee()),d=n.__importStar(Oe()),y=n.__importStar(Rt()),s=n.__importStar(tt()),u=function(v){n.__extends(o,v);function o(){return v!==null&&v.apply(this,arguments)||this}return Object.defineProperty(o.prototype,"balls",{get:function(){return this.get("balls")},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"strikes",{get:function(){return this.get("strikes")},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"outs",{get:function(){return this.get("outs")},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"resultingBalls",{get:function(){var a=this.get("resultingBalls");return a!==void 0?a:this.balls},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"resultingStrikes",{get:function(){var a=this.get("resultingStrikes");return a!==void 0?a:this.strikes},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"resultingOuts",{get:function(){var a=this.get("resultingOuts");return a!==void 0?a:this.outs},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"inning",{get:function(){return this.get("inning")},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"half",{get:function(){return this.get("half")},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"homeId",{get:function(){return this.get("homeId")},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"awayId",{get:function(){return this.get("awayId")},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"atBatTeamId",{get:function(){return this.half==="top"?this.awayId:this.homeId},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"inFieldTeamId",{get:function(){return this.half==="top"?this.homeId:this.awayId},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"pitchesThisInning",{get:function(){return this.get("pitchesThisInning")},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"pitchesThisAtBat",{get:function(){return this.get("pitchesThisAtBat")},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"lastPitchDetail",{get:function(){return this.get("lastPitchDetail")},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"atBatIndex",{get:function(){return this.get("atBatIndex")},enumerable:!1,configurable:!0}),o.prototype.pitchesThrownThisGame=function(a){return this.getIn(["pitchesThrownThisGame",a])||0},Object.defineProperty(o.prototype,"lastEventWasOut",{get:function(){return this.getIn(["lastEvent","wasOut"])},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"lastEventEndedInning",{get:function(){return this.getIn(["lastEvent","endedInning"])},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"lastEventWasStrikeout",{get:function(){return this.getIn(["lastEvent","strikeout"])},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"lastEventWasWalk",{get:function(){return this.getIn(["lastEvent","walk"])},enumerable:!1,configurable:!0}),o.prototype.resetLastEventFlags=function(){return this.mergeIn(["lastEvent"],{walk:!1,strikeout:!1,endedInning:!1,wasOut:!1})},o.prototype.resetResultingCount=function(){return this.merge({resultingBalls:void 0,resultingStrikes:void 0,resultingOuts:void 0})},o}(d.ImmutableState);Hr.SituationState=u;var h=function(v){n.__extends(o,v);function o(a){var r=v.call(this,a)||this;return r.baseEvents=a,r}return o.prototype.processOneEvent=function(a,r){switch(a=a.resetLastEventFlags().resetResultingCount(),r.code){case"pitch":a=this.handlePitch(a,r);break;case"ball_in_play":a=this.handleBallInPlay(a,r);break;case"foul_error":a=this.handleFoulError(a,r);break;case"base_running":a=this.handleBaseRunning(a,r);break;case"end_half":a=this.handleEndHalf(a);break;case"override":a=this.handleOverride(a,r);break;case"set_teams":return this.handleSetTeams(a,r);case"end_at_bat":a=this.handleEndAtBat(a,r);break;case"illegal_pitch_advance":a=this.handleIllegalPitchAdvance(a,r);break}return this.reconcileSituation(a)},o.prototype.initialState=function(){return new u(t.fromJS({balls:0,strikes:0,outs:0,resultingBalls:void 0,resultingStrikes:void 0,resultingOuts:void 0,inning:1,half:"top",homeId:"",awayId:"",pitchesThisInning:0,pitchesThisAtBat:0,atBatIndex:0,pitchesThrownThisGame:{},lastPitchDetail:{id:""},lastEvent:{endedInning:!1,strikeout:!1,walk:!1}}))},o.prototype.reconcileSituation=function(a){var r=function(e){return e+1};return a.withMutations(function(e){e.get("balls")>=4&&e.set("strikes",0).set("balls",0).set("resultingBalls",4).set("pitchesThisAtBat",0).update("atBatIndex",r).setIn(["lastEvent","walk"],!0),e.get("strikes")>=3&&e.set("strikes",0).set("resultingStrikes",3).set("balls",0).set("outs",e.get("outs")+1).set("pitchesThisAtBat",0).update("atBatIndex",r).setIn(["lastEvent","strikeout"],!0).setIn(["lastEvent","wasOut"],!0),e.get("outs")>=3&&(e.set("outs",0).set("resultingOuts",3).set("strikes",0).set("balls",0).set("pitchesThisAtBat",0).update("atBatIndex",r).set("pitchesThisInning",0).setIn(["lastEvent","endedInning"],!0),e.get("half")==="top"?e.set("half","bottom"):(e.set("inning",e.get("inning")+1),e.set("half","top")))})},o.prototype.handleSetTeams=function(a,r){return a=a.set("homeId",r.attributes.homeId),a.set("awayId",r.attributes.awayId)},o.prototype.forceIncrementResultingStrikes=function(a){return a.strikes===2&&(a=a.set("resultingOuts",a.outs+1)),a.set("resultingStrikes",a.strikes+1)},o.prototype.handlePitch=function(a,r){a=a.increment("pitchesThisInning",1).increment("pitchesThisAtBat",1),a=a.incrementIn(["pitchesThrownThisGame",a.inFieldTeamId],1),a=a.set("lastPitchDetail",{id:r.id,speed:r.attributes.speed,style:r.attributes.style,speedProvider:r.attributes.speedProvider});var e=r.attributes.advancesCount!==!1;switch(r.attributes.result){case"ball":case"intentional_ball":case"illegal_pitch":return e?a.increment("balls",1):a.set("resultingBalls",a.balls+1);case"strike_swinging":case"strike_looking":case"foul_bunt":case"foul_tip":return e?a.increment("strikes",1):this.forceIncrementResultingStrikes(a);case"foul":return a.strikes!==2?e?a.increment("strikes",1):this.forceIncrementResultingStrikes(a):a;case"ball_in_play":return a.set("balls",0).set("strikes",0)}return a},o.prototype.handleBallInPlay=function(a,r){return a=a.set("pitchesThisAtBat",0).increment("atBatIndex",1).set("strikes",0).set("balls",0),y.ballInPlayResultConfigs[r.attributes.playResult].batterOut&&(a=a.increment("outs",1).setIn(["lastEvent","wasOut"],!0)),l.contains(["dropped_third_strike","dropped_third_strike_batter_out"],r.attributes.playResult)&&(a=a.setIn(["lastEvent","strikeout"],!0)),a},o.prototype.handleBaseRunning=function(a,r){return y.baseRunningPlayTypeConfigs[r.attributes.playType].runnerOut?a.increment("outs",1).setIn(["lastEvent","wasOut"],!0):a},o.prototype.handleEndHalf=function(a){return a=a.set("pitchesThisInning",0).set("pitchesThisAtBat",0).increment("atBatIndex",1).setIn(["lastEvent","endedInning"],!0).set("outs",0).set("strikes",0).set("balls",0),a.half==="top"?a.set("half","bottom"):a.increment("inning",1).set("half","top")},o.prototype.handleOverride=function(a,r){var e=r.attributes,i=e.inning,c=e.half,f=e.outs,_=e.balls,S=e.strikes;return s.changesInning(r)&&(a=a.setIn(["lastEvent","endedInning"],!0).set("pitchesThisInning",0).set("pitchesThisAtBat",0).increment("atBatIndex",1)),a.withMutations(function(P){i!==void 0&&P.set("inning",i),c!==void 0&&P.set("half",c),f!==void 0&&P.set("outs",f),_!==void 0&&P.set("balls",_),S!==void 0&&P.set("strikes",S)})},o.prototype.handleEndAtBat=function(a,r){return a=a.set("pitchesThisAtBat",0).increment("atBatIndex",1).set("balls",0).set("strikes",0),r.attributes.reason==="walk"?a=a.setIn(["lastEvent","walk"],!0):r.attributes.reason==="strikeout"&&(a=a.increment("outs",1).setIn(["lastEvent","strikeout"],!0).setIn(["lastEvent","wasOut"],!0)),a},o.prototype.handleIllegalPitchAdvance=function(a,r){return r.attributes&&r.attributes.advancesCount===!0&&(a=a.increment("balls",1)),a},o.prototype.handleFoulError=function(a,r){return r.attributes.advancesCount===!0&&(a=a.update("strikes",function(e){return Math.min(e+1,2)})),a},o}(p.VersionedStateEngine);return Hr.SituationEngine=h,Hr}var Nr={},Vd;function gv(){if(Vd)return Nr;Vd=1,Object.defineProperty(Nr,"__esModule",{value:!0}),Nr.SprayChartEngine=Nr.SprayChartState=void 0;var n=X,l=n.__importStar(Pe),t=n.__importStar(fe()),p=n.__importStar(Ee()),d=n.__importStar(Oe()),y=function(u){n.__extends(h,u);function h(){return u!==null&&u.apply(this,arguments)||this}return h.prototype.fullSprayChartData=function(){return this.get("teams").toJS()},h.prototype.sprayChartDataForTeam=function(v){var o=this.getIn(["teams",v]);return o!==void 0?o.toJS():{}},h.prototype.sprayChartDataForPlayer=function(v,o,a){var r=this.getIn(["teams",v,a,o]);return r!==void 0?r.toJS():[]},h.prototype.initializeForTeam=function(v){return this.setIn(["teams",v],t.Map({}).setIn(["offense"],t.Map({})).setIn(["defense"],t.Map({})))},h.prototype.addBallInPlay=function(v,o,a,r){return this.updateIn(["teams",a,o,r],function(e){return e===void 0&&(e=t.List()),e.push(v)})},h}(d.ImmutableState);Nr.SprayChartState=y;var s=function(u){n.__extends(h,u);function h(v,o,a,r){var e=u.call(this,v)||this;return e.baseEvents=v,e.situation=o,e.lineup=a,e.fielders=r,e}return Object.defineProperty(h.prototype,"lastSituationState",{get:function(){return this.situation.stateBeforeEvent(this.nextEventOffset)},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"lastLineupState",{get:function(){return this.lineup.stateBeforeEvent(this.nextEventOffset)},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"lastFielderState",{get:function(){return this.fielders.stateBeforeEvent(this.nextEventOffset)},enumerable:!1,configurable:!0}),h.prototype.initialState=function(){return new y(t.fromJS({teams:{}}))},h.prototype.processOneEvent=function(v,o){switch(o.code){case"set_teams":return this.setTeams(v,o);case"ball_in_play":return this.ballInPlay(v,o)}return v},h.prototype.setTeams=function(v,o){return v.initializeForTeam(o.attributes.homeId).initializeForTeam(o.attributes.awayId)},h.prototype.ballInPlay=function(v,o){if(l.contains(["foul_tip_out","dropped_third_strike","dropped_third_strike_batter_out"],o.attributes.playResult))return v;var a=this.lastSituationState.atBatTeamId,r=this.lastLineupState.currentBatter(a),e=this.lastSituationState.inFieldTeamId,i=this.lastFielderState.playerForPosition(e,"P");return v=v.addBallInPlay(o,"offense",a,r),i!==void 0?v.addBallInPlay(o,"defense",e,i):v},h}(p.VersionedStateEngine);return Nr.SprayChartEngine=s,Nr}var Pa={},Ia={},_o={},zd;function Kd(){return zd||(zd=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.getBaseRunningPlayType=n.getBallInPlayResult=n.getEquivalentPlays=n.getEquivalentPlayTypeForBaseRunningPlayType=n.getEquivalentPlayTypeForPbpPlayType=n.getSacBuntWithOutEvent=n.isPlaySacBuntWithOut=n.EquivalentPlays=n.EquivalentPlayType=n.lookupMapForEvents=void 0;var l=X,t=l.__importStar(tr()),p=tr();function d(c){for(var f={},_=0,S=c;_<S.length;_++){var P=S[_];f[P.id]=P}return f}n.lookupMapForEvents=d;var y;(function(c){c.Single="single",c.Error="error",c.FieldersChoice="fielders_choice",c.StolenBase="stolen_base",c.DefensiveIndifference="defensive_indifference",c.WildPitch="wild_pitch",c.PassedBall="passed_ball",c.AdvancedOnError="advanced_on_error",c.GroundOut="ground_out",c.SacBuntBatterOut="sacbunt_batter_out",c.Double="double",c.SinglePlusError="single_plus_error",c.FieldersChoicePlusError="fielders_choice_plus_error",c.TwoBaseError="two_base_error",c.OtherAdvanceToSecond="other_to_second",c.Triple="triple",c.SinglePlusTwoBaseError="single_plus_two_base_error",c.DoublePlusError="double_plus_error",c.ThreeBaseError="three_base_error",c.FieldersChoicePlusTwoBaseError="fielders_choice_plus_two_base_error",c.OtherAdvanceToThird="other_to_third",c.InsideTheParkHomerun="itp_homerun",c.SinglePlusThreeBaseError="single_plus_three_base_error",c.DoublePlusTwoBaseError="double_plus_two_base_error",c.TriplePlusError="triple_plus_error",c.FourBaseError="four_base_error",c.FieldersChoicePlusThreeBaseError="fielders_choice_plus_three_base_error",c.OtherAdvanceToHome="other_to_home"})(y=n.EquivalentPlayType||(n.EquivalentPlayType={}));var s=function(){function c(){}return c.SINGLE_ERROR=[y.Single,y.Error,y.FieldersChoice],c.DOUBLE=[y.Double,y.SinglePlusError,y.TwoBaseError,y.FieldersChoicePlusError,y.OtherAdvanceToSecond],c.TRIPLE=[y.Triple,y.SinglePlusTwoBaseError,y.DoublePlusError,y.ThreeBaseError,y.FieldersChoicePlusTwoBaseError,y.OtherAdvanceToThird],c.HOMERUN=[y.InsideTheParkHomerun,y.SinglePlusThreeBaseError,y.DoublePlusTwoBaseError,y.TriplePlusError,y.FourBaseError,y.FieldersChoicePlusThreeBaseError,y.OtherAdvanceToHome],c.STOLEN_BASE=[y.StolenBase,y.DefensiveIndifference,y.WildPitch,y.PassedBall,y.AdvancedOnError],c.GROUNDOUT=[y.GroundOut,y.SacBuntBatterOut],c.ALL=[c.SINGLE_ERROR,c.STOLEN_BASE,c.GROUNDOUT,c.DOUBLE,c.TRIPLE,c.HOMERUN],c}();n.EquivalentPlays=s;function u(c,f){return h(c,f)!==void 0}n.isPlaySacBuntWithOut=u;function h(c,f){var _,S=f[c.result.eventId];if(S.code==="ball_in_play"&&S.attributes.playResult==="sacrifice_bunt"){var P=(_=t.firstWithRoleToJS(c.participants,"batter"))===null||_===void 0?void 0:_.playerId,I=c.baseRunningOnPlayEvents.find(function(E){var B=f[E.eventId].attributes;return E.playType==="out_on_last_play"&&B.base===1&&B.defenders.length===0&&B.playType==="out_on_last_play"&&B.runnerId===P});if(I!==void 0)return f[I.eventId]}}n.getSacBuntWithOutEvent=h;function v(c,f,_,S){var P=c.baseRunningOnPlayEvents.find(function(I){var E=f[I.eventId].attributes;return E.base===S&&E.runnerId===_});if(P!==void 0)return f[P.eventId]}function o(c,f,_){var S=(0,p.firstWithRoleToJS)(f.participants,"batter");if(S!==void 0){if(S.scored){var P=v(f,_,S.playerId,2),I=v(f,_,S.playerId,3),E=v(f,_,S.playerId,4);switch(c){case"home_run":{var B=_[f.result.eventId];if(B!==void 0&&B.attributes.playResult==="home_run"&&B.attributes.hrLocation==="in_the_park")return y.InsideTheParkHomerun}break;case"triple":switch(E.attributes.playType){case"on_same_error":case"advanced_on_error":return y.TriplePlusError;default:return y.OtherAdvanceToHome}case"double":switch(E.attributes.playType){case"on_same_error":case"advanced_on_error":return y.DoublePlusTwoBaseError;default:return y.OtherAdvanceToHome}case"fielders_choice":case"single":return E.attributes.playType==="on_same_error"||E.attributes.playType==="advanced_on_error"?c==="fielders_choice"?y.FieldersChoicePlusThreeBaseError:y.SinglePlusThreeBaseError:y.OtherAdvanceToHome;case"error":return E.attributes.playType==="on_same_error"&&(I===void 0||I.attributes.playType==="on_same_error")&&(P===void 0||P.attributes.playType==="on_same_error")?y.FourBaseError:y.OtherAdvanceToHome}}if(f.result.situation.bases[3]===S.playerId)switch(c){case"triple":return y.Triple;case"double":{var b=v(f,_,S.playerId,3);switch(b.attributes.playType){case"on_same_error":case"advanced_on_error":return y.DoublePlusError;default:return y.OtherAdvanceToThird}}break;case"fielders_choice":case"single":{var I=v(f,_,S.playerId,3);return(I==null?void 0:I.attributes.playType)==="on_same_error"||(I==null?void 0:I.attributes.playType)==="advanced_on_error"?c==="fielders_choice"?y.FieldersChoicePlusTwoBaseError:y.SinglePlusTwoBaseError:y.OtherAdvanceToThird}case"error":{var P=v(f,_,S.playerId,2),I=v(f,_,S.playerId,3);return(I==null?void 0:I.attributes.playType)==="on_same_error"&&(P===void 0||P.attributes.playType==="on_same_error")?y.ThreeBaseError:y.OtherAdvanceToThird}}if(f.result.situation.bases[2]===S.playerId){var b=v(f,_,S.playerId,2);switch(c){case"double":return y.Double;case"single":switch(b==null?void 0:b.attributes.playType){case"on_same_error":case"advanced_on_error":return y.SinglePlusError;default:return y.OtherAdvanceToSecond}case"error":switch(b==null?void 0:b.attributes.playType){case"on_same_error":return y.TwoBaseError;default:return y.OtherAdvanceToSecond}case"fielders_choice":switch(b==null?void 0:b.attributes.playType){case"on_same_error":case"advanced_on_error":return y.FieldersChoicePlusError;default:return y.OtherAdvanceToSecond}}}switch(c){case"single":return y.Single;case"error":return y.Error;case"fielders_choice":return y.FieldersChoice;case"batter_out_advance_runners":return y.GroundOut;case"sacrifice_bunt":return u(f,_)?y.SacBuntBatterOut:void 0;default:return}}}n.getEquivalentPlayTypeForPbpPlayType=o;function a(c){switch(c){case"stole_base":return y.StolenBase;case"defensive_indifference":return y.DefensiveIndifference;case"wild_pitch":return y.WildPitch;case"passed_ball":return y.PassedBall;case"advanced_on_error":return y.AdvancedOnError;default:return}}n.getEquivalentPlayTypeForBaseRunningPlayType=a;function r(c){for(var f=0,_=s.ALL;f<_.length;f++){var S=_[f];if(c&&S.includes(c))return S===s.DOUBLE?c===y.OtherAdvanceToSecond?S:S.filter(function(P){return P!==y.OtherAdvanceToSecond}):S===s.TRIPLE?c===y.OtherAdvanceToThird?S:S.filter(function(P){return P!==y.OtherAdvanceToThird}):S===s.HOMERUN?c===y.OtherAdvanceToHome?S:S.filter(function(P){return P!==y.OtherAdvanceToHome}):S}return[]}n.getEquivalentPlays=r;function e(c){switch(c){case y.SinglePlusThreeBaseError:case y.SinglePlusTwoBaseError:case y.SinglePlusError:case y.Single:return"single";case y.FourBaseError:case y.ThreeBaseError:case y.TwoBaseError:case y.Error:return"error";case y.FieldersChoicePlusThreeBaseError:case y.FieldersChoicePlusTwoBaseError:case y.FieldersChoicePlusError:case y.FieldersChoice:return"fielders_choice";case y.GroundOut:return"batter_out_advance_runners";case y.SacBuntBatterOut:return"sacrifice_bunt";case y.DoublePlusTwoBaseError:case y.DoublePlusError:case y.Double:return"double";case y.TriplePlusError:case y.Triple:return"triple";default:return}}n.getBallInPlayResult=e;function i(c){switch(c){case y.StolenBase:return"stole_base";case y.DefensiveIndifference:return"defensive_indifference";case y.WildPitch:return"wild_pitch";case y.PassedBall:return"passed_ball";case y.SinglePlusError:case y.FieldersChoicePlusError:case y.DoublePlusError:case y.SinglePlusTwoBaseError:case y.FieldersChoicePlusTwoBaseError:case y.SinglePlusThreeBaseError:case y.FieldersChoicePlusThreeBaseError:case y.DoublePlusTwoBaseError:case y.TriplePlusError:case y.AdvancedOnError:return"advanced_on_error";case y.FourBaseError:case y.ThreeBaseError:case y.TwoBaseError:return"on_same_error";default:return}}n.getBaseRunningPlayType=i}(_o)),_o}var Jd;function _v(){if(Jd)return Ia;Jd=1,Object.defineProperty(Ia,"__esModule",{value:!0}),Ia.renderForPlayDetail=void 0;var n=Kd();function l(p){var d={};return p.forEach(function(y,s){return d[y.id]=s}),d}function t(p,d,y){var s=[],u=(0,n.lookupMapForEvents)(p),h=l(p),v=function(i){var c=h[i],f=y.situation.stateBeforeEvent(c).atBatTeamId;return y.stateBeforeEvent(c).currentBatter(f)},o=d.pitches.map(function(i){return v(i.eventId)}).concat([v(d.result.eventId)]),a=!1;if(!o.isEmpty){var r=o[0];a=o.reduce(function(i,c){return i||r!==c},!1)}d.childEvents.forEach(function(i){if(i.code==="base_running"){var c=u[i.eventId],f=(0,n.getEquivalentPlayTypeForBaseRunningPlayType)(c.attributes.playType);s.push({eventId:i.eventId,playType:c.attributes.playType,equivalentPlayType:f,equivalentPlays:(0,n.getEquivalentPlays)(f),participants:i.participants,headline:i.headline,template:i.template,writeInDescription:i.writeInDescription,situation:i.situation})}});var e=(0,n.getEquivalentPlayTypeForPbpPlayType)(d.result.playType,d,u);return{atBat:d,equivalentPlayType:e,equivalentPlays:(0,n.getEquivalentPlays)(e),baseRunningEvents:s,containsBatterSubstitution:a}}return Ia.renderForPlayDetail=t,Ia}var ma={},Yd;function Sv(){if(Yd)return ma;Yd=1,Object.defineProperty(ma,"__esModule",{value:!0}),ma.ResultPlayEdit=void 0;var n=X,l=n.__importStar(Pe),t=n.__importStar(tr()),p=tr(),d=Kd(),y=Ge(),s=$i(),u;(function(v){v.ImplicitlyScores="implicitly_scores",v.NeedsManualAdvancement="needs_manual_advancement",v.PreviouslyManuallyScored="previously_manually_scored"})(u||(u={}));var h=function(){function v(){}return v.makeReplacementEvent=function(o,a,r,e){var i,c=(0,d.lookupMapForEvents)(e),f=(i=t.firstWithRoleToJS(r.participants,"batter"))===null||i===void 0?void 0:i.playerId;return d.EquivalentPlays.DOUBLE.includes(a)?this.getDoubleReplacementMetaEvent(c,o,f,a,r):d.EquivalentPlays.TRIPLE.includes(a)?this.getTripleReplacementMetaEvent(c,o,f,a,r):d.EquivalentPlays.HOMERUN.includes(a)?this.getHomerunReplacementMetaEvent(c,o,f,a,r):(0,s.makeEditGroupMetaEvent)([this.getSingleEventReplacementMetaEvent(c,o,f,a,r)])},v.getSingleEventReplacementMetaEvent=function(o,a,r,e,i){var c=o[a],f=v.makeEvents(c,e,r);if(f!==void 0){var _=v.getDeleteEventIds(c,i,o);return{id:(0,y.uuid4)(),code:"replace",deleteIds:_,events:f,compactorAttributes:{stream:"main"}}}},v.getRunnerResult=function(o,a){var r=a.initialSituation.bases;a.childEvents.length>0&&(r=a.childEvents[a.childEvents.length-1].situation.bases);var e=r[o];if(e!==void 0){var i=(0,p.firstParticipantWithIdToJS)(a.participants,e);if(i===void 0)throw"was not able to find participant record for ".concat(e);return{playerId:e,base:i.base,out:i.out,scored:i.scored}}},v.lastBaserunningEvent=function(o,a,r,e,i){var c=n.__spreadArray([],a.baseRunningOnPlayEvents,!0).reverse().find(function(_){var S=(0,p.firstWithRoleToJS)(_.participants,"runner");return _.eventId!==i&&S!==void 0&&S.playerId===o});if(c===void 0){if(e===void 0)return;throw"Could not find baserunning event for runner ".concat(o)}var f=r[c.eventId];if(f===void 0)throw"Could not find baserunning event ".concat(c.eventId," for runner ").concat(o);if(e!==void 0&&f.attributes.playType!==e)throw"BaserunningEvent had playType ".concat(f.attributes.playType," instead of expected ").concat(e);return f},v.lastBaserunningEventIdNotInvolvingBatter=function(o,a){var r=n.__spreadArray([],a.baseRunningOnPlayEvents,!0).reverse().find(function(e){var i=(0,p.firstWithRoleToJS)(e.participants,"runner");return i===void 0||i.playerId!==o});return r==null?void 0:r.eventId},v.getDoubleReplacementMetaEvent=function(o,a,r,e,i){var c=this.getRunnerResult(1,i),f=this.getRunnerResult(2,i),_=this.getRunnerResult(3,i),S=[],P=[];if(e===d.EquivalentPlayType.OtherAdvanceToSecond)throw"Can only change from an otherAdvanceToSecond. Changing to is not permitted.";if(e===d.EquivalentPlayType.Double){S.push(a),S.push.apply(S,i.baseRunningOnPlayEvents.map(function(D){return D.eventId}));var I=o[a];if(P.push(this.cloneBallInPlayEvent(I,I.attributes.playType,"double")),_!==void 0)if(_.base===3)P.push.apply(P,this.getEventsForRunnerAtThird({createdAt:I.createdAt,runnerResult:_,implicitEndingBase:4,baseEventsMap:o,atBat:i}));else{var E=this.getNewEventForRunnerAtHome({createdAt:I.createdAt,runnerResult:_,newRunnerState:u.ImplicitlyScores,baseEventsMap:o,atBat:i});E!==void 0&&P.push(E)}if(f!==void 0)if(f.base===3)P.push.apply(P,this.getEventsForRunnerAtThird({createdAt:I.createdAt,runnerResult:f,implicitEndingBase:4,baseEventsMap:o,atBat:i}));else{var E=this.getNewEventForRunnerAtHome({createdAt:I.createdAt,runnerResult:f,newRunnerState:u.ImplicitlyScores,baseEventsMap:o,atBat:i});E!==void 0&&P.push(E)}if(c!==void 0)if(c.base===3)P.push.apply(P,this.getEventsForRunnerAtThird({createdAt:I.createdAt,runnerResult:c,implicitEndingBase:3,baseEventsMap:o,atBat:i}));else{var E=this.getNewEventForRunnerAtHome({createdAt:I.createdAt,runnerResult:c,newRunnerState:u.PreviouslyManuallyScored,baseEventsMap:o,atBat:i});E!==void 0&&P.push(E)}return(0,s.makeEditGroupMetaEvent)([(0,s.makeReplaceMetaEvent)(S,P)])}else if(i.result.playType==="double"){S.push(a),S.push.apply(S,i.baseRunningOnPlayEvents.map(function(U){return U.eventId}));var I=o[a];if(P.push(this.cloneBallInPlayEvent(I,I.attributes.playType,(0,d.getBallInPlayResult)(e))),_!==void 0)if(_.base===3)P.push.apply(P,this.getEventsForRunnerAtThird({createdAt:I.createdAt,runnerResult:_,implicitEndingBase:4,baseEventsMap:o,atBat:i}));else{var E=this.getNewEventForRunnerAtHome({createdAt:I.createdAt,runnerResult:_,newRunnerState:u.ImplicitlyScores,baseEventsMap:o,atBat:i});E!==void 0&&P.push(E)}if(f!==void 0)if(f.base===3)P.push.apply(P,this.getEventsForRunnerAtThird({createdAt:I.createdAt,runnerResult:f,implicitEndingBase:3,baseEventsMap:o,atBat:i}));else{var E=this.getNewEventForRunnerAtHome({createdAt:I.createdAt,runnerResult:f,newRunnerState:u.NeedsManualAdvancement,baseEventsMap:o,atBat:i});E!==void 0&&P.push(E)}if(c!==void 0)if(c.base===3)P.push.apply(P,this.getEventsForRunnerAtThird({createdAt:I.createdAt,runnerResult:c,implicitEndingBase:2,baseEventsMap:o,atBat:i}));else{var E=this.getNewEventForRunnerAtHome({createdAt:I.createdAt,runnerResult:c,newRunnerState:u.PreviouslyManuallyScored,baseEventsMap:o,atBat:i});E!==void 0&&P.push(E)}return P.push(this.makeBaseRunningEvent({runnerId:r,base:2,playType:(0,d.getBaseRunningPlayType)(e),createdAt:I.createdAt})),(0,s.makeEditGroupMetaEvent)([(0,s.makeReplaceMetaEvent)(S,P)])}else{S.push(a),S.push.apply(S,this.getBaserunningEventIdsInvolvingPlayer(i,r));var I=o[a],B=this.cloneBallInPlayEvent(I,I.attributes.playType,(0,d.getBallInPlayResult)(e)),b=this.lastBaserunningEvent(r,i,o);if(b===void 0)throw"Could not find baserunnerEvent for ".concat(r,".");var R=this.getBaserunningEventToAdvanceBatter(r,e,2,o,i),F=this.lastBaserunningEventIdNotInvolvingBatter(r,i);if(F===void 0){var x=(0,s.makeReplaceMetaEvent)(S,[B,R]);return(0,s.makeEditGroupMetaEvent)([x])}else{var w=(0,s.makeReplaceMetaEvent)(S,[B]),L=(0,s.makeInsertAfterMetaEvent)(F,R);return(0,s.makeEditGroupMetaEvent)([w,L])}}},v.getEventsForRunnerAtThird=function(o){var a=o.createdAt,r=o.runnerResult,e=o.implicitEndingBase,i=o.baseEventsMap,c=o.atBat,f=[],_;if(r.out&&(_=this.lastBaserunningEvent(r.playerId,c,i,"out_on_last_play"),f.push(_)),e===4){var S=this.lastBaserunningEvent(r.playerId,c,i,void 0,_==null?void 0:_.id);S!==void 0&&S.attributes.playType==="remained_on_last_play"?f.unshift(S):f.unshift(this.makeRemainedOnLastPlay({base:3,runnerId:r.playerId,createdAt:a}))}else e===2&&(r.out||f.unshift(this.makeAdvancedOnLastPlay({base:3,runnerId:r.playerId,createdAt:a})));return f},v.getNewEventForRunnerAtHome=function(o){var a=o.createdAt,r=o.runnerResult,e=o.newRunnerState,i=o.baseEventsMap,c=o.atBat;if(r!==void 0){if(r.out)return this.lastBaserunningEvent(r.playerId,c,i,"out_on_last_play");if(r.scored)switch(e){case u.ImplicitlyScores:break;case u.NeedsManualAdvancement:return this.makeAdvancedOnLastPlay({base:4,runnerId:r.playerId,createdAt:a});case u.PreviouslyManuallyScored:var f=this.lastBaserunningEvent(r.playerId,c,i);if(f!==void 0&&f.attributes.base===4)return f;throw"Illegal state. runner supposedly scored, but could not find previousEvent at home."}else{var _=this.lastBaserunningEvent(r.playerId,c,i);if(_!==void 0&&_.attributes.playType==="did_not_score")return _;throw"Illegal state. runner was on ".concat(r.base," was safe and did not score.")}}},v.getTripleReplacementMetaEvent=function(o,a,r,e,i){var c=this.getRunnerResult(1,i),f=this.getRunnerResult(2,i),_=this.getRunnerResult(3,i),S=[],P=[];if(e===d.EquivalentPlayType.OtherAdvanceToThird)throw"Can only change from an otherAdvanceToThird. Changing to is not permitted.";if(e===d.EquivalentPlayType.Triple){S.push(a),S.push.apply(S,i.baseRunningOnPlayEvents.map(function(D){return D.eventId}));var I=o[a];P.push(this.cloneBallInPlayEvent(I,I.attributes.playType,"triple"));var E=this.getNewEventForRunnerAtHome({createdAt:I.createdAt,runnerResult:_,newRunnerState:u.ImplicitlyScores,baseEventsMap:o,atBat:i});return E!==void 0&&P.push(E),E=this.getNewEventForRunnerAtHome({createdAt:I.createdAt,runnerResult:f,newRunnerState:u.ImplicitlyScores,baseEventsMap:o,atBat:i}),E!==void 0&&P.push(E),E=this.getNewEventForRunnerAtHome({createdAt:I.createdAt,runnerResult:c,newRunnerState:u.ImplicitlyScores,baseEventsMap:o,atBat:i}),E!==void 0&&P.push(E),(0,s.makeEditGroupMetaEvent)([(0,s.makeReplaceMetaEvent)(S,P)])}else if(i.result.playType==="triple"){S.push(a),S.push.apply(S,i.baseRunningOnPlayEvents.map(function(U){return U.eventId}));var I=o[a];if(P.push(this.cloneBallInPlayEvent(I,I.attributes.playType,(0,d.getBallInPlayResult)(e))),e===d.EquivalentPlayType.DoublePlusError){var E=this.getNewEventForRunnerAtHome({createdAt:I.createdAt,runnerResult:_,newRunnerState:u.ImplicitlyScores,baseEventsMap:o,atBat:i});E!==void 0&&P.push(E),E=this.getNewEventForRunnerAtHome({createdAt:I.createdAt,runnerResult:f,newRunnerState:u.ImplicitlyScores,baseEventsMap:o,atBat:i}),E!==void 0&&P.push(E),E=this.getNewEventForRunnerAtHome({createdAt:I.createdAt,runnerResult:c,newRunnerState:u.NeedsManualAdvancement,baseEventsMap:o,atBat:i}),E!==void 0&&P.push(E)}else{var E=this.getNewEventForRunnerAtHome({createdAt:I.createdAt,runnerResult:_,newRunnerState:u.ImplicitlyScores,baseEventsMap:o,atBat:i});E!==void 0&&P.push(E),E=this.getNewEventForRunnerAtHome({createdAt:I.createdAt,runnerResult:f,newRunnerState:u.NeedsManualAdvancement,baseEventsMap:o,atBat:i}),E!==void 0&&P.push(E),E=this.getNewEventForRunnerAtHome({createdAt:I.createdAt,runnerResult:c,newRunnerState:u.NeedsManualAdvancement,baseEventsMap:o,atBat:i}),E!==void 0&&P.push(E)}return P.push(this.makeBaseRunningEvent({runnerId:r,base:3,playType:(0,d.getBaseRunningPlayType)(e),createdAt:I.createdAt})),(0,s.makeEditGroupMetaEvent)([(0,s.makeReplaceMetaEvent)(S,P)])}else if(i.result.playType==="double"){if(e===d.EquivalentPlayType.DoublePlusError){S.push.apply(S,this.getBaserunningEventIdsInvolvingPlayer(i,r));var B=this.lastBaserunningEvent(r,i,o);if(B===void 0)throw"Could not find baserunnerEvent for ".concat(r,".");var b=void 0;B.attributes.playType==="advanced_on_error"||B.attributes.playType==="on_same_error"?b=B:b=this.makeAdvancedOnError({base:3,runnerId:r,createdAt:B.createdAt});var R=(0,s.makeReplaceMetaEvent)(S,[b]);return(0,s.makeEditGroupMetaEvent)([R])}else{S.push(a),S.push.apply(S,i.baseRunningOnPlayEvents.map(function(G){return G.eventId}));var I=o[a];P.push(this.cloneBallInPlayEvent(I,I.attributes.playType,(0,d.getBallInPlayResult)(e)));var E=this.getNewEventForRunnerAtHome({createdAt:I.createdAt,runnerResult:_,newRunnerState:u.ImplicitlyScores,baseEventsMap:o,atBat:i});E!==void 0&&P.push(E),E=this.getNewEventForRunnerAtHome({createdAt:I.createdAt,runnerResult:f,newRunnerState:u.NeedsManualAdvancement,baseEventsMap:o,atBat:i}),E!==void 0&&P.push(E),E=this.getNewEventForRunnerAtHome({createdAt:I.createdAt,runnerResult:c,newRunnerState:u.PreviouslyManuallyScored,baseEventsMap:o,atBat:i}),E!==void 0&&P.push(E),P.push(this.getBaserunningEventToAdvanceBatter(r,e,3,o,i))}return(0,s.makeEditGroupMetaEvent)([(0,s.makeReplaceMetaEvent)(S,P)])}else if(e===d.EquivalentPlayType.DoublePlusError){S.push(a),S.push.apply(S,i.baseRunningOnPlayEvents.map(function(G){return G.eventId}));var I=o[a];P.push(this.cloneBallInPlayEvent(I,I.attributes.playType,(0,d.getBallInPlayResult)(e)));var E=this.getNewEventForRunnerAtHome({createdAt:I.createdAt,runnerResult:_,newRunnerState:u.ImplicitlyScores,baseEventsMap:o,atBat:i});return E!==void 0&&P.push(E),E=this.getNewEventForRunnerAtHome({createdAt:I.createdAt,runnerResult:f,newRunnerState:u.ImplicitlyScores,baseEventsMap:o,atBat:i}),E!==void 0&&P.push(E),E=this.getNewEventForRunnerAtHome({createdAt:I.createdAt,runnerResult:c,newRunnerState:u.PreviouslyManuallyScored,baseEventsMap:o,atBat:i}),E!==void 0&&P.push(E),P.push(this.getBaserunningEventToAdvanceBatter(r,e,3,o,i)),(0,s.makeEditGroupMetaEvent)([(0,s.makeReplaceMetaEvent)(S,P)])}else{S.push(a),S.push.apply(S,this.getBaserunningEventIdsInvolvingPlayer(i,r));var I=o[a],F=this.cloneBallInPlayEvent(I,I.attributes.playType,(0,d.getBallInPlayResult)(e)),B=this.lastBaserunningEvent(r,i,o);if(B===void 0)throw"Could not find baserunnerEvent for ".concat(r,".");var b=this.getBaserunningEventToAdvanceBatter(r,e,3,o,i),x=this.lastBaserunningEventIdNotInvolvingBatter(r,i);if(x===void 0){var R=(0,s.makeReplaceMetaEvent)(S,[F,b]);return(0,s.makeEditGroupMetaEvent)([R])}else{var w=(0,s.makeReplaceMetaEvent)(S,[F]),L=(0,s.makeInsertAfterMetaEvent)(x,b);return(0,s.makeEditGroupMetaEvent)([w,L])}}},v.getHomerunReplacementMetaEvent=function(o,a,r,e,i){var c=this.getRunnerResult(1,i),f=this.getRunnerResult(2,i),_=this.getRunnerResult(3,i),S=[],P=[];if(e===d.EquivalentPlayType.OtherAdvanceToHome)throw"Can only change from an otherAdvanceToHome. Changing to is not permitted.";if(e===d.EquivalentPlayType.InsideTheParkHomerun){S.push(a),S.push.apply(S,i.baseRunningOnPlayEvents.map(function(U){return U.eventId}));var I=o[a],E=this.cloneBallInPlayEvent(I,I.attributes.playType,"home_run");E.attributes.hrLocation="in_the_park",P.push(E);var B=this.getNewEventForRunnerAtHome({createdAt:I.createdAt,runnerResult:_,newRunnerState:u.ImplicitlyScores,baseEventsMap:o,atBat:i});return B!==void 0&&P.push(B),B=this.getNewEventForRunnerAtHome({createdAt:I.createdAt,runnerResult:f,newRunnerState:u.ImplicitlyScores,baseEventsMap:o,atBat:i}),B!==void 0&&P.push(B),B=this.getNewEventForRunnerAtHome({createdAt:I.createdAt,runnerResult:c,newRunnerState:u.ImplicitlyScores,baseEventsMap:o,atBat:i}),B!==void 0&&P.push(B),(0,s.makeEditGroupMetaEvent)([(0,s.makeReplaceMetaEvent)(S,P)])}else if(i.result.playType==="home_run"){S.push(a),S.push.apply(S,i.baseRunningOnPlayEvents.map(function(G){return G.eventId}));var I=o[a];if(P.push(this.cloneBallInPlayEvent(I,I.attributes.playType,(0,d.getBallInPlayResult)(e))),e===d.EquivalentPlayType.TriplePlusError){var B=this.getNewEventForRunnerAtHome({createdAt:I.createdAt,runnerResult:_,newRunnerState:u.ImplicitlyScores,baseEventsMap:o,atBat:i});B!==void 0&&P.push(B),B=this.getNewEventForRunnerAtHome({createdAt:I.createdAt,runnerResult:f,newRunnerState:u.ImplicitlyScores,baseEventsMap:o,atBat:i}),B!==void 0&&P.push(B),B=this.getNewEventForRunnerAtHome({createdAt:I.createdAt,runnerResult:c,newRunnerState:u.ImplicitlyScores,baseEventsMap:o,atBat:i}),B!==void 0&&P.push(B)}else if(e===d.EquivalentPlayType.DoublePlusTwoBaseError){var B=this.getNewEventForRunnerAtHome({createdAt:I.createdAt,runnerResult:_,newRunnerState:u.ImplicitlyScores,baseEventsMap:o,atBat:i});B!==void 0&&P.push(B),B=this.getNewEventForRunnerAtHome({createdAt:I.createdAt,runnerResult:f,newRunnerState:u.ImplicitlyScores,baseEventsMap:o,atBat:i}),B!==void 0&&P.push(B),B=this.getNewEventForRunnerAtHome({createdAt:I.createdAt,runnerResult:c,newRunnerState:u.NeedsManualAdvancement,baseEventsMap:o,atBat:i}),B!==void 0&&P.push(B)}else{var B=this.getNewEventForRunnerAtHome({createdAt:I.createdAt,runnerResult:_,newRunnerState:u.ImplicitlyScores,baseEventsMap:o,atBat:i});B!==void 0&&P.push(B),B=this.getNewEventForRunnerAtHome({createdAt:I.createdAt,runnerResult:f,newRunnerState:u.NeedsManualAdvancement,baseEventsMap:o,atBat:i}),B!==void 0&&P.push(B),B=this.getNewEventForRunnerAtHome({createdAt:I.createdAt,runnerResult:c,newRunnerState:u.NeedsManualAdvancement,baseEventsMap:o,atBat:i}),B!==void 0&&P.push(B)}return P.push(this.makeBaseRunningEvent({runnerId:r,base:4,playType:(0,d.getBaseRunningPlayType)(e),createdAt:I.createdAt})),(0,s.makeEditGroupMetaEvent)([(0,s.makeReplaceMetaEvent)(S,P)])}else if(i.result.playType==="triple"){if(e===d.EquivalentPlayType.TriplePlusError){S.push.apply(S,this.getBaserunningEventIdsInvolvingPlayer(i,r));var b=this.lastBaserunningEvent(r,i,o);if(b===void 0)throw"Could not find baserunnerEvent for ".concat(r,".");var R=void 0;b.attributes.playType==="advanced_on_error"||b.attributes.playType==="on_same_error"?R=b:R=this.makeAdvancedOnError({base:4,runnerId:r,createdAt:b.createdAt});var F=(0,s.makeReplaceMetaEvent)(S,[R]);return(0,s.makeEditGroupMetaEvent)([F])}else if(e===d.EquivalentPlayType.DoublePlusTwoBaseError){S.push(a),S.push.apply(S,i.baseRunningOnPlayEvents.map(function(q){return q.eventId}));var I=o[a];P.push(this.cloneBallInPlayEvent(I,I.attributes.playType,(0,d.getBallInPlayResult)(e)));var B=this.getNewEventForRunnerAtHome({createdAt:I.createdAt,runnerResult:_,newRunnerState:u.ImplicitlyScores,baseEventsMap:o,atBat:i});B!==void 0&&P.push(B),B=this.getNewEventForRunnerAtHome({createdAt:I.createdAt,runnerResult:f,newRunnerState:u.ImplicitlyScores,baseEventsMap:o,atBat:i}),B!==void 0&&P.push(B),B=this.getNewEventForRunnerAtHome({createdAt:I.createdAt,runnerResult:c,newRunnerState:u.NeedsManualAdvancement,baseEventsMap:o,atBat:i}),B!==void 0&&P.push(B),P.push(this.getBaserunningEventToAdvanceBatter(r,e,4,o,i))}else{S.push(a),S.push.apply(S,i.baseRunningOnPlayEvents.map(function(q){return q.eventId}));var I=o[a];P.push(this.cloneBallInPlayEvent(I,I.attributes.playType,(0,d.getBallInPlayResult)(e)));var B=this.getNewEventForRunnerAtHome({createdAt:I.createdAt,runnerResult:_,newRunnerState:u.ImplicitlyScores,baseEventsMap:o,atBat:i});B!==void 0&&P.push(B),B=this.getNewEventForRunnerAtHome({createdAt:I.createdAt,runnerResult:f,newRunnerState:u.NeedsManualAdvancement,baseEventsMap:o,atBat:i}),B!==void 0&&P.push(B),B=this.getNewEventForRunnerAtHome({createdAt:I.createdAt,runnerResult:c,newRunnerState:u.NeedsManualAdvancement,baseEventsMap:o,atBat:i}),B!==void 0&&P.push(B),P.push(this.getBaserunningEventToAdvanceBatter(r,e,4,o,i))}return(0,s.makeEditGroupMetaEvent)([(0,s.makeReplaceMetaEvent)(S,P)])}else if(i.result.playType==="double"){if(e===d.EquivalentPlayType.TriplePlusError){S.push(a),S.push.apply(S,i.baseRunningOnPlayEvents.map(function(q){return q.eventId}));var I=o[a];P.push(this.cloneBallInPlayEvent(I,I.attributes.playType,(0,d.getBallInPlayResult)(e)));var B=this.getNewEventForRunnerAtHome({createdAt:I.createdAt,runnerResult:_,newRunnerState:u.ImplicitlyScores,baseEventsMap:o,atBat:i});B!==void 0&&P.push(B),B=this.getNewEventForRunnerAtHome({createdAt:I.createdAt,runnerResult:f,newRunnerState:u.ImplicitlyScores,baseEventsMap:o,atBat:i}),B!==void 0&&P.push(B),B=this.getNewEventForRunnerAtHome({createdAt:I.createdAt,runnerResult:c,newRunnerState:u.ImplicitlyScores,baseEventsMap:o,atBat:i}),B!==void 0&&P.push(B),P.push(this.getBaserunningEventToAdvanceBatter(r,e,4,o,i))}else if(e===d.EquivalentPlayType.DoublePlusTwoBaseError){S.push.apply(S,this.getBaserunningEventIdsInvolvingPlayer(i,r));var b=this.lastBaserunningEvent(r,i,o);if(b===void 0)throw"Could not find baserunnerEvent for ".concat(r,".");var R=void 0;b.attributes.playType==="advanced_on_error"||b.attributes.playType==="on_same_error"?R=b:R=this.makeAdvancedOnError({base:4,runnerId:r,createdAt:b.createdAt});var F=(0,s.makeReplaceMetaEvent)(S,[R]);return(0,s.makeEditGroupMetaEvent)([F])}else{S.push(a),S.push.apply(S,i.baseRunningOnPlayEvents.map(function(q){return q.eventId}));var I=o[a];P.push(this.cloneBallInPlayEvent(I,I.attributes.playType,(0,d.getBallInPlayResult)(e)));var B=this.getNewEventForRunnerAtHome({createdAt:I.createdAt,runnerResult:_,newRunnerState:u.ImplicitlyScores,baseEventsMap:o,atBat:i});B!==void 0&&P.push(B),B=this.getNewEventForRunnerAtHome({createdAt:I.createdAt,runnerResult:f,newRunnerState:u.NeedsManualAdvancement,baseEventsMap:o,atBat:i}),B!==void 0&&P.push(B),B=this.getNewEventForRunnerAtHome({createdAt:I.createdAt,runnerResult:c,newRunnerState:u.PreviouslyManuallyScored,baseEventsMap:o,atBat:i}),B!==void 0&&P.push(B),P.push(this.getBaserunningEventToAdvanceBatter(r,e,4,o,i))}return(0,s.makeEditGroupMetaEvent)([(0,s.makeReplaceMetaEvent)(S,P)])}else if(e===d.EquivalentPlayType.TriplePlusError){S.push(a),S.push.apply(S,i.baseRunningOnPlayEvents.map(function(q){return q.eventId}));var I=o[a];P.push(this.cloneBallInPlayEvent(I,I.attributes.playType,(0,d.getBallInPlayResult)(e)));var B=this.getNewEventForRunnerAtHome({createdAt:I.createdAt,runnerResult:_,newRunnerState:u.ImplicitlyScores,baseEventsMap:o,atBat:i});return B!==void 0&&P.push(B),B=this.getNewEventForRunnerAtHome({createdAt:I.createdAt,runnerResult:f,newRunnerState:u.ImplicitlyScores,baseEventsMap:o,atBat:i}),B!==void 0&&P.push(B),B=this.getNewEventForRunnerAtHome({createdAt:I.createdAt,runnerResult:c,newRunnerState:u.ImplicitlyScores,baseEventsMap:o,atBat:i}),B!==void 0&&P.push(B),P.push(this.getBaserunningEventToAdvanceBatter(r,e,4,o,i)),(0,s.makeEditGroupMetaEvent)([(0,s.makeReplaceMetaEvent)(S,P)])}else if(e===d.EquivalentPlayType.DoublePlusTwoBaseError){S.push(a),S.push.apply(S,i.baseRunningOnPlayEvents.map(function(q){return q.eventId}));var I=o[a];P.push(this.cloneBallInPlayEvent(I,I.attributes.playType,(0,d.getBallInPlayResult)(e)));var B=this.getNewEventForRunnerAtHome({createdAt:I.createdAt,runnerResult:_,newRunnerState:u.ImplicitlyScores,baseEventsMap:o,atBat:i});return B!==void 0&&P.push(B),B=this.getNewEventForRunnerAtHome({createdAt:I.createdAt,runnerResult:f,newRunnerState:u.ImplicitlyScores,baseEventsMap:o,atBat:i}),B!==void 0&&P.push(B),B=this.getNewEventForRunnerAtHome({createdAt:I.createdAt,runnerResult:c,newRunnerState:u.PreviouslyManuallyScored,baseEventsMap:o,atBat:i}),B!==void 0&&P.push(B),P.push(this.getBaserunningEventToAdvanceBatter(r,e,4,o,i)),(0,s.makeEditGroupMetaEvent)([(0,s.makeReplaceMetaEvent)(S,P)])}else{S.push(a),S.push.apply(S,this.getBaserunningEventIdsInvolvingPlayer(i,r));var I=o[a],x=this.cloneBallInPlayEvent(I,I.attributes.playType,(0,d.getBallInPlayResult)(e)),R=this.getBaserunningEventToAdvanceBatter(r,e,4,o,i),w=this.lastBaserunningEventIdNotInvolvingBatter(r,i);if(w===void 0){var F=(0,s.makeReplaceMetaEvent)(S,[x,R]);return(0,s.makeEditGroupMetaEvent)([F])}else{var L=(0,s.makeReplaceMetaEvent)(S,[x]),D=(0,s.makeInsertAfterMetaEvent)(w,R);return(0,s.makeEditGroupMetaEvent)([L,D])}}},v.getBaserunningEventToAdvanceBatter=function(o,a,r,e,i){var c=this.lastBaserunningEvent(o,i,e);if(c===void 0)throw"Could not find baserunnerEvent for ".concat(o,".");var f;switch(a){case d.EquivalentPlayType.TriplePlusError:case d.EquivalentPlayType.DoublePlusTwoBaseError:case d.EquivalentPlayType.SinglePlusThreeBaseError:case d.EquivalentPlayType.FieldersChoicePlusThreeBaseError:case d.EquivalentPlayType.DoublePlusError:case d.EquivalentPlayType.SinglePlusTwoBaseError:case d.EquivalentPlayType.FieldersChoicePlusTwoBaseError:case d.EquivalentPlayType.SinglePlusError:case d.EquivalentPlayType.FieldersChoicePlusError:c.attributes.playType==="advanced_on_error"?f=c:f=this.makeAdvancedOnError({base:r,runnerId:o,createdAt:c.createdAt});break;case d.EquivalentPlayType.FourBaseError:case d.EquivalentPlayType.ThreeBaseError:case d.EquivalentPlayType.TwoBaseError:c.attributes.playType==="on_same_error"?f=c:f=this.makeAdvancedOnSameError({base:r,runnerId:o,createdAt:c.createdAt});break;default:throw"Cannot change to ".concat(a," at this point. Should have been taken care of earlier.")}return f},v.getDeleteEventIds=function(o,a,r){if(o.code==="ball_in_play"){var e=(0,d.getSacBuntWithOutEvent)(a,r);if(e!==void 0)return[o.id,e.id]}return[o.id]},v.getBaserunningEventIdsInvolvingPlayer=function(o,a){return o.baseRunningOnPlayEvents.filter(function(r){return(0,p.firstParticipantWithIdToJS)(r.participants,a)!==void 0}).map(function(r){return r.eventId})},v.makeEvents=function(o,a,r){switch(o.code){case"ball_in_play":return v.makeBallInPlayReplacement(o,a,r);case"base_running":return v.makeBaseRunningReplacement(o,a);default:return}},v.makeBallInPlayReplacement=function(o,a,r){var e=(0,d.getBallInPlayResult)(a);if(e!==void 0){var i=(0,d.getEquivalentPlays)(a),c=o.attributes.playResult;if(!(c===e||!l.contains(i,a)))switch(a){case d.EquivalentPlayType.Single:case d.EquivalentPlayType.Error:case d.EquivalentPlayType.FieldersChoice:return[v.cloneBallInPlayEvent(o,o.attributes.playType,e)];case d.EquivalentPlayType.GroundOut:return[v.cloneBallInPlayEvent(o,"ground_ball",e)];case d.EquivalentPlayType.SacBuntBatterOut:return[v.cloneBallInPlayEvent(o,"bunt",e),v.makeOutOnLastPlayEventAtFirst({batter:r,createdAt:o.createdAt})];default:return}}},v.cloneBallInPlayEvent=function(o,a,r){return{id:(0,y.uuid4)(),code:"ball_in_play",createdAt:o.createdAt,attributes:{playType:a,playResult:r,defenders:o.attributes.defenders,playFlavor:o.attributes.playFlavor,ballWasCaught:o.attributes.ballWasCaught}}},v.makeBaseRunningEvent=function(o){var a=o.runnerId,r=o.base,e=o.playType,i=o.createdAt;return{id:(0,y.uuid4)(),code:"base_running",createdAt:i,attributes:{base:r,defenders:[],playType:e,runnerId:a}}},v.makeOutOnLastPlayEventAtFirst=function(o){var a=o.batter,r=o.createdAt;return this.makeBaseRunningEvent({runnerId:a,base:1,playType:"out_on_last_play",createdAt:r})},v.makeAdvancedOnLastPlay=function(o){var a=o.base,r=o.runnerId,e=o.createdAt;return this.makeBaseRunningEvent({runnerId:r,base:a,playType:"advanced_on_last_play",createdAt:e})},v.makeRemainedOnLastPlay=function(o){var a=o.base,r=o.runnerId,e=o.createdAt;return this.makeBaseRunningEvent({runnerId:r,base:a,playType:"remained_on_last_play",createdAt:e})},v.makeAdvancedOnError=function(o){var a=o.base,r=o.runnerId,e=o.createdAt;return this.makeBaseRunningEvent({runnerId:r,base:a,playType:"advanced_on_error",createdAt:e})},v.makeAdvancedOnSameError=function(o){var a=o.base,r=o.runnerId,e=o.createdAt;return this.makeBaseRunningEvent({runnerId:r,base:a,playType:"on_same_error",createdAt:e})},v.makeBaseRunningReplacement=function(o,a){var r=(0,d.getBaseRunningPlayType)(a);if(r!==void 0){var e=(0,d.getEquivalentPlays)(a),i=o.attributes.playType;if(!(i===r||!l.contains(e,a)))return[{id:(0,y.uuid4)(),code:"base_running",createdAt:o.createdAt,attributes:{playType:r,playFlavor:o.attributes.playFlavor,base:o.attributes.base,runnerId:o.attributes.runnerId,defenders:o.attributes.defenders}}]}},v}();return ma.ResultPlayEdit=h,ma}var So={},ba={},Qd;function Xd(){if(Qd)return ba;Qd=1,Object.defineProperty(ba,"__esModule",{value:!0}),ba.asTuple=void 0;var n=function(l){return l};return ba.asTuple=n,ba}var Zd;function Pv(){return Zd||(Zd=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.calculateGameResult=n.Frame=n.prepareStats=n.prepareScore=n.generateFrameEnd=n.generateLineup=n.generateGameState=n.generateBatterIntro=n.generateInningEnd=n.generateGameEnd=n.generateInningIntro=n.generateGameIntro=n.generateScore=n.generateSituation=n.generateCount=n.generateAnnouncements=void 0;var l=X,t=l.__importStar(Wi()),p=l.__importStar(Pe),d=l.__importStar(gd()),y=Xd(),s=Fr();function u(b){return{count:h(b),situation:v(b),score:o(b)+".",gameIntro:a(b),inningIntro:r(b),gameEnd:e(b),inningEnd:i(b),batterIntro:c(b),gameState:f(b)}}n.generateAnnouncements=u;function h(b){var R=b.balls===0?"oh":b.balls.toString(),F=b.strikes===0?"oh":b.strikes.toString();return"The count is ".concat(R," and ").concat(F,".")}n.generateCount=h;function v(b){var R=b.runnersOnBase===0?"The bases are empty":"".concat(b.runnersOnBase," on"),F=b.outs===0?"no-one out":"".concat(b.outs," out");return"".concat(R,", ").concat(F,".")}n.generateSituation=v;function o(b){var R=(0,n.prepareScore)(b);return"".concat(R[0].stub,", ").concat(R[0].runs,"; ").concat(R[1].stub,", ").concat(R[1].runs)}n.generateScore=o;function a(b){var R=t.stubbify(b.awayTeamId),F=t.stubbify(b.homeTeamId);return"Top of the 1st, it's ".concat(R," vs. ").concat(F,".")}n.generateGameIntro=a;function r(b){var R=b.half,F=t.ordinalNumber(b.inning),x=o(b);return"It's the ".concat(R," of the ").concat(F,", ").concat(x,".")}n.generateInningIntro=r;function e(b){var R=(0,n.calculateGameResult)(b)==="tie",F=p.sortBy((0,n.prepareScore)(b),function(x){return-1*x.runs});return R?"That's the end of the game, ".concat(F[0].stub," and ").concat(F[1].stub," tie ").concat(F[0].runs," to ").concat(F[1].runs,"."):"That's the end of the game, ".concat(F[0].stub," get the win over ").concat(F[1].stub," ").concat(F[0].runs," to ").concat(F[1].runs,".")}n.generateGameEnd=e;function i(b){var R=new E(b.inning,b.half).predecessor;if(!d.maybeIsSet(R))return"";var F=d.valueFromMaybe(R),x=[S(F,b),o(b),_(b)];return p.compact(x).join("; ")+"."}n.generateInningEnd=i;function c(b){var R=b.currentBatter;if(R.playerId===void 0)return"";var F="".concat(t.stubbify(R.playerId)," steps up to the plate");if(R.statAtBats!==void 0){var x=R.statHits===0?"oh":R.statHits.toString(),w=R.statAtBats===0?"oh":R.statAtBats.toString();F+=", they're ".concat(x," for ").concat(w," today")}return F+"."}n.generateBatterIntro=c;function f(b){var R=r(b);return b.currentBatter&&b.currentBatter.playerId&&(R+=" ".concat(t.stubbify(b.currentBatter.playerId)," is at bat.")),b.currentPitcherId&&(R+=" ".concat(t.stubbify(b.currentPitcherId)," pitching;")),R+=" "+v(b),R}n.generateGameState=f;function _(b){if(b.nextBatters.indexOf(void 0)>-1)return"";var R=t.stubbify(b.half==="top"?b.awayTeamId:b.homeTeamId),F=t.stubbify(b.nextBatters[0]),x=t.stubbify(b.nextBatters[1]),w=t.stubbify(b.nextBatters[2]);return"Leading off for ".concat(R," will be ").concat(F,", then ").concat(x,", then ").concat(w)}n.generateLineup=_;function S(b,R){var F=t.ordinalNumber(b.inning),x=I(b,R),w=t.pluralSuffix(x.runs,"run"),L=t.pluralSuffix(x.hits,"hit"),D=t.pluralSuffix(x.errors,"error");return"That ends the ".concat(b.half," of the ").concat(F,"; ").concat(w,", ").concat(L,", ").concat(D)}n.generateFrameEnd=S;var P=function(b){return(0,y.asTuple)([{stub:t.stubbify(b.awayTeamId),runs:b.scores[b.awayTeamId]},{stub:t.stubbify(b.homeTeamId),runs:b.scores[b.homeTeamId]}])};n.prepareScore=P;function I(b,R){var F=R.stats||{},x=function(w,L){var D=(0,s.xor)(w==="offense",b.half==="top")?R.homeTeamId:R.awayTeamId,U=(F[D]||{})[w]||{},G=U[b.inning-1]||{};return G[L]||0};return{runs:x("offense","runs"),hits:x("offense","hits"),errors:x("defense","errors")}}n.prepareStats=I;var E=function(){function b(R,F){this.inning=R,this.half=F}return Object.defineProperty(b.prototype,"predecessor",{get:function(){return this.half==="top"&&this.inning>1?d.maybeWithValue(new b(this.inning-1,"bottom")):this.half==="bottom"?d.maybeWithValue(new b(this.inning,"top")):d.unsetMaybe()},enumerable:!1,configurable:!0}),b}();n.Frame=E;var B=function(b){var R=b.scores[b.homeTeamId]-b.scores[b.awayTeamId];return R===0?"tie":R>0?"homeWin":"homeLoss"};n.calculateGameResult=B}(So)),So}var ef;function Iv(){if(ef)return Pa;ef=1,Object.defineProperty(Pa,"__esModule",{value:!0}),Pa.StateAccessor=void 0;var n=X,l=n.__importStar(Pe),t=n.__importStar(gt()),p=_v(),d=Sv(),y=Pv(),s=io(),u=function(h){n.__extends(v,h);function v(o,a){var r=h.call(this,o,a)||this;return r.controller=a,r}return Object.defineProperty(v.prototype,"inputContext",{get:function(){return this.controller.context},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"scores",{get:function(){return this.get("scores",this.controller.baserunners)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"strikes",{get:function(){return this.get("strikes",this.controller.situation)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"balls",{get:function(){return this.get("balls",this.controller.situation)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"outs",{get:function(){return this.get("outs",this.controller.situation)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"atBatTeamId",{get:function(){return this.get("atBatTeamId",this.controller.situation)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"inFieldTeamId",{get:function(){return this.get("inFieldTeamId",this.controller.situation)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"inning",{get:function(){return this.get("inning",this.controller.situation)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"half",{get:function(){return this.get("half",this.controller.situation)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"baserunners",{get:function(){return this.get("baserunners",this.controller.baserunners)},enumerable:!1,configurable:!0}),v.prototype.currentBatter=function(o){return this.call("currentBatter",[o],this.controller.lineup)},v.prototype.lineupIndexOfPlayer=function(o,a){return this.call("indexOfPlayer",[o,a],this.controller.lineup)},v.prototype.playerForPosition=function(o,a){return this.call("playerForPosition",[o,a],this.controller.fielders)},v.prototype.playerStat=function(o,a,r,e,i){return i===void 0&&(i=!0),this.call("playerStat",[o,a,r,e,i],this.controller.stats)},v.prototype.teamStat=function(o,a,r,e){return e===void 0&&(e=!0),this.call("teamStat",[o,a,r,e],this.controller.stats)},v.prototype.pitchingStatsPerInning=function(o,a){var r=this.fullPerInningStats[o];return r===void 0?[]:r.defense.map(function(e){return e.pitchers[a]})},Object.defineProperty(v.prototype,"currentFieldSituation",{get:function(){var o=this.call("currentBatter",[this.atBatTeamId],this.controller.lineup),a=this.call("positionsMapForTeam",[this.inFieldTeamId],this.controller.fielders).P,r=this.playerStat(this.inFieldTeamId,a,"defense","#P",!1)||0,e=this.playerStat(this.inFieldTeamId,a,"defense","IP",!0)||0,i=this.call("statsForInning",[this.currentGameSituation.inning],this.controller.perInning),c=i[this.inFieldTeamId].defense,f=c?c.pitchers[a]:void 0,_=f?f.pitches:0,S=this.playerStat(this.atBatTeamId,o,"offense","AB",!1)||0,P=this.playerStat(this.atBatTeamId,o,"offense","H",!1)||0,I=this.get("lastPitchDetail",this.controller.situation);return{batter:o,baserunners:this.get("baserunners",this.controller.baserunners),fielders:this.call("positionsMapForTeam",[this.inFieldTeamId],this.controller.fielders),atBatTeamId:this.atBatTeamId,inFieldTeamId:this.inFieldTeamId,stats:{batter:{atBats:S,hits:P},pitcher:{cumulativePitches:r,currentInningPitches:_,inningsPitched:e,lastPitchDetail:I}}}},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"allStats",{get:function(){return this.get("rendered",this.controller.stats).teams},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"payloadForGameAccount",{get:function(){var o={};return this.inFieldTeamId!==""&&(o[this.inFieldTeamId]=this.boxscoreSituation(this.inFieldTeamId)),this.atBatTeamId!==""&&(o[this.atBatTeamId]=this.boxscoreSituation(this.atBatTeamId)),{stats:this.get("pivotStatsForOutput",this.controller.stats),sportSpecificData:{pitchData:this.get("pitchData",this.controller.pitchData),sprayChartsData:this.call("fullSprayChartData",[],this.controller.sprayChart),linescore:this.linescoreWithStatTotals,boxscoreTeams:o,currentState:{batter:this.currentBatter(this.atBatTeamId),pitcher:this.playerForPosition(this.inFieldTeamId,"P"),inning:this.inning,inningHalf:this.half,baserunners:this.baserunners,scores:this.scores,balls:this.balls,strikes:this.strikes,outs:this.outs}}}},enumerable:!1,configurable:!0}),v.prototype.gameStatsForTeam=function(o){return this.get("statsForOutput",this.controller.stats)[o]},v.prototype.sprayChartDataForTeam=function(o){return this.call("sprayChartDataForTeam",[o],this.controller.sprayChart)},Object.defineProperty(v.prototype,"fullSprayCharts",{get:function(){return this.call("fullSprayChartData",[],this.controller.sprayChart)},enumerable:!1,configurable:!0}),v.prototype.playerSprayChart=function(o,a,r){return{atBats:this.call("completedAtBatsForBatter",[o],this.controller.playByPlay),ballsInPlay:this.call("sprayChartDataForPlayer",[a,o,r],this.controller.sprayChart)}},Object.defineProperty(v.prototype,"currentGameSituation",{get:function(){return{inning:this.inning,inningHalf:this.half,baserunners:this.baserunners,scores:this.scores,balls:this.balls,strikes:this.strikes,outs:this.outs,atBatTeamId:this.get("atBatTeamId",this.controller.situation),batters:this.call("positionsMapForTeam",[this.atBatTeamId],this.controller.fielders),remainingOuts:3-this.outs}},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"currentGameSituationAsPlayByPlaySituationRecord",{get:function(){return{inning:this.inning,half:this.half,balls:this.balls,strikes:this.strikes,outs:this.outs,bases:this.get("baserunners",this.controller.baserunners),homeScore:this.scores[this.get("homeId",this.controller.situation)],awayScore:this.scores[this.get("awayId",this.controller.situation)]}},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"linescore",{get:function(){return this.get("linescore",this.controller.perInning)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"fullPerInningStats",{get:function(){return this.get("fullPerInningStats",this.controller.perInning)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"linescoreWithStatTotals",{get:function(){for(var o=this.get("linescore",this.controller.perInning),a=this.get("summedPerInningStats",this.controller.perInning),r={},e=0,i=l.keys(o);e<i.length;e++){var c=i[e];r[c]={runsPerInning:o[c],totalRuns:a[c].totalRuns,totalHits:a[c].totalHits,totalErrors:a[c].totalErrors}}return r},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"fullAnnotatedAtBats",{get:function(){return this.get("completedAnnotatedAtBats",this.controller.playByPlay)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"fullPlayByPlay",{get:function(){return{completedAtBats:this.get("completedAtBats",this.controller.playByPlay),currentAtBat:this.get("currentAtBat",this.controller.playByPlay),currentBatter:this.call("currentBatter",[this.atBatTeamId],this.controller.lineup)}},enumerable:!1,configurable:!0}),v.prototype.partialPlayByPlay=function(o){return{recentCompletedAtBats:this.call("recentCompletedAtBats",[o],this.controller.playByPlay),currentAtBat:this.get("currentAtBat",this.controller.playByPlay)}},Object.defineProperty(v.prototype,"aggregateInningTransitionData",{get:function(){return{lineups:this.fullLineups,stats:this.allStats,atBatTeamId:this.atBatTeamId}},enumerable:!1,configurable:!0}),v.prototype.possiblyMutatedAtBats=function(o){return this.call("possiblyMutatedAtBats",[o],this.controller.playByPlay)},v.prototype.possiblyMutatedAtBatsWithPerInningStats=function(o){return{possiblyMutatedAtBats:this.call("possiblyMutatedAtBats",[o],this.controller.playByPlay),fullPerInningStats:this.get("fullPerInningStats",this.controller.perInning)}},v.prototype.completedAtBat=function(o){return this.call("completedAtBatAtIndex",[o],this.controller.playByPlay)},v.prototype.completedAtBatContainingEvent=function(o){return this.call("completedAtBatContainingEvent",[o],this.controller.playByPlay)},v.prototype.atBatContainingEvent=function(o){return this.call("atBatContainingEvent",[o],this.controller.playByPlay)},v.prototype.nextCompletedAtBatAfterEvent=function(o){var a=this.completedAtBatContainingEvent(o);return a?this.completedAtBat(a.index+1):void 0},Object.defineProperty(v.prototype,"positionsMap",{get:function(){return this.get("positionsMap",this.controller.fielders)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"fullLineups",{get:function(){return this.get("fullLineups",this.controller.lineup)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"dhsMap",{get:function(){return this.get("dhsMap",this.controller.lineup)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"dpFlexMap",{get:function(){return this.get("dpFlexMap",this.controller.lineup)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"scorekeepingState",{get:function(){return{gameSituation:this.currentGameSituation,fieldSituation:this.currentFieldSituation,lineups:this.fullLineups,fielders:this.positionsMap,dhs:this.dhsMap,dpFlex:this.dpFlexMap,scoredOnLastEvent:this.get("runnersScoredOnLastEvent",this.controller.baserunners),homeTeamId:this.get("homeId",this.controller.situation),awayTeamId:this.get("awayId",this.controller.situation),pitchActionContext:this.pitchActionContext,lastEventInfo:{endedInningHalf:this.get("lastEventEndedInning",this.controller.situation)}}},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"pitchActionContext",{get:function(){return this.call("pitchActionContext",[this.controller.context,this.controller.situation,this.controller.baserunners],this.controller.actionContext)},enumerable:!1,configurable:!0}),v.prototype.runnerSafeActionContext=function(o,a){return this.call("runnerSafeActionContext",[this.controller.outputStream(),this.controller.situation,this.controller.baserunners,o,a],this.controller.actionContext)},v.prototype.runnerOutActionContext=function(o,a){return this.call("runnerOutActionContext",[this.controller.outputStream(),this.controller.baserunners,o,a],this.controller.actionContext)},v.prototype.inningStats=function(o){return this.call("statsForInning",[o],this.controller.perInning)},v.prototype.boxscoreSituation=function(o){var a=this.call("fielderHistory",[o],this.controller.history);for(var r in a)a.hasOwnProperty(r)&&(a[r]=l.pluck(a[r],"position"));var e=this.call("playerOrderForBoxscore",[this.controller.lineup,o],this.controller.history),i=e.reduce(function(c,f){return c.concat(f)},[]);return{battingOrder:e,pitcherHistory:this.call("orderedPitchersForBoxscore",[o],this.controller.history),fielderHistory:a,courtesyRunners:this.call("courtesyRunnerOrderForBoxscore",[i,o],this.controller.history)}},Object.defineProperty(v.prototype,"aggregateBoxscoreSituation",{get:function(){var o={stats:this.allStats,teams:{}};return o.teams[this.inFieldTeamId]=this.boxscoreSituation(this.inFieldTeamId),o.teams[this.atBatTeamId]=this.boxscoreSituation(this.atBatTeamId),o},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"boxscorePDF",{get:function(){var o=this,a={};return[this.atBatTeamId,this.inFieldTeamId].forEach(function(r){a[r]=o.boxscorePDFRecord(r)}),a},enumerable:!1,configurable:!0}),v.prototype.boxscorePDFRecord=function(o){return{boxscore:this.boxscoreSituation(o),linescore:this.linescoreWithStatTotals[o],score:this.scores[o],stats:this.allStats[o]}},Object.defineProperty(v.prototype,"scorebook",{get:function(){var o=[this.get("homeId",this.controller.situation),this.get("awayId",this.controller.situation)],a=o[0],r=o[1],e={};e[a]=this.call("battingHistory",[a],this.controller.history),e[r]=this.call("battingHistory",[r],this.controller.history);var i={};l.extend(i,this.call("fielderHistory",[a],this.controller.history)),l.extend(i,this.call("fielderHistory",[r],this.controller.history));var c=this.call("renderForScorebook",[this.controller.outputStream(),this.controller.situation,this.controller.lineup],this.controller.playByPlay);return{battingHistories:e,fieldingHistories:i,atBatProgressMap:c.atBatProgressMap,atBatsByInningColumnSlot:c.atBatsByInningColumnSlot}},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"tabular_data",{get:function(){return this.call("exportTabularPlayByPlay",[this.controller.outputStream()],this.controller.playByPlay)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"pitchCountData",{get:function(){var o={};return o[this.inFieldTeamId]=this.call("pitcherHistory",[this.inFieldTeamId],this.controller.history),o[this.atBatTeamId]=this.call("pitcherHistory",[this.atBatTeamId],this.controller.history),{stats:this.allStats,pitcherHistories:o}},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"aggregateGameStreamData",{get:function(){return{gameSituation:this.currentGameSituation,playByPlay:this.fullPlayByPlay,linescore:this.linescoreWithStatTotals,boxscore:this.aggregateBoxscoreSituation,fieldSituation:{batter:this.call("currentBatter",[this.atBatTeamId],this.controller.lineup),baserunners:this.get("baserunners",this.controller.baserunners),fielders:this.call("positionsMapForTeam",[this.inFieldTeamId],this.controller.fielders),atBatTeamId:this.atBatTeamId,inFieldTeamId:this.inFieldTeamId},scorebook:this.scorebook,tabular_data:this.tabular_data}},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"gameStatHighlights",{get:function(){var o=[0],a=[{returnKey:"hits",category:"offense",stat:"H",excludeValues:o,numberOfPlayers:3,sortOrder:"descending"},{returnKey:"walks",category:"offense",stat:"BB",excludeValues:o,numberOfPlayers:3,sortOrder:"descending"},{returnKey:"rbis",category:"offense",stat:"RBI",excludeValues:o,numberOfPlayers:3,sortOrder:"descending"},{returnKey:"qabs",category:"offense",stat:"QAB",excludeValues:o,numberOfPlayers:3,sortOrder:"descending"},{returnKey:"innings",category:"defense",stat:"IP",excludeValues:o,numberOfPlayers:3,sortOrder:"descending"},{returnKey:"firstPitchStrikes",category:"defense",stat:"FPS",excludeValues:o,numberOfPlayers:3,sortOrder:"descending"},{returnKey:"strikeouts",category:"defense",stat:"SO",excludeValues:o,numberOfPlayers:3,sortOrder:"descending"},{returnKey:"whip",category:"defense",stat:"WHIP",numberOfPlayers:3,sortOrder:"ascending"}];return this.call("statHighlights",[a],this.controller.stats)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"payloadForNarrativeScienceRecaps",{get:function(){return{outputStream:this.controller.outputStream(),playByPlay:this.fullPlayByPlay,linescore:this.linescoreWithStatTotals,allStats:this.allStats,perInningStats:this.fullPerInningStats}},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"payloadForStatCrewExport",{get:function(){var o=[this.get("homeId",this.controller.situation),this.get("awayId",this.controller.situation)],a=o[0],r=o[1],e={};e[a]=this.call("battingHistory",[a],this.controller.history),e[r]=this.call("battingHistory",[r],this.controller.history);var i={};l.extend(i,this.call("fielderHistory",[a],this.controller.history)),l.extend(i,this.call("fielderHistory",[r],this.controller.history));var c={};c[a]=this.call("pitcherHistory",[a],this.controller.history),c[r]=this.call("pitcherHistory",[r],this.controller.history);var f={};return f[a]=this.call("playerOrderForBoxscore",[this.controller.lineup,a],this.controller.history),f[r]=this.call("playerOrderForBoxscore",[this.controller.lineup,r],this.controller.history),{playByPlay:this.fullPlayByPlay,linescore:this.linescoreWithStatTotals,allStats:this.allStats,perInningStats:this.fullPerInningStats,battingHistories:e,fieldingHistories:i,pitcherHistories:c,boxscoreOrder:f}},enumerable:!1,configurable:!0}),v.prototype.playDetail=function(o){var a=this.completedAtBat(o);if(a!==void 0)return{atBat:a,playDetail:(0,p.renderForPlayDetail)(this.controller.outputStream(),a,this.controller.lineup)}},v.prototype.makeReplacementEvent=function(o,a){var r=this.completedAtBatContainingEvent(o);return d.ResultPlayEdit.makeReplacementEvent(o,a,r,this.controller.outputStream())},Object.defineProperty(v.prototype,"announcements",{get:function(){var o=this.call("currentBatter",[this.atBatTeamId],this.controller.lineup),a={playerId:o,statAtBats:this.playerStat(this.atBatTeamId,o,"offense","AB",!1),statHits:this.playerStat(this.atBatTeamId,o,"offense","H",!1)},r=this.call("batters",[this.atBatTeamId],this.controller.lineup),e=this.call("lineupIndex",[this.atBatTeamId],this.controller.lineup),i={balls:this.balls,strikes:this.strikes,outs:this.outs,runnersOnBase:this.get("runnersOnBase",this.controller.baserunners),scores:this.scores,homeTeamId:this.get("homeId",this.controller.situation),awayTeamId:this.get("awayId",this.controller.situation),inning:this.inning,half:this.half,stats:this.fullPerInningStats,nextBatters:(0,s.modularSlice)(r,e,3),currentBatter:a,currentPitcherId:this.call("positionsMapForTeam",[this.inFieldTeamId],this.controller.fielders).P};return(0,y.generateAnnouncements)(i)},enumerable:!1,configurable:!0}),v}(t.EngineStateAccessor);return Pa.StateAccessor=u,Pa}var jr={},Ea={},Ba={},tf;function mv(){if(tf)return Ba;tf=1,Object.defineProperty(Ba,"__esModule",{value:!0}),Ba.sortObjectArrayByKeys=void 0;function n(l,t){l.sort(function(p,d){for(var y=0,s=t;y<s.length;y++){var u=s[y],h=[p[u],d[u]],v=h[0],o=h[1];if(v===void 0&&(v=1/0),o===void 0&&(o=1/0),v>o)return 1;if(o>v)return-1}return 0})}return Ba.sortObjectArrayByKeys=n,Ba}var rf;function nf(){if(rf)return Ea;rf=1,Object.defineProperty(Ea,"__esModule",{value:!0}),Ea.GameStatsDoc=void 0;var n=X,l=n.__importStar(fe()),t=n.__importStar(Pe),p=n.__importStar(mv()),d=n.__importStar(Oe()),y=Fr(),s=function(u){n.__extends(h,u);function h(){return u!==null&&u.apply(this,arguments)||this}return Object.defineProperty(h.prototype,"renderFunctions",{get:function(){return[]},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"teams",{get:function(){return this.get("teams").toJS()},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"statsWithEdits",{get:function(){for(var v=this.get("teams").mergeDeep(this.get("editsForTeams")).toJS(),o=0,a=this.editPlayerRemoveList;o<a.length;o++){var r=a[o];for(var e in v)v.hasOwnProperty(e)&&v[e].players!==void 0&&delete v[e].players[r]}return v},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"editPlayerRemoveList",{get:function(){var v=this.get("editPlayersToRemove"),o=l.Set.of();return(v||o).toArray()},enumerable:!1,configurable:!0}),h.prototype.addPlayerToRemoveList=function(v){return this.update("editPlayersToRemove",function(o){return o.add(v)})},h.prototype.removePlayerFromRemoveList=function(v){return this.update("editPlayersToRemove",function(o){return o.delete(v)})},h.prototype.pivotStatsForStatsObject=function(v){var o={id:"",offense:[],defense:[],general:[]};return["offense","defense","general"].map(function(a){for(var r in v[a])v[a].hasOwnProperty(r)&&o[a].push({s:r,v:v[a][r]})}),o},Object.defineProperty(h.prototype,"pivotStatsForOutput",{get:function(){var v=Object();v.stats={team:[],player:[]};var o=this.rendered.teams;for(var a in o)if(a!==""&&o.hasOwnProperty(a)){var r=o[a].players;for(var e in r)if(e!==""&&r.hasOwnProperty(e)){var i=this.pivotStatsForStatsObject(r[e].stats);i.id=e,v.stats.player.push(i)}var c=this.pivotStatsForStatsObject(o[a].stats);c.id=a,v.stats.team.push(c)}return v},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"statsForOutput",{get:function(){return this.rendered.teams},enumerable:!1,configurable:!0}),h.prototype.sanitizeStatsDocument=function(v){for(var o in v)if(v.hasOwnProperty(o)){for(var a in v[o])if(v[o].hasOwnProperty(a)){var r=v[o][a];(isNaN(r)||r===1/0||r===-1/0||r===void 0)&&delete v[o][a]}}},h.prototype.applyToTeamsAndPlayersWithEdits=function(){for(var v=[],o=0;o<arguments.length;o++)v[o]=arguments[o];for(var a=this.statsWithEdits,r=0,e=v;r<e.length;r++){var i=e[r];for(var c in a)if(a.hasOwnProperty(c)){var f=a[c].players;for(var _ in f)f.hasOwnProperty(_)&&i(f[_].stats);i(a[c].stats)}}return{teams:a}},Object.defineProperty(h.prototype,"sanitized",{get:function(){return this.applyToTeamsAndPlayersWithEdits(this.sanitizeStatsDocument.bind(this))},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"rendered",{get:function(){return this.applyToTeamsAndPlayersWithEdits.apply(this,n.__spreadArray(n.__spreadArray([],this.renderFunctions,!1),[this.sanitizeStatsDocument.bind(this)],!1))},enumerable:!1,configurable:!0}),h.prototype.incrementPlayerStats=function(v,o,a,r,e,i,c){e===void 0&&(e=1),i===void 0&&(i=!0),c===void 0&&(c="teams");var f=this;if(o!==void 0){var _=[c,v,"players",o,"stats",a,r];f=f.setIn(_,this.getIn(_,0)+e)}return i&&(f=f.incrementTeamStats(v,a,r,e)),f},h.prototype.updatePlayerStatsElements=function(v,o,a,r,e){e===void 0&&(e="teams");var i=this;if(o!==void 0){var c=[e,v,"players",o,"stats",a];i=this.updatedStatsElements(i,c,r)}if(v!==void 0){var f=[e,v,"stats",a];i=this.updatedStatsElements(i,f,r)}return i},h.prototype.updatedStatsElements=function(v,o,a){return v.updateIn(o,l.Map(),function(r){for(var e=0,i=a;e<i.length;e++){var c=i[e],f=c.key;if("maxValue"in c){var _=r.get(f,0);r=r.set(f,Math.max(_,c.maxValue))}else{var S="incrementBy"in c?c.incrementBy:(0,y.bin)(c.increment);r=r.set(f,r.get(f,0)+S)}}return r})},h.prototype.setPlayerStats=function(v,o,a,r,e,i){if(i===void 0&&(i="teams"),o!==void 0){var c=[i,v,"players",o,"stats",a,r];return this.setIn(c,e)}return this},h.prototype.getPlayerStat=function(v,o,a,r,e){e===void 0&&(e="teams");var i=[e,v,"players",o,"stats",a,r];return this.getIn(i)},h.prototype.incrementTeamStats=function(v,o,a,r,e){if(r===void 0&&(r=1),e===void 0&&(e="teams"),v!==void 0){var i=[e,v,"stats",o,a];return this.setIn(i,this.getIn(i,0)+r)}return this},h.prototype.setTeamStats=function(v,o,a,r,e){if(e===void 0&&(e="teams"),v!==void 0){var i=[e,v,"stats",o,a];return this.setIn(i,r)}return this},h.prototype.playerStat=function(v,o,a,r,e){e===void 0&&(e=!0);var i=e?this.rendered.teams:this.sanitized.teams;if(!(i[v]===void 0||i[v].players===void 0||i[v].players[o]===void 0||i[v].players[o].stats[a]===void 0||i[v].players[o].stats[a][r]===void 0))return i[v].players[o].stats[a][r]},h.prototype.teamStat=function(v,o,a,r){r===void 0&&(r=!0);var e=r?this.rendered.teams:this.sanitized.teams;if(!(e[v]===void 0||e[v].stats[o]===void 0))return e[v].stats[o][a]},h.prototype.statHighlights=function(v){for(var o={},a=this.rendered.teams,r=0,e=v;r<e.length;r++){var i=e[r];o[i.returnKey]=[]}for(var c in a)if(a.hasOwnProperty(c)){var f=a[c].players;for(var _ in f)if(f.hasOwnProperty(_))for(var S=0,P=v;S<P.length;S++){var i=P[S];try{var I=f[_].stats[i.category][i.stat];I!==void 0&&o[i.returnKey].push({playerId:_,teamId:c,value:I})}catch{}}}for(var E=function(R){var F=o[R.returnKey];R.excludeValues!==void 0&&R.excludeValues.length!==0&&(F=t.reject(F,function(x){return R.excludeValues?t.contains(R.excludeValues,x.value):!1})),p.sortObjectArrayByKeys(F,["value","playerId"]),R.sortOrder==="descending"&&F.reverse(),o[R.returnKey]=t.first(F,R.numberOfPlayers)},B=0,b=v;B<b.length;B++){var i=b[B];E(i)}return o},h}(d.ImmutableState);return Ea.GameStatsDoc=s,Ea}var af;function bv(){if(af)return jr;af=1,Object.defineProperty(jr,"__esModule",{value:!0}),jr.StatsEngine=jr.BatsGameStatsDoc=void 0;var n=X,l=n.__importStar(fe()),t=n.__importStar(Pe),p=n.__importStar(Ee()),d=Fr(),y=n.__importStar(nf()),s=tt(),u=n.__importStar(Rt()),h=function(o){n.__extends(a,o);function a(){return o!==null&&o.apply(this,arguments)||this}return Object.defineProperty(a.prototype,"context",{get:function(){return this.get("context").toJS()},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"renderFunctions",{get:function(){return[this.renderOffensiveStats.bind(this),t.partial(this.renderDefensiveStats,this.context).bind(this)]},enumerable:!1,configurable:!0}),a.prototype.setTeams=function(r){return this.set("teams",l.fromJS(r))},a.prototype.renderOffensiveStats=function(r){var e=r.offense;if(e!==void 0){e.H=(0,d.safeSum)(e["1B"],e["2B"],e["3B"],e.HR),e.PA=(0,d.safeSum)(e.BB,e.HBP,e.SHB,e.SHF,e.CI,e.AB),e.AVG=(0,d.safeSum)(e.H)/e.AB,e.TB=(0,d.safeSum)(e["1B"],2*e["2B"],3*e["3B"],4*e.HR),e.XBH=(0,d.safeSum)(e["2B"],e["3B"],e.HR),e.SLG=(0,d.safeSum)(e.TB)/e.AB,e["2S+3%"]=(0,d.safeSum)(e["2S+3"])/e.PA,e["6+%"]=(0,d.safeSum)(e["6+"])/e.PA,e["PS/PA"]=(0,d.safeSum)(e.PS)/e.PA,e["AB/HR"]=(0,d.safeSum)(e.AB)/e.HR,e["BA/RISP"]=(0,d.safeSum)(e.HRISP)/e.ABRISP,e["BB/K"]=(0,d.safeSum)(e.BB)/e.SO,e["PA/BB"]=(0,d.safeSum)(e.PA)/e.BB,e.BABIP=(0,d.safeSum)(e.H,-1*e.HR)/(0,d.safeSum)(e.SHF,e.AB,-1*e.SO,-1*e.HR),e["GB%"]=(0,d.safeSum)(e.GB)/e.INP,e["FLB%"]=(0,d.safeSum)(e.FLB)/e.INP,e["LND%"]=(0,d.safeSum)(e.LND)/e.INP,e["C%"]=(0,d.safeSum)(e.AB,-1*e.SO)/e.AB,e["SM%"]=(0,d.safeSum)(e.SM)/e.PS,e["SW%"]=(0,d.safeSum)(e.SW)/e.PS,e.OB=(0,d.safeSum)(e.H,e.BB,e.HBP),e.OBP=(0,d.safeSum)(e.OB)/(0,d.safeSum)(e.AB,e.BB,e.HBP,e.SHF),e.OPS=(0,d.safeSum)(e.SLG,e.OBP),e["QAB%"]=(0,d.safeSum)(e.QAB)/e.PA,e["SB%"]=(0,d.safeSum)(e.SB)/(0,d.safeSum)(e.SB,e.CS),e.LEADOFF_OBP=(0,d.safeSum)(e.LOOB)/(0,d.safeSum)(e.LOPA),e.OS=(0,d.safeSum)(e.CB,e.SL,e.CH,e.SC,e.KB,e.DC,e.KC),e.OSS=(0,d.safeSum)(e.CBS,e.SLS,e.CHS,e.SCS,e.KBS,e.DCS,e.KCS),e.OSSW=(0,d.safeSum)(e.CBSW,e.SLSW,e.CHSW,e.SCSW,e.KBSW,e.DCSW,e.KCSW),e.OSSM=(0,d.safeSum)(e.CBSM,e.SLSM,e.CHSM,e.SCSM,e.KBSM,e.DCSM,e.KCSM);for(var i=0,c=["FB","CB","SL","CH","CT","RB","DB","SC","DC","KB","KC","OS"];i<c.length;i++){var f=c[i];e["".concat(f,"%")]=(0,d.safeSum)(e[f])/e.PS,e["".concat(f,"S%")]=(0,d.safeSum)(e["".concat(f,"S")])/e[f],e["".concat(f,"SW%")]=(0,d.safeSum)(e["".concat(f,"SW")])/e[f],e["".concat(f,"SM%")]=(0,d.safeSum)(e["".concat(f,"SM")])/e[f]}}},a.prototype.renderDefensiveStats=function(r,e){var i,c,f,_,S,P,I,E,B,b=e.defense;if(b!==void 0){b.IP=(0,d.safeSum)(b.outs)/3,b["IC:C"]=(0,d.safeSum)(b["outs:C"])/3,b["IP:F"]=(0,d.safeSum)(b["outs:F"])/3,b["IP:1B"]=(0,d.safeSum)(b["outs-1B"])/3,b["IP:2B"]=(0,d.safeSum)(b["outs-2B"])/3,b["IP:3B"]=(0,d.safeSum)(b["outs-3B"])/3,b["IP:SS"]=(0,d.safeSum)(b["outs-SS"])/3,b["IP:LF"]=(0,d.safeSum)(b["outs-LF"])/3,b["IP:CF"]=(0,d.safeSum)(b["outs-CF"])/3,b["IP:RF"]=(0,d.safeSum)(b["outs-RF"])/3,b["IP:SF"]=(0,d.safeSum)(b["outs-SF"])/3,b.AB=(0,d.safeSum)(b.BF,-1*b.BB,-1*b.HBP,-1*b.SHF,-1*b.SHB,-1*b.CI),b["BB/INN"]=(0,d.safeSum)(b.BB)/b.IP,b["SM%"]=(0,d.safeSum)(b.SM)/b["#P"],b.BAA=(0,d.safeSum)(b.H)/b.AB,b["FLB%"]=(0,d.safeSum)(b.FLB)/b.INP,b.BABIP=(0,d.safeSum)(b.H,-1*b.HR)/(0,d.safeSum)(b.SHF,b.AB,-1*b.SO,-1*b.HR),b["BA/RISP"]=(0,d.safeSum)(b.HRISP)/b.ABRISP,b.WHIP=(0,d.safeSum)(b.H,b.BB)/b.IP,b["LOB%"]=(0,d.safeSum)(b.H,b.BB,b.HBP,-1*b.R)/(0,d.safeSum)(b.H,b.BB,b.HBP,-1.4*b.HR),b["FPS%"]=(0,d.safeSum)(b.FPS)/b.BF,b["FPSH%"]=(0,d.safeSum)(b.FPSH)/b.FPS,b["FPSW%"]=(0,d.safeSum)(b.FPSW)/b.FPS,b["FPSO%"]=(0,d.safeSum)(b.FPSO)/b.FPS,b["K/BB"]=(0,d.safeSum)(b.SO)/b.BB,b["<3%"]=(0,d.safeSum)(b["<3"])/b.BF,b["S%"]=(0,d.safeSum)(b.TS)/b["#P"],b["LND%"]=(0,d.safeSum)(b.LND)/b.INP,b["123INN%"]=(0,d.safeSum)(b["123INN"])/b.IP,b["HARD%"]=(0,d.safeSum)(b.HARD)/(0,d.safeSum)(b.HARD,b.WEAK),b["WEAK%"]=(0,d.safeSum)(b.WEAK)/(0,d.safeSum)(b.HARD,b.WEAK),b["<13%"]=(0,d.safeSum)(b["<13"])/b.IP,b["P/BF"]=(0,d.safeSum)(b["#P"])/b.BF,b["GB%"]=(0,d.safeSum)(b.GB)/(0,d.safeSum)(b.GB,b.FLY),b["FLY%"]=(0,d.safeSum)(b.FLY)/(0,d.safeSum)(b.GB,b.FLY),b["GO/AO"]=(0,d.safeSum)(b.GO)/b.AO,b["P/IP"]=(0,d.safeSum)(b["#P"])/b.IP,b["K/BF"]=(0,d.safeSum)(b.SO)/b.BF,b.TC=(0,d.safeSum)(b.PO,b.E,b.A),b.FPCT=(0,d.safeSum)(b.PO,b.A)/b.TC,b["CS:C%"]=(0,d.safeSum)(b["CS:C"])/(0,d.safeSum)(b["SB:C"],b["CS:C"]),b["SBATT:C"]=(0,d.safeSum)(b["SB:C"],b["CS:C"]),b["SB%"]=(0,d.safeSum)(b.SB)/(0,d.safeSum)(b.SB,b.CS),b["K/G"]=(0,d.safeSum)(b.SO)/((0,d.safeSum)(b.IP)/r.inningsPerGame),b["1ST2OUT%"]=(0,d.safeSum)(b["1ST2OUT"])/b.IP,b.SVO=(0,d.safeSum)(b.SV,b.BS),b["SV%"]=(0,d.safeSum)(b.SV)/b.SVO,b["LOO%"]=(0,d.safeSum)(b.LOO)/b.IP,b.ERA=r.inningsPerGame*(0,d.safeSum)(b.ER)/b.IP,b["SB:C%"]=(0,d.safeSum)(b["SB:C"])/(0,d.safeSum)(b["SB:C"],b["CS:C"]),b.EXTRA_PITCHES=(i=b.EXTRA_PITCHES)!==null&&i!==void 0?i:0,b.WALKS_SCORED=(c=b.WALKS_SCORED)!==null&&c!==void 0?c:0,b.UER=(0,d.safeSum)(b.R,-1*b.ER);for(var R=["P","C","1B","2B","3B","SS","LF","CF","RF","SF"],F=0,x=R;F<x.length;F++){var w=x[F];b["TC:".concat(w)]=(0,d.safeSum)(b["PO:".concat(w)],b["E:".concat(w)],b["A:".concat(w)]),b["FPCT:".concat(w)]=(0,d.safeSum)(b["PO:".concat(w)],b["A:".concat(w)])/b["TC:".concat(w)]}b.OS=(0,d.safeSum)(b.CB,b.SL,b.CH,b.SC,b.KB,b.DC,b.KC),b.OSS=(0,d.safeSum)(b.CBS,b.SLS,b.CHS,b.SCS,b.KBS,b.DCS,b.KCS),b.OSSW=(0,d.safeSum)(b.CBSW,b.SLSW,b.CHSW,b.SCSW,b.KBSW,b.DCSW,b.KCSW),b.OSSM=(0,d.safeSum)(b.CBSM,b.SLSM,b.CHSM,b.SCSM,b.KBSM,b.DCSM,b.KCSM),b["OS#MPH"]=(0,d.safeSum)(b["CB#MPH"],b["SL#MPH"],b["CH#MPH"],b["SC#MPH"],b["KB#MPH"],b["DC#MPH"],b["KC#MPH"]),b.OSMPH=(0,d.safeSum)(b.CBMPH,b.SLMPH,b.CHMPH,b.SCMPH,b.KBMPH,b.DCMPH,b.KCMPH),b.TopOS=Math.max((f=b.TopCB)!==null&&f!==void 0?f:0,(_=b.TopSL)!==null&&_!==void 0?_:0,(S=b.TopCH)!==null&&S!==void 0?S:0,(P=b.TopSC)!==null&&P!==void 0?P:0,(I=b.TopKB)!==null&&I!==void 0?I:0,(E=b.TopDC)!==null&&E!==void 0?E:0,(B=b.TopKC)!==null&&B!==void 0?B:0);for(var L=0,D=["FB","CB","SL","CH","CT","RB","DB","SC","DC","KB","KC","OS"];L<D.length;L++){var U=D[L];b["".concat(U,"%")]=(0,d.safeSum)(b[U])/b["#P"],b["".concat(U,"S%")]=(0,d.safeSum)(b["".concat(U,"S")])/b[U],b["".concat(U,"SW%")]=(0,d.safeSum)(b["".concat(U,"SW")])/b[U],b["".concat(U,"SM%")]=(0,d.safeSum)(b["".concat(U,"SM")])/b[U],b["MPH".concat(U)]=(0,d.safeSum)(b["".concat(U,"MPH")])/b["".concat(U,"#MPH")]}if(r.FIPConstant!==void 0&&r.FIPHRValue!==void 0&&r.FIPBBValue!==void 0&&r.FIPSOValue!==void 0&&r.inningsPerGame!==void 0){var G=(0,d.safeSum)(b.BB)+(r.FIPIncludeHBPWithBB?b.HBP:0),q=(0,d.safeSum)(b.HR)*r.FIPHRValue+G*r.FIPBBValue+-1*(0,d.safeSum)(b.SO)*r.FIPSOValue;b.FIP=r.FIPConstant+r.inningsPerGame*q/b.IP}}},a}(y.GameStatsDoc);jr.BatsGameStatsDoc=h;var v=function(o){n.__extends(a,o);function a(r,e,i,c,f,_,S,P){var I=o.call(this,r)||this;return I.context=e,I.baserunners=i,I.situation=c,I.lineup=f,I.fielders=_,I.earnedRuns=S,I.statEvents=P,I.stateHistory.pop(),I.stateHistory.push(I.initialState()),I}return a.prototype.initialState=function(){return new h(l.fromJS({teams:{},editsForTeams:{},context:this.context,pitcherLastAtBatIndex:{}})).set("editPlayersToRemove",l.Set.of())},a.prototype.processOneEvent=function(r,e){switch(e.code){case"team_stat_edit":r=this.applyTeamEdit(r,e);break;case"player_stat_edit":r=this.applyPlayerEdit(r,e);break;case"remove_player_edit":r=this.applyRemovePlayerEdit(r,e);break;case"clear_all_edits":r=this.clearAllEdits(r);break;default:r=this.updateStatsForEvent(r,e)}return r},a.prototype.getDerivedMultiGamePivotedStatsWithBaseStats=function(r){var e=this.stateHistory[0].setTeams(r).set("context",l.fromJS(this.context));return e.pivotStatsForOutput},a.prototype.getDerivedMultiGameStatsWithBaseStats=function(r){var e=this.stateHistory[0].setTeams(r).set("context",l.fromJS(this.context));return e.statsForOutput},Object.defineProperty(a.prototype,"situationBeforeEvent",{get:function(){return this.situation.stateBeforeEvent(this.nextEventOffset)},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"situationAfterEvent",{get:function(){return this.situation.stateAfterEvent(this.nextEventOffset)},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"lineupBeforeEvent",{get:function(){return this.lineup.stateBeforeEvent(this.nextEventOffset)},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"lineupAfterEvent",{get:function(){return this.lineup.stateAfterEvent(this.nextEventOffset)},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"fieldersBeforeEvent",{get:function(){return this.fielders.stateBeforeEvent(this.nextEventOffset)},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"fieldersAfterEvent",{get:function(){return this.fielders.stateAfterEvent(this.nextEventOffset)},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"baserunnersBeforeEvent",{get:function(){return this.baserunners.stateBeforeEvent(this.nextEventOffset)},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"baserunnersAfterEvent",{get:function(){return this.baserunners.stateAfterEvent(this.nextEventOffset)},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"earnedRunsBeforeEvent",{get:function(){return this.earnedRuns.stateBeforeEvent(this.nextEventOffset)},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"earnedRunsAfterEvent",{get:function(){return this.earnedRuns.stateAfterEvent(this.nextEventOffset)},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"currentPitcher",{get:function(){return{id:this.fieldersBeforeEvent.playerForPosition(this.situationBeforeEvent.inFieldTeamId,"P"),teamId:this.situationBeforeEvent.inFieldTeamId}},enumerable:!1,configurable:!0}),a.prototype.isLeadoffBatter=function(r){var e=r.isAtBat||this.situationAfterEvent.lastEventWasWalk||r.isSacrifice||r.code==="end_at_bat"&&(r.attributes.endAtBatReason==="hit_by_pitch"||r.attributes.endAtBatReason==="catcher_interference");return r.battersThisInning===1&&e},a.prototype.isInningExtendedByError=function(){var r=this.earnedRunsAfterEvent.get("runners").filter(function(e){return!e.qualified&&e.isEffectivelyOut}).size;return r+this.situationAfterEvent.outs>=3},a.prototype.applyTeamEdit=function(r,e){return r.setTeamStats(e.teamId,e.category,e.statName,e.statValue,"editsForTeams")},a.prototype.applyPlayerEdit=function(r,e){return r.setPlayerStats(e.teamId,e.playerId,e.category,e.statName,e.statValue,"editsForTeams").removePlayerFromRemoveList(e.playerId)},a.prototype.applyRemovePlayerEdit=function(r,e){return r.addPlayerToRemoveList(e.playerId)},a.prototype.clearAllEdits=function(r){return r.update("editsForTeams",function(e){return e.clear()}).set("editPlayersToRemove",l.Set.of())},a.prototype.setGamesScored=function(r,e){var i=[this.situationBeforeEvent.inFieldTeamId,this.situationBeforeEvent.atBatTeamId],c=i[0],f=i[1];r=r.setTeamStats(f,"general","GP",1),r=r.setTeamStats(f,"offense","GP",1),r=r.setTeamStats(c,"general","GP",1),r=r.setTeamStats(c,"defense","GP:F",1),r=r.setTeamStats(c,"defense","GP:C",1),r=r.setTeamStats(c,"defense","GP:P",1);var _=this.fieldersAfterEvent.playersMapForTeam(c);for(var S in _)if(!(!_.hasOwnProperty(S)||S==="undefined")){r=r.setPlayerStats(c,S,"general","GP",1);var P=_[S];P!==void 0&&(t.contains(["EH","DH","F10"],P)||(r=r.setPlayerStats(c,S,"defense","GP:F",1)),P==="C"&&(r=r.setPlayerStats(c,S,"defense","GP:C",1)),P==="P"&&(r=r.setPlayerStats(c,S,"defense","GP:P",1)))}var I=this.lineupAfterEvent.currentBatter(f);I!==void 0&&e.code!=="ball_in_play"&&!(0,s.baserunningRelatedToLastBIP)(e)&&!this.situationAfterEvent.lastEventEndedInning&&(r=r.setPlayerStats(f,I,"offense","GP",1),r=r.setPlayerStats(f,I,"general","GP",1));for(var E in this.baserunnersAfterEvent.baserunners)if(E!==void 0){var B=this.baserunnersAfterEvent.baserunners[E];B!==void 0&&(r=r.setPlayerStats(f,B,"offense","GP",1),r=r.setPlayerStats(f,B,"general","GP",1))}return r},a.prototype.updateBatterStats=function(r,e){var i=this.situationBeforeEvent.atBatTeamId,c=this.lineupBeforeEvent.currentBatter(i),f=[{key:"H",increment:e.isHit},{key:"PS",increment:e.code==="pitch"},{key:"TS",increment:e.isStrike},{key:"SW",increment:e.isSwing},{key:"SM",increment:e.isMiss},{key:"2STRIKES",increment:(e.code==="pitch"||e.code==="override")&&this.situationAfterEvent.strikes===2&&this.situationBeforeEvent.strikes!==this.situationAfterEvent.strikes},{key:"FULL",increment:(e.code==="pitch"||e.code==="override")&&this.situationAfterEvent.strikes===2&&this.situationAfterEvent.balls===3&&(this.situationBeforeEvent.strikes!==this.situationAfterEvent.strikes||this.situationBeforeEvent.balls!==this.situationAfterEvent.balls)},{key:"INP",increment:e.code==="ball_in_play"&&e.isInPlay},{key:"GSHR",increment:e.code==="ball_in_play"&&e.attributes.ballInPlayResult==="home_run"&&this.baserunnersAfterEvent.runnersScoredOnLastEvent.length===4},{key:"ROE",increment:e.reachedBaseOnError},{key:"FC",increment:e.code==="ball_in_play"&&e.attributes.ballInPlayResult==="fielders_choice"},{key:"LOBB",increment:this.situationAfterEvent.lastEventWasWalk&&e.leadOff},{key:"SO",increment:this.situationAfterEvent.lastEventWasStrikeout||e.code==="ball_in_play"&&e.attributes.ballInPlayResult==="foul_tip_out"},{key:"SOL",increment:this.situationAfterEvent.lastEventWasStrikeout&&e.atBatLastPitchResult==="strike_looking"},{key:"HBP",increment:e.code==="end_at_bat"&&e.attributes.endAtBatReason==="hit_by_pitch"},{key:"AB",increment:e.isAtBat},{key:"ABRISP",increment:e.isAtBat&&e.risp},{key:"QAB",incrementBy:e.qabIncrement},{key:"2S+3",incrementBy:e.threeAfterTwoIncrement},{key:"HRISP",increment:e.isHit&&e.risp},{key:"HARD",increment:e.isHardHit&&e.isInPlay},{key:"WEAK",increment:!e.isHardHit&&e.isInPlay},{key:"GB",increment:e.isGround},{key:"LND",increment:e.attributes.ballInPlayType==="line_drive"},{key:"FLB",increment:t.contains(["pop_fly","fly_ball"],e.attributes.ballInPlayType)},{key:"SHF",increment:e.code==="ball_in_play"&&t.contains(["sacrifice_fly","sacrifice_fly_error"],e.attributes.ballInPlayResult)},{key:"SHB",increment:e.code==="ball_in_play"&&t.contains(["sacrifice_bunt","sacrifice_bunt_error"],e.attributes.ballInPlayResult)},{key:"6+",incrementBy:e.sixPlusIncrement},{key:"1B",increment:e.code==="ball_in_play"&&e.attributes.ballInPlayResult==="single"},{key:"2B",increment:e.code==="ball_in_play"&&e.attributes.ballInPlayResult==="double"},{key:"3B",increment:e.code==="ball_in_play"&&e.attributes.ballInPlayResult==="triple"},{key:"HR",increment:e.code==="ball_in_play"&&e.attributes.ballInPlayResult==="home_run"},{key:"BB",increment:this.situationAfterEvent.lastEventWasWalk},{key:"CI",increment:e.code==="end_at_bat"&&e.attributes.endAtBatReason==="catcher_interference"},{key:"R",increment:!1},{key:"RBI",increment:!1},{key:"2OUTRBI",increment:!1},{key:"LOB",increment:!1}];if(this.appendPitchStyleStats(e,f),r=r.updatePlayerStatsElements(i,c,"offense",f),e.isHit&&this.situationBeforeEvent.strikes===2&&(r=r.incrementTeamStats(i,"offense","TWO_STRIKE_HITS",1)),this.isLeadoffBatter(e)){r=r.incrementTeamStats(i,"offense","LOPA",1);var _=e.code==="end_at_bat"&&e.attributes.endAtBatReason==="hit_by_pitch",S=this.situationAfterEvent.lastEventWasWalk||_;(e.isHit||S)&&(r=r.incrementTeamStats(i,"offense","LOOB",1))}r=r.incrementPlayerStats(e.lastBatter.teamId,e.lastBatter.id,"offense","GIDP",e.lastBallInPlayWasGround?e.doublePlayIncrement:0),r=r.incrementPlayerStats(e.lastBatter.teamId,e.lastBatter.id,"offense","GITP",(0,d.bin)(e.lastBallInPlayWasGround&&e.outsOnPlay===3));for(var P=0,I=this.baserunnersAfterEvent.runnersScoredOnLastEvent;P<I.length;P++){var E=I[P];r=r.incrementPlayerStats(i,E,"offense","R",1)}for(var B=0,b=this.baserunnersAfterEvent.runnersUnscoredOnLastEvent;B<b.length;B++){var R=b[B];r=r.incrementPlayerStats(i,R,"offense","R",-1)}if(r=r.incrementPlayerStats(e.lastBatter.teamId,e.lastBatter.id,"offense","LOB",e.playerLOBIncrement,!1),this.situationAfterEvent.lastEventEndedInning){var F=this.baserunnersAfterEvent.runnersLeftOnBase;e.code==="ball_in_play"||this.situationAfterEvent.lastEventWasStrikeout||e.code==="base_running"&&e.attributes.baseRunningPlayType==="out_on_last_play"?(r=r.incrementTeamStats(i,"offense","LOB",F),r=r.incrementPlayerStats(i,e.lastBatter.id,"offense","3OUTLOB",F,!1)):e.code==="base_running"&&(r=r.incrementTeamStats(i,"offense","LOB",this.baserunnersAfterEvent.runnersLeftOnBase),r=r.incrementPlayerStats(i,e.attributes.baseRunningRunnerId,"offense","3OUTLOB",F,!1))}return this.incrementRBIStats(r,e)},a.prototype.incrementRBIStatsForBatter=function(r,e,i,c,f){r=r.incrementPlayerStats(i,c,"offense","RBI",f);var _=this.situationAfterEvent.lastEventEndedInning?3:this.situationAfterEvent.outs;return _-e.outsOnPlay===2&&(r=r.incrementPlayerStats(i,c,"offense","2OUTRBI",f)),r},a.prototype.incrementRBIStats=function(r,e){var i=this.situationBeforeEvent.atBatTeamId,c=this.lineupBeforeEvent.currentBatter(i);if(this.baserunnersBeforeEvent.runnersOnBase===3&&this.situationAfterEvent.lastEventWasWalk&&(e.code==="illegal_pitch_advance"||e.code==="pitch"&&e.attributes.pitchAdvancesRunners))return this.incrementRBIStatsForBatter(r,e,i,c,1);if(this.situationAfterEvent.lastEventWasWalk||e.code==="end_at_bat"&&t.contains(["hit_by_pitch","catcher_interference"],e.attributes.endAtBatReason))return this.incrementRBIStatsForBatter(r,e,i,c,this.baserunnersAfterEvent.runnersScoredOnLastEvent.length);if(!t.contains(["ball_in_play","base_running"],e.code)||e.code==="base_running"&&!t.contains(["advanced_on_last_play","remained_on_last_play","out_on_last_play","did_not_score"],e.attributes.baseRunningPlayType))return r;var f=e.lastBallInPlayWasGround&&e.forcedOutsOnPlay===2&&e.forcedOutsOnEvent===1,_=e.lastBallInPlayWasGround&&(e.forcedOutsOnPlay===3||e.forcedOutsOnPlay===2&&e.forcedOutsOnEvent===0);if(e.lastBallInPlayWasRBIEligible!==!0||_)return r;if(f){var S=-1*t.last(e.scoresOnPlayAfterEachEvent,2)[0];r=this.incrementRBIStatsForBatter(r,e,i,e.lastBatter.id,S)}else{var P=t.last(e.scoresOnPlayAfterEachEvent,2),S=t.last(P)-(P.length===1?0:P[0]);r=this.incrementRBIStatsForBatter(r,e,i,e.lastBatter.id,S)}return r},a.prototype.appendPitchStyleStats=function(r,e){if(!(r.code!=="pitch"||r.attributes.pitchStyle===void 0)){var i="";switch(r.attributes.pitchStyle){case"fastball":i="FB";break;case"curveball":i="CB";break;case"slider":i="SL";break;case"changeup":i="CH";break;case"cutter":i="CT";break;case"riseball":i="RB";break;case"dropball":i="DB";break;case"screwball":i="SC";break;case"drop_curve":i="DC";break;case"knuckleball":i="KB";break;case"knuckle_curve":i="KC";break;default:return}e.push({key:i,increment:!0}),e.push({key:"".concat(i,"S"),increment:r.isStrike}),e.push({key:"".concat(i,"SW"),increment:r.isSwing}),e.push({key:"".concat(i,"SM"),increment:r.isMiss}),e.push({key:"".concat(i,"#MPH"),increment:r.attributes.pitchSpeed!==void 0}),e.push({key:"".concat(i,"MPH"),incrementBy:r.attributes.pitchSpeed||0}),r.attributes.pitchSpeed!==void 0&&e.push({key:"Top".concat(i),maxValue:r.attributes.pitchSpeed})}},a.prototype.updatePitcherStats=function(r,e){var i=this.situationBeforeEvent.inFieldTeamId,c=this.fieldersBeforeEvent.playerForPosition(i,"P"),f=this.earnedRunsAfterEvent.mostRecentRunner(e.lastBatter.id),_=!1;f!==void 0&&(_=f.out);var S=[{key:"GS",increment:e.code==="pitch"&&e.firstPitchThrownForTeam},{key:"DP:P",incrementBy:e.doublePlayIncrement},{key:"TP:P",increment:e.outsOnPlay===3},{key:"#P",increment:e.code==="pitch"},{key:"BF",increment:e.isPlateAppearance},{key:"TS",increment:e.isStrike},{key:"TB",increment:e.isBall},{key:"FPS",increment:this.situationAfterEvent.pitchesThisAtBat===1&&e.isStrike},{key:"INP",increment:e.code==="ball_in_play"&&e.isInPlay},{key:"SW",increment:e.isSwing},{key:"SM",increment:e.isMiss},{key:"2STRIKES",increment:(e.code==="pitch"||e.code==="override")&&this.situationAfterEvent.strikes===2&&this.situationBeforeEvent.strikes!==this.situationAfterEvent.strikes},{key:"FULL",increment:(e.code==="pitch"||e.code==="override")&&this.situationAfterEvent.strikes===2&&this.situationAfterEvent.balls===3&&(this.situationBeforeEvent.strikes!==this.situationAfterEvent.strikes||this.situationBeforeEvent.balls!==this.situationAfterEvent.balls)},{key:"LOB",increment:!1},{key:"SB",increment:e.code==="base_running"&&e.attributes.baseRunningPlayType==="stole_base"},{key:"LOBB",increment:this.situationAfterEvent.lastEventWasWalk&&e.leadOff},{key:"SO",increment:this.situationAfterEvent.lastEventWasStrikeout||e.code==="ball_in_play"&&e.attributes.ballInPlayResult==="foul_tip_out"},{key:"SOL",increment:this.situationAfterEvent.lastEventWasStrikeout&&e.atBatLastPitchResult==="strike_looking"},{key:"WP",increment:this.situationAfterEvent.lastEventWasStrikeout&&e.attributes.droppedThirdStrikeCause==="wild_pitch"||e.code==="base_running"&&e.attributes.baseRunningPlayType==="wild_pitch"},{key:"HBP",increment:e.code==="end_at_bat"&&e.attributes.endAtBatReason==="hit_by_pitch"},{key:"FPSO",increment:e.firstPitchStrikeAtBat&&e.code!=="base_running"&&(e.outsOnEvent>0||t.contains(["error","fielders_choice"],e.attributes.ballInPlayResult))},{key:"FPSW",increment:e.pitchesThisAtBat!==0&&e.firstPitchStrikeAtBat&&this.situationAfterEvent.lastEventWasWalk},{key:"FPSH",increment:e.firstPitchStrikeAtBat&&e.isHit},{key:"ABRISP",increment:e.isAtBat&&e.risp},{key:"HRISP",increment:e.isHit&&e.risp},{key:"<3",increment:e.pitchesThisAtBat<=3&&(this.situationAfterEvent.lastEventWasStrikeout||e.code==="ball_in_play"||this.situationAfterEvent.lastEventWasWalk)},{key:"<13",increment:e.pitchesThisInning<=13&&this.situationAfterEvent.lastEventEndedInning&&t.isEqual(e.firstPitcherOfInning,this.currentPitcher)},{key:"123INN",increment:this.situationAfterEvent.lastEventEndedInning&&e.outsOnEvent===1&&e.battersReachedBaseThisInning===0&&t.isEqual(e.firstPitcherOfInning,this.currentPitcher)},{key:"0BBINN",increment:this.situationAfterEvent.lastEventEndedInning&&e.walksThisInning===0},{key:"H",increment:e.isHit},{key:"IF",increment:e.code==="ball_in_play"&&e.attributes.ballInPlayResult==="infield_fly"},{key:"GO",increment:e.isGroundOut},{key:"AO",increment:e.isAirOut},{key:"GB",increment:e.isGround},{key:"LND",increment:e.attributes.ballInPlayType==="line_drive"},{key:"FLB",increment:t.contains(["pop_fly","fly_ball"],e.attributes.ballInPlayType)},{key:"FLY",increment:t.contains(["pop_fly","line_drive","fly_ball"],e.attributes.ballInPlayType)},{key:"HARD",increment:e.isHardHit&&e.isInPlay},{key:"WEAK",increment:!e.isHardHit&&e.isInPlay},{key:"SHF",increment:e.code==="ball_in_play"&&e.attributes.ballInPlayResult==="sacrifice_fly"},{key:"SHB",increment:e.code==="ball_in_play"&&e.attributes.ballInPlayResult==="sacrifice_bunt"},{key:"outs",incrementBy:e.outsOnEvent},{key:"1B",increment:e.code==="ball_in_play"&&e.attributes.ballInPlayResult==="single"},{key:"2B",increment:e.code==="ball_in_play"&&e.attributes.ballInPlayResult==="double"},{key:"3B",increment:e.code==="ball_in_play"&&e.attributes.ballInPlayResult==="triple"},{key:"HR",increment:e.code==="ball_in_play"&&e.attributes.ballInPlayResult==="home_run"},{key:"FC",increment:e.code==="ball_in_play"&&e.attributes.ballInPlayResult==="fielders_choice"},{key:"FC",incrementBy:-(0,d.bin)(_&&e.doublePlayIncrement===1&&e.lastBallInPlayResult==="fielders_choice")},{key:"CI",increment:e.code==="end_at_bat"&&e.attributes.endAtBatReason==="catcher_interference"},{key:"BK",increment:e.code==="balk"},{key:"R",increment:!1},{key:"PIK",increment:e.positionForPickoff==="P"},{key:"CS",increment:e.code==="base_running"&&e.attributes.baseRunningPlayType==="caught_stealing"},{key:"1ST2OUT",increment:(e.isEndOfPitchesToCurrentBatter||e.code==="ball_in_play"&&u.ballInPlayResultConfigs[e.attributes.ballInPlayResult].batterOut)&&this.situationAfterEvent.outs===2&&e.battersThisInning===2&&t.isEqual(e.firstPitcherOfInning,this.currentPitcher)},{key:"LOO",increment:e.code!=="base_running"&&e.battersThisInning===1&&t.isEqual(e.firstPitcherOfInning,this.currentPitcher)&&this.earnedRunsAfterEvent.effectiveOutsForTeam===1&&this.earnedRunsAfterEvent.runnersEffectivelyOutOnEventIndex(this.nextEventOffset).length===1},{key:"ER",increment:!1}];if(this.situationAfterEvent.lastEventWasWalk){var P=this.earnedRunsAfterEvent.runners[0];r=r.incrementPlayerStats(i,P.pitcherId,"defense","BB",1),P.pitcherId!==c&&(r=r.incrementPlayerStats(i,P.pitcherId,"defense","BF",1,!1))}for(var I=0,E=this.earnedRunsAfterEvent.runnersScoredOnEventIndex(this.nextEventOffset);I<E.length;I++){var B=E[I];B.placed||(this.earnedRunsAfterEvent.effectiveOutsForTeam<3&&(r=r.incrementTeamStats(i,"defense","ER",1)),this.earnedRunsAfterEvent.effectiveOutsForPitcher(B.pitcherId)<3&&(r=r.incrementPlayerStats(i,B.pitcherId,"defense","ER",1,!1))),B.walked&&(r=r.incrementPlayerStats(i,B.pitcherId,"defense","WALKS_SCORED",1,!0))}for(var b=0,R=this.earnedRunsAfterEvent.runnersUnscoredOnEventIndex(this.nextEventOffset);b<R.length;b++){var F=R[b];if(!F.placed){var x=F.scoredOnEventIndex;this.earnedRuns.stateAfterEvent(x).effectiveOutsForTeam<3&&(r=r.incrementTeamStats(i,"defense","ER",-1)),this.earnedRuns.stateAfterEvent(x).effectiveOutsForPitcher(F.pitcherId)<3&&(r=r.incrementPlayerStats(i,F.pitcherId,"defense","ER",-1,!1))}F.walked&&(r=r.incrementPlayerStats(i,F.pitcherId,"defense","WALKS_SCORED",-1,!0))}for(var w=0,L=this.baserunnersAfterEvent.runnersScoredOnLastEvent;w<L.length;w++){var D=L[w],P=this.earnedRunsAfterEvent.currentRunner(D);r=r.updatePlayerStatsElements(i,P!==void 0?P.pitcherId:void 0,"defense",[{key:"R",increment:!0},{key:"BBS",increment:P!==void 0&&P.walked},{key:"LOBBS",increment:P!==void 0&&P.walked&&P.leadoff}])}for(var U=0,G=this.baserunnersAfterEvent.runnersUnscoredOnLastEvent;U<G.length;U++){var q=G[U],P=this.earnedRunsAfterEvent.mostRecentRunner(q);r=r.updatePlayerStatsElements(i,P!==void 0?P.pitcherId:void 0,"defense",[{key:"R",incrementBy:-1},{key:"BBS",incrementBy:-(0,d.bin)(P!==void 0&&P.walked)},{key:"LOBBS",incrementBy:-(0,d.bin)(P!==void 0&&P.walked&&P.leadoff)}])}e.code==="pitch"&&e.attributes.pitchSpeed!==void 0&&S.push({key:"TopMPH",maxValue:e.attributes.pitchSpeed}),this.appendPitchStyleStats(e,S),r=r.updatePlayerStatsElements(i,c,"defense",S),e.code==="pitch"&&this.isInningExtendedByError()&&(r=r.incrementTeamStats(i,"defense","EXTRA_PITCHES",1)),this.situationAfterEvent.lastEventEndedInning&&(r=r.incrementPlayerStats(i,c,"defense","LOB",this.baserunnersAfterEvent.runnersLeftOnBase));var z=this.situationBeforeEvent.atBatIndex;if(c!==void 0&&e.code==="pitch"&&r.getIn(["pitcherLastAtBatIndex",c])!==z){var ne=r.getPlayerStat(i,c,"defense","#P");r=r.setPlayerStats(i,c,"defense","LBFPN",ne).setIn(["pitcherLastAtBatIndex",c],z)}return r},a.prototype.updateCatcherStats=function(r,e){var i=this.situationBeforeEvent.inFieldTeamId,c=this.fieldersBeforeEvent.playerForPosition(i,"C"),f=[{key:"E",increment:e.code==="end_at_bat"&&e.attributes.endAtBatReason==="catcher_interference"},{key:"E:C",increment:e.code==="end_at_bat"&&e.attributes.endAtBatReason==="catcher_interference"},{key:"CI:C",increment:e.code==="end_at_bat"&&e.attributes.endAtBatReason==="catcher_interference"},{key:"PB:C",increment:e.isKPassedBall||e.code==="base_running"&&e.attributes.baseRunningPlayType==="passed_ball"},{key:"SB:C",increment:e.code==="base_running"&&e.attributes.baseRunningPlayType==="stole_base"},{key:"outs:C",incrementBy:e.outsOnEvent},{key:"PIK:C",increment:e.positionForPickoff==="C"},{key:"CS:C",increment:e.code==="base_running"&&e.attributes.baseRunningPlayType==="caught_stealing"}];return!t.contains(["dropped_third_strike","dropped_third_strike_batter_out"],e.attributes.ballInPlayResult)&&(e.attributes.ballInPlayResult==="foul_tip_out"||this.situationAfterEvent.lastEventWasStrikeout)&&(r=r.incrementPlayerStats(i,c,"defense","PO",1),r=r.incrementPlayerStats(i,c,"defense","PO:C",1)),r.updatePlayerStatsElements(i,c,"defense",f)},a.prototype.updateFielderStatsForPlayer=function(r,e,i,c){var f=this.situationBeforeEvent.inFieldTeamId,_=[{key:"outs:F",incrementBy:e.outsOnEvent},{key:"outs-".concat(c),incrementBy:e.outsOnEvent}];return r.updatePlayerStatsElements(f,i,"defense",_)},a.prototype.incrementAPOForDefenders=function(r,e,i,c,f){f===void 0&&(f=!1);var _=this.fieldersBeforeEvent.positionsMapForTeam(this.situationBeforeEvent.inFieldTeamId),S={},P=!1;if(i===1)for(var I=0;I<e.length;I++){var E=_[e[I].position],B=e[I].position;I<e.length-1?P||(P=e[I].error,!P&&(E===void 0||S[E]===void 0)&&(f||(r=r.incrementPlayerStats(this.situationBeforeEvent.inFieldTeamId,E,"defense","A"),r=r.incrementPlayerStats(this.situationBeforeEvent.inFieldTeamId,E,"defense","A:".concat(B))),S[E]=!0)):(r=r.incrementPlayerStats(this.situationBeforeEvent.inFieldTeamId,E,"defense","PO",c?0:1),r=r.incrementPlayerStats(this.situationBeforeEvent.inFieldTeamId,E,"defense","PO:".concat(B),c?0:1))}else{var b=void 0,B=void 0;e.length<i?(B=e[0].position,b=_[B]):(B=e[e.length-i].position,b=_[B]),r=r.incrementPlayerStats(this.situationBeforeEvent.inFieldTeamId,b,"defense","PO",c?0:1),r=r.incrementPlayerStats(this.situationBeforeEvent.inFieldTeamId,b,"defense","PO:".concat(B),c?0:1)}return r},a.prototype.incrementEForDefenders=function(r,e){for(var i=!1,c=this.fieldersBeforeEvent.positionsMapForTeam(this.situationBeforeEvent.inFieldTeamId),f=0;f<e.length;f++)e[f].error&&(r=r.incrementPlayerStats(this.situationBeforeEvent.inFieldTeamId,c[e[f].position],"defense","E"),r=r.incrementPlayerStats(this.situationBeforeEvent.inFieldTeamId,c[e[f].position],"defense","E:".concat(e[f].position)),i=!0);return i||(r=r.incrementTeamStats(this.situationBeforeEvent.inFieldTeamId,"defense","E")),r},a.prototype.reconcileAssistsWithPreviousDefenders=function(r,e){var i={},c=!1;t.each(e.defendersByEventInPlay,function(b,R){t.each(b,function(F,x){c=c||F.error,!c&&(R<e.defendersByEventInPlay.length-2||R!==e.defendersByEventInPlay.length-1&&x!==b.length-1)&&(i[F.position]=!0)})});var f={},_=t.last(e.defendersByEventInPlay[e.defendersByEventInPlay.length-2]);if(_===void 0)return r;var S=_.position;f[S]=!0;for(var P=0,I=t.initial(e.defenders);P<I.length;P++){var E=I[P];f[E.position]=!0}for(var B in f)i[B]===void 0&&(r=r.incrementPlayerStats(this.situationBeforeEvent.inFieldTeamId,this.fieldersBeforeEvent.playerForPosition(this.situationBeforeEvent.inFieldTeamId,B),"defense","A"),r=r.incrementPlayerStats(this.situationBeforeEvent.inFieldTeamId,this.fieldersBeforeEvent.playerForPosition(this.situationBeforeEvent.inFieldTeamId,B),"defense","A:".concat(B)));return r},a.prototype.updateDefenderStats=function(r,e){if(e.isError&&e.code!=="end_at_bat"&&(r=this.incrementEForDefenders(r,e.defenders)),e.doublePlayIncrement!==0){r=r.incrementTeamStats(this.situationBeforeEvent.inFieldTeamId,"defense","DP",e.doublePlayIncrement);for(var i=0,c=e.defenderIdsAtPointOfDoublePlay;i<c.length;i++){var f=c[i];r=r.incrementPlayerStats(this.situationBeforeEvent.inFieldTeamId,f,"defense","DP",e.doublePlayIncrement,!1),r=r.incrementPlayerStats(this.situationBeforeEvent.inFieldTeamId,f,"defense","DPP:".concat(this.fieldersBeforeEvent.positionForPlayer(f)),e.doublePlayIncrement,!1)}}if(e.outsOnPlay===3){r=r.incrementTeamStats(this.situationBeforeEvent.inFieldTeamId,"defense","TP",1);for(var _=0,S=e.defenderIdsForPlay;_<S.length;_++){var f=S[_];r=r.incrementPlayerStats(this.situationBeforeEvent.inFieldTeamId,f,"defense","TP",1,!1),r=r.incrementPlayerStats(this.situationBeforeEvent.inFieldTeamId,f,"defense","TPP:".concat(this.fieldersBeforeEvent.positionForPlayer(f)),1,!1)}}if(e.defenders===void 0||e.defenders.length===0&&e.attributes.baseRunningPlayType!=="out_on_last_play")return r;var P,I;if(e.defenders.length===0?(P=e.defendersByEventInPlay[0],I=!1):(P=e.defenders,I=!0),P.length===0)return r;if(e.outsOnEvent>0||e.isError)if(e.batterOutOnCatchInPlay&&e.eventIndexInPlay===0){var E=this.fieldersBeforeEvent.playerForPosition(this.situationBeforeEvent.inFieldTeamId,P[0].position);r=r.incrementPlayerStats(this.situationBeforeEvent.inFieldTeamId,E,"defense","PO"),r=r.incrementPlayerStats(this.situationBeforeEvent.inFieldTeamId,E,"defense","PO:".concat(P[0].position))}else if(e.code==="ball_in_play"||e.code==="base_running"&&e.attributes.baseRunningPlayType==="out_on_last_play")if(I&&e.code==="base_running")r=this.incrementAPOForDefenders(r,P,e.outsOnEvent,e.isError,!0),r=this.reconcileAssistsWithPreviousDefenders(r,e);else{var B=1+e.outsOnPlay-e.outsOnEvent,b=B-(0,d.bin)(e.batterOutOnCatchInPlay);r=this.incrementAPOForDefenders(r,P,b,e.isError)}else e.code==="base_running"&&(r=this.incrementAPOForDefenders(r,P,1,e.isError));return r},a.prototype.updateBaserunnerStats=function(r,e){var i=this.situationBeforeEvent.atBatTeamId,c=[{key:"SB",increment:e.attributes.baseRunningPlayType==="stole_base"},{key:"CS",increment:e.attributes.baseRunningPlayType==="caught_stealing"},{key:"PIK",increment:e.attributes.baseRunningPlayType==="picked_off"}];return r=r.updatePlayerStatsElements(i,e.attributes.baseRunningRunnerId,"offense",c),r},a.prototype.updateDecisionStats=function(r,e){var i="";switch(e.attributes.pitcherDecision){case"win":i="W";break;case"loss":i="L";break;case"save":i="SV";break;case"blown_save":i="BS";break}for(var c=0,f=["W","L","SV","BS"];c<f.length;c++){var _=f[c];r=r.incrementPlayerStats(e.attributes.pitcherDecisionTeamId,e.attributes.pitcherDecisionPitcherId,"defense",_,(0,d.bin)(i===_))}return r},a.prototype.handleManualOverride=function(r,e){if(e.attributes.overrideScores===void 0)return r;for(var i=0,c=e.attributes.overrideScores;i<c.length;i++){var f=c[i];r=r.setTeamStats(f.teamId,"offense","R",f.score),f.teamId===this.situationBeforeEvent.inFieldTeamId?r=r.setTeamStats(this.situationBeforeEvent.atBatTeamId,"defense","R",f.score):r=r.setTeamStats(this.situationBeforeEvent.inFieldTeamId,"defense","R",f.score)}return r},a.prototype.updateStatsForEvent=function(r,e){var i=this.statEvents.stateAfterEvent(this.nextEventOffset).statsEvent;if(r=this.setGamesScored(r,e),t.contains(["NOP","PLAYER"],i.code))return r;r=this.updateBatterStats(r,i),r=this.updatePitcherStats(r,i),r=this.updateCatcherStats(r,i),r=this.updateDefenderStats(r,i);var c=this.fieldersBeforeEvent.positionsMapForTeam(this.situationBeforeEvent.inFieldTeamId);for(var f in c)if(c.hasOwnProperty(f)){var _=c[f];_!==void 0&&f!==void 0&&!t.contains(["EH","DH","F10"],f)&&(r=this.updateFielderStatsForPlayer(r,i,_,f))}return e.code==="pitcher_decision"&&(r=this.updateDecisionStats(r,i)),e.code==="base_running"&&(r=this.updateBaserunnerStats(r,i)),e.code==="override"&&(r=this.handleManualOverride(r,i)),r},a}(p.VersionedStateEngine);return jr.StatsEngine=v,jr}var nr={},Ta={},sf;function Ev(){if(sf)return Ta;sf=1,Object.defineProperty(Ta,"__esModule",{value:!0}),Ta.StatsEvent=void 0;var n=X,l=n.__importStar(Pe),t=n.__importStar(Rt()),p=n.__importStar(tt()),d=tt(),y=function(){function s(u,h,v,o,a){if(this.context=h,this.lastEventWasWalk=v,this.lastEventWasStrikeout=o,this.lastEventWasOut=a,this.id=u.id,this.attributes=Object(),this.defenders=u.attributes!==void 0&&u.attributes.defenders!==void 0?u.attributes.defenders:[],l.contains(["pitch","end_at_bat","balk","illegal_pitch","illegal_pitch_advance","ball_in_play","base_running","override","end_half","pitcher_decision","foul_error"],u.code)?this.code=u.code:l.contains(["fill_position","fill_lineup_index","fill_lineup","replace_runner","swap_players","assign_dh"],u.code)?this.code="PLAYER":this.code="NOP",this.isHit=(0,d.isHit)(u),this.isError=(0,d.isError)(u),this.isStrike=(0,d.isStrike)(u),u.code==="ball_in_play"){this.attributes.ballInPlayResult=u.attributes.playResult,this.attributes.ballInPlayType=u.attributes.playType,this.attributes.ballInPlayHomeRunLocation=u.attributes.hrLocation,this.attributes.droppedThirdStrikeCause=u.attributes.cause;var r=this.attributes.ballInPlayResult!=="batter_out_advance_runners"&&l.contains(["line_drive","fly_ball","pop_fly"],this.attributes.ballInPlayType),e=t.ballInPlayResultConfigs[this.attributes.ballInPlayResult].batterOut,i=u.attributes.ballWasCaught;e===!1?this.attributes.ballInPlayBallWasCaught=!1:e&&i===void 0?this.attributes.ballInPlayBallWasCaught=r:this.attributes.ballInPlayBallWasCaught=i}else u.code==="pitch"?(this.attributes.pitchResult=u.attributes.result,this.attributes.pitchStyle=u.attributes.style,this.attributes.pitchSpeed=u.attributes.speed,this.attributes.pitchAdvancesRunners=u.attributes.advancesRunners||!1):u.code==="base_running"?(this.attributes.baseRunningPlayType=u.attributes.playType,this.attributes.baseRunningRunnerId=u.attributes.runnerId):u.code==="end_at_bat"?this.attributes.endAtBatReason=u.attributes.reason:u.code==="pitcher_decision"?(this.attributes.pitcherDecisionTeamId=u.attributes.teamId,this.attributes.pitcherDecisionPitcherId=u.attributes.pitcherId,this.attributes.pitcherDecision=u.attributes.decision):u.code==="override"&&(this.attributes.overrideScores=u.attributes.scores)}return Object.defineProperty(s.prototype,"isSwing",{get:function(){return this.code==="pitch"&&(this.attributes.pitchResult==="strike_swinging"||this.attributes.pitchResult==="ball_in_play"||this.attributes.pitchResult==="foul"||this.attributes.pitchResult==="foul_bunt")},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"isMiss",{get:function(){return this.code==="pitch"&&this.attributes.pitchResult==="strike_swinging"},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"isBall",{get:function(){return this.code==="pitch"&&l.contains(["ball","intentional_ball","illegal_pitch"],this.attributes.pitchResult)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"isKPassedBall",{get:function(){return this.attributes.ballInPlayResult==="dropped_third_strike"&&this.attributes.droppedThirdStrikeCause==="passed_ball"},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"reachedBaseOnError",{get:function(){return this.code==="ball_in_play"&&this.isError},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"isHitOut",{get:function(){return this.code==="ball_in_play"&&l.contains(["batter_out","batter_out_advance_runners","infield_fly","offensive_interference"],this.attributes.ballInPlayResult)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"isSacrifice",{get:function(){return this.code==="ball_in_play"&&(0,d.isSacrificeResult)(this.attributes.ballInPlayResult)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"isHardHitCode",{get:function(){return l.contains(["hard_ground_ball","line_drive"],this.attributes.ballInPlayType)||this.attributes.ballInPlayResult==="home_run"&&this.attributes.ballInPlayHomeRunLocation!=="in_the_park"},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"isHardHit",{get:function(){return this.code==="ball_in_play"&&this.isHardHitCode},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"isInPlay",{get:function(){return this.code==="ball_in_play"?this.attributes.droppedThirdStrikeCause==="passed_ball"?!0:!l.contains(["other_out","foul_tip_out","foul_error","other_out","dropped_third_strike","dropped_third_strike_batter_out"],this.attributes.ballInPlayResult):!1},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"isAtBat",{get:function(){return this.isHit||this.isHitOut||this.lastEventWasStrikeout||this.reachedBaseOnError&&!this.isSacrifice||this.code==="ball_in_play"&&l.contains(["dropped_third_strike","dropped_third_strike_batter_out","fielders_choice","foul_tip_out","other_out"],this.attributes.ballInPlayResult)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"isPlateAppearance",{get:function(){return this.isAtBat||this.lastEventWasWalk||this.isSacrifice||this.code==="end_at_bat"&&l.contains(["hit_by_pitch","catcher_interference"],this.attributes.endAtBatReason)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"isAirOut",{get:function(){return this.code==="ball_in_play"&&l.contains(["batter_out","batter_out_advance_runners","infield_fly","sacrifice_fly"],this.attributes.ballInPlayResult)&&l.contains(["pop_fly","line_drive","fly_ball"],this.attributes.ballInPlayType)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"isGround",{get:function(){return this.code==="ball_in_play"&&p.isGroundType(this.attributes.ballInPlayType)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"lastBallInPlayWasGround",{get:function(){return l.contains(["ground_ball","hard_ground_ball"],this.lastBallInPlayType)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"isGroundOut",{get:function(){return p.isGroundOutResult(this.attributes.ballInPlayType,this.attributes.ballInPlayResult)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"isBattingPlay",{get:function(){return this.isAtBat||this.code==="pitch"},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"isGoodPlay",{get:function(){return this.lastEventWasWalk||this.code==="ball_in_play"&&l.contains(["double","triple","home_run","sacrifice_bunt","sacrifice_fly","sacrifice_fly_error","sacrifice_bunt_error"],this.attributes.ballInPlayResult)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"isEndOfPitchesToCurrentBatter",{get:function(){return this.lastEventWasStrikeout||this.lastEventWasWalk||this.code==="end_at_bat"||this.code==="pitch"&&this.attributes.pitchResult==="ball_in_play"},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"didBatterReachBase",{get:function(){return this.code==="ball_in_play"&&!t.ballInPlayResultConfigs[this.attributes.ballInPlayResult].batterOut||this.code==="pitch"&&this.lastEventWasWalk||this.code==="end_at_bat"&&this.attributes.endAtBatReason!=="strikeout"},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"outsOnEvent",{get:function(){return this.lastEventWasOut?1:0},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"isEndOfAtBat",{get:function(){return this.lastEventWasStrikeout||this.lastEventWasWalk||this.code==="end_at_bat"||this.code==="ball_in_play"},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"positionForPickoff",{get:function(){if(!(this.code!=="base_running"||this.attributes.baseRunningPlayType!=="picked_off")){var u=(l.first(this.defenders)||{}).position;return l.contains(["P","C"],u)?u:this.context.defaultPickOffPosition}},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"numberOfBaserunnersAfterLastBatterAtBatDone",{get:function(){var u=0;for(var h in this.baserunnersAfterLastBatterAtBatDone)h!==void 0&&(u+=this.baserunnersAfterLastBatterAtBatDone[h]!==void 0?1:0);return u},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"doublePlayIncrement",{get:function(){return this.outsOnPlay===2&&this.outsOnEvent===1?1:this.outsOnPlay===3?-1:0},enumerable:!1,configurable:!0}),s}();return Ta.StatsEvent=y,Ta}var of;function Bv(){if(of)return nr;of=1,Object.defineProperty(nr,"__esModule",{value:!0}),nr.StatEventsEngine=nr.StateAccessorWrapper=nr.StatsEventEngineState=void 0;var n=X,l=n.__importStar(Pe),t=n.__importStar(fe()),p=tt(),d=Ev(),y=n.__importStar(Ee()),s=n.__importStar(Oe()),u=function(o){n.__extends(a,o);function a(){return o!==null&&o.apply(this,arguments)||this}return a}(s.ImmutableState);nr.StatsEventEngineState=u;var h=function(o){n.__extends(a,o);function a(r){var e=o.call(this,r)||this;return e.internalObject=r,e}return a.prototype.get=function(r){return this.internalObject.get(r)},a.prototype.set=function(r,e){return new a(this.internalObject.set(r,e))},a.prototype.withMutations=function(r){return new a(this.internalObject.withMutations(r))},Object.defineProperty(a.prototype,"strikes",{get:function(){return this.internalObject.get("strikes")},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"leadOff",{get:function(){return this.internalObject.get("leadOff")},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"have2Strikes",{get:function(){return this.internalObject.get("have2Strikes")},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"pitchesAfter2Strikes",{get:function(){return this.internalObject.get("pitchesAfter2Strikes")},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"firstPitchStrikeAtBat",{get:function(){return this.internalObject.get("firstPitchStrikeAtBat")},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"qabIncrementedForPlay",{get:function(){return this.internalObject.get("qabIncrementedForPlay")},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"twoPlusThreeIncrementedForPlay",{get:function(){return this.internalObject.get("twoPlusThreeIncrementedForPlay")},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"sixPlusIncrementedForPlay",{get:function(){return this.internalObject.get("sixPlusIncrementedForPlay")},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"battersThisInning",{get:function(){return this.internalObject.get("battersThisInning")},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"battersReachedBaseThisInning",{get:function(){return this.internalObject.get("battersReachedBaseThisInning")},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"walksThisInning",{get:function(){return this.internalObject.get("walksThisInning")},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"firstPitchThrownForTeam",{get:function(){return this.internalObject.get("firstPitchThrownForTeam")},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"firstPitcherOfInning",{get:function(){return this.internalObject.get("firstPitcherOfInning")},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"forcedOutsOnPlay",{get:function(){return this.internalObject.get("forcedOutsOnPlay")},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"forcedOutsOnEvent",{get:function(){return this.internalObject.get("forcedOutsOnEvent")},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"outsOnPlay",{get:function(){return this.internalObject.get("outsOnPlay")},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"scoresOnPlayAfterEachEvent",{get:function(){return this.internalObject.get("scoresOnPlayAfterEachEvent")},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"batterOutOnCatchInPlay",{get:function(){return this.internalObject.get("batterOutOnCatchInPlay")},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"eventIndexInPlay",{get:function(){return this.internalObject.get("eventIndexInPlay")},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"lastBallInPlayResult",{get:function(){return this.internalObject.get("lastBallInPlayResult")},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"lastBallInPlayType",{get:function(){return this.internalObject.get("lastBallInPlayType")},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"lastBallInPlayWasRBIEligible",{get:function(){return this.internalObject.get("lastBallInPlayWasRBIEligible")},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"defendersByEventInPlay",{get:function(){return this.internalObject.get("defendersByEventInPlay").toJS()},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"defenderIdsForPlay",{get:function(){return this.internalObject.get("defenderIdsForPlay").toArray()},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"defenderIdsAtPointOfDoublePlay",{get:function(){return this.internalObject.get("defenderIdsAtPointOfDoublePlay").toArray()},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"baserunnersAfterLastBatterAtBatDone",{get:function(){return this.internalObject.get("baserunnersAfterLastBatterAtBatDone")},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"lastBatterId",{get:function(){return this.internalObject.get("lastBatterId")},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"lastBatterTeamId",{get:function(){return this.internalObject.get("lastBatterTeamId")},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"atBatLastPitchResult",{get:function(){return this.internalObject.get("atBatLastPitchResult")},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"playerLOBIncrement",{get:function(){return this.internalObject.get("playerLOBIncrement")},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"statsEvent",{get:function(){return this.internalObject.get("statsEvent")},enumerable:!1,configurable:!0}),a}(s.ImmutableState);nr.StateAccessorWrapper=h;var v=function(o){n.__extends(a,o);function a(r,e,i,c,f,_,S){var P=o.call(this,r)||this;return P.context=e,P.baserunners=i,P.situation=c,P.lineup=f,P.fielders=_,P.plays=S,P.pitchUpdaters=[P.updateWalksThisInning.bind(P),P.updateBattersReachedBase.bind(P),P.updateFirstPitcherOfInning.bind(P),P.updateFirstPitchStrikeAtBat.bind(P),P.updateLeadOff.bind(P),P.updateBattersThisInning.bind(P),P.updateFirstPitchThrownForTeam.bind(P),P.updateAtBatLastPitchResult.bind(P)],P.playUpdaters=[P.updateLastBatterIds.bind(P),P.updateLastBallInPlay.bind(P),P.updateBaseRunning.bind(P),P.updateOutsOnPlay.bind(P),P.updateDefenderIds.bind(P),P.updateScoresOnPlayAfterEachEvent.bind(P),P.updateBatterOutOnCatchInPlay.bind(P),P.updatePlayerLOBIncrement.bind(P)],P.updaters=[P.updateFromOtherEngines.bind(P)].concat(P.pitchUpdaters,P.playUpdaters,[P.updateQABForPlay.bind(P)]),P}return a.prototype.initialState=function(){return new h(new u(t.fromJS({strikes:0,battersThisInning:0,battersReachedBaseThisInning:0,walksThisInning:0,firstPitchThrownForTeam:!1,firstPitcherOfInning:{},leadOff:!0,have2Strikes:!1,pitchesAfter2Strikes:0,firstPitchStrikeAtBat:!1,forcedOutsOnPlay:0,forcedOutsOnEvent:0,outsOnPlay:0,scoresOnPlayAfterEachEvent:[],batterOutOnCatchInPlay:!1,eventIndexInPlay:0,lastBallInPlayResult:void 0,lastBallInPlayType:void 0,lastBallInPlayWasRBIEligible:!1,defendersByEventInPlay:[],defenderIdsForPlay:[],defenderIdsAtPointOfDoublePlay:[],baserunnersAfterLastBatterAtBatDone:{1:void 0,2:void 0,3:void 0},lastBatterId:void 0,lastBatterTeamId:void 0,atBatLastPitchResult:void 0,qabIncrementedForPlay:!1,twoPlusThreeIncrementedForPlay:!1,sixPlusIncrementedForPlay:!1,playerLOBIncrement:0,statsEvent:void 0})))},a.prototype.processOneEvent=function(r,e){var i=this,c=this.situation.stateAfterEvent(this.nextEventOffset),f=new d.StatsEvent(e,this.context,c.lastEventWasWalk,c.lastEventWasStrikeout,c.lastEventWasOut);return r.withMutations(function(_){for(var S=new h(_),P=0,I=i.updaters;P<I.length;P++){var E=I[P];E(e,f,S)}_.set("statsEvent",f)})},a.prototype.updateFromOtherEngines=function(r,e,i){var c=this.situation.stateBeforeEvent(this.nextEventOffset),f=this.baserunners.stateBeforeEvent(this.nextEventOffset),_=this.plays.stateAfterEvent(this.nextEventOffset);e.risp=f.playerAtBase(2)!==void 0||f.playerAtBase(3)!==void 0,e.pitchesThisAtBat=c.pitchesThisAtBat+(r.code==="pitch"?1:0),e.pitchesThisInning=c.pitchesThisInning+(r.code==="pitch"?1:0),e.eventIndexInPlay=_.eventIndexInPlay},a.prototype.setEventPropertiesFromOwnState=function(r,e){for(var i=[],c=2;c<arguments.length;c++)i[c-2]=arguments[c];for(var f=0,_=i;f<_.length;f++){var S=_[f];e[S]=r.get(S)}},a.prototype.updateFirstPitchThrownForTeam=function(r,e,i){var c=this.situation.stateAfterEvent(this.nextEventOffset);r.code==="pitch"&&i.set("firstPitchThrownForTeam",c.pitchesThrownThisGame(c.inFieldTeamId)===1),this.setEventPropertiesFromOwnState(i,e,"firstPitchThrownForTeam")},a.prototype.updateBattersThisInning=function(r,e,i){var c=this.situation.stateAfterEvent(this.nextEventOffset);r.code==="pitch"&&(c.pitchesThisInning===1?i.set("battersThisInning",1):c.pitchesThisAtBat===1&&i.set("battersThisInning",i.battersThisInning+1)),this.setEventPropertiesFromOwnState(i,e,"battersThisInning")},a.prototype.updateLeadOff=function(r,e,i){var c=this.situation.stateAfterEvent(this.nextEventOffset);r.code==="pitch"&&c.pitchesThisAtBat===1&&i.set("leadOff",c.pitchesThisInning===1),this.setEventPropertiesFromOwnState(i,e,"leadOff")},a.prototype.updateFirstPitchStrikeAtBat=function(r,e,i){var c=this.situation.stateAfterEvent(this.nextEventOffset);r.code==="pitch"&&c.pitchesThisAtBat===1&&(e.isStrike?i.set("firstPitchStrikeAtBat",!0):i.set("firstPitchStrikeAtBat",!1)),this.setEventPropertiesFromOwnState(i,e,"firstPitchStrikeAtBat")},a.prototype.updateFirstPitcherOfInning=function(r,e,i){var c=this.situation.stateAfterEvent(this.nextEventOffset),f=this.fielders.stateAfterEvent(this.nextEventOffset),_=f.playerForPosition(c.inFieldTeamId,"P");(r.code==="pitch"&&c.pitchesThisInning===1||i.firstPitcherOfInning.get("id")===void 0&&_!==void 0)&&i.update("firstPitcherOfInning",function(S){return S.set("id",_).set("teamId",c.inFieldTeamId)}),e.firstPitcherOfInning={id:i.firstPitcherOfInning.get("id"),teamId:i.firstPitcherOfInning.get("teamId")}},a.prototype.updateBattersReachedBase=function(r,e,i){var c=this.situation.stateAfterEvent(this.nextEventOffset);r.code==="pitch"&&c.pitchesThisInning===1&&i.set("battersReachedBaseThisInning",0),i.set("battersReachedBaseThisInning",i.battersReachedBaseThisInning+(e.didBatterReachBase?1:0)),this.setEventPropertiesFromOwnState(i,e,"battersReachedBaseThisInning")},a.prototype.updateWalksThisInning=function(r,e,i){var c=this.situation.stateAfterEvent(this.nextEventOffset);r.code==="pitch"&&c.pitchesThisInning===1&&i.set("walksThisInning",0),c.lastEventWasWalk&&i.set("walksThisInning",i.walksThisInning+1),this.setEventPropertiesFromOwnState(i,e,"walksThisInning")},a.prototype.updateAtBatLastPitchResult=function(r,e,i){var c,f=this.situation.stateBeforeEvent(this.nextEventOffset);f.pitchesThisAtBat===0&&i.set("atBatLastPitchResult",void 0),r.code==="pitch"&&i.set("atBatLastPitchResult",(c=e.attributes.pitchResult)!==null&&c!==void 0?c:void 0),this.setEventPropertiesFromOwnState(i,e,"atBatLastPitchResult")},a.prototype.getBaseForRunner=function(r,e){var i=0;for(var c in e)if(e[c]===r){i=+c;break}return i},a.prototype.idsFromDefenders=function(r){var e=this.situation.stateBeforeEvent(this.nextEventOffset),i=this.fielders.stateBeforeEvent(this.nextEventOffset);return l.uniq(l.map(r,function(c){return i.playerForPosition(e.inFieldTeamId,c.position)}))},a.prototype.updateBatterOutOnCatchInPlay=function(r,e,i){(0,p.eventRelatesToAtBatTeam)(r)&&((0,p.baserunningRelatedToLastBIP)(r)||i.set("batterOutOnCatchInPlay",r.code==="ball_in_play"&&!!e.attributes.ballInPlayBallWasCaught)),this.setEventPropertiesFromOwnState(i,e,"batterOutOnCatchInPlay")},a.prototype.updateScoresOnPlayAfterEachEvent=function(r,e,i){var c=this.baserunners.stateAfterEvent(this.nextEventOffset),f=this.plays.stateAfterEvent(this.nextEventOffset);f.isPartOfPlay&&!f.eventStartsNewPlay?i.update("scoresOnPlayAfterEachEvent",function(_){return _.push(i.scoresOnPlayAfterEachEvent.last()+c.runnersScoredOnLastEvent.length-c.runnersUnscoredOnLastEvent.length)}):f.isPartOfPlay&&i.update("scoresOnPlayAfterEachEvent",function(_){return _.clear().push(c.runnersScoredOnLastEvent.length)}),e.scoresOnPlayAfterEachEvent=i.scoresOnPlayAfterEachEvent.toArray()},a.prototype.updateDefenderIds=function(r,e,i){var c=this,f=this.plays.stateAfterEvent(this.nextEventOffset);(0,p.isBallInPlayEvent)(r)&&i.set("defendersByEventInPlay",t.List.of(r.attributes.defenders)),f.isPartOfPlay&&!f.eventStartsNewPlay?(i.update("defendersByEventInPlay",function(_){return _.push(r.attributes.defenders)}),i.update("defenderIdsForPlay",function(_){for(var S=0,P=c.idsFromDefenders(e.defenders);S<P.length;S++){var I=P[S];_.contains(I)||(_=_.push(I))}return _}),i.outsOnPlay===2&&e.outsOnEvent===1&&i.update("defenderIdsAtPointOfDoublePlay",function(_){_=_.clear();for(var S=0,P=i.defenderIdsForPlay.slice();S<P.length;S++){var I=P[S];_=_.push(I)}return _})):f.isPartOfPlay&&(i.update("defenderIdsForPlay",function(_){_=_.clear();for(var S=0,P=c.idsFromDefenders(e.defenders);S<P.length;S++){var I=P[S];_=_.push(I)}return _}),i.update("defenderIdsAtPointOfDoublePlay",function(_){return _.clear()})),e.defendersByEventInPlay=i.defendersByEventInPlay,e.defenderIdsForPlay=i.defenderIdsForPlay,e.defenderIdsAtPointOfDoublePlay=i.defenderIdsAtPointOfDoublePlay},a.prototype.updateOutsOnPlay=function(r,e,i){var c=this.situation.stateBeforeEvent(this.nextEventOffset),f=this.plays.stateAfterEvent(this.nextEventOffset);(0,p.manualInningAdvance)(r)?i.set("outsOnPlay",0):f.isPartOfPlay&&!f.eventStartsNewPlay?i.set("outsOnPlay",i.outsOnPlay+e.outsOnEvent):f.isPartOfPlay?i.set("outsOnPlay",e.outsOnEvent):c.lastEventEndedInning&&i.set("outsOnPlay",0),this.setEventPropertiesFromOwnState(i,e,"outsOnPlay")},a.prototype.updateBaseRunning=function(r,e,i){var c=this.baserunners.stateBeforeEvent(this.nextEventOffset),f=this.plays.stateAfterEvent(this.nextEventOffset);e.isEndOfAtBat&&i.update("baserunnersAfterLastBatterAtBatDone",function(I){return I.set("1",c.baserunners[1]).set("2",c.baserunners[2]).set("3",c.baserunners[3])});var _={1:i.baserunnersAfterLastBatterAtBatDone.get("1"),2:i.baserunnersAfterLastBatterAtBatDone.get("2"),3:i.baserunnersAfterLastBatterAtBatDone.get("3")};if(f.isPartOfPlay&&!f.eventStartsNewPlay){var S=r,P=this.getBaseForRunner(S.attributes.runnerId,_);S.attributes.playType==="out_on_last_play"&&S.attributes.base===P+1&&!i.batterOutOnCatchInPlay?(i.set("forcedOutsOnPlay",i.forcedOutsOnPlay+e.outsOnEvent),i.set("forcedOutsOnEvent",e.outsOnEvent)):i.set("forcedOutsOnEvent",0)}else(0,p.eventRelatesToAtBatTeam)(r)&&(i.set("forcedOutsOnPlay",e.outsOnEvent),i.set("forcedOutsOnEvent",e.outsOnEvent));e.baserunnersAfterLastBatterAtBatDone=_,this.setEventPropertiesFromOwnState.apply(this,n.__spreadArray([i,e],["forcedOutsOnPlay","forcedOutsOnEvent"],!1))},a.prototype.updateLastBallInPlay=function(r,e,i){var c=this.situation.stateBeforeEvent(this.nextEventOffset),f=this.baserunners.stateBeforeEvent(this.nextEventOffset);if(r.code==="ball_in_play"){var _=r.attributes.playType;i.set("lastBallInPlayResult",r.attributes.playResult),i.set("lastBallInPlayType",_),!e.isError&&!e.isKPassedBall||e.isSacrifice||c.outs<2&&f.playerAtBase(3)!==void 0&&(0,p.isGroundType)(_)?i.set("lastBallInPlayWasRBIEligible",!0):i.set("lastBallInPlayWasRBIEligible",!1)}else r.code==="base_running"&&!(0,p.baserunningRelatedToLastBIP)(r)&&(i.set("lastBallInPlayResult",void 0),i.set("lastBallInPlayType",void 0),i.set("lastBallInPlayWasRBIEligible",!1));this.setEventPropertiesFromOwnState.apply(this,n.__spreadArray([i,e],["lastBallInPlayResult","lastBallInPlayType","lastBallInPlayWasRBIEligible"],!1))},a.prototype.updateLastBatterIds=function(r,e,i){var c=this.situation.stateBeforeEvent(this.nextEventOffset),f=this.lineup.stateBeforeEvent(this.nextEventOffset);(r.code==="pitch"||r.code==="end_at_bat"||r.code==="ball_in_play"&&r.attributes.playResult==="other_out")&&(i.set("lastBatterId",f.currentBatter(c.atBatTeamId)),i.set("lastBatterTeamId",c.atBatTeamId)),e.lastBatter={id:i.lastBatterId,teamId:i.lastBatterTeamId},this.setEventPropertiesFromOwnState.apply(this,n.__spreadArray([i,e],["lastBatterId","lastBatterTeamId"],!1))},a.prototype.updatePlayerLOBIncrement=function(r,e,i){var c=this.situation.stateAfterEvent(this.nextEventOffset);i.set("playerLOBIncrement",0),e.code==="base_running"&&e.attributes.baseRunningPlayType==="advanced_on_last_play"&&r.attributes.base===4&&!((0,p.isHitResult)(i.lastBallInPlayResult)||(0,p.isSacrificeResult)(i.lastBallInPlayResult))?i.set("playerLOBIncrement",-1):e.code==="base_running"&&(e.attributes.baseRunningPlayType==="did_not_score"&&r.attributes.base===4||e.attributes.baseRunningPlayType==="remained_on_last_play"&&r.attributes.base===3)&&!((0,p.isHitResult)(i.lastBallInPlayResult)||(0,p.isSacrificeResult)(i.lastBallInPlayResult))?i.set("playerLOBIncrement",1):(e.isAtBat&&!e.isHit||c.lastEventWasStrikeout)&&i.set("playerLOBIncrement",e.numberOfBaserunnersAfterLastBatterAtBatDone-i.scoresOnPlayAfterEachEvent.first()),this.setEventPropertiesFromOwnState(i,e,"playerLOBIncrement")},a.prototype.updateQABForPlay=function(r,e,i){var c=this.situation.stateAfterEvent(this.nextEventOffset);r.code==="pitch"&&(i.have2Strikes&&i.set("pitchesAfter2Strikes",i.pitchesAfter2Strikes+1),c.strikes===2&&i.set("have2Strikes",!0));var f=i.pitchesAfter2Strikes>=3,_=e.pitchesThisAtBat>=6,S=_||f||e.isGoodPlay||e.isHardHit;_&&i.sixPlusIncrementedForPlay===!1?(e.sixPlusIncrement=1,i.set("sixPlusIncrementedForPlay",!0)):e.sixPlusIncrement=0,f&&i.twoPlusThreeIncrementedForPlay===!1?(e.threeAfterTwoIncrement=1,i.set("twoPlusThreeIncrementedForPlay",!0)):e.threeAfterTwoIncrement=0,S&&i.qabIncrementedForPlay===!1?(e.qabIncrement=1,i.set("qabIncrementedForPlay",!0)):e.qabIncrement=0,(c.lastEventEndedInning||e.isEndOfAtBat||(0,p.manualInningAdvance)(r))&&(i.set("pitchesAfter2Strikes",0),i.set("have2Strikes",!1),i.set("qabIncrementedForPlay",!1),i.set("twoPlusThreeIncrementedForPlay",!1),i.set("sixPlusIncrementedForPlay",!1))},a}(y.VersionedStateEngine);return nr.StatEventsEngine=v,nr}var uf;function Tv(){if(uf)return Xt;uf=1,Object.defineProperty(Xt,"__esModule",{value:!0}),Xt.BaseballCompactorController=Xt.BaseballTranscoderController=Xt.BaseballControllerMixin=void 0;var n=X,l=n.__importStar(Pe),t=n.__importStar(gt()),p=gt(),d=n.__importStar(Or()),y=$e(),s=Ay(),u=Ry(),h=Vy(),v=zy(),o=Ky(),a=n.__importStar(tt()),r=tt(),e=Rt(),i=Jy(),c=Yy(),f=er,_=av(),S=iv(),P=sv(),I=cv(),E=dv(),B=Nd(),b=fv(),R=pv(),F=hv(),x=yv(),w=vv(),L=gv(),D=Iv(),U=bv(),G=Bv(),q=function(){function ue(){}return ue.prototype.initializeEngines=function(ee){this.context=this.transformInputContext(ee),this.situation=new w.SituationEngine([]),this.plays=new x.PlaysEngine([],this.situation),this.fielders=new i.FieldersEngine([],this.situation),this.lineup=new _.LineupEngine([],this.situation),this.sprayChart=new L.SprayChartEngine([],this.situation,this.lineup,this.fielders),this.pitchData=new P.PitchDataEngine([],this.situation,this.fielders),this.baserunners=new v.BaserunnerEngine([],this.situation,this.lineup),this.actionContext=new u.ActionContextEngine([],this.situation,this.lineup,this.baserunners),this.earnedRuns=new o.EarnedRunEngine([],this.situation,this.lineup,this.fielders,this.baserunners),this.playByPlay=new I.PlayByPlayEngine([],this.context,this.situation,this.lineup,this.fielders,this.baserunners),this.statEvents=new G.StatEventsEngine([],this.context,this.baserunners,this.situation,this.lineup,this.fielders,this.plays),this.perInning=new S.PerInningEngine([],this.situation,this.baserunners,this.fielders),this.stats=new U.StatsEngine([],this.context,this.baserunners,this.situation,this.lineup,this.fielders,this.earnedRuns,this.statEvents),this.history=new c.HistoryEngine([],this.situation,this.lineup,this.fielders),this.engines=[this.plays,this.situation,this.fielders,this.lineup,this.sprayChart,this.pitchData,this.baserunners,this.actionContext,this.earnedRuns,this.playByPlay,this.statEvents,this.perInning,this.stats,this.history]},ue.prototype.unpivotSeasonStats=function(ee){if(ee!==void 0){for(var $={players:{},stats:{offense:{},defense:{},general:{}}},Y=0,W=ee.player;Y<W.length;Y++){var J=W[Y];$.players[J.id]={stats:{offense:{},defense:{},general:{}}}}return["offense","defense","general"].map(function(ae){ee.team[ae].map(function(se){var ie=se;$.stats[ae][ie.s]=ie.v}),ee.player.map(function(se){se[ae].map(function(ie){var ye=ie;$.players[se.id].stats[ae][ye.s]=ye.v})})}),$}},ue.prototype.transformInputContext=function(ee){var $,Y,W={};if(W.playerNames=ee.playerNames,W.inningsPerGame=ee.inningsPerGame,W.seasonStatsTeamId=ee.seasonStatsTeamId,W.seasonStats=this.unpivotSeasonStats(ee.seasonStats),W.playByPlayMetadataKeys=ee.playByPlayMetadataKeys,W.sport=ee.sport,W.backwardsCompatibleSentBackRunner=($=ee.backwardsCompatibleSentBackRunner)!==null&&$!==void 0?$:!1,W.sanityCheckEvents=(Y=ee.sanityCheckEvents)!==null&&Y!==void 0?Y:!1,W.isLLViolationAvailable=ee.ageGroup==="youth",ee.sport==="baseball")switch(W.defaultPickOffPosition="P",W.enableIllegalPitch=!1,ee.ageGroup){case"youth":W.enableIllegalPitch=!0,W.FIPConstant=3.5,W.FIPHRValue=1.48,W.FIPBBValue=.4,W.FIPIncludeHBPWithBB=!0,W.FIPSOValue=.36;break;case"prep":W.FIPConstant=3.2,W.FIPHRValue=1.45,W.FIPBBValue=.38,W.FIPIncludeHBPWithBB=!0,W.FIPSOValue=.31;break;case"college":W.FIPConstant=3.2,W.FIPHRValue=1.44,W.FIPBBValue=.37,W.FIPIncludeHBPWithBB=!0,W.FIPSOValue=.29;break;case"adult":W.FIPConstant=3.2,W.FIPHRValue=1.4,W.FIPBBValue=.34,W.FIPIncludeHBPWithBB=!0,W.FIPSOValue=.23;break}else switch(W.defaultPickOffPosition="C",W.enableIllegalPitch=!0,ee.ageGroup){case"youth":case"prep":case"college":W.FIPConstant=3.3,W.FIPHRValue=1.44,W.FIPBBValue=.36,W.FIPIncludeHBPWithBB=!1,W.FIPSOValue=.27;break;case"adult":W.FIPConstant=3.5,W.FIPHRValue=1.47,W.FIPBBValue=.42,W.FIPIncludeHBPWithBB=!1,W.FIPSOValue=.39;break}return W},ue.prototype.getDerivedMultiGamePivotedStatsWithBaseStats=function(ee){return this.stats.getDerivedMultiGamePivotedStatsWithBaseStats(ee)},ue.prototype.getDerivedMultiGameStatsWithBaseStats=function(ee){return this.stats.getDerivedMultiGameStatsWithBaseStats(ee)},ue}();Xt.BaseballControllerMixin=q;var z=function(ue){n.__extends(ee,ue);function ee($,Y){var W=ue.call(this)||this;W.stateAccessorClass=D.StateAccessor,W.numberOfDecisionEvents=0,W.initializeEngines(Y),W.transcoder=new f.Transcoder($,W.legacyEvents,W.situation,W.lineup,W.fielders,W.baserunners);for(var J=0,ae=W.engines;J<ae.length;J++){var se=ae[J];se.baseEvents=W.transcoder.outStream}return W.stateAccessorClass=D.StateAccessor,W.push({code:"set_teams",id:"auto_generated_set_teams",passThrough:!0,attributes:{homeId:$.homeTeamId,awayId:$.awayTeamId}}),W}return ee.prototype.pushEventsFromCompletedStream=function($){this.numberOfDecisionEvents>0&&this.rollbackDecisionEvents();var Y=this.transcoder.outStream.length;this.transcoder.pushEventsFromCompletedStream($),this.numberOfDecisionEvents=this.transcoder.outStream.length-Y},ee.prototype.rollbackDecisionEvents=function(){this.transcoder.outStream.splice(this.transcoder.outStream.length-this.numberOfDecisionEvents,this.numberOfDecisionEvents),this.setEngineOutStreamAndIndex(this.transcoder.outStream.length),this.numberOfDecisionEvents=0},ee.prototype.push=function($){return this.numberOfDecisionEvents>0&&this.rollbackDecisionEvents(),ue.prototype.push.call(this,$)},ee.prototype.updateFromPushPayload=function($,Y){return this.numberOfDecisionEvents>0&&this.rollbackDecisionEvents(),ue.prototype.updateFromPushPayload.call(this,$,Y)},ee}(t.TranscoderController);Xt.BaseballTranscoderController=z;var ne=function(ue){n.__extends(ee,ue);function ee($){var Y=ue.call(this)||this;Y.stateAccessorClass=D.StateAccessor,Y.initializeEngines($),Y.compactor=new d.SabertoothEventCompactor;for(var W=0,J=l.values(Y.compactor.componentStreams);W<J.length;W++){var ae=J[W];ae.eventBlacklistedForUndo=function(j){return j.code==="set_teams"}}for(var se=0,ie=Y.engines;se<ie.length;se++){var ye=ie[se];ye.baseEvents=Y.compactor.outStream}return Y}return ee.prototype.pushSerializedAndFetch=function($){var Y=JSON.parse($);return this.pushAndFetch(Y)},ee.prototype.pushAndFetch=function($){try{this.sanityCheckPushedEvent($)}catch(ae){throw this.clearScratch(),ae}var Y,W={sequenceNumber:this.inStreamLength(),eventId:$.id};if($.code==="undo")Y=this.getAnimationOperationsForLatestInStreamEvent(!0),Y=this.invertAnimationOperations(Y),this.pushBatch([$],this.context.sanityCheckEvents?"strictlyCheckUndoRedo":"looselyCheckUndoRedo");else{var J=this.shouldSkipAnimationOperations($);this.pushBatch([$],this.context.sanityCheckEvents?"strictlyCheckUndoRedo":"looselyCheckUndoRedo"),Y=J?[]:this.getAnimationOperationsForLatestInStreamEvent(!1)}return Y=this.coalesceAnimationOperations(Y),n.__assign(n.__assign({},this.internalGetLatestScorekeepingState(Y)),{sequenceNumberPair:W})},ee.prototype.sanityCheckPushedEvent=function($){if(this.context.sanityCheckEvents){var Y=$,W=this.firstScratchEventId();if(Y.code==="base_running"){var J=W?this.stateBeforeEvent(W):this.latestState(),ae=Y,se=ae.attributes.runnerId,ie=ae.attributes.base,ye=J.baserunners;if(ie===1&&ye[1]!==void 0&&ye[1]!==se||ie===2&&ye[2]!==void 0&&ye[2]!==se||ie===3&&ye[3]!==void 0&&ye[3]!==se)throw new p.SabertoothError("illegal_base_running","base_running event had destination base that was not empty");if(ye[1]!==se&&ye[2]!==se&&ye[3]!==se&&ye[-2]!==se&&ye[-3]!==se)throw new p.SabertoothError("illegal_base_running","base_running event had runnerId that was not on base");return}if(Y.code==="transaction"){var j=Y;if(j.events.length===0)return;Y=j.events[0]}if(Y.code==="pitch"){var te=this.situation.stateBeforeEventIdOrLatest(W).atBatTeamId,Z=this.lineup.stateBeforeEventIdOrLatest(W).currentBatter(te);if(Z===void 0)throw new p.SabertoothError("unset_batter","event received with no batter set");return}}},ee.prototype.shouldSkipAnimationOperations=function($){var Y=this.scratch;if(Y.length===0)return!1;if($.code==="transaction"){var W=$.events;return Y.length!==W.length?!1:l.zip(Y,W).every(function(J){return J[0].id===J[1].id})}else return Y.length!==1?!1:Y[0].id===$.id},ee.prototype.pushBatchAndFetch=function($){return this.pushBatch($),this.internalGetLatestScorekeepingState([])},ee.prototype.pushBatchToScratchAndFetch=function($){var Y=this.scratch.length>0;this.pushBatchToScratch($);var W=this.getAnimationOperationsForScratchEvents($);W=this.coalesceAnimationOperations(W);var J=this.internalGetLatestScorekeepingState(W);(!Y||this.baserunnerResolver===void 0)&&(this.baserunnerResolver=new h.BaserunnerResolver(this.context.isLLViolationAvailable,this.context.backwardsCompatibleSentBackRunner));var ae=this.baserunnerResolver.pushScratchEvents($,J.scorekeepingState,J.animationOperations);return n.__assign(n.__assign({},J),ae)},ee.prototype.markSafe=function($){return this.markResolution("safe",$)},ee.prototype.markOut=function($){return this.markResolution("out",$)},ee.prototype.markSentBack=function($){return this.markResolution("sent_back",$)},ee.prototype.markViolation=function($){return this.markResolution("violation",$)},ee.prototype.markResolution=function($,Y){var W,J,ae,se,ie=(J=(W=this.baserunnerResolver)===null||W===void 0?void 0:W.markResolution($,Y))!==null&&J!==void 0?J:{animationOperations:[],events:[]},ye=(se=(ae=this.baserunnerResolver)===null||ae===void 0?void 0:ae.isUsingBackwardsCompatibleResolver())!==null&&se!==void 0?se:!1,j=this.internalGetLatestScorekeepingState(ie.animationOperations,ye);return{animationOperations:j.animationOperations,events:ie.events}},ee.prototype.clearScratchAndFetch=function(){var $=this.getAnimationOperationsForScratchEvents(this.scratch);return $=this.invertAnimationOperations($),$=this.coalesceAnimationOperations($),this.clearScratch(),this.internalGetLatestScorekeepingState($)},ee.prototype.getLatestScorekeepingState=function(){return this.internalGetLatestScorekeepingState([])},ee.prototype.internalGetLatestScorekeepingState=function($,Y){Y===void 0&&(Y=!1);var W=this.outputStream(),J=W.length>0?W[W.length-1]:void 0,ae=this.latestState().scorekeepingState,se=[];return Y?se=$:se=this.addStationaryBaserunnersToAnimationOperations($,ae),{scorekeepingState:ae,undoRedoAvailability:this.undoRedoAvailability("main"),lastEventId:J===void 0?void 0:J.id,animationOperations:se}},ee.prototype.getAnimationOperationsForLatestInStreamEvent=function($){var Y,W,J,ae,se,ie=this.compactor.inStream;if(ie.length===0)return[];var ye=this.compactor.componentStreams.main,j=$?this.compactor.eventTargetedByUndoSubjectToBlacklist("main"):ie[ie.length-1];if(j===void 0||((W=(Y=j.compactorAttributes)===null||Y===void 0?void 0:Y.stream)!==null&&W!==void 0?W:"main")!=="main"||["insert","delete","replace","edit_group"].indexOf(j.code)>=0)return[];var te=ye.inEventIdToOutEventIdMap[j.id],Z=(J=this.compactor.outIndexMap[te])!==null&&J!==void 0?J:-1,M=-1,H=(ae=ye.inIndexMap[j.id])!==null&&ae!==void 0?ae:-1;if(H>0){var Q=ye.inStream[H-1],oe=ye.inEventIdToOutEventIdMap[Q.id];M=(se=this.compactor.outIndexMap[oe])!==null&&se!==void 0?se:-1}return this.collectAnimationOperations(M,Z)},ee.prototype.getAnimationOperationsForScratchEvents=function($){if($.length===0)return[];var Y=this.compactor.outStream.length-1,W=Y-$.length;return this.collectAnimationOperations(W,Y)},ee.prototype.collectAnimationOperations=function($,Y){for(var W=[],J=$+1;J<=Y;J++){var ae=this.baserunners.stateAfterEvent(J).animationOperations();W.push.apply(W,ae)}return W},ee.prototype.coalesceAnimationOperations=function($){for(var Y,W={},J=0,ae=$;J<ae.length;J++){var se=ae[J],ie=(Y=W[se.playerId])!==null&&Y!==void 0?Y:se;W[se.playerId]={playerId:se.playerId,result:se.result,toBase:se.toBase,fromBase:ie.fromBase}}return Object.values(W)},ee.prototype.invertAnimationOperations=function($){var Y=this;return $.reverse().map(function(W){var J,ae=(J=W.inverseResult)!==null&&J!==void 0?J:Y.invertResult(W.result);return{playerId:W.playerId,result:ae==="safe"&&W.fromBase===0?"removed":ae,fromBase:W.toBase,toBase:W.fromBase}})},ee.prototype.invertResult=function($){switch($){case"removed":return"safe";case"safe":return"safe";case"scored":return"safe";case"out":return"safe";case"poof":return"safe";case"subbedOut":return"subbedIn";case"subbedIn":return"subbedOut";default:return $}},ee.prototype.addStationaryBaserunnersToAnimationOperations=function($,Y){for(var W=n.__spreadArray([],$,!0),J=function(ye){var j=Y.fieldSituation.baserunners[ye],te=ye===-3?3:ye;if(j){var Z=$.find(function(M){return M.playerId===j});if(!Z)W.push({playerId:j,fromBase:te,toBase:te,result:"safe"});else if(Z.toBase!==te)throw"Runner ".concat(j," on ").concat(ye," has an operation that ends at base ").concat(Z.toBase)}},ae=0,se=[1,2,3,-3];ae<se.length;ae++){var ie=se[ae];J(ie)}return W},ee.prototype.undoRedoAvailabilityWithDescription=function($){var Y=this.undoRedoAvailability($),W=Y.undoEvent;return(0,y.isMetaEvent)(W)?(0,y.isTransactionMetaEvent)(W)?Y.undoEventDescription=a.codeForEvent(l.first(W.events)):Y.undoEventDescription=W.code:Y.undoEventDescription=a.codeForEvent(W),Y},ee.prototype.getPitcherDecisionEventIds=function(){return l.chain(this.outputStream()).filter(function($){return($==null?void 0:$.code)==="pitcher_decision"}).pluck("id").value()},ee.prototype.getDefensiveEditResult=function($,Y,W){var J=this.compactor.outIndexMap[$],ae=this.situation.stateBeforeEvent(J).inFieldTeamId,se=this.fielders.stateBeforeEvent(J).playerForPosition(ae,W);if(l.contains(["EH","DH"],W))throw"Cannot make replace a player who does not have a fielding position";var ie=this.history.latestState.positionHistory(ae)[W],ye=new E.DefensivePlayEdit($,this.compactor.outIndexMap,this.compactor.outStream,ae,W,ie,se),j=this.history.latestState.fielderHistory(ae)[Y];return ye.makeEditResult(Y,j)},ee.prototype.getOffensiveEditIneligiblePlayers=function($,Y){var W=this.playByPlay.getLatestState().completedAtBatContainingEvent($);if(W===void 0||W.index===void 0)throw"Cannot edit an event from an atBat that is in progress.";var J=this.compactor.outIndexMap[$],ae=this.situation.stateBeforeEvent(J).atBatTeamId;switch(Y){case e.BaseballOffensiveRole.Batter:var se=this.compactor.outIndexMap[W.result.eventId],ie=W.orderedEventIds[W.orderedEventIds.length-1],ye=this.compactor.outIndexMap[ie];return(0,B.getIneligiblePlayers)(J,se,ye,ae,this.lineup,this.baserunners);case e.BaseballOffensiveRole.Runner:return(0,B.getIneligiblePlayers)(J,J,J,ae,this.lineup,this.baserunners);default:throw"Unhandled role ".concat(Y)}},ee.prototype.getOffensiveEditResult=function($,Y,W){var J=this.playByPlay.getLatestState().completedAtBatContainingEvent($);if(J===void 0||J.index===void 0)throw"Cannot edit an event from an atBat that is in progress.";var ae=this.compactor.outIndexMap[$],se=this.compactor.outStream[ae],ie=this.situation.stateBeforeEvent(ae).atBatTeamId,ye=this.lineup.stateBeforeEvent(ae).currentBatter(ie),j=this.baserunners.stateBeforeEvent(ae).baserunners,te;if(Y===ye)te=e.BaseballOffensiveLocation.Batter;else if(Y===j[1])te=e.BaseballOffensiveLocation.RunnerOnFirst;else if(Y===j[2])te=e.BaseballOffensiveLocation.RunnerOnSecond;else if(Y===j[3])te=e.BaseballOffensiveLocation.RunnerOnThird;else throw"Could not find outgoingPlayerId among batters or runners.";var Z=new B.OffensivePlayEdit(se,this.compactor.outStream,this.compactor.outIndexMap,J,ie,te,Y,W);return Z.makeEditResult()},ee.prototype.getIllegalPlayerReplacementEvents=function($,Y,W){return(0,F.getIllegalEvents)($,Y,W,this.lineup,this.baserunners,this.fielders)},ee.prototype.getPlayerReplacementEvents=function($,Y){var W=new R.PlayerReplacementEdit(this.compactor.outStream,$,Y);return W.makeEditEvent()},ee.prototype.getPitchEditEvent=function($,Y){var W=this.compactor.outIndexMap[$],J=this.compactor.outStream[W];if(!J||!(0,r.isPitchEvent)(J))throw"Could not find pitch event with id ".concat($);var ae=new b.PitchEditor(J);return ae.makeEditEvent(Y)},ee.prototype.getMaxPrepsManualExportFile=function($,Y,W){for(var J,ae,se,ie,ye=this.latestState().boxscorePDF,j=["Jersey","Hits","Singles","Doubles","Triples","HomeRuns","RunsBattedIn","Runs","AtBats","BaseOnBalls","StruckOut","HitByPitch","FieldersChoice","StolenBase","StolenBaseAttempts","ReachedOnError","SacrificeBunt","SacrificeFly","EarnedRuns","RunsAgainst","HomeRunsAgainst","BattersFaced","BattersStruckOut","BaseOnBallsAgainst","HitsAgainst","HitBatter","WildPitches","Appearances","InningsPitched","PartialInningPitched","NumberOfPitches"],te={Hits:{offense:"H"},Singles:{offense:"1B"},Doubles:{offense:"2B"},Triples:{offense:"3B"},HomeRuns:{offense:"HR"},RunsBattedIn:{offense:"RBI"},Runs:{offense:"R"},AtBats:{offense:"AB"},BaseOnBalls:{offense:"BB"},StruckOut:{offense:"SO"},HitByPitch:{offense:"HBP"},FieldersChoice:{offense:"FC"},StolenBase:{offense:"SB"},ReachedOnError:{offense:"ROE"},SacrificeBunt:{offense:"SHB"},SacrificeFly:{offense:"SHF"},EarnedRuns:{defense:"ER"},RunsAgainst:{defense:"R"},BattersFaced:{defense:"BF"},BattersStruckOut:{defense:"SO"},BaseOnBallsAgainst:{defense:"BB"},HitsAgainst:{defense:"H"},HitBatter:{defense:"HBP"},WildPitches:{defense:"WP"},Appearances:{defense:"GP:P"},InningsPitched:{defense:"IP"},PartialInningPitched:{defense:"IP:F"},NumberOfPitches:{defense:"#P"},HomeRunsAgainst:{defense:"HR"}},Z=(se=(ae=(J=ye[Y])===null||J===void 0?void 0:J.stats)===null||ae===void 0?void 0:ae.players)!==null&&se!==void 0?se:{},M=[$,j.join("|")],H=function(Te,me){var qe=(ie=W[Te])!==null&&ie!==void 0?ie:"";if(qe==="")return"continue";var st=j.slice(1).map(function(Ue){var Qe,ht,It,wt,Ct,Vt,Mt,mt,xt,bt,Lt,Re,zt,Le,Ut=te[Ue],He=Ut&&(Vt=(It=(Qe=me.stats.offense)===null||Qe===void 0?void 0:Qe[(ht=Ut.offense)!==null&&ht!==void 0?ht:""])!==null&&It!==void 0?It:(wt=me.stats.defense)===null||wt===void 0?void 0:wt[(Ct=Ut.defense)!==null&&Ct!==void 0?Ct:""])!==null&&Vt!==void 0?Vt:0;if(Ue==="StolenBaseAttempts"){var De=(mt=(Mt=me.stats.offense)===null||Mt===void 0?void 0:Mt.SB)!==null&&mt!==void 0?mt:0,ur=(bt=(xt=me.stats.offense)===null||xt===void 0?void 0:xt.CS)!==null&&bt!==void 0?bt:0;He=De+ur}var yt=(Re=(Lt=me.stats.defense)===null||Lt===void 0?void 0:Lt["GP:P"])!==null&&Re!==void 0?Re:void 0,_r=(Le=(zt=me.stats.offense)===null||zt===void 0?void 0:zt.GP)!==null&&Le!==void 0?Le:void 0;return(_r===0||_r===void 0)&&["Hits","Singles","Doubles","Triples","HomeRuns","RunsBattedIn","Runs","AtBats","BaseOnBalls","StruckOut","HitByPitch","FieldersChoice","StolenBase","StolenBaseAttempts","ReachedOnError","SacrificeBunt","SacrificeFly"].includes(Ue)&&(He=void 0),yt===0||yt===void 0?["EarnedRuns","RunsAgainst","HomeRunsAgainst","BattersFaced","BattersStruckOut","BaseOnBallsAgainst","HitsAgainst","HitBatter","WildPitches","Appearances","InningsPitched","PartialInningPitched","NumberOfPitches"].includes(Ue)&&(He=void 0):Ue==="InningsPitched"&&He!==void 0?He=Math.floor(He):Ue==="PartialInningPitched"&&He!==void 0?He=Math.round(He*3)%3:He!==void 0&&(He=Math.round(He)),He!==void 0?He.toString():""});M.push(n.__spreadArray([qe],st,!0).join("|"))},Q=0,oe=Object.entries(Z);Q<oe.length;Q++){var pe=oe[Q],ce=pe[0],Ie=pe[1];H(ce,Ie)}return M.join(`
`)},ee}(t.CompactorController);return Xt.BaseballCompactorController=ne,(0,s.applyMixins)(z,[q]),(0,s.applyMixins)(ne,[q]),Xt}var Oa={},qr={},Po={},lf;function ar(){return lf||(lf=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.onValidPlayCode=n.isValidPlayCode=n.PlayCode=n.BasketballEventCode=void 0;var l;(function(y){y.SetTeams="set_teams",y.Play="play",y.ActivatePlayer="activate_player",y.DeactivatePlayer="deactivate_player",y.EndPeriod="end_period",y.AssignPlayer="assign_player",y.AdjustScore="adjust_score",y.OverrideScore="override_score"})(l=n.BasketballEventCode||(n.BasketballEventCode={}));var t;(function(y){y.Made2="made2",y.Made3="made3",y.Missed2="missed2",y.Missed3="missed3",y.MadeFreeThrow="madeFreeThrow",y.MissedFreeThrow="missedFreeThrow",y.Foul="foul",y.Turnover="turnover",y.Rebound="rebound",y.Assist="assist",y.Steal="steal",y.Block="block"})(t=n.PlayCode||(n.PlayCode={}));function p(y){return Object.values(t).includes(y)}n.isValidPlayCode=p;function d(y,s,u){if(s.code!==l.Play)return y;var h=s;return p(h.attributes.play_code)?u(y,h):y}n.onValidPlayCode=d}(Po)),Po}var Aa={},cf;function vr(){if(cf)return Aa;cf=1,Object.defineProperty(Aa,"__esModule",{value:!0}),Aa.assertUnreachable=void 0;function n(l){throw new Error("Unhandled case value ".concat(l))}return Aa.assertUnreachable=n,Aa}var df;function Ov(){if(df)return qr;df=1,Object.defineProperty(qr,"__esModule",{value:!0}),qr.ActivePlayerEngine=qr.ActivePlayerState=void 0;var n=X,l=n.__importStar(fe()),t=n.__importStar(Ee()),p=n.__importStar(Oe()),d=ar(),y=vr(),s=function(h){n.__extends(v,h);function v(){return h!==null&&h.apply(this,arguments)||this}return Object.defineProperty(v.prototype,"activePlayersImmutable",{get:function(){return this.get("teams")},enumerable:!1,configurable:!0}),v.prototype.isPlayerActive=function(o,a){var r=this.getIn(["teams",o]);return r===void 0?!1:a!==void 0&&r.contains(a)},Object.defineProperty(v.prototype,"activePlayers",{get:function(){return this.activePlayersImmutable.toJS()},enumerable:!1,configurable:!0}),v.prototype.activatePlayer=function(o,a){return this.updateIn(["teams",o],function(r){return a===void 0||r.contains(a)?r:r.push(a)})},v}(p.ImmutableState);qr.ActivePlayerState=s;var u=function(h){n.__extends(v,h);function v(o){var a=h.call(this,o)||this;return a.baseEvents=o,a}return v.prototype.initialState=function(){return new s(l.fromJS({teams:{},teamIdForPlayId:{}}))},v.prototype.processOneEvent=function(o,a){var r=this;switch(a.code){case d.BasketballEventCode.SetTeams:return this.handleSetTeams(o,a);case d.BasketballEventCode.ActivatePlayer:return this.handleActivatePlayer(o,a);case d.BasketballEventCode.DeactivatePlayer:return this.handleDeactivatePlayer(o,a);case d.BasketballEventCode.Play:return(0,d.onValidPlayCode)(o,a,function(e,i){return r.handlePlay(e,i)});case d.BasketballEventCode.AssignPlayer:return this.handleAssignPlayer(o,a);case d.BasketballEventCode.AdjustScore:case d.BasketballEventCode.OverrideScore:case d.BasketballEventCode.EndPeriod:return o;default:(0,y.assertUnreachable)(a.code)}},v.prototype.handleSetTeams=function(o,a){var r=a.attributes.homeId,e=a.attributes.awayId;return o.setIn(["teams",r],l.List()).setIn(["teams",e],l.List())},v.prototype.handleActivatePlayer=function(o,a){var r=a.attributes.team_id,e=a.attributes.player_id;return o.activatePlayer(r,e)},v.prototype.handleDeactivatePlayer=function(o,a){var r=a.attributes.team_id,e=a.attributes.player_id;return o.updateIn(["teams",r],function(i){var c=i.indexOf(e);return c>=0?i.delete(c):i})},v.prototype.handlePlay=function(o,a){var r=a.id,e=a.attributes.team_id;return o.setIn(["teamIdForPlayId",r],e)},v.prototype.handleAssignPlayer=function(o,a){var r=a.attributes.play_event_id,e=a.attributes.player_id,i=o.getIn(["teamIdForPlayId",r]);return i===void 0?o:o.activatePlayer(i,e)},v}(t.VersionedStateEngine);return qr.ActivePlayerEngine=u,qr}var Ra={},lt={},ff;function Io(){if(ff)return lt;ff=1,Object.defineProperty(lt,"__esModule",{value:!0}),lt.makeOverrideScore=lt.makeAdjustScore=lt.makeAssignPlayer=lt.makePlay=lt.makeDeactivatePlayer=lt.makeActivatePlayer=void 0;var n=ar(),l=Ge();function t(h){var v=h.teamId,o=h.playerId,a=h.pbpEntryId,r=h.createdAt,e=r===void 0?void 0:r;return{id:(0,l.uuid4)(),code:n.BasketballEventCode.ActivatePlayer,createdAt:e,attributes:{pbp_entry_id:a||(0,l.uuid4)(),team_id:v,player_id:o},compactorAttributes:{stream:"main"}}}lt.makeActivatePlayer=t;function p(h){var v=h.teamId,o=h.playerId,a=h.pbpEntryId,r=h.createdAt,e=r===void 0?void 0:r;return{id:(0,l.uuid4)(),code:n.BasketballEventCode.DeactivatePlayer,createdAt:e,attributes:{pbp_entry_id:a||(0,l.uuid4)(),team_id:v,player_id:o},compactorAttributes:{stream:"main"}}}lt.makeDeactivatePlayer=p;function d(h){var v=h.teamId,o=h.playCode,a=h.pbpEntryId,r=h.createdAt,e=r===void 0?void 0:r;return{id:(0,l.uuid4)(),code:n.BasketballEventCode.Play,createdAt:e,attributes:{pbp_entry_id:a||(0,l.uuid4)(),team_id:v,play_code:o},compactorAttributes:{stream:"main"}}}lt.makePlay=d;function y(h){var v=h.playId,o=h.playerId,a=h.isEdit,r=a===void 0?!1:a,e=h.createdAt,i=e===void 0?void 0:e;return{id:(0,l.uuid4)(),code:n.BasketballEventCode.AssignPlayer,createdAt:i,attributes:{play_event_id:v,player_id:o,is_edit:r},compactorAttributes:{stream:"main"}}}lt.makeAssignPlayer=y;function s(h){var v=h.teamId,o=h.adjustment,a=h.pbpEntryId,r=h.createdAt,e=r===void 0?void 0:r;return{id:(0,l.uuid4)(),code:n.BasketballEventCode.AdjustScore,createdAt:e,attributes:{pbp_entry_id:a||(0,l.uuid4)(),team_id:v,adjustment:o},compactorAttributes:{stream:"main"}}}lt.makeAdjustScore=s;function u(h){var v=h.teamId,o=h.points,a=h.pbpEntryId,r=h.createdAt,e=r===void 0?void 0:r;return{id:(0,l.uuid4)(),code:n.BasketballEventCode.OverrideScore,createdAt:e,attributes:{pbp_entry_id:a||(0,l.uuid4)(),team_id:v,points:o},compactorAttributes:{stream:"main"}}}return lt.makeOverrideScore=u,lt}var mo={},pf;function Vi(){return pf||(pf=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.PlayByPlayEngine=n.PlayByPlayEntry=n.playByPlayEntry=n.PlayByPlayState=n.PlayByPlayType=void 0;var l=X,t=l.__importStar(fe()),p=l.__importStar(Ee()),d=l.__importStar(Oe()),y=ar(),s=l.__importStar(vr()),u=gt(),h;(function(r){r.Play="play",r.StartPeriod="startPeriod",r.EndPeriod="endPeriod",r.ImplicitPlayerActivate="implicitPlayerActivate",r.PlayerActivate="playerActivate",r.PlayerDeactivate="playerDeactivate",r.ScoreAdjustment="scoreAdjustment",r.ScoreOverride="scoreOverride"})(h=n.PlayByPlayType||(n.PlayByPlayType={}));var v=function(r){l.__extends(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return Object.defineProperty(e.prototype,"allEntriesImmutable",{get:function(){return this.get("entries")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"allEntries",{get:function(){return this.allEntriesImmutable.toJS()},enumerable:!1,configurable:!0}),e.prototype.pushEntry=function(i){var c=this.allEntriesImmutable.count(),f=this.updateIn(["entries"],function(_){return _.push(i)});return i.eventId!==void 0&&(f=f.setIn(["eventIdIndexMap",i.eventId],c)),f},e.prototype.entryForEventId=function(i){var c=this.getIn(["eventIdIndexMap",i]);if(c!==void 0){var f=this.getIn(["entries",c]);if(f===void 0)throw new u.InvalidEventIndexError(c);return{entry:f,index:c}}},e}(d.ImmutableState);n.PlayByPlayState=v,n.playByPlayEntry=t.Record({id:"",template:"",playByPlayType:"",eventId:void 0,playCode:void 0,playerStats:void 0,teamId:void 0,playerId:void 0,playerAssignmentEventId:void 0,period:void 0,scores:void 0,scoreAdjustment:void 0,playerEdited:void 0,playerAssignable:!1,teamAssignable:!1,deletable:!1,createdAt:void 0});var o=function(r){l.__extends(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e}(n.playByPlayEntry);n.PlayByPlayEntry=o;var a=function(r){l.__extends(e,r);function e(i,c,f,_,S){var P=r.call(this,i)||this;return P.baseEvents=i,P.activePlayer=c,P.period=f,P.score=_,P.stats=S,P}return e.prototype.initialState=function(){return new v(t.fromJS({entries:[],eventIdIndexMap:{}}))},e.prototype.processOneEvent=function(i,c){var f=this;switch(c.code){case y.BasketballEventCode.Play:return(0,y.onValidPlayCode)(i,c,function(_,S){return f.handlePlay(_,S)});case y.BasketballEventCode.EndPeriod:return this.handleEndPeriod(i,c);case y.BasketballEventCode.AssignPlayer:return this.handleAssignPlayer(i,c);case y.BasketballEventCode.SetTeams:return i;case y.BasketballEventCode.ActivatePlayer:return this.handleActivatePlayer(i,c);case y.BasketballEventCode.DeactivatePlayer:return this.handleDeactivatePlayer(i,c);case y.BasketballEventCode.AdjustScore:return this.handleAdjustScore(i,c);case y.BasketballEventCode.OverrideScore:return this.handleOverrideScore(i,c);default:s.assertUnreachable(c.code)}},e.prototype.handlePlay=function(i,c){var f=this.period.stateBeforeEvent(this.nextEventOffset),_=i;if(f&&f.isActive===!1){var S=new o(t.fromJS({template:"Start of period ".concat(f.period),id:"start_of_period_".concat(f.period),playByPlayType:h.StartPeriod,period:f.period,playerAssignable:!1,teamAssignable:!1,deletable:!1,createdAt:c.createdAt}));_=_.pushEntry(S)}var P=c.attributes.play_code,I;if(P===y.PlayCode.Made2||P===y.PlayCode.Made3||P===y.PlayCode.MadeFreeThrow){var E=this.score.stateAfterEvent(this.nextEventOffset);I=E==null?void 0:E.scoresImmutable}else I=void 0;var B=new o(t.fromJS({template:"".concat(c.attributes.play_code," by ").concat(c.attributes.team_id),id:c.attributes.pbp_entry_id,playByPlayType:h.Play,eventId:c.id,playCode:P,teamId:c.attributes.team_id,scores:I,playerAssignable:!0,teamAssignable:!0,deletable:!0,createdAt:c.createdAt}));return _.pushEntry(B)},e.prototype.handleEndPeriod=function(i,c){var f=this.period.stateBeforeEvent(this.nextEventOffset),_=this.score.stateAfterEvent(this.nextEventOffset),S=new o(t.fromJS({template:"End of period ".concat(f==null?void 0:f.period),id:"end_of_period_".concat(f==null?void 0:f.period),playByPlayType:h.EndPeriod,eventId:c.id,period:f==null?void 0:f.period,scores:_==null?void 0:_.scoresImmutable,playerAssignable:!1,teamAssignable:!1,deletable:!0,createdAt:c.createdAt}));return i.pushEntry(S)},e.prototype.handleAssignPlayer=function(i,c){var f=c.attributes.play_event_id,_=i.entryForEventId(f);if(_===void 0)return i;var S=_.index,P=_.entry,I=c.attributes.player_id,E=this.stats.stateAfterEvent(this.nextEventOffset),B=new o(t.fromJS({template:"".concat(P.playCode," by ").concat(I),id:P.id,playByPlayType:h.Play,eventId:P.eventId,playCode:P.playCode,playerStats:E==null?void 0:E.stats[P.teamId].players[I],teamId:P.teamId,playerId:I,playerAssignmentEventId:c.id,scores:P.scores,playerEdited:c.attributes.is_edit,playerAssignable:!0,teamAssignable:!0,deletable:!0,createdAt:P.createdAt})),b=this.activePlayer.stateBeforeEvent(this.nextEventOffset);if(b!=null&&b.isPlayerActive(P.teamId,I))return i.setIn(["entries",S],B);var R=new o(t.fromJS({template:"".concat(I," entered the game"),id:"".concat(P.id,"_implicit_activate"),playByPlayType:h.ImplicitPlayerActivate,teamId:P.teamId,playerId:I,playerAssignable:!1,teamAssignable:!1,deleteable:!1,createdAt:P.createdAt}));return i.updateIn(["entries"],function(F){return F.set(S,B).insert(S,R)}).setIn(["eventIdIndexMap",P.eventId],S+1)},e.prototype.handleActivatePlayer=function(i,c){var f=c.attributes.team_id,_=c.attributes.player_id,S=this.activePlayer.stateBeforeEvent(this.nextEventOffset);if(S!=null&&S.isPlayerActive(f,_))return i;var P=new o(t.fromJS({template:"".concat(_," entered the game"),id:c.attributes.pbp_entry_id,playByPlayType:h.PlayerActivate,eventId:c.id,teamId:f,playerId:_,playerAssignable:!0,teamAssignable:!1,deletable:!0,createdAt:c.createdAt}));return i.pushEntry(P)},e.prototype.handleDeactivatePlayer=function(i,c){var f=c.attributes.team_id,_=c.attributes.player_id,S=this.activePlayer.stateBeforeEvent(this.nextEventOffset);if(!(S!=null&&S.isPlayerActive(f,_)))return i;var P=new o(t.fromJS({template:"".concat(_," sat down"),id:c.attributes.pbp_entry_id,playByPlayType:h.PlayerDeactivate,eventId:c.id,teamId:f,playerId:_,playerAssignable:!0,teamAssignable:!1,deletable:!0,createdAt:c.createdAt}));return i.pushEntry(P)},e.prototype.handleAdjustScore=function(i,c){var f=c.attributes.team_id,_=c.attributes.adjustment,S=this.score.stateAfterEvent(this.nextEventOffset),P=new o(t.fromJS({template:"Score adjusted: ".concat(_," for ").concat(f),id:c.attributes.pbp_entry_id,playByPlayType:h.ScoreAdjustment,eventId:c.id,teamId:f,scores:S==null?void 0:S.scoresImmutable,scoreAdjustment:_,playerAssignable:!1,teamAssignable:!0,deletable:!0,createdAt:c.createdAt}));return i.pushEntry(P)},e.prototype.handleOverrideScore=function(i,c){var f,_=c.attributes.team_id,S=(f=this.score.stateBeforeEvent(this.nextEventOffset))===null||f===void 0?void 0:f.scores[_],P=this.score.stateAfterEvent(this.nextEventOffset),I=P.scores[_]-S,E=new o(t.fromJS({template:"Score adjusted: ".concat(I," for ").concat(_),id:c.attributes.pbp_entry_id,playByPlayType:h.ScoreOverride,eventId:c.id,teamId:_,scores:P==null?void 0:P.scoresImmutable,scoreAdjustment:I,playerAssignable:!1,teamAssignable:!0,deletable:!0,createdAt:c.createdAt}));return i.pushEntry(E)},e}(p.VersionedStateEngine);n.PlayByPlayEngine=a}(mo)),mo}var hf;function Av(){if(hf)return Ra;hf=1,Object.defineProperty(Ra,"__esModule",{value:!0}),Ra.makeReplaceEventToChangePlay=void 0;var n=Ge(),l=Io(),t=Vi();function p(d,y){if(d.eventId===void 0)throw new Error("entry is missing eventId");if(d.playByPlayType!==t.PlayByPlayType.Play)throw new Error("entry is wrong play type ".concat(d.playByPlayType));if(d.teamId===void 0)throw new Error("entry is missing teamId");var s=(0,l.makePlay)({teamId:d.teamId,playCode:y,pbpEntryId:d.id,createdAt:d.createdAt});return d.playerAssignmentEventId!==void 0?{id:(0,n.uuid4)(),code:"replace",deleteIds:[d.eventId,d.playerAssignmentEventId],events:[s,(0,l.makeAssignPlayer)({playId:s.id,playerId:d.playerId,isEdit:!0,createdAt:d.createdAt})]}:{id:(0,n.uuid4)(),code:"replace",deleteIds:[d.eventId],events:[s]}}return Ra.makeReplaceEventToChangePlay=p,Ra}var jt={},yf;function Rv(){if(yf)return jt;yf=1,Object.defineProperty(jt,"__esModule",{value:!0}),jt.makeReplaceEventToChangeTeamAndPlayer=jt.makeReplaceEventToChangeTeamForScoreOverride=jt.makeReplaceEventToChangeTeamForScoreAdjust=jt.makeReplaceEventToChangeTeamForPlay=void 0;var n=Ge(),l=Io(),t=Vi();function p(u,h){if(u.eventId===void 0)throw new Error("entry is missing eventId");if(u.playByPlayType!==t.PlayByPlayType.Play)throw new Error("entry is wrong play type ".concat(u.playByPlayType));if(u.playCode===void 0)throw new Error("entry is missing playCode");var v;return u.playerAssignmentEventId===void 0?v=[u.eventId]:v=[u.eventId,u.playerAssignmentEventId],{id:(0,n.uuid4)(),code:"replace",deleteIds:v,events:[(0,l.makePlay)({teamId:h,playCode:u.playCode,pbpEntryId:u.id,createdAt:u.createdAt})]}}jt.makeReplaceEventToChangeTeamForPlay=p;function d(u,h){if(u.eventId===void 0)throw new Error("entry is missing eventId");if(u.playByPlayType!==t.PlayByPlayType.ScoreAdjustment)throw new Error("entry is wrong play type ".concat(u.playByPlayType));return{id:(0,n.uuid4)(),code:"replace",deleteIds:[u.eventId],events:[(0,l.makeAdjustScore)({teamId:h,adjustment:u.scoreAdjustment,pbpEntryId:u.id,createdAt:u.createdAt})]}}jt.makeReplaceEventToChangeTeamForScoreAdjust=d;function y(u,h){if(u.eventId===void 0)throw new Error("entry is missing eventId");if(u.playByPlayType!==t.PlayByPlayType.ScoreOverride)throw new Error("entry is wrong play type ".concat(u.playByPlayType));var v=u.scores.get(u.teamId);return{id:(0,n.uuid4)(),code:"replace",deleteIds:[u.eventId],events:[(0,l.makeOverrideScore)({teamId:h,points:v,pbpEntryId:u.id,createdAt:u.createdAt})]}}jt.makeReplaceEventToChangeTeamForScoreOverride=y;function s(u,h,v){if(u.eventId===void 0)throw new Error("entry is missing eventId");if(u.playByPlayType!==t.PlayByPlayType.Play)throw new Error("entry is wrong play type ".concat(u.playByPlayType));if(u.playCode===void 0)throw new Error("entry is missing playCode");var o=(0,l.makePlay)({teamId:h,playCode:u.playCode,pbpEntryId:u.id,createdAt:u.createdAt}),a;return u.playerAssignmentEventId===void 0?a=[u.eventId]:a=[u.eventId,u.playerAssignmentEventId],{id:(0,n.uuid4)(),code:"replace",deleteIds:a,events:[o,(0,l.makeAssignPlayer)({playId:o.id,playerId:v,isEdit:!0,createdAt:u.createdAt})]}}return jt.makeReplaceEventToChangeTeamAndPlayer=s,jt}var Fa={},vf;function gf(){if(vf)return Fa;vf=1,Object.defineProperty(Fa,"__esModule",{value:!0}),Fa.StateAccessor=void 0;var n=X,l=n.__importStar(gt()),t=function(p){n.__extends(d,p);function d(y,s){var u=p.call(this,y,s)||this;return u.controller=s,u}return Object.defineProperty(d.prototype,"scorekeepingState",{get:function(){return{gameSituation:this.currentGameSituation,homeTeamId:this.get("homeId",this.controller.score),awayTeamId:this.get("awayId",this.controller.score)}},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"activePlayers",{get:function(){return this.get("activePlayers",this.controller.activePlayer)},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"lineScores",{get:function(){return this.get("lineScores",this.controller.statsPerPeriod)},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"stats",{get:function(){return this.get("stats",this.controller.stats)},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"scores",{get:function(){return this.get("scores",this.controller.score)},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"periodStats",{get:function(){return this.get("periodStats",this.controller.statsPerPeriod)},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"currentGameSituation",{get:function(){return{activePlayers:this.activePlayers,lineScores:this.lineScores,scores:this.scores,period:this.get("period",this.controller.period),periodIsActive:this.get("isActive",this.controller.period)}},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"allPlayByPlay",{get:function(){return this.get("allEntries",this.controller.playByPlay)},enumerable:!1,configurable:!0}),d}(l.EngineStateAccessor);return Fa.StateAccessor=t,Fa}var Ur={},_f;function Fv(){if(_f)return Ur;_f=1,Object.defineProperty(Ur,"__esModule",{value:!0}),Ur.PeriodEngine=Ur.PeriodState=void 0;var n=X,l=n.__importStar(fe()),t=n.__importStar(Ee()),p=n.__importStar(Oe()),d=ar(),y=n.__importStar(vr()),s=function(h){n.__extends(v,h);function v(){return h!==null&&h.apply(this,arguments)||this}return Object.defineProperty(v.prototype,"period",{get:function(){return this.get("period")},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"isActive",{get:function(){return this.get("isActive")},enumerable:!1,configurable:!0}),v}(p.ImmutableState);Ur.PeriodState=s;var u=function(h){n.__extends(v,h);function v(o){var a=h.call(this,o)||this;return a.baseEvents=o,a}return v.prototype.initialState=function(){return new s(l.fromJS({period:1,isActive:!1}))},v.prototype.processOneEvent=function(o,a){var r=this;switch(a.code){case d.BasketballEventCode.Play:return(0,d.onValidPlayCode)(o,a,function(e,i){return r.handlePlay(e)});case d.BasketballEventCode.EndPeriod:return this.handleEndPeriod(o);case d.BasketballEventCode.SetTeams:case d.BasketballEventCode.ActivatePlayer:case d.BasketballEventCode.DeactivatePlayer:case d.BasketballEventCode.AssignPlayer:case d.BasketballEventCode.AdjustScore:case d.BasketballEventCode.OverrideScore:return o;default:y.assertUnreachable(a.code)}},v.prototype.handlePlay=function(o){return o.isActive?o:o.set("isActive",!0)},v.prototype.handleEndPeriod=function(o){return o.isActive?o.increment("period",1).set("isActive",!1):o.increment("period",1)},v}(t.VersionedStateEngine);return Ur.PeriodEngine=u,Ur}var Wr={},Sf;function kv(){if(Sf)return Wr;Sf=1,Object.defineProperty(Wr,"__esModule",{value:!0}),Wr.ScoreEngine=Wr.ScoreState=void 0;var n=X,l=n.__importStar(fe()),t=n.__importStar(Ee()),p=n.__importStar(Oe()),d=ar(),y=n.__importStar(vr()),s=function(h){n.__extends(v,h);function v(){return h!==null&&h.apply(this,arguments)||this}return Object.defineProperty(v.prototype,"scoresImmutable",{get:function(){return this.get("scores")},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"scores",{get:function(){return this.scoresImmutable.toJS()},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"homeId",{get:function(){return this.get("homeId")},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"awayId",{get:function(){return this.get("awayId")},enumerable:!1,configurable:!0}),v.prototype.incrementScore=function(o,a){return this.incrementIn(["scores",o],a)},v}(p.ImmutableState);Wr.ScoreState=s;var u=function(h){n.__extends(v,h);function v(o){var a=h.call(this,o)||this;return a.baseEvents=o,a}return v.prototype.initialState=function(){return new s(l.fromJS({scores:{},homeId:void 0,awayId:void 0}))},v.prototype.processOneEvent=function(o,a){var r=this;switch(a.code){case d.BasketballEventCode.SetTeams:return this.handleSetTeams(o,a);case d.BasketballEventCode.Play:return(0,d.onValidPlayCode)(o,a,function(e,i){return r.handlePlay(e,i)});case d.BasketballEventCode.AdjustScore:return this.handleAdjustScore(o,a);case d.BasketballEventCode.OverrideScore:return this.handleOverrideScore(o,a);case d.BasketballEventCode.ActivatePlayer:case d.BasketballEventCode.DeactivatePlayer:case d.BasketballEventCode.EndPeriod:case d.BasketballEventCode.AssignPlayer:return o;default:y.assertUnreachable(a.code)}},v.prototype.handleSetTeams=function(o,a){var r,e=a.attributes.homeId,i=a.attributes.awayId;return o.set("homeId",e).set("awayId",i).set("scores",l.fromJS((r={},r[e]=0,r[i]=0,r)))},v.prototype.handlePlay=function(o,a){var r=a.attributes.play_code,e=a.attributes.team_id;switch(r){case d.PlayCode.Made2:return o.incrementScore(e,2);case d.PlayCode.Made3:return o.incrementScore(e,3);case d.PlayCode.MadeFreeThrow:return o.incrementScore(e,1);case d.PlayCode.Missed2:case d.PlayCode.Missed3:case d.PlayCode.MissedFreeThrow:case d.PlayCode.Assist:case d.PlayCode.Foul:case d.PlayCode.Rebound:case d.PlayCode.Steal:case d.PlayCode.Turnover:case d.PlayCode.Block:return o;default:y.assertUnreachable(r)}},v.prototype.handleAdjustScore=function(o,a){return o.incrementScore(a.attributes.team_id,a.attributes.adjustment)},v.prototype.handleOverrideScore=function(o,a){return o.setIn(["scores",a.attributes.team_id],a.attributes.points)},v}(t.VersionedStateEngine);return Wr.ScoreEngine=u,Wr}var ka={},Pf;function wv(){if(Pf)return ka;Pf=1,Object.defineProperty(ka,"__esModule",{value:!0}),ka.makeDeleteEvent=void 0;var n=Ge();function l(t){if(t.eventId===void 0)throw new Error("Cannot make a delete event for an entry that has no eventId");return t.playerAssignmentEventId===void 0?{id:(0,n.uuid4)(),code:"delete",deleteIds:[t.eventId]}:{id:(0,n.uuid4)(),code:"delete",deleteIds:[t.eventId,t.playerAssignmentEventId]}}return ka.makeDeleteEvent=l,ka}var ir={},If;function Cv(){if(If)return ir;If=1,Object.defineProperty(ir,"__esModule",{value:!0}),ir.makeDeleteEventToUnassignPlayer=ir.makeReplaceEventToChangePlayerActivation=ir.makeMetaEventToAssignPlayerToPlay=void 0;var n=Vi(),l=Ge(),t=Io();function p(s,u){if(s.eventId===void 0)throw new Error("entry is missing eventId");if(s.playByPlayType!==n.PlayByPlayType.Play)throw new Error("entry is wrong play type ".concat(s.playByPlayType));return s.playerAssignmentEventId===void 0?{id:(0,l.uuid4)(),code:"insert",afterId:s.eventId,events:[(0,t.makeAssignPlayer)({playId:s.eventId,playerId:u,isEdit:!0,createdAt:s.createdAt})]}:{id:(0,l.uuid4)(),code:"replace",deleteIds:[s.playerAssignmentEventId],events:[(0,t.makeAssignPlayer)({playId:s.eventId,playerId:u,isEdit:!0,createdAt:s.createdAt})]}}ir.makeMetaEventToAssignPlayerToPlay=p;function d(s,u){if(s.eventId===void 0)throw new Error("entry is missing eventId");if(s.playByPlayType!==n.PlayByPlayType.PlayerActivate&&s.playByPlayType!==n.PlayByPlayType.PlayerDeactivate)throw new Error("entry is wrong play type ".concat(s.playByPlayType));return{id:(0,l.uuid4)(),code:"replace",deleteIds:[s.eventId],events:[s.playByPlayType===n.PlayByPlayType.PlayerActivate?(0,t.makeActivatePlayer)({teamId:s.teamId,playerId:u,pbpEntryId:s.id,createdAt:s.createdAt}):(0,t.makeDeactivatePlayer)({teamId:s.teamId,playerId:u,pbpEntryId:s.id,createdAt:s.createdAt})]}}ir.makeReplaceEventToChangePlayerActivation=d;function y(s){if(s.playByPlayType!==n.PlayByPlayType.Play)throw new Error("entry is wrong play type ".concat(s.playByPlayType));if(s.playerAssignmentEventId===void 0)throw new Error("entry is missing playerAssignmentEventId");return{id:(0,l.uuid4)(),code:"delete",deleteIds:[s.playerAssignmentEventId]}}return ir.makeDeleteEventToUnassignPlayer=y,ir}var $r={},bo={},mf;function Eo(){return mf||(mf=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.TeamPlayerStats=n.Stats=n.Stat=void 0;var l=X,t=l.__importStar(fe()),p=$e(),d=ar(),y=l.__importStar(vr()),s;(function(c){c.FGM="FGM",c.FGA="FGA",c.FGP="FG%",c.M2PT="2PTM",c.A2PT="2PTA",c.P2PT="2PT%",c.M3PT="3PTM",c.A3PT="3PTA",c.P3PT="3PT%",c.FTM="FTM",c.FTA="FTA",c.FTP="FT%",c.REB="REB",c.AST="AST",c.STL="STL",c.PF="PF",c.TO="TO",c.PTS="PTS",c.GP="GP",c.GS="GS",c.BLK="BLK",c.PM="+/-",c.AST2TO="AST/TO",c.TSP="TS%",c.EFGP="eFG%"})(s=n.Stat||(n.Stat={}));var u;(function(c){function f(){return Object.values(s)}c.values=f;function _(){return c.values().reduce(function(b,R){return b.set(R,0)},t.Map())}c.empty=_;function S(b,R){return E(!0,b,R)}c.addPlay=S;function P(b,R){return E(!1,b,R)}c.removePlay=P;function I(b){switch(b){case s.REB:return"RPG";case s.AST:return"APG";case s.STL:return"SPG";case s.BLK:return"BPG";case s.PF:return"PFPG";case s.TO:return"TOPG";case s.PTS:return"PPG";case s.GP:case s.FTP:case s.FGP:case s.P3PT:case s.FTA:case s.FTM:case s.A2PT:case s.A3PT:case s.M2PT:case s.M3PT:case s.P2PT:case s.FGM:case s.FGA:case s.GS:case s.PM:case s.AST2TO:case s.TSP:case s.EFGP:return;default:y.assertUnreachable(b)}}c.averageKey=I;function E(b,R,F){return h(function(){switch(F){case d.PlayCode.Made2:return B(b,R,s.FGM,s.FGA,s.M2PT,s.A2PT);case d.PlayCode.Made3:return B(b,R,s.FGM,s.FGA,s.A3PT,s.M3PT);case d.PlayCode.MadeFreeThrow:return B(b,R,s.FTM,s.FTA);case d.PlayCode.Missed2:return B(b,R,s.FGA,s.A2PT);case d.PlayCode.Missed3:return B(b,R,s.FGA,s.A3PT);case d.PlayCode.MissedFreeThrow:return B(b,R,s.FTA);case d.PlayCode.Assist:return B(b,R,s.AST);case d.PlayCode.Foul:return B(b,R,s.PF);case d.PlayCode.Rebound:return B(b,R,s.REB);case d.PlayCode.Steal:return B(b,R,s.STL);case d.PlayCode.Turnover:return B(b,R,s.TO);case d.PlayCode.Block:return B(b,R,s.BLK);default:y.assertUnreachable(F)}}())}function B(b,R){for(var F=[],x=2;x<arguments.length;x++)F[x-2]=arguments[x];return F.reduce(function(w,L){return w.updateIn([L],0,function(D){return b?++D:--D})},R)}})(u=n.Stats||(n.Stats={})),function(c){function f(w){var L=Object.entries(w).reduce(function(U,G){var q=G[0],z=G[1];return U.setIn([q],z.stats.offense[s.PTS])},t.Map.of()),D=c.fromTeamsStatDoc(w,!0);return c.toTeamsStatDoc(D,L)}c.getDerivedMultiGameStatsWithBaseStats=f;function _(w){return w.toJS().reduce(function(L,D){var U=t.Map().set(p.TOTAL,u.empty()).set(p.UNASSIGNED_PLAYER,u.empty());return L.set(D,U)},t.Map())}c.fromTeams=_;function S(w,L){return L.reduce(function(D,U,G){var q=w.getIn([G,p.TOTAL,s.PTS]),z=w.getIn([G,p.UNASSIGNED_PLAYER,s.PTS]),ne=q-z,ue=U-ne,ee=w.setIn([G,p.TOTAL,s.PTS],U).setIn([G,p.UNASSIGNED_PLAYER,s.PTS],ue);return D[G]=R(ee.get(G)),D},{})}c.toTeamsStatDoc=S;function P(w,L){return Object.entries(w).reduce(function(D,U){var G=U[0],q=U[1],z=q.stats,ne=q.unassigned,ue=q.players,ee=Object.entries(ue).reduce(function($,Y){var W=Y[0],J=Y[1];return $.setIn([G,W],b(J.stats,!!L))},D).setIn([G,p.TOTAL],b(z,!!L));return ne?ee.setIn([G,p.UNASSIGNED_PLAYER],b(ne.stats,!1)):ee},t.fromJS({}))}c.fromTeamsStatDoc=P;function I(w,L){return w.reduce(function(D,U,G){return D.setIn([G],E(w.get(G),L.get(G)))},t.Map())}c.subtract=I;function E(w,L){return w.reduce(function(D,U,G){return D.setIn([G],B(w.get(G),L.get(G,u.empty())))},t.Map())}function B(w,L){return a(w.reduce(function(D,U,G){return D.setIn([G],w.get(G)-L.get(G,0))},u.empty()))}function b(w,L){return a(t.fromJS(w.offense),L)}function R(w){return w.reduce(function(L,D,U){switch(U){case p.TOTAL:case p.UNASSIGNED_PLAYER:return L;default:return L.players[U]=F(D),L}},{players:{},unassigned:F(w.get(p.UNASSIGNED_PLAYER)),stats:x(w.get(p.TOTAL))})}function F(w){return{stats:x(w)}}function x(w){return{offense:w.toJS()}}}(n.TeamPlayerStats||(n.TeamPlayerStats={}));function h(c){return v(c,o,a)}function v(c){for(var f=[],_=1;_<arguments.length;_++)f[_-1]=arguments[_];return f.reduce(function(S,P){return P(S)},c)}function o(c){var f=function(S){return c.get(S,0)},_=f(s.FTM)+f(s.M2PT)*2+f(s.M3PT)*3;return c.setIn([s.PTS],_)}function a(c,f){var _=function(I){return c.get(I,0)},S=function(I,E){return _(I)/_(E)},P=c.setIn([s.FGP],S(s.FGM,s.FGA)).setIn([s.P2PT],S(s.M2PT,s.A2PT)).setIn([s.P3PT],S(s.M3PT,s.A3PT)).setIn([s.FTP],S(s.FTM,s.FTA));return P=v(P,r,e,i),f?u.values().reduce(function(I,E){var B=u.averageKey(E);return B?I.setIn([B],S(E,s.GP)):I},P):P}function r(c){var f=function(S){return c.get(S,0)},_=function(S,P){return f(S)/f(P)};return c.setIn([s.AST2TO],_(s.AST,s.TO))}function e(c){var f=function(S){return c.get(S,0)},_=.5*f(s.PTS)/(f(s.FGA)+.44*f(s.FTA));return c.setIn([s.TSP],_)}function i(c){var f=function(S){return c.get(S,0)},_=(f(s.FGM)+.5*f(s.M3PT))/f(s.FGA);return c.setIn([s.EFGP],_)}}(bo)),bo}var bf;function Mv(){if(bf)return $r;bf=1,Object.defineProperty($r,"__esModule",{value:!0}),$r.BoxScoreEngine=$r.BoxScoreState=void 0;var n=X,l=n.__importStar(fe()),t=n.__importStar(Ee()),p=$e(),d=n.__importStar(Oe()),y=ar(),s=n.__importStar(vr()),u=Eo(),h=ar(),v=function(a){n.__extends(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return Object.defineProperty(r.prototype,"stats",{get:function(){return u.TeamPlayerStats.toTeamsStatDoc(this.teamPlayerStats,this.teamPoints)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"teamPoints",{get:function(){return this.get("teamPoints")},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"teamPlayerStats",{get:function(){return this.get("stats")},enumerable:!1,configurable:!0}),r}(d.ImmutableState);$r.BoxScoreState=v;var o=function(a){n.__extends(r,a);function r(e,i,c){var f=a.call(this,e)||this;return f.baseEvents=e,f.score=i,f.activePlayerEngine=c,f}return r.prototype.initialState=function(){return new v(l.fromJS({teams:[],teamPoints:{},playForPlayer:{},startedPlayerCount:0,stats:l.Map()}))},r.prototype.processOneEvent=function(e,i){var c=this;switch(i.code){case y.BasketballEventCode.SetTeams:return r.handleSetTeams(e,i);case y.BasketballEventCode.Play:return(0,y.onValidPlayCode)(e,i,function(f,_){return f=c.handlePlusMinusCalculation(f,_),c.handlePlay(f,_)});case y.BasketballEventCode.AssignPlayer:return e=this.handleAssignPlayer(e,i),this.handlePlusMinusCalcForImplicitSub(e,i);case y.BasketballEventCode.AdjustScore:return e=this.handlePlusMinusCalculation(e,i),this.handleScoreChange(e,i);case y.BasketballEventCode.OverrideScore:return e=this.handlePlusMinusCalculation(e,i),this.handleScoreChange(e,i);case y.BasketballEventCode.EndPeriod:return e;case y.BasketballEventCode.ActivatePlayer:return r.handleActivatePlayer(e,i);case y.BasketballEventCode.DeactivatePlayer:return e;default:s.assertUnreachable(i.code)}},r.handleSetTeams=function(e,i){var c=i.attributes,f=c.homeId,_=c.awayId;return e.setIn(["teamPoints",f],0).setIn(["teamPoints",_],0).setIn(["teams"],l.List.of(f,_)).setIn(["stats"],u.TeamPlayerStats.fromTeams(l.List.of(f,_))).updateIn(["stats",f,p.TOTAL],u.Stats.empty(),function(S){return S.setIn([u.Stat.GP],1)}).updateIn(["stats",_,p.TOTAL],u.Stats.empty(),function(S){return S.setIn([u.Stat.GP],1)})},r.prototype.handleScoreChange=function(e,i){var c=i.attributes.team_id,f=this.score.stateAfterEvent(this.nextEventOffset).scores[c];return e.setIn(["teamPoints",c],f)},r.handleActivatePlayer=function(e,i){var c=i.attributes,f=c.team_id,_=c.player_id;return r.markPlayerSeen(_,f,e)},r.prototype.handlePlusMinusCalculation=function(e,i){var c=i.attributes.team_id,f=this.determineEventPlayValue(i),_=this.activePlayerEngine.stateAfterEvent(this.nextEventOffset).activePlayers;return Object.entries(_).reduce(function(S,P){var I=P[0],E=P[1],B=I===c?f:-f;return E.reduce(function(b,R){return b.updateIn(["stats",I,R,u.Stat.PM],0,function(F){return F+B})},S)},e)},r.prototype.determineEventPlayValue=function(e){switch(e.code){case y.BasketballEventCode.Play:var i=e.attributes.play_code;switch(i){case h.PlayCode.MadeFreeThrow:return 1;case h.PlayCode.Made2:return 2;case h.PlayCode.Made3:return 3;default:return 0}case y.BasketballEventCode.AdjustScore:return e.attributes.adjustment;case y.BasketballEventCode.OverrideScore:return e.attributes.points;default:return 0}},r.prototype.handlePlay=function(e,i){var c=i.attributes,f=c.team_id,_=c.play_code;return this.handleScoreChange(e.updateIn(["stats",f,p.UNASSIGNED_PLAYER],u.Stats.empty(),function(S){return u.Stats.addPlay(S,_)}).updateIn(["stats",f,p.TOTAL],u.Stats.empty(),function(S){return u.Stats.addPlay(S,_)}),i)},r.prototype.handleAssignPlayer=function(e,i){var c=i.attributes,f=c.play_event_id,_=c.player_id,S=this.baseEvents,P=e.getIn(["playForPlayer",f],p.UNASSIGNED_PLAYER),I=S[this.indexForEventId(f)]||S.slice(this.nextEventOffset).find(function(R){return R.id===f}),E=I.attributes,B=E.team_id,b=E.play_code;return(0,y.onValidPlayCode)(e,I,function(){return r.markPlayerSeen(_,B,e.setIn(["playForPlayer",f],_).updateIn(["stats",B,_],u.Stats.empty(),function(R){return u.Stats.addPlay(R,b)}).updateIn(["stats",B,P],u.Stats.empty(),function(R){return u.Stats.removePlay(R,b)}))})},r.prototype.handlePlusMinusCalcForImplicitSub=function(e,i){var c,f=i.attributes,_=f.play_event_id,S=f.player_id,P=this.baseEvents,I=P[this.indexForEventId(_)]||P.slice(this.nextEventOffset).find(function(b){return b.id===_}),E=I.attributes.team_id,B=this.determineEventPlayValue(I);return!((c=this.activePlayerEngine.stateBeforeEvent(this.nextEventOffset))===null||c===void 0)&&c.isPlayerActive(E,S)?e:e.updateIn(["stats",E,S,u.Stat.PM],0,function(b){return b+B})},r.markPlayerSeen=function(e,i,c){var f=["stats",i,e],_=c.get("startedPlayerCount"),S=_<5?1:c.getIn(n.__spreadArray(n.__spreadArray([],f,!0),[u.Stat.GS],!1),0);return c.updateIn(f,u.Stats.empty(),function(P){return P.setIn([u.Stat.GP],1)}).updateIn(f,u.Stats.empty(),function(P){return P.setIn([u.Stat.GS],S)}).updateIn(["startedPlayerCount"],function(P){return++P})},r}(t.VersionedStateEngine);return $r.BoxScoreEngine=o,$r}var Vr={},Ef;function xv(){if(Ef)return Vr;Ef=1,Object.defineProperty(Vr,"__esModule",{value:!0}),Vr.PerPeriodBoxScoreEngine=Vr.PeriodBoxScoreState=void 0;var n=X,l=n.__importStar(fe()),t=n.__importStar(Ee()),p=$e(),d=n.__importStar(Oe()),y=ar(),s=n.__importStar(vr()),u=Eo(),h=function(o){n.__extends(a,o);function a(){return o!==null&&o.apply(this,arguments)||this}return Object.defineProperty(a.prototype,"periodStats",{get:function(){var r=this.get("statsPerPeriod");return r.reduce(function(e,i,c){var f=i.reduce(function(_,S,P){return _.setIn([P],S.getIn([p.TOTAL,u.Stat.PTS]))},l.Map());return e[c]=u.TeamPlayerStats.toTeamsStatDoc(i,f),e},{})},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"lineScores",{get:function(){return Object.entries(this.periodStats).reduce(function(r,e){var i=e[0],c=e[1],f=parseInt(i,10),_=Object.entries(c).reduce(function(S,P){var I=P[0],E=P[1];return S[I]=E.stats.offense[u.Stat.PTS],S},{});return Object.entries(_).reduce(function(S,P){var I=P[0],E=P[1],B=S.getIn([I],l.List());return B=B.insert(f,E),S.setIn([I],B)},r)},l.Map()).toJS()},enumerable:!1,configurable:!0}),a}(d.ImmutableState);Vr.PeriodBoxScoreState=h;var v=function(o){n.__extends(a,o);function a(r,e,i){var c=o.call(this,r)||this;return c.baseEvents=r,c.period=e,c.stats=i,c}return a.prototype.initialState=function(){return new h(l.fromJS({statsPerPeriod:l.Map()}))},a.prototype.processOneEvent=function(r,e){switch(e.code){case y.BasketballEventCode.Play:case y.BasketballEventCode.SetTeams:case y.BasketballEventCode.AssignPlayer:case y.BasketballEventCode.AdjustScore:case y.BasketballEventCode.OverrideScore:return this.handleStatsChange(r);case y.BasketballEventCode.EndPeriod:case y.BasketballEventCode.ActivatePlayer:case y.BasketballEventCode.DeactivatePlayer:return r;default:s.assertUnreachable(e.code)}},a.prototype.handleStatsChange=function(r){var e,i=this.stats.stateAfterEvent(this.nextEventOffset),c=u.TeamPlayerStats.fromTeamsStatDoc(i.stats),f=this.period.stateAfterEvent(this.nextEventOffset),_=Math.max(1,f.period-(f.isActive?0:1)),S=(e=l.List).of.apply(e,c.keySeq().toArray()),P=function(b){return r.getIn(["statsPerPeriod",b],E)},I=Array.from({length:_},function(b,R){return++R}),E=u.TeamPlayerStats.fromTeams(S),B=_===1?c:I.slice(0,-1).reduce(function(b,R){return u.TeamPlayerStats.subtract(b,P(R))},c);return I.reduce(function(b,R){return b.updateIn(["statsPerPeriod",R],function(F){return R===_?B:F||E})},r)},a}(t.VersionedStateEngine);return Vr.PerPeriodBoxScoreEngine=v,Vr}var Bf;function Lv(){if(Bf)return Oa;Bf=1,Object.defineProperty(Oa,"__esModule",{value:!0}),Oa.BasketballCompactorController=void 0;var n=X,l=Ov(),t=Av(),p=Rv(),d=gf(),y=Or(),s=gt(),u=Fv(),h=Vi(),v=kv(),o=wv(),a=vr(),r=Cv(),e=Mv(),i=xv(),c=Eo(),f=function(_){n.__extends(S,_);function S(){var P=_.call(this)||this;P.stateAccessorClass=d.StateAccessor,P.activePlayer=new l.ActivePlayerEngine([]),P.period=new u.PeriodEngine([]),P.score=new v.ScoreEngine([]),P.stats=new e.BoxScoreEngine([],P.score,P.activePlayer),P.playByPlay=new h.PlayByPlayEngine([],P.activePlayer,P.period,P.score,P.stats),P.statsPerPeriod=new i.PerPeriodBoxScoreEngine([],P.period,P.stats),P.engines=[P.activePlayer,P.period,P.score,P.statsPerPeriod,P.playByPlay,P.stats],P.compactor=new y.SabertoothEventCompactor;for(var I=0,E=P.engines;I<E.length;I++){var B=E[I];B.baseEvents=P.compactor.outStream}return P}return S.prototype.pushBatchAndFetch=function(P){return this.pushBatch(P),this.getLatestScorekeepingState()},S.prototype.pushBatchToScratchAndFetch=function(P){return this.pushBatchToScratch(P),this.getLatestScorekeepingState()},S.prototype.getLatestScorekeepingState=function(){var P=this.outputStream(),I=P.length>0?P[P.length-1]:void 0;return{scorekeepingState:this.latestState().scorekeepingState,undoRedoAvailability:this.undoRedoAvailability("main"),lastEventId:I===void 0?void 0:I.id}},S.prototype.getDeleteEvent=function(P){var I=this.playByPlay.currentState.entryForEventId(P);if(I!==void 0)return(0,o.makeDeleteEvent)(I.entry)},S.prototype.getDeleteEventToUnassignPlayer=function(P){var I=this.playByPlay.currentState.entryForEventId(P);if(I!==void 0&&I.entry.playerAssignmentEventId!==void 0)return(0,r.makeDeleteEventToUnassignPlayer)(I.entry)},S.prototype.getDerivedMultiGameStatsWithBaseStats=function(P){return c.TeamPlayerStats.getDerivedMultiGameStatsWithBaseStats(P)},S.prototype.getMetaEventToChangePlayer=function(P,I){var E=this.playByPlay.currentState.entryForEventId(P);if(E!==void 0){var B=E.entry;if(B.playerId!==I)switch(B.playByPlayType){case h.PlayByPlayType.Play:return(0,r.makeMetaEventToAssignPlayerToPlay)(B,I);case h.PlayByPlayType.PlayerActivate:case h.PlayByPlayType.PlayerDeactivate:return(0,r.makeReplaceEventToChangePlayerActivation)(B,I);case h.PlayByPlayType.StartPeriod:case h.PlayByPlayType.EndPeriod:case h.PlayByPlayType.ImplicitPlayerActivate:case h.PlayByPlayType.ScoreAdjustment:case h.PlayByPlayType.ScoreOverride:throw Error("".concat(B.playByPlayType," cannot change player"));default:(0,a.assertUnreachable)(B.playByPlayType)}}},S.prototype.getReplaceEventToChangeTeam=function(P,I){var E=this.playByPlay.currentState.entryForEventId(P);if(E!==void 0){var B=E.entry;if(B.teamId!==I)switch(B.playByPlayType){case h.PlayByPlayType.Play:return(0,p.makeReplaceEventToChangeTeamForPlay)(B,I);case h.PlayByPlayType.ScoreAdjustment:return(0,p.makeReplaceEventToChangeTeamForScoreAdjust)(B,I);case h.PlayByPlayType.ScoreOverride:return(0,p.makeReplaceEventToChangeTeamForScoreOverride)(B,I);case h.PlayByPlayType.PlayerActivate:case h.PlayByPlayType.PlayerDeactivate:case h.PlayByPlayType.StartPeriod:case h.PlayByPlayType.EndPeriod:case h.PlayByPlayType.ImplicitPlayerActivate:throw Error("".concat(B.playByPlayType," cannot change team"));default:(0,a.assertUnreachable)(B.playByPlayType)}}},S.prototype.getMetaEventToChangeTeamAndPlayer=function(P,I,E){var B=this.playByPlay.currentState.entryForEventId(P);if(B!==void 0){var b=B.entry;if(b.teamId===I)return this.getMetaEventToChangePlayer(P,E);switch(b.playByPlayType){case h.PlayByPlayType.Play:return(0,p.makeReplaceEventToChangeTeamAndPlayer)(b,I,E);case h.PlayByPlayType.ScoreAdjustment:case h.PlayByPlayType.ScoreOverride:case h.PlayByPlayType.PlayerActivate:case h.PlayByPlayType.PlayerDeactivate:case h.PlayByPlayType.StartPeriod:case h.PlayByPlayType.EndPeriod:case h.PlayByPlayType.ImplicitPlayerActivate:throw Error("".concat(b.playByPlayType," cannot change team"));default:(0,a.assertUnreachable)(b.playByPlayType)}}},S.prototype.getReplaceEventToChangePlay=function(P,I){var E=this.playByPlay.currentState.entryForEventId(P);if(E!==void 0){var B=E.entry;if(B.playCode!==I)switch(B.playByPlayType){case h.PlayByPlayType.Play:return(0,t.makeReplaceEventToChangePlay)(B,I);case h.PlayByPlayType.PlayerActivate:case h.PlayByPlayType.PlayerDeactivate:case h.PlayByPlayType.StartPeriod:case h.PlayByPlayType.EndPeriod:case h.PlayByPlayType.ImplicitPlayerActivate:case h.PlayByPlayType.ScoreAdjustment:case h.PlayByPlayType.ScoreOverride:throw Error("".concat(B.playByPlayType," cannot change playCode"));default:(0,a.assertUnreachable)(B.playByPlayType)}}},S}(s.CompactorController);return Oa.BasketballCompactorController=f,Oa}var wa={},zr={},Bo={},Kr={},Tf;function Ca(){if(Tf)return Kr;Tf=1,Object.defineProperty(Kr,"__esModule",{value:!0}),Kr.unreachablePlayCode=Kr.assertUnreachable=void 0;function n(t){throw new Error("Unhandled case value ".concat(t))}Kr.assertUnreachable=n;function l(t){throw new Error("Unhandled case value ".concat(t))}return Kr.unreachablePlayCode=l,Kr}var To={},Of;function Me(){return Of||(Of=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.Sport=n.StatFormat=n.onValidPlayCode=n.isValidPlayCode=n.MultiSportEventCode=void 0;var l;(function(d){d.BeginPlay="begin_play",d.EndPlay="end_play",d.SetTeams="set_teams",d.Play="play",d.ActivatePlayer="activate_player",d.DeactivatePlayer="deactivate_player",d.EndPeriod="end_period",d.AssignPlayer="assign_player",d.AdjustScore="adjust_score",d.OverrideScore="override_score",d.SetGameSettings="set_game_settings",d.SetServer="set_server"})(l=n.MultiSportEventCode||(n.MultiSportEventCode={}));function t(d,y){return Object.values(y).includes(d)}n.isValidPlayCode=t;function p(d,y,s,u){if(y.code!==l.Play)return d;var h=y;return t(h.attributes.play_code,s)?u(d,h):d}n.onValidPlayCode=p,function(d){d.INTEGER="integer",d.DECIMAL="decimal",d.FLOAT_PERCENTAGE="floatPercentage",d.FLOAT_RATIO="floatRatio",d.PERCENTAGE="percentage",d.PERCENTAGE_SIGN="percentageSign",d.WIDE_INTEGER="wideInteger",d.JOIN="join"}(n.StatFormat||(n.StatFormat={})),function(d){d.SOCCER="soccer",d.HOCKEY="hockey",d.FIELD_HOCKEY="fieldHockey",d.LACROSSE="lacrosse",d.WATER_POLO="waterPolo",d.RUGBY="rugby",d.FOOTBALL="football",d.FLAG_FOOTBALL="flagFootball",d.BASKETBALL="basketball",d.VOLLEYBALL="volleyball"}(n.Sport||(n.Sport={}))}(To)),To}var Oo={},Af;function Jr(){return Af||(Af=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.HOOPS_CONFIGURATION=n.OpponentPlayCode=n.PlayCode=void 0;var l;(function(p){p.Made2="made2",p.Made3="made3",p.Missed2="missed2",p.Missed3="missed3",p.MadeFreeThrow="madeFreeThrow",p.MissedFreeThrow="missedFreeThrow",p.Foul="foul",p.TechnicalFoul="technicalFoul",p.Turnover="turnover",p.Rebound="rebound",p.OffensiveRebound="offensiveRebound",p.DefensiveRebound="defensiveRebound",p.Assist="assist",p.Steal="steal",p.Block="block",p.Timeout="timeout",p.Timeout30="timeout30"})(l=n.PlayCode||(n.PlayCode={}));var t;(function(p){p.Made2="made2",p.Made3="made3",p.MadeFreeThrow="madeFreeThrow",p.MissedFreeThrow="missedFreeThrow",p.Foul="foul",p.TechnicalFoul="technicalFoul",p.Turnover="turnover",p.Rebound="rebound",p.OffensiveRebound="offensiveRebound",p.DefensiveRebound="defensiveRebound",p.Timeout="timeout",p.Timeout30="timeout30"})(t=n.OpponentPlayCode||(n.OpponentPlayCode={})),n.HOOPS_CONFIGURATION={play_codes:Object.values(l),opponent_play_codes:Object.values(t)}}(Oo)),Oo}var Rf;function Ma(){return Rf||(Rf=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.TeamPlayerStats=n.Stats=n.LegacyHoopsStat=n.HoopsStat=void 0;var l=X,t=l.__importStar(fe()),p=l.__importStar(Ca()),d=$e(),y=Me(),s=Jr(),u;(function(f){f.FGM="FGM",f.FGA="FGA",f.FGP="FG%",f.M2PT="2PTM",f.A2PT="2PTA",f.P2PT="2PT%",f.M3PT="3PTM",f.A3PT="3PTA",f.P3PT="3PT%",f.FTM="FTM",f.FTA="FTA",f.FTP="FT%",f.REB="REB",f.ORB="ORB",f.DRB="DRB",f.AST="AST",f.STL="STL",f.PF="PF",f.TF="TF",f.TO="TO",f.PTS="PTS",f.GP="GP",f.GS="GS",f.BLK="BLK",f.TMO="TMO",f.TMO30="TMO30",f.PM="+/-",f.AST2TO="AST/TO",f.TSP="TS%",f.EFGP="eFG%",f.REBPG="RPG",f.ASTPG="APG",f.STLPG="SPG",f.BLKPG="BPG",f.PFPG="PFPG",f.TOPG="TOPG",f.PTSPG="PPG"})(u=n.HoopsStat||(n.HoopsStat={})),function(f){f.OF="OF",f.FF="FF",f.PT2C="2CP",f.PTOTO="POT",f.PIP="PIP",f.M3PTPFGA="3PTM/FGA",f.TSA="TSA",f.A2PTPG="2PTAPG",f.A3PTPG="3PTAPG",f.M2PTPG="2PTMPG",f.M3PTPG="3PTMPG",f.FGMPG="FGMPG",f.FGAPG="FGAPG",f.FTMPG="FTMPG",f.FTAPG="FTAPG",f.FTAPFGA="FTA/FGA",f.OFPG="OFPG",f.TFPG="TFPG",f.FFPG="FFPG"}(n.LegacyHoopsStat||(n.LegacyHoopsStat={}));var h;(function(f){function _(){return Object.values(u)}f.values=_;function S(){return v(f.values().reduce(function(R,F){return R.set(F,0)},t.Map()))}f.empty=S;function P(R,F){if((0,y.isValidPlayCode)(F,s.HOOPS_CONFIGURATION.play_codes))return B(!0,R,F);p.unreachablePlayCode(F)}f.addPlay=P;function I(R,F){if((0,y.isValidPlayCode)(F,s.HOOPS_CONFIGURATION.play_codes))return B(!1,R,F);p.unreachablePlayCode(F)}f.removePlay=I;function E(R){switch(R){case u.REB:return u.REBPG;case u.AST:return u.ASTPG;case u.STL:return u.STLPG;case u.BLK:return u.BLKPG;case u.PF:return u.PFPG;case u.TO:return u.TOPG;case u.PTS:return u.PTSPG;default:return}}f.averageKey=E;function B(R,F,x){return v(function(){switch(x){case s.PlayCode.Made2:return b(R,F,u.FGM,u.FGA,u.M2PT,u.A2PT);case s.PlayCode.Made3:return b(R,F,u.FGM,u.FGA,u.A3PT,u.M3PT);case s.PlayCode.MadeFreeThrow:return b(R,F,u.FTM,u.FTA);case s.PlayCode.Missed2:return b(R,F,u.FGA,u.A2PT);case s.PlayCode.Missed3:return b(R,F,u.FGA,u.A3PT);case s.PlayCode.MissedFreeThrow:return b(R,F,u.FTA);case s.PlayCode.Assist:return b(R,F,u.AST);case s.PlayCode.Foul:return b(R,F,u.PF);case s.PlayCode.TechnicalFoul:return b(R,F,u.TF,u.PF);case s.PlayCode.Rebound:return b(R,F,u.REB);case s.PlayCode.OffensiveRebound:return b(R,F,u.REB,u.ORB);case s.PlayCode.DefensiveRebound:return b(R,F,u.REB,u.DRB);case s.PlayCode.Steal:return b(R,F,u.STL);case s.PlayCode.Turnover:return b(R,F,u.TO);case s.PlayCode.Block:return b(R,F,u.BLK);case s.PlayCode.Timeout:return b(R,F,u.TMO);case s.PlayCode.Timeout30:return b(R,F,u.TMO30);default:p.unreachablePlayCode(x)}}())}function b(R,F){for(var x=[],w=2;w<arguments.length;w++)x[w-2]=arguments[w];return x.reduce(function(L,D){return L.updateIn([D],0,function(U){return R?++U:--U})},F)}})(h=n.Stats||(n.Stats={})),function(f){function _(L){var D=Object.entries(L).reduce(function(G,q){var z=q[0],ne=q[1];return G.setIn([z],ne.stats.offense[u.PTS])},t.Map.of()),U=f.fromTeamsStatDoc(L,!0);return f.toTeamsStatDoc(U,D)}f.getDerivedMultiGameStatsWithBaseStats=_;function S(L){return L.toJS().reduce(function(D,U){var G=t.Map().set(d.TOTAL,h.empty()).set(d.UNASSIGNED_PLAYER,h.empty());return D.set(U,G)},t.Map())}f.fromTeams=S;function P(L,D){return D.reduce(function(U,G,q){var z=L.getIn([q,d.TOTAL,u.PTS]),ne=L.getIn([q,d.UNASSIGNED_PLAYER,u.PTS]),ue=z-ne,ee=G-ue,$=L.setIn([q,d.TOTAL,u.PTS],G).setIn([q,d.UNASSIGNED_PLAYER,u.PTS],ee);return U[q]=F($.get(q)),U},{})}f.toTeamsStatDoc=P;function I(L,D){return Object.entries(L).reduce(function(U,G){var q=G[0],z=G[1],ne=z.stats,ue=z.unassigned,ee=z.players,$=Object.entries(ee).reduce(function(Y,W){var J=W[0],ae=W[1];return Y.setIn([q,J],R(ae.stats,!!D))},U).setIn([q,d.TOTAL],R(ne,!!D));return ue?$.setIn([q,d.UNASSIGNED_PLAYER],R(ue.stats,!1)):$},t.fromJS({}))}f.fromTeamsStatDoc=I;function E(L,D){return L.reduce(function(U,G,q){return U.setIn([q],B(L.get(q),D.get(q)))},t.Map())}f.subtract=E;function B(L,D){return L.reduce(function(U,G,q){return U.setIn([q],b(L.get(q),D.get(q,h.empty())))},t.Map())}function b(L,D){return r(L.reduce(function(U,G,q){return U.setIn([q],L.get(q)-D.get(q,0))},h.empty()),void 0)}function R(L,D){return r(t.fromJS(L.offense),D)}function F(L){return L.reduce(function(D,U,G){switch(G){case d.TOTAL:case d.UNASSIGNED_PLAYER:return D;default:return D.players[G]=x(U),D}},{players:{},unassigned:x(L.get(d.UNASSIGNED_PLAYER)),stats:w(L.get(d.TOTAL))})}function x(L){return{stats:w(L)}}function w(L){return{offense:L.toJS()}}}(n.TeamPlayerStats||(n.TeamPlayerStats={}));function v(f){return o(f,a,r)}function o(f){for(var _=[],S=1;S<arguments.length;S++)_[S-1]=arguments[S];return _.reduce(function(P,I){return I(P)},f)}function a(f){var _=function(P){return f.get(P,0)},S=_(u.FTM)+_(u.M2PT)*2+_(u.M3PT)*3;return f.setIn([u.PTS],S)}function r(f,_){var S=function(E){return f.get(E,0)},P=function(E,B){return S(E)/S(B)},I=f.setIn([u.FGP],P(u.FGM,u.FGA)).setIn([u.P2PT],P(u.M2PT,u.A2PT)).setIn([u.P3PT],P(u.M3PT,u.A3PT)).setIn([u.FTP],P(u.FTM,u.FTA));return I=o(I,e,i,c),_?h.values().reduce(function(E,B){var b=h.averageKey(B);return b?E.setIn([b],P(B,u.GP)):E},I):I}function e(f){var _=function(P){return f.get(P,0)},S=function(P,I){return _(P)/_(I)};return f.setIn([u.AST2TO],S(u.AST,u.TO))}function i(f){var _=function(P){return f.get(P,0)},S=.5*_(u.PTS)/(_(u.FGA)+.44*_(u.FTA));return f.setIn([u.TSP],S)}function c(f){var _=function(P){return f.get(P,0)},S=(_(u.FGM)+.5*_(u.M3PT))/_(u.FGA);return f.setIn([u.EFGP],S)}}(Bo)),Bo}var Pt={},Ff;function Ao(){if(Ff)return Pt;Ff=1,Object.defineProperty(Pt,"__esModule",{value:!0}),Pt.inThePaint=Pt.madeShot=Pt.participantsWithRole=Pt.participantWithRole=Pt.participantIdWithRole=void 0;var n=X,l=n.__importDefault(Pe);function t(u,h){var v=p(u,h);return v!==void 0?v.player.$id:void 0}Pt.participantIdWithRole=t;function p(u,h){var v=d(u,h);if(v)return l.default.first(v)}Pt.participantWithRole=p;function d(u,h){if(u.participants)return l.default.filter(u.participants,function(v){return l.default.contains(v.roles,h)})}Pt.participantsWithRole=d;function y(u){return!!u.properties&&u.properties.made}Pt.madeShot=y;function s(u){return!!u.properties&&u.properties.shot_zone===8}return Pt.inThePaint=s,Pt}var kf;function Dv(){if(kf)return zr;kf=1,Object.defineProperty(zr,"__esModule",{value:!0}),zr.StatsEngine=zr.HoopsGameStatsDoc=void 0;var n=X,l=n.__importStar(fe()),t=n.__importDefault(Pe),p=n.__importStar(Ee()),d=Fr(),y=n.__importStar(nf()),s=Ma(),u=n.__importStar(Ao()),h=Ao(),v=function(a){n.__extends(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return Object.defineProperty(r.prototype,"internal",{get:function(){return this.getIn(["internal"]).toJS()},enumerable:!1,configurable:!0}),r.prototype.setTeams=function(e){return this.set("teams",l.fromJS(e))},Object.defineProperty(r.prototype,"renderFunctions",{get:function(){return[this.renderGeneralStats.bind(this),this.renderOffensiveStats.bind(this),this.renderDefensiveStats.bind(this)]},enumerable:!1,configurable:!0}),r.prototype.renderOffensiveStats=function(e){var i=e.offense;if(i!==void 0){var c=(e.general||{})[s.HoopsStat.GP];c!==void 0&&(i[s.HoopsStat.FGM]=(0,d.safeSum)(i[s.HoopsStat.M2PT],i[s.HoopsStat.M3PT]),i[s.HoopsStat.FGA]=(0,d.safeSum)(i[s.HoopsStat.A2PT],i[s.HoopsStat.A3PT]),i[s.HoopsStat.FGP]=i[s.HoopsStat.FGM]/i[s.HoopsStat.FGA],i[s.HoopsStat.FTP]=i[s.HoopsStat.FTM]/i[s.HoopsStat.FTA],i[s.HoopsStat.P2PT]=i[s.HoopsStat.M2PT]/i[s.HoopsStat.A2PT],i[s.HoopsStat.P3PT]=i[s.HoopsStat.M3PT]/i[s.HoopsStat.A3PT],i[s.LegacyHoopsStat.M3PTPFGA]=i[s.HoopsStat.M3PT]/i[s.HoopsStat.FGA],i[s.HoopsStat.PTS]=(0,d.safeSum)(i[s.HoopsStat.FTM],2*i[s.HoopsStat.M2PT],3*i[s.HoopsStat.M3PT]),i[s.HoopsStat.EFGP]=(0,d.safeSum)(i[s.HoopsStat.FGM],.5*i[s.HoopsStat.M3PT])/i[s.HoopsStat.FGA],i[s.LegacyHoopsStat.TSA]=(0,d.safeSum)(i[s.HoopsStat.FGA],.44*i[s.HoopsStat.FTA]),i[s.HoopsStat.TSP]=i[s.HoopsStat.PTS]/(2*i[s.LegacyHoopsStat.TSA]),i[s.HoopsStat.PTSPG]=i[s.HoopsStat.PTS]/c,i[s.LegacyHoopsStat.A2PTPG]=i[s.HoopsStat.A2PT]/c,i[s.LegacyHoopsStat.A3PTPG]=i[s.HoopsStat.A3PT]/c,i[s.LegacyHoopsStat.M2PTPG]=i[s.HoopsStat.M2PT]/c,i[s.LegacyHoopsStat.M3PTPG]=i[s.HoopsStat.M3PT]/c,i[s.LegacyHoopsStat.FGMPG]=i[s.HoopsStat.FGM]/c,i[s.LegacyHoopsStat.FGAPG]=i[s.HoopsStat.FGA]/c,i[s.LegacyHoopsStat.FTAPG]=i[s.HoopsStat.FTA]/c,i[s.LegacyHoopsStat.FTMPG]=i[s.HoopsStat.FTM]/c,i[s.LegacyHoopsStat.FTAPFGA]=i[s.HoopsStat.FTA]/i[s.HoopsStat.FGA],i[s.HoopsStat.ASTPG]=i[s.HoopsStat.AST]/c,i[s.HoopsStat.REBPG]=i[s.HoopsStat.REB]/c,i[s.HoopsStat.TOPG]=i[s.HoopsStat.TO]/c,i[s.HoopsStat.AST2TO]=i[s.HoopsStat.AST]/i[s.HoopsStat.TO],i[s.HoopsStat.BLKPG]=i[s.HoopsStat.BLK]/c)}},r.prototype.renderDefensiveStats=function(e){var i=e.defense;if(i!==void 0){var c=(e.general||{})[s.HoopsStat.GP];c!==void 0&&(i[s.HoopsStat.REBPG]=i[s.HoopsStat.REB]/c,i[s.HoopsStat.BLKPG]=i[s.HoopsStat.BLK]/c,i[s.HoopsStat.STLPG]=i[s.HoopsStat.STL]/c,i[s.HoopsStat.PTS]=(0,d.safeSum)(i[s.HoopsStat.FTM],2*i[s.HoopsStat.M2PT],3*i[s.HoopsStat.M3PT]),i[s.HoopsStat.FGM]=i[s.HoopsStat.M2PT]/i[s.HoopsStat.M3PT],i[s.HoopsStat.FGA]=i[s.HoopsStat.A2PT]/i[s.HoopsStat.A3PT],i[s.HoopsStat.FGP]=i[s.HoopsStat.FGM]/i[s.HoopsStat.FGA],i[s.HoopsStat.P2PT]=i[s.HoopsStat.M2PT]/i[s.HoopsStat.A2PT],i[s.HoopsStat.P3PT]=i[s.HoopsStat.M3PT]/i[s.HoopsStat.A3PT],i[s.LegacyHoopsStat.M3PTPFGA]=i[s.HoopsStat.M3PT]/i[s.HoopsStat.FGA])}},r.prototype.renderGeneralStats=function(e){var i=e.general;i!==void 0&&(i[s.HoopsStat.PFPG]=i[s.HoopsStat.PF]/i[s.HoopsStat.GP],i[s.LegacyHoopsStat.OFPG]=i[s.LegacyHoopsStat.OF]/i[s.HoopsStat.GP],i[s.LegacyHoopsStat.TFPG]=i[s.HoopsStat.TF]/i[s.HoopsStat.GP],i[s.LegacyHoopsStat.FFPG]=i[s.LegacyHoopsStat.FF]/i[s.HoopsStat.GP],i[s.HoopsStat.REB]=(0,d.safeSum)((e.offense||{})[s.HoopsStat.REB],(e.defense||{})[s.HoopsStat.REB]),i[s.HoopsStat.REBPG]=i[s.HoopsStat.REB]/i[s.HoopsStat.GP])},r}(y.GameStatsDoc);zr.HoopsGameStatsDoc=v;var o=function(a){n.__extends(r,a);function r(e,i){var c=a.call(this,e)||this;return c.baseEvents=e,c.context=i,c}return r.prototype.initialState=function(){return new v(l.fromJS({teams:{},editsForTeams:{},internal:{period:void 0,offRebound:!1,lastFoulType:void 0,lastReboundTeamId:void 0,lastTurnoverLosingTeamId:void 0,possession:{rebounderTeamId:void 0,turnoverLosingTeamId:void 0,offRebound:void 0,foulType:void 0,currentNumber:void 0}}})).set("editPlayersToRemove",l.Set.of())},r.prototype.processOneEvent=function(e,i){if(i.code==="set_teams")return e;switch(i.code){case"team_stat_edit":return this.applyTeamEdit(e,i);case"player_stat_edit":return this.applyPlayerEdit(e,i);case"remove_player_edit":return this.applyRemovePlayerEdit(e,i);case"clear_all_edits":return this.clearAllEdits(e)}e=this.reconcileState(e,i);var c=e.internal;return e=this.setGamesPlayed(e,i),e=this.incrementShooterStats(e,i,c),e=this.incrementDefensiveTeamStats(e,i,c),e=this.incrementFoulerStats(e,i,c),e=this.incrementOtherParticipantStats(e,i,c),e},r.prototype.applyTeamEdit=function(e,i){return e.setTeamStats(i.teamId,i.category,i.statName,i.statValue,"editsForTeams")},r.prototype.applyPlayerEdit=function(e,i){return e.setPlayerStats(i.teamId,i.playerId,i.category,i.statName,i.statValue,"editsForTeams").removePlayerFromRemoveList(i.playerId)},r.prototype.applyRemovePlayerEdit=function(e,i){return e.addPlayerToRemoveList(i.playerId)},r.prototype.clearAllEdits=function(e){return e.update("editsForTeams",function(i){return i.clear()}).set("editPlayersToRemove",l.Set.of())},r.prototype.getDerivedMultiGamePivotedStatsWithBaseStats=function(e){var i=this.stateHistory[0].setTeams(e).set("context",l.fromJS(this.context));return i.pivotStatsForOutput},r.prototype.reconcileState=function(e,i){var c=this,f,_,S,P,I=e.getIn(["internal"]);return I=I.withMutations(function(E){E.set("lastReboundTeamId",E.getIn(["possession","rebounderTeamId"])),E.set("lastTurnoverLosingTeamId",E.getIn(["possession","turnoverLosingTeamId"])),E.set("offRebound",E.getIn(["possession","offRebound"]))}),(((f=i.result)===null||f===void 0?void 0:f.poss_num)!==I.getIn(["possession","currentNumber"])||((_=i.result)===null||_===void 0?void 0:_.per)!==I.get("period"))&&(I=I.set("possession",l.fromJS({rebounderTeamId:void 0,turnoverLosingTeamId:void 0,offRebound:void 0,foulType:void 0,currentNumber:(S=i.result)===null||S===void 0?void 0:S.poss_num}))),I=I.set("period",(P=i.result)===null||P===void 0?void 0:P.per),I=I.updateIn(["possession"],function(E){return E.withMutations(function(B){var b,R;i.properties&&i.properties.rebounder_team_id!==void 0&&B.set("rebounderTeamId",i.properties.rebounder_team_id),t.default.contains(["shot","frt"],i.code)&&B.get("rebounderTeamId")===((b=i.setting)===null||b===void 0?void 0:b.p_team_id)&&B.set("offRebound",!0);var F=i.properties?i.properties.foul_type:void 0,x=i.properties?i.properties.fouler_team_id:void 0,w=i.properties?i.properties.team_id:void 0;i.code==="foulc"&&(t.default.contains(["personal_foul","flagrant_foul"],F)||F==="technical_foul"&&c.context.ageGroup!=="college")&&((R=i.setting)===null||R===void 0?void 0:R.p_team_id)===x&&B.set("turnoverLosingTeamId",x),i.code==="etov"&&B.set("turnoverLosingTeamId",w),i.code==="foulc"&&B.set("foulType",F)})}),I=I.set("lastFoulType",I.getIn(["possession","foulType"])),e.set("internal",I)},r.prototype.setGamesPlayed=function(e,i){for(var c in i)if(c.indexOf("lineup")===0){var f=c.split("_")[1];e=e.setTeamStats(f,"general",s.HoopsStat.GP,1);var _=i[c].active_players;if(_!==void 0)for(var S=0,P=_;S<P.length;S++){var I=P[S];e=e.setPlayerStats(f,I,"general",s.HoopsStat.GP,1)}}for(var E=0,B=i.participants||[];E<B.length;E++){var b=B[E];b.team_id!==void 0&&(e=e.setPlayerStats(b.team_id,b.player.$id,"general",s.HoopsStat.GP,1))}return e},r.prototype.incrementShooterStats=function(e,i,c){var f,_,S,P,I=(0,h.participantIdWithRole)(i,"shtr"),E=(f=i.setting)===null||f===void 0?void 0:f.p_team_id,B=(_=i.properties)===null||_===void 0?void 0:_.points,b=u.madeShot(i),R=u.inThePaint(i),F=(S=i.properties)===null||S===void 0?void 0:S.shot_zone,x=["SZM".concat(F),"SZA".concat(F)],w=x[0],L=x[1],D=[{key:s.LegacyHoopsStat.PT2C,incrementBy:(i.code==="shot"||i.code==="frt"&&c.lastFoulType!=="technical_foul")&&b&&c.offRebound&&c.lastReboundTeamId===E?B:0},{key:s.LegacyHoopsStat.PTOTO,incrementBy:t.default.contains(["shot","frt"],i.code)&&b&&c.lastTurnoverLosingTeamId!==void 0&&c.lastTurnoverLosingTeamId!==((P=i.setting)===null||P===void 0?void 0:P.p_team_id)?B:0},{key:s.LegacyHoopsStat.PIP,incrementBy:i.code==="shot"&&b&&B===2&&R?B:0},{key:w,increment:b},{key:L,increment:!0},{key:s.HoopsStat.M2PT,increment:i.code==="shot"&&b&&B===2},{key:s.HoopsStat.A2PT,increment:i.code==="shot"&&B===2},{key:s.HoopsStat.M3PT,increment:i.code==="shot"&&b&&B===3},{key:s.HoopsStat.A3PT,increment:i.code==="shot"&&B===3},{key:s.HoopsStat.FTM,increment:i.code==="frt"&&b},{key:s.HoopsStat.FTA,increment:i.code==="frt"}];return e.updatePlayerStatsElements(E,I,"offense",D)},r.prototype.incrementDefensiveTeamStats=function(e,i,c){var f,_,S=(f=i.setting)===null||f===void 0?void 0:f.defensive_team_id,P=(_=i.properties)===null||_===void 0?void 0:_.points,I=u.madeShot(i);return i.code==="shot"&&P===2&&(e=e.incrementTeamStats(S,"defense",s.HoopsStat.A2PT,1),I&&(e=e.incrementTeamStats(S,"defense",s.HoopsStat.M2PT,1))),i.code==="shot"&&P===3&&(e=e.incrementTeamStats(S,"defense",s.HoopsStat.A3PT,1),I&&(e=e.incrementTeamStats(S,"defense",s.HoopsStat.M3PT,1))),i.code==="frt"&&(e=e.incrementTeamStats(S,"defense",s.HoopsStat.FTA,1),I&&(e=e.incrementTeamStats(S,"defense",s.HoopsStat.FTM,1))),e},r.prototype.incrementFoulerStats=function(e,i,c){var f,_,S,P=(0,h.participantIdWithRole)(i,"flr"),I=(f=i.properties)===null||f===void 0?void 0:f.fouler_team_id,E=((_=i.setting)===null||_===void 0?void 0:_.p_team_id)===I,B=(S=i.properties)===null||S===void 0?void 0:S.foul_type,b=[{key:s.HoopsStat.PF,increment:i.code==="foulc"},{key:"PFP1",increment:i.code==="foulc"&&c.period===1},{key:"PFP2",increment:i.code==="foulc"&&c.period===2},{key:"PFP3",increment:i.code==="foulc"&&c.period===3},{key:"PFP4",increment:i.code==="foulc"&&c.period===4},{key:"PFP5G",increment:i.code==="foulc"&&c.period>4},{key:s.LegacyHoopsStat.OF,increment:i.code==="foulc"&&B==="personal_foul"},{key:s.HoopsStat.TF,increment:i.code==="foulc"&&B==="technical_foul"},{key:s.LegacyHoopsStat.FF,increment:i.code==="foulc"&&B==="flagrant_foul"}];e=e.updatePlayerStatsElements(I,P,"general",b);var R=[{key:s.HoopsStat.PF,increment:i.code==="foulc"&&E},{key:s.HoopsStat.TO,increment:i.code==="foulc"&&E&&!(B==="technical_foul"&&t.default.contains(["adult","college"],this.context.ageGroup))}];return e.updatePlayerStatsElements(I,P,"offense",R)},r.prototype.incrementOtherParticipantStats=function(e,i,c){var f,_,S,P,I,E=(f=i.setting)===null||f===void 0?void 0:f.p_team_id,B=(_=i.setting)===null||_===void 0?void 0:_.defensive_team_id,b=(0,h.participantIdWithRole)(i,"asst"),R=(0,h.participantIdWithRole)(i,"blkr"),F=(0,h.participantIdWithRole)(i,"shtr"),x=(0,h.participantIdWithRole)(i,"stlr"),w=(0,h.participantIdWithRole)(i,"tov"),L=(0,h.participantIdWithRole)(i,"rbdr"),D=u.madeShot(i);return i.code==="shot"&&i.assist_added&&D&&(e=e.incrementPlayerStats(E,b,"offense",s.HoopsStat.AST,1)),i.code==="shot"&&i.block_added&&!D&&(e=e.incrementPlayerStats(B,R,"defense",s.HoopsStat.BLK,1),e=e.incrementPlayerStats(E,F,"offense",s.HoopsStat.BLK,1)),i.code==="etov"&&i.steal_added&&(e=e.incrementPlayerStats(B,x,"defense",s.HoopsStat.STL,1)),i.code==="etov"&&(e=e.incrementPlayerStats(E,w,"offense",s.HoopsStat.TO,1),i.steal_added&&(e=e.incrementPlayerStats(E,w,"offense",s.HoopsStat.STL,1))),t.default.contains(["shot","frt"],i.code)&&(((S=i.properties)===null||S===void 0?void 0:S.rebounder_team_id)===((P=i.setting)===null||P===void 0?void 0:P.p_team_id)?e=e.incrementPlayerStats(E,L,"offense",s.HoopsStat.REB,1):((I=i.properties)===null||I===void 0?void 0:I.rebounder_team_id)!==void 0&&(e=e.incrementPlayerStats(B,L,"defense",s.HoopsStat.REB,1))),e},r}(p.VersionedStateEngine);return zr.StatsEngine=o,zr}var Yr={},wf;function Gv(){if(wf)return Yr;wf=1,Object.defineProperty(Yr,"__esModule",{value:!0}),Yr.LegacySituationEngine=Yr.SituationState=void 0;var n=X,l=n.__importStar(Ee()),t=n.__importStar(fe()),p=n.__importStar(Oe()),d=function(s){n.__extends(u,s);function u(){return s!==null&&s.apply(this,arguments)||this}return Object.defineProperty(u.prototype,"period",{get:function(){return this.get("period")},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"scoresImmutable",{get:function(){return this.get("scores").mergeDeep(this.get("scoreEdits"))},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"scores",{get:function(){return this.scoresImmutable.toJS()},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"homeId",{get:function(){return this.get("homeId")},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"awayId",{get:function(){return this.get("awayId")},enumerable:!1,configurable:!0}),u.prototype.incrementScore=function(h,v,o){var a=this;return v&&(a=this.incrementIn(["scores",h],o)),a},u}(p.ImmutableState);Yr.SituationState=d;var y=function(s){n.__extends(u,s);function u(){return s!==null&&s.apply(this,arguments)||this}return u.prototype.processOneEvent=function(h,v){switch(v.code){case"set_teams":h=this.setTeams(h,v);break;case"strtp":h=h.increment("period",1);break;case"shot":case"frt":var o=v;h=h.incrementScore(o.properties.team_id,o.properties.made,o.properties.points);break;case"scadj":var a=v;h=h.setIn(["scores",h.homeId],a.properties.adjusted_home_score),h=h.setIn(["scores",h.awayId],a.properties.adjusted_away_score);break;case"team_stat_edit":h=this.teamStatEdit(h,v);break;case"clear_all_edits":h=this.clearAllEdits(h);break}return h},u.prototype.initialState=function(){return new d(t.fromJS({scores:{},scoreEdits:{},period:0,homeId:void 0,awayId:void 0}))},u.prototype.setTeams=function(h,v){return h.setIn(["scores",v.attributes.homeId],0).setIn(["scores",v.attributes.awayId],0).set("homeId",v.attributes.homeId).set("awayId",v.attributes.awayId)},u.prototype.teamStatEdit=function(h,v){return v.statName==="R"&&v.category==="offense"&&(h=h.setIn(["scoreEdits",v.teamId],v.statValue)),h},u.prototype.clearAllEdits=function(h){return h.update("scoreEdits",function(v){return v.clear()})},u}(l.VersionedStateEngine);return Yr.LegacySituationEngine=y,Yr}var Qr={},Cf;function Hv(){if(Cf)return Qr;Cf=1,Object.defineProperty(Qr,"__esModule",{value:!0}),Qr.ShotChartsEngine=Qr.ShotChartsState=void 0;var n=X,l=n.__importStar(fe()),t=n.__importStar(Ee()),p=n.__importStar(Oe()),d=Ao(),y=function(u){n.__extends(h,u);function h(){return u!==null&&u.apply(this,arguments)||this}return h.prototype.shotChartsData=function(){return this.getIn(["teams"]).toJS()},h.prototype.ensureTeam=function(v){var o=this;return o.hasIn(["teams",v])||(o=o.setIn(["teams",v],l.fromJS({shots:[],players:{}}))),o},h.prototype.ensurePlayer=function(v,o){var a=this;return a.hasIn(["teams",v,"players",o])||(a=a.setIn(["teams",v,"players",o,"shots"],l.List())),a},h}(p.ImmutableState);Qr.ShotChartsState=y;var s=function(u){n.__extends(h,u);function h(){return u!==null&&u.apply(this,arguments)||this}return h.prototype.initialState=function(){return new y(l.fromJS({teams:{}}))},h.prototype.processOneEvent=function(v,o){return o.code==="shot"&&(v=this.addShot(v,o)),v},h.prototype.addShot=function(v,o){var a=o.properties.team_id,r=(0,d.participantIdWithRole)(o,"shtr");v=v.ensureTeam(a);var e;return r!==void 0?(v=v.ensurePlayer(a,r),e=["teams",a,"players",r,"shots"]):e=["teams",a,"shots"],v.updateIn(e,function(i){var c;return i.push({p:o.properties.rel_court_pos,m:o.properties.made?1:0,q:(c=o.setting)===null||c===void 0?void 0:c.per,n:o.properties.points,d:o.properties.play_direction,shot_zone:o.properties.shot_zone})})},h}(t.VersionedStateEngine);return Qr.ShotChartsEngine=s,Qr}var Xr={},Mf;function Nv(){if(Mf)return Xr;Mf=1,Object.defineProperty(Xr,"__esModule",{value:!0}),Xr.PassthroughTranscoder=Xr.TranscoderState=void 0;var n=X,l=n.__importStar(gt()),t=function(d){n.__extends(y,d);function y(){return d!==null&&d.apply(this,arguments)||this}return y}(l.TranscoderState);Xr.TranscoderState=t;var p=function(d){n.__extends(y,d);function y(s){var u=d.call(this,s)||this;return u.baseEvents=s,u}return y.prototype.initialState=function(){return new t},y.prototype.processOneEvent=function(s,u){this.state.outStream.push(u)},y}(l.SnapshottedTranscoder);return Xr.PassthroughTranscoder=p,Xr}var xf;function jv(){if(xf)return wa;xf=1,Object.defineProperty(wa,"__esModule",{value:!0}),wa.BasketballPassthroughController=void 0;var n=X,l=n.__importStar(gt()),t=gf(),p=Dv(),d=Gv(),y=Hv(),s=Nv(),u=function(h){n.__extends(v,h);function v(o,a){var r=h.call(this)||this;return r.context=a,r.stateAccessorClass=t.StateAccessor,r.transcoder=new s.PassthroughTranscoder(r.legacyEvents),r.stats=new p.StatsEngine(r.transcoder.outStream,r.context),r.situation=new d.LegacySituationEngine(r.transcoder.outStream),r.shotCharts=new y.ShotChartsEngine(r.transcoder.outStream),r.engines=[r.stats,r.situation,r.shotCharts],r.push({code:"set_teams",id:"auto_generated_set_teams",attributes:{homeId:o.homeTeamId,awayId:o.awayTeamId}}),r}return v.prototype.getDerivedMultiGamePivotedStatsWithBaseStats=function(o){return this.stats.getDerivedMultiGamePivotedStatsWithBaseStats(o)},v}(l.TranscoderController);return wa.BasketballPassthroughController=u,wa}var xa={},La={},sr={},xe={},Lf;function Ro(){if(Lf)return xe;Lf=1,Object.defineProperty(xe,"__esModule",{value:!0}),xe.makeEndPlay=xe.makeBeginPlay=xe.makeUndo=xe.makeTransaction=xe.makeOverrideScore=xe.makeAdjustScore=xe.makeAssignPlayer=xe.makePlay=xe.makeDeactivatePlayer=xe.makeActivatePlayer=void 0;var n=Ge(),l=Me();function t(r){var e=r.teamId,i=r.playerId,c=r.pbpEntryId,f=r.createdAt,_=f===void 0?void 0:f;return{id:(0,n.uuid4)(),code:l.MultiSportEventCode.ActivatePlayer,createdAt:_,attributes:{pbp_entry_id:c||(0,n.uuid4)(),team_id:e,player_id:i},compactorAttributes:{stream:"main"}}}xe.makeActivatePlayer=t;function p(r){var e=r.teamId,i=r.playerId,c=r.pbpEntryId,f=r.createdAt,_=f===void 0?void 0:f;return{id:(0,n.uuid4)(),code:l.MultiSportEventCode.DeactivatePlayer,createdAt:_,attributes:{pbp_entry_id:c||(0,n.uuid4)(),team_id:e,player_id:i},compactorAttributes:{stream:"main"}}}xe.makeDeactivatePlayer=p;function d(r){var e=r.teamId,i=r.playCode,c=r.pbpEntryId,f=r.id,_=f===void 0?void 0:f,S=r.createdAt,P=S===void 0?void 0:S,I=r.playDetails,E=I===void 0?void 0:I;return{id:_??(0,n.uuid4)(),code:l.MultiSportEventCode.Play,createdAt:P,attributes:{pbp_entry_id:c||(0,n.uuid4)(),team_id:e,play_code:i,play_details:E},compactorAttributes:{stream:"main"}}}xe.makePlay=d;function y(r){var e=r.playId,i=r.playerId,c=r.isEdit,f=c===void 0?!1:c,_=r.createdAt,S=_===void 0?void 0:_;return{id:(0,n.uuid4)(),code:l.MultiSportEventCode.AssignPlayer,createdAt:S,attributes:{play_event_id:e,player_id:i,is_edit:f},compactorAttributes:{stream:"main"}}}xe.makeAssignPlayer=y;function s(r){var e=r.teamId,i=r.adjustment,c=r.pbpEntryId,f=r.createdAt,_=f===void 0?void 0:f;return{id:(0,n.uuid4)(),code:l.MultiSportEventCode.AdjustScore,createdAt:_,attributes:{pbp_entry_id:c||(0,n.uuid4)(),team_id:e,adjustment:i},compactorAttributes:{stream:"main"}}}xe.makeAdjustScore=s;function u(r){var e=r.teamId,i=r.points,c=r.pbpEntryId,f=r.createdAt,_=f===void 0?void 0:f;return{id:(0,n.uuid4)(),code:l.MultiSportEventCode.OverrideScore,createdAt:_,attributes:{pbp_entry_id:c||(0,n.uuid4)(),team_id:e,points:i},compactorAttributes:{stream:"main"}}}xe.makeOverrideScore=u;function h(r){return{id:(0,n.uuid4)(),code:"transaction",events:r,compactorAttributes:{stream:"main"}}}xe.makeTransaction=h;function v(r){return{id:r??(0,n.uuid4)(),code:"undo"}}xe.makeUndo=v;function o(){return{id:(0,n.uuid4)(),code:l.MultiSportEventCode.BeginPlay,compactorAttributes:{stream:"main"}}}xe.makeBeginPlay=o;function a(){return{id:(0,n.uuid4)(),code:l.MultiSportEventCode.EndPlay,compactorAttributes:{stream:"main"}}}return xe.makeEndPlay=a,xe}var Fo={},Je={},ko={},Da={},wo={},Df;function Co(){return Df||(Df=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.GameSettings=n.getPeriodType=n.PeriodType=void 0,function(t){t.Quarters="quarters",t.Halves="halves"}(n.PeriodType||(n.PeriodType={}));function l(t){var p;if(t.hoops)return(p=t.hoops)===null||p===void 0?void 0:p.periodType}n.getPeriodType=l,function(t){function p(y){return y?{hoops:{gameClock:y.get("gameClock"),periodType:y.get("periodType"),periodLength:y.get("periodLength"),teamTimeouts:y.get("teamTimeouts"),timeoutsReset:y.get("timeoutsReset")}}:t.emptyGameSettingsDoc()}t.fromHoopsMap=p;function d(){return{hoops:void 0}}t.emptyGameSettingsDoc=d}(n.GameSettings||(n.GameSettings={}))}(wo)),wo}var Gf;function Hf(){if(Gf)return Da;Gf=1,Object.defineProperty(Da,"__esModule",{value:!0}),Da.formatPeriod=void 0;var n=Fr(),l=Co();function t(d,y){y===void 0&&(y=l.PeriodType.Quarters);var s,u=d;switch(y){case l.PeriodType.Quarters:{d<=4?s="Quarter":(u=d-4,s="Overtime");break}case l.PeriodType.Halves:{d<=2?s="Half":(u=d-2,s="Overtime");break}default:s="Period"}var h=p(u);return"".concat(u).concat(h," ").concat(s)}Da.formatPeriod=t;function p(d){if((0,n.inRange)(d,10,20))return"th";var y=d%10;switch(y){case 1:return"st";case 2:return"nd";case 3:return"rd";default:return"th"}}return Da}var Nf;function jf(){return Nf||(Nf=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.prepareScore=n.generateScoreChanged=n.generateGameEnd=n.generateGameState=n.generateAnnouncements=void 0;var l=X,t=l.__importStar(Wi()),p=l.__importDefault(Pe),d=Xd(),y=Hf();function s(a){return{gameState:u(a.awayTeamId,a.homeTeamId,a.scores[a.awayTeamId],a.scores[a.homeTeamId],a.periodNumber,a.periodType),gameEnd:h(a),scoreChanged:v(a)}}n.generateAnnouncements=s;function u(a,r,e,i,c,f){var _=t.stubbify(a),S=t.stubbify(r),P=(0,y.formatPeriod)(c,f);return"Were underway at the ".concat(_," game versus ").concat(S,". Currently the game is in the ").concat(P," and the score is ").concat(_," ").concat(e," ").concat(S," ").concat(i)}n.generateGameState=u;function h(a){var r=p.default.sortBy((0,n.prepareScore)(a),function(c){return-1*c.score}),e=r[0],i=r[1];return e.score-i.score===0?"That's the end of the game, ".concat(e.stub," and ").concat(i.stub," tie ").concat(e.score," to ").concat(i.score,"."):"That's the end of the game, ".concat(e.stub," get the win over ").concat(i.stub," ").concat(e.score," to ").concat(i.score,".")}n.generateGameEnd=h;function v(a){var r=a.scores[a.awayTeamId],e=a.scores[a.homeTeamId];return"Score changed! ".concat(r," ").concat(e)}n.generateScoreChanged=v;var o=function(a){return(0,d.asTuple)([{stub:t.stubbify(a.awayTeamId),score:a.scores[a.awayTeamId]},{stub:t.stubbify(a.homeTeamId),score:a.scores[a.homeTeamId]}])};n.prepareScore=o}(ko)),ko}var qf;function Uf(){if(qf)return Je;qf=1,Object.defineProperty(Je,"__esModule",{value:!0}),Je.getColorCommentaryMaybe=Je.getEndPeriodCommentary=Je.getPeriodStartCommentary=Je.getAdjustScoreCommentary=Je.getDeactivatePlayerCommentary=Je.getActivatePlayerCommentary=Je.getPlayCommentary=void 0;var n=X,l=Jr(),t=n.__importStar(Wi()),p=Fr(),d=n.__importDefault(Pe),y=jf(),s=Ma(),u=Hf();function h(G,q,z){z===void 0&&(z=p.getRandomInt);var ne=t.stubbify(q);switch(G){case l.PlayCode.Made2:return v(ne,z);case l.PlayCode.Made3:return o(ne,z);case l.PlayCode.Missed2:return a(ne,z);case l.PlayCode.Missed3:return r(ne,z);case l.PlayCode.MadeFreeThrow:return e(ne,z);case l.PlayCode.MissedFreeThrow:return i(ne,z);case l.PlayCode.Foul:return c(ne,z);case l.PlayCode.Turnover:return f(ne,z);case l.PlayCode.Rebound:case l.PlayCode.DefensiveRebound:case l.PlayCode.OffensiveRebound:return _(ne,z);case l.PlayCode.Assist:return S(ne,z);case l.PlayCode.Steal:return P(ne,z);case l.PlayCode.Block:return I(ne,z);case l.PlayCode.Timeout:return E(ne);case l.PlayCode.Timeout30:return B(ne);default:return}}Je.getPlayCommentary=h;function v(G,q){var z=["".concat(G," finishes with the soft touch for 2"),"Easy shot from ".concat(G," for 2"),"".concat(G," puts it up and in for 2"),"".concat(G," nails the deuce"),"".concat(G," with the soft touch around the rim for 2")],ne=q(z.length);return z[ne]}function o(G,q){var z=["The shot from ".concat(G," is good for 3"),"".concat(G," drains one from beyond the arc"),"".concat(G," knocks down the trifecta!"),"".concat(G," with the triple"),"".concat(G," with the 3 is good")],ne=q(z.length);return z[ne]}function a(G,q){var z=["No good for 2 from ".concat(G," that time"),"".concat(G," is too strong on the 2 and misses"),"Just off the mark with that one from ".concat(G," for 2"),"Tough luck on the close-range shot from ".concat(G),"".concat(G," Nearly had it for 2, but the ball spins out")],ne=q(z.length);return z[ne]}function r(G,q){var z=["".concat(G," is off from 3"),"No basket on the triple from ".concat(G),"A long one from ".concat(G," is missed"),"".concat(G," not good from long range"),"".concat(G," came up short on the 3 point attempt")],ne=q(z.length);return z[ne]}function e(G,q){var z=["".concat(G," Sinks the free throw!"),"".concat(G," Calmly drains the free throw"),"".concat(G," Delivers a perfect stroke from the free throw line")],ne=q(z.length);return z[ne]}function i(G,q){var z=["".concat(G," Comes up short from the free throw line"),"No luck from ".concat(G,"'s free throw shot"),"".concat(G," Can't find the mark from the free throw line")],ne=q(z.length);return z[ne]}function c(G,q){var z=["".concat(G," Commits the foul on that play"),"Oops, thats a foul by ".concat(G)],ne=q(z.length);return z[ne]}function f(G,q){var z=["".concat(G," Loses possession with the turnover"),"".concat(G," Turns it over")],ne=q(z.length);return z[ne]}function _(G,q){var z=["".concat(G," Grabs the board"),"".concat(G," Cleans the glass with that rebound"),"".concat(G," Claims the board")],ne=q(z.length);return z[ne]}function S(G,q){var z=["".concat(G," with the dish"),"".concat(G," Delivers the dime"),"".concat(G," Makes it look easy with the assist")],ne=q(z.length);return z[ne]}function P(G,q){var z=["".concat(G," Is picking pockets with the steal"),"".concat(G," Forces the turnover with the steal"),"".concat(G," Sneaks up and steals the ball away")],ne=q(z.length);return z[ne]}function I(G,q){var z=["".concat(G," Rejects the shot with the block"),"".concat(G," Swats it away"),"".concat(G," Sends it back with the block")],ne=q(z.length);return z[ne]}function E(G){return"A minute timeout is called by ".concat(G)}function B(G){return"A quick timeout on the floor by ".concat(G)}function b(G,q){q===void 0&&(q=p.getRandomInt);var z=t.stubbify(G),ne=["".concat(z," Checks in"),"".concat(z," Enters the game"),"".concat(z," Makes their way onto the court")],ue=q(ne.length);return ne[ue]}Je.getActivatePlayerCommentary=b;function R(G,q){q===void 0&&(q=p.getRandomInt);var z=t.stubbify(G),ne=["".concat(z," Is headed to the bench after a strong stint"),"".concat(z," Takes a breather on the bench"),"Substitution time! ".concat(z," makes way for a sub")],ue=q(ne.length);return ne[ue]}Je.getDeactivatePlayerCommentary=R;function F(G,q){return"Score changed! ".concat(G," ").concat(q)}Je.getAdjustScoreCommentary=F;function x(G,q,z,ne,ue,ee){var $=t.stubbify(G),Y=t.stubbify(q),W=(0,u.formatPeriod)(ue,ee);return ue===1?(0,y.generateGameState)(G,q,z,ne,ue,ee):"The ".concat(W," is underway. ").concat($," take on ").concat(Y,". The current score is ").concat($," ").concat(z," ").concat(Y," ").concat(ne)}Je.getPeriodStartCommentary=x;function w(G,q,z){var ne=(0,u.formatPeriod)(G,z),ue=d.default.sortBy((0,y.prepareScore)({scores:q.scores,homeTeamId:q.homeId,awayTeamId:q.awayId}),function($){return-1*$.score}),ee=ue[0].score-ue[1].score;return ee===0?"The ".concat(ne," ends tied up at ").concat(ue[0].score):"The ".concat(ne," comes to a close with ").concat(ue[0].stub," leading the game by ").concat(ee)}Je.getEndPeriodCommentary=w;function L(G,q,z,ne,ue){var ee=[],$=U(q,z,ue);$&&ee.push($);var Y=D(G,z,ne,ue);if(Y&&ee.push(Y),ee.length!==0)return ee.join(" ").trim()}Je.getColorCommentaryMaybe=L;function D(G,q,z,ne){if([l.PlayCode.Made2,l.PlayCode.Made3,l.PlayCode.MadeFreeThrow].includes(q))try{var ue=+G.stats[ne].players[z].stats.offense[s.HoopsStat.PTS];switch(q){case l.PlayCode.MadeFreeThrow:if(ue===10)return"They now have 10 points in the game!";break;case l.PlayCode.Made2:if([10,11].includes(ue))return"They now have ".concat(ue," points in the game!");break;case l.PlayCode.Made3:if([10,11,12].includes(ue))return"They now have ".concat(ue," points in the game!");break;default:return}}catch{return}}function U(G,q,z){if([l.PlayCode.Made2,l.PlayCode.Made3].includes(q))try{var ne=G.latestScorerStreaks[z].streakCount;switch(ne){case 2:return"Thats back to back buckets, theyre heating up!";case 3:return"Thats 3 buckets in a row, theyre on fire!";default:return}}catch{return}}return Je}var Wf;function kt(){return Wf||(Wf=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.MultiSportPlayByPlayEngine=n.PlayByPlayEntry=n.playByPlayEntry=n.PlayByPlayState=n.PlayByPlayType=void 0;var l=X,t=l.__importStar(fe()),p=l.__importStar(Ee()),d=l.__importStar(Oe()),y=gt(),s=Me(),u=Uf(),h;(function(r){r.Play="play",r.StartPeriod="startPeriod",r.EndPeriod="endPeriod",r.ImplicitPlayerActivate="implicitPlayerActivate",r.PlayerActivate="playerActivate",r.PlayerDeactivate="playerDeactivate",r.ScoreAdjustment="scoreAdjustment",r.ScoreOverride="scoreOverride",r.BeginPlay="beginPlay",r.EndPlay="endPlay"})(h=n.PlayByPlayType||(n.PlayByPlayType={}));var v=function(r){l.__extends(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return Object.defineProperty(e.prototype,"isInProgress",{get:function(){return this.get(e.isInProgressKey,!1)},enumerable:!1,configurable:!0}),e.prototype.setInProgress=function(i){return this.set(e.isInProgressKey,i)},Object.defineProperty(e.prototype,"inProgressEntries",{get:function(){return this.get(e.inProgressEntriesKey)},enumerable:!1,configurable:!0}),e.prototype.pushInProgressEntry=function(i){return this.updateIn([e.inProgressEntriesKey],t.List(),function(c){return c.push(i)})},e.prototype.clearInProgressEntries=function(){return this.set(e.inProgressEntriesKey,t.List())},Object.defineProperty(e.prototype,"latestScorerStreaks",{get:function(){return this.get(e.latestScorerStreakKey).toJS()},enumerable:!1,configurable:!0}),e.prototype.trackLatestScore=function(i,c){var f=this.latestScorerStreaks;if(f[i]){var _=f[i];return _.playerId===c?this.setIn([e.latestScorerStreakKey,i,"playerId"],c).setIn([e.latestScorerStreakKey,i,"streakCount"],_.streakCount+1):this.setIn([e.latestScorerStreakKey,i,"playerId"],c).setIn([e.latestScorerStreakKey,i,"streakCount"],1)}return this.setIn([e.latestScorerStreakKey,i,"playerId"],c).setIn([e.latestScorerStreakKey,i,"streakCount"],1)},e.prototype.trackLatestMiss=function(i,c){var f=this.latestScorerStreaks;if(f[i]){var _=f[i];if(_.playerId===c)return this.setIn([e.latestScorerStreakKey,i,"playerId"],c).setIn([e.latestScorerStreakKey,i,"streakCount"],0)}return this},Object.defineProperty(e.prototype,"allEntriesImmutable",{get:function(){return this.get(e.entriesKey)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"allEntries",{get:function(){return this.allEntriesImmutable.toJS()},enumerable:!1,configurable:!0}),e.prototype.pushEntry=function(i){var c=this.allEntriesImmutable.count(),f=this.updateIn([e.entriesKey],function(_){return _.push(i)});return i.eventIds&&i.eventIds.forEach(function(_){return f=f.setIn([e.eventIdIndexMapKey,_],c)}),f},e.prototype.entryForEventId=function(i){var c=this.getIn([e.eventIdIndexMapKey,i]);if(c!==void 0){var f=this.getIn([e.entriesKey,c]);if(f===void 0)throw new y.InvalidEventIndexError(c);return{entry:f,index:c}}},e.isInProgressKey="isInProgress",e.inProgressEntriesKey="inProgressEntries",e.entriesKey="entries",e.eventIdIndexMapKey="eventIdIndexMap",e.latestScorerStreakKey="latestScorerStreak",e}(d.ImmutableState);n.PlayByPlayState=v,n.playByPlayEntry=t.Record({id:"",template:"",playByPlayType:"",eventIds:void 0,playCode:void 0,playerStats:void 0,teamId:void 0,playerId:void 0,playerAssignmentEventId:void 0,period:void 0,teamScores:void 0,periodScores:void 0,scoreAdjustment:void 0,playerEdited:void 0,playerAssignable:!1,teamAssignable:!1,deletable:!1,createdAt:void 0,summary:void 0,playDetails:void 0,initialState:void 0,colorCommentary:void 0});var o=function(r){l.__extends(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e}(n.playByPlayEntry);n.PlayByPlayEntry=o;var a=function(r){l.__extends(e,r);function e(i,c,f,_,S,P){var I=r.call(this,i)||this;return I.baseEvents=i,I.confirguration=c,I.activePlayer=f,I.period=_,I.score=S,I.stats=P,I.playsForStreakTracking=[],I.playsForStreakBreaking=[],I}return e.prototype.initialState=function(){return new v(t.fromJS({entries:[],eventIdIndexMap:{},isInProgress:!1,inProgressEntriesKey:{},latestScorerStreak:{}}))},e.prototype.processOneEvent=function(i,c){var f=this;switch(c.code){case s.MultiSportEventCode.BeginPlay:return this.handleBeginPlay(i,c);case s.MultiSportEventCode.EndPlay:return this.handleEndPlay(i,c);case s.MultiSportEventCode.Play:return(0,s.onValidPlayCode)(i,c,this.confirguration.play_codes,function(_,S){return f.handlePlay(_,S)});case s.MultiSportEventCode.EndPeriod:return this.handleEndPeriod(i,c);case s.MultiSportEventCode.AssignPlayer:return this.handleAssignPlayer(i,c);case s.MultiSportEventCode.ActivatePlayer:return this.handleActivatePlayer(i,c);case s.MultiSportEventCode.DeactivatePlayer:return this.handleDeactivatePlayer(i,c);case s.MultiSportEventCode.AdjustScore:return this.handleAdjustScore(i,c);case s.MultiSportEventCode.OverrideScore:return this.handleOverrideScore(i,c);default:return i}},e.prototype.handleBeginPlay=function(i,c){return i},e.prototype.handleEndPlay=function(i,c){return i},e.prototype.getColorCommentaryMaybe=function(i,c,f,_,S){},e.prototype.handleEndPeriod=function(i,c){var f=this.period.stateBeforeEvent(this.nextEventOffset),_=this.score.stateAfterEvent(this.nextEventOffset),S=new o(t.fromJS({template:"End of period ".concat(f==null?void 0:f.period),id:"end_of_period_".concat(f==null?void 0:f.period),playByPlayType:h.EndPeriod,eventIds:[c.id],period:f==null?void 0:f.period,teamScores:_==null?void 0:_.scoresImmutable,playerAssignable:!1,teamAssignable:!1,deletable:!0,createdAt:c.createdAt,summary:this.getEndPeriodSummary(f.period,_,f.periodType)}));return i.pushEntry(S)},e.prototype.getEndPeriodSummary=function(i,c,f){},e.prototype.handleAssignPlayer=function(i,c){var f,_=c.attributes.play_event_id,S=i.entryForEventId(_);if(S===void 0)return i;var P=S.index,I=S.entry;if(I.eventIds===void 0)throw new Error("entry is missing eventId");var E=c.attributes.player_id,B=(f=this.stats)===null||f===void 0?void 0:f.stateAfterEvent(this.nextEventOffset);I.playCode&&I.teamId&&(this.playsForStreakTracking.includes(I.playCode)?i=i.trackLatestScore(I.teamId,E):this.playsForStreakBreaking.includes(I.playCode)&&(i=i.trackLatestMiss(I.teamId,E)));var b=void 0;I.playCode&&I.teamId&&B&&(b=this.getColorCommentaryMaybe(B,i,I.playCode,E,I.teamId));var R=new o(t.fromJS({template:"".concat(I.playCode," by ").concat(E),id:I.id,playByPlayType:h.Play,eventIds:I.eventIds,playCode:I.playCode,playerStats:B==null?void 0:B.stats[I.teamId].players[E],teamId:I.teamId,period:I.period,playerId:E,playerAssignmentEventId:c.id,teamScores:I.teamScores,playerEdited:c.attributes.is_edit,playerAssignable:!0,teamAssignable:!0,deletable:!0,createdAt:I.createdAt,colorCommentary:b,summary:(0,u.getPlayCommentary)(I.playCode,E)})),F=this.activePlayer.stateBeforeEvent(this.nextEventOffset);if(F!=null&&F.isPlayerActive(I.teamId,E))return i.setIn(["entries",P],R);var x=new o(t.fromJS({template:"".concat(E," entered the game"),id:"".concat(I.id,"_implicit_activate"),playByPlayType:h.ImplicitPlayerActivate,teamId:I.teamId,period:I.period,playerId:E,playerAssignable:!1,teamAssignable:!1,deleteable:!1,createdAt:I.createdAt,summary:this.getActivatePlayerSummary(E)}));return i.updateIn(["entries"],function(w){return w.set(P,R).insert(P,x)}).setIn(l.__spreadArray(["eventIdIndexMap"],I.eventIds.toArray(),!0),P+1)},e.prototype.handleActivatePlayer=function(i,c){var f=c.attributes.team_id,_=c.attributes.player_id,S=this.period.stateBeforeEvent(this.nextEventOffset),P=this.activePlayer.stateBeforeEvent(this.nextEventOffset);if(P!=null&&P.isPlayerActive(f,_))return i;var I=new o(t.fromJS({template:"".concat(_," entered the game"),id:c.attributes.pbp_entry_id,playByPlayType:h.PlayerActivate,eventIds:[c.id],teamId:f,period:S==null?void 0:S.period,playerId:_,playerAssignable:!0,teamAssignable:!1,deletable:!0,createdAt:c.createdAt,summary:this.getActivatePlayerSummary(_)}));return i.pushEntry(I)},e.prototype.getActivatePlayerSummary=function(i){},e.prototype.handleDeactivatePlayer=function(i,c){var f=c.attributes.team_id,_=c.attributes.player_id,S=this.period.stateBeforeEvent(this.nextEventOffset),P=this.activePlayer.stateBeforeEvent(this.nextEventOffset);if(!(P!=null&&P.isPlayerActive(f,_)))return i;var I=new o(t.fromJS({template:"".concat(_," sat down"),id:c.attributes.pbp_entry_id,playByPlayType:h.PlayerDeactivate,eventIds:[c.id],teamId:f,period:S==null?void 0:S.period,playerId:_,playerAssignable:!0,teamAssignable:!1,deletable:!0,createdAt:c.createdAt,summary:this.getDeactivatePlayerSummary(_)}));return i.pushEntry(I)},e.prototype.getDeactivatePlayerSummary=function(i){},e.prototype.handleAdjustScore=function(i,c){var f=c.attributes.team_id,_=c.attributes.adjustment,S=this.score.stateAfterEvent(this.nextEventOffset),P=this.period.stateBeforeEvent(this.nextEventOffset),I=new o(t.fromJS({template:"Score adjusted: ".concat(_," for ").concat(f),id:c.attributes.pbp_entry_id,playByPlayType:h.ScoreAdjustment,eventIds:[c.id],teamId:f,period:P==null?void 0:P.period,teamScores:S==null?void 0:S.scoresImmutable,scoreAdjustment:_,playerAssignable:!1,teamAssignable:!0,deletable:!0,createdAt:c.createdAt,summary:this.getAdjustScoreSummary(S.scores[S.awayId],S.scores[S.homeId])}));return i.pushEntry(I)},e.prototype.getAdjustScoreSummary=function(i,c){},e.prototype.handleOverrideScore=function(i,c){var f,_=c.attributes.team_id,S=(f=this.score.stateBeforeEvent(this.nextEventOffset))===null||f===void 0?void 0:f.scores[_],P=this.score.stateAfterEvent(this.nextEventOffset),I=P.scores[_]-S,E=this.period.stateBeforeEvent(this.nextEventOffset),B=new o(t.fromJS({template:"Score adjusted: ".concat(I," for ").concat(_),id:c.attributes.pbp_entry_id,playByPlayType:h.ScoreOverride,eventIds:[c.id],teamId:_,period:E==null?void 0:E.period,teamScores:P==null?void 0:P.scoresImmutable,scoreAdjustment:I,playerAssignable:!1,teamAssignable:!0,deletable:!0,createdAt:c.createdAt}));return i.pushEntry(B)},e}(p.VersionedStateEngine);n.MultiSportPlayByPlayEngine=a}(Fo)),Fo}var $f;function qv(){if($f)return sr;$f=1,Object.defineProperty(sr,"__esModule",{value:!0}),sr.makeDeleteEventToUnassignPlayer=sr.makeReplaceEventToChangePlayerActivation=sr.makeMetaEventToAssignPlayerToPlay=void 0;var n=Ge(),l=Ro(),t=kt();function p(s,u){if(s.eventIds===void 0||s.eventIds.size===0)throw new Error("entry is missing eventId");if(s.playByPlayType!==t.PlayByPlayType.Play)throw new Error("entry is wrong play type ".concat(s.playByPlayType));var h=s.eventIds.last();return s.playerAssignmentEventId===void 0?{id:(0,n.uuid4)(),code:"insert",afterId:h,events:[(0,l.makeAssignPlayer)({playId:h,playerId:u,isEdit:!0,createdAt:s.createdAt})]}:{id:(0,n.uuid4)(),code:"replace",deleteIds:[s.playerAssignmentEventId],events:[(0,l.makeAssignPlayer)({playId:h,playerId:u,isEdit:!0,createdAt:s.createdAt})]}}sr.makeMetaEventToAssignPlayerToPlay=p;function d(s,u){if(s.eventIds===void 0||s.eventIds.size===0)throw new Error("entry is missing eventId");if(s.playByPlayType!==t.PlayByPlayType.PlayerActivate&&s.playByPlayType!==t.PlayByPlayType.PlayerDeactivate)throw new Error("entry is wrong play type ".concat(s.playByPlayType));return{id:(0,n.uuid4)(),code:"replace",deleteIds:s.eventIds.toArray(),events:[s.playByPlayType===t.PlayByPlayType.PlayerActivate?(0,l.makeActivatePlayer)({teamId:s.teamId,playerId:u,pbpEntryId:s.id,createdAt:s.createdAt}):(0,l.makeDeactivatePlayer)({teamId:s.teamId,playerId:u,pbpEntryId:s.id,createdAt:s.createdAt})]}}sr.makeReplaceEventToChangePlayerActivation=d;function y(s){if(s.playByPlayType!==t.PlayByPlayType.Play)throw new Error("entry is wrong play type ".concat(s.playByPlayType));if(s.playerAssignmentEventId===void 0)throw new Error("entry is missing playerAssignmentEventId");return{id:(0,n.uuid4)(),code:"delete",deleteIds:[s.playerAssignmentEventId]}}return sr.makeDeleteEventToUnassignPlayer=y,sr}var Ga={},Vf;function Uv(){if(Vf)return Ga;Vf=1,Object.defineProperty(Ga,"__esModule",{value:!0}),Ga.makeDeleteEvent=void 0;var n=X,l=Ge();function t(p){if(p.eventIds===void 0||p.eventIds.size===0)throw new Error("Cannot make a delete event for an entry that has no eventId");return p.playerAssignmentEventId===void 0?{id:(0,l.uuid4)(),code:"delete",deleteIds:p.eventIds.toArray()}:{id:(0,l.uuid4)(),code:"delete",deleteIds:n.__spreadArray(n.__spreadArray([],p.eventIds.toArray(),!0),[p.playerAssignmentEventId],!1)}}return Ga.makeDeleteEvent=t,Ga}var Ha={},zf;function Wv(){if(zf)return Ha;zf=1,Object.defineProperty(Ha,"__esModule",{value:!0}),Ha.makeReplaceEventToChangePlay=void 0;var n=X,l=Ge(),t=Ro(),p=kt();function d(y,s,u){if(y.eventIds===void 0||y.eventIds.size===0)throw new Error("entry is missing eventId");if(y.playByPlayType!==p.PlayByPlayType.Play)throw new Error("entry is wrong play type ".concat(y.playByPlayType));if(y.teamId===void 0)throw new Error("entry is missing teamId");var h=(0,t.makePlay)({teamId:y.teamId,playCode:s,pbpEntryId:y.id,createdAt:y.createdAt,playDetails:u});return y.playerAssignmentEventId!==void 0?{id:(0,l.uuid4)(),code:"replace",deleteIds:n.__spreadArray(n.__spreadArray([],y.eventIds.toArray(),!0),[y.playerAssignmentEventId],!1),events:[h,(0,t.makeAssignPlayer)({playId:h.id,playerId:y.playerId,isEdit:!0,createdAt:y.createdAt})]}:{id:(0,l.uuid4)(),code:"replace",deleteIds:y.eventIds.toArray(),events:[h]}}return Ha.makeReplaceEventToChangePlay=d,Ha}var Na={},Kf;function $v(){if(Kf)return Na;Kf=1,Object.defineProperty(Na,"__esModule",{value:!0}),Na.makeReplaceEventToChangePlays=void 0;var n=Ge(),l=kt();function t(p,d,y){var s,u;if(p.eventIds===void 0||p.eventIds.size===0)throw new Error("entry is missing eventIds");if(p.playByPlayType!==l.PlayByPlayType.Play)throw new Error("entry is wrong play type ".concat(p.playByPlayType));if(p.teamId===void 0)throw new Error("entry is missing teamId");var h={id:(0,n.uuid4)(),code:"replace",deleteIds:p.eventIds.toArray(),events:d};return p.playerAssignmentEventId!==void 0&&y!==void 0?(h.deleteIds.push(p.playerAssignmentEventId),(s=h.events).push.apply(s,y)):p.playerAssignmentEventId!==void 0?h.deleteIds.push(p.playerAssignmentEventId):y!==void 0&&(u=h.events).push.apply(u,y),h}return Na.makeReplaceEventToChangePlays=t,Na}var qt={},Jf;function Vv(){if(Jf)return qt;Jf=1,Object.defineProperty(qt,"__esModule",{value:!0}),qt.makeReplaceEventToChangeTeamAndPlayer=qt.makeReplaceEventToChangeTeamForScoreOverride=qt.makeReplaceEventToChangeTeamForScoreAdjust=qt.makeReplaceEventToChangeTeamForPlay=void 0;var n=X,l=Ge(),t=Ro(),p=kt();function d(h,v){if(h.eventIds===void 0||h.eventIds.size===0)throw new Error("entry is missing eventId");if(h.playByPlayType!==p.PlayByPlayType.Play)throw new Error("entry is wrong play type ".concat(h.playByPlayType));if(h.playCode===void 0)throw new Error("entry is missing playCode");var o;return h.playerAssignmentEventId===void 0?o=h.eventIds.toArray():o=n.__spreadArray(n.__spreadArray([],h.eventIds.toArray(),!0),[h.playerAssignmentEventId],!1),{id:(0,l.uuid4)(),code:"replace",deleteIds:o,events:[(0,t.makePlay)({teamId:v,playCode:h.playCode,pbpEntryId:h.id,createdAt:h.createdAt})]}}qt.makeReplaceEventToChangeTeamForPlay=d;function y(h,v){if(h.eventIds===void 0||h.eventIds.size===0)throw new Error("entry is missing eventId");if(h.playByPlayType!==p.PlayByPlayType.ScoreAdjustment)throw new Error("entry is wrong play type ".concat(h.playByPlayType));return{id:(0,l.uuid4)(),code:"replace",deleteIds:h.eventIds.toArray(),events:[(0,t.makeAdjustScore)({teamId:v,adjustment:h.scoreAdjustment,pbpEntryId:h.id,createdAt:h.createdAt})]}}qt.makeReplaceEventToChangeTeamForScoreAdjust=y;function s(h,v){if(h.eventIds===void 0||h.eventIds.size===0)throw new Error("entry is missing eventId");if(h.playByPlayType!==p.PlayByPlayType.ScoreOverride)throw new Error("entry is wrong play type ".concat(h.playByPlayType));var o=h.teamScores.get(h.teamId);return{id:(0,l.uuid4)(),code:"replace",deleteIds:h.eventIds.toArray(),events:[(0,t.makeOverrideScore)({teamId:v,points:o,pbpEntryId:h.id,createdAt:h.createdAt})]}}qt.makeReplaceEventToChangeTeamForScoreOverride=s;function u(h,v,o){if(h.eventIds===void 0||h.eventIds.size===0)throw new Error("entry is missing eventId");if(h.playByPlayType!==p.PlayByPlayType.Play)throw new Error("entry is wrong play type ".concat(h.playByPlayType));if(h.playCode===void 0)throw new Error("entry is missing playCode");var a=(0,t.makePlay)({teamId:v,playCode:h.playCode,pbpEntryId:h.id,createdAt:h.createdAt}),r;return h.playerAssignmentEventId===void 0?r=h.eventIds.toArray():r=n.__spreadArray(n.__spreadArray([],h.eventIds.toArray(),!0),[h.playerAssignmentEventId],!1),{id:(0,l.uuid4)(),code:"replace",deleteIds:r,events:[a,(0,t.makeAssignPlayer)({playId:a.id,playerId:o,isEdit:!0,createdAt:h.createdAt})]}}return qt.makeReplaceEventToChangeTeamAndPlayer=u,qt}var Yf;function ja(){if(Yf)return La;Yf=1,Object.defineProperty(La,"__esModule",{value:!0}),La.MultiSportCompactorController=void 0;var n=X,l=gt(),t=qv(),p=Ca(),d=Uv(),y=Wv(),s=$v(),u=Vv(),h=kt(),v=Pe,o=function(a){n.__extends(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.pushSerializedAndFetch=function(e){var i=JSON.parse(e),c={sequenceNumber:this.inStreamLength(),eventId:i.id};return this.pushBatch([i]),n.__assign(n.__assign({},this.getLatestScorekeepingState()),{sequenceNumberPair:c})},r.prototype.pushBatchAndFetch=function(e){return this.pushBatch(e),this.getLatestScorekeepingState()},r.prototype.pushBatchToScratchAndFetch=function(e){return this.pushBatchToScratch(e),this.getLatestScorekeepingState()},r.prototype.getLatestScorekeepingState=function(){var e=this.outputStream(),i=e.length>0?e[e.length-1]:void 0;return{scorekeepingState:this.latestState().scorekeepingState,undoRedoAvailability:this.undoRedoAvailability("main"),lastEventId:i===void 0?void 0:i.id}},r.prototype.getMetaEventToChangePlayer=function(e,i){var c=this.playByPlay.currentState.entryForEventId(e);if(c!==void 0){var f=c.entry;if(f.playerId!==i)switch(f.playByPlayType){case h.PlayByPlayType.Play:return(0,t.makeMetaEventToAssignPlayerToPlay)(f,i);case h.PlayByPlayType.PlayerActivate:case h.PlayByPlayType.PlayerDeactivate:return(0,t.makeReplaceEventToChangePlayerActivation)(f,i);case h.PlayByPlayType.StartPeriod:case h.PlayByPlayType.EndPeriod:case h.PlayByPlayType.ImplicitPlayerActivate:case h.PlayByPlayType.ScoreAdjustment:case h.PlayByPlayType.ScoreOverride:case h.PlayByPlayType.BeginPlay:case h.PlayByPlayType.EndPlay:throw Error("".concat(f.playByPlayType," cannot change player"));default:(0,p.assertUnreachable)(f.playByPlayType)}}},r.prototype.getDeleteEvent=function(e){var i=this.playByPlay.currentState.entryForEventId(e);if(i!==void 0)return(0,d.makeDeleteEvent)(i.entry)},r.prototype.getMetaEventToUnassignPlayer=function(e){var i=this.playByPlay.currentState.entryForEventId(e);if(i!==void 0&&i.entry.playerAssignmentEventId!==void 0)return(0,t.makeDeleteEventToUnassignPlayer)(i.entry)},r.prototype.getReplaceEventToChangePlay=function(e,i,c){var f=this.playByPlay.currentState.entryForEventId(e);if(f!==void 0){var _=f.entry;if(_.playCode===i){if(_.playDetails===void 0&&c===void 0)return;if(_.playDetails!==void 0&&(0,v.isEqual)(Object.fromEntries(_.playDetails),c))return}switch(_.playByPlayType){case h.PlayByPlayType.Play:return(0,y.makeReplaceEventToChangePlay)(_,i,c);case h.PlayByPlayType.PlayerActivate:case h.PlayByPlayType.PlayerDeactivate:case h.PlayByPlayType.StartPeriod:case h.PlayByPlayType.EndPeriod:case h.PlayByPlayType.ImplicitPlayerActivate:case h.PlayByPlayType.ScoreAdjustment:case h.PlayByPlayType.ScoreOverride:case h.PlayByPlayType.BeginPlay:case h.PlayByPlayType.EndPlay:throw Error("".concat(_.playByPlayType," cannot change playCode"));default:(0,p.assertUnreachable)(_.playByPlayType)}}},r.prototype.getReplaceEventToChangePlays=function(e,i,c){var f=this.playByPlay.currentState.entryForEventId(e);if(f!==void 0){var _=f.entry;switch(_.playByPlayType){case h.PlayByPlayType.Play:return(0,s.makeReplaceEventToChangePlays)(_,i,c);case h.PlayByPlayType.PlayerActivate:case h.PlayByPlayType.PlayerDeactivate:case h.PlayByPlayType.StartPeriod:case h.PlayByPlayType.EndPeriod:case h.PlayByPlayType.ImplicitPlayerActivate:case h.PlayByPlayType.ScoreAdjustment:case h.PlayByPlayType.ScoreOverride:case h.PlayByPlayType.BeginPlay:case h.PlayByPlayType.EndPlay:throw Error("".concat(_.playByPlayType," cannot change playCode"));default:(0,p.assertUnreachable)(_.playByPlayType)}}},r.prototype.getReplaceEventToChangeTeam=function(e,i){var c=this.playByPlay.currentState.entryForEventId(e);if(c!==void 0){var f=c.entry;if(f.teamId!==i)switch(f.playByPlayType){case h.PlayByPlayType.Play:return(0,u.makeReplaceEventToChangeTeamForPlay)(f,i);case h.PlayByPlayType.ScoreAdjustment:return(0,u.makeReplaceEventToChangeTeamForScoreAdjust)(f,i);case h.PlayByPlayType.ScoreOverride:return(0,u.makeReplaceEventToChangeTeamForScoreOverride)(f,i);case h.PlayByPlayType.PlayerActivate:case h.PlayByPlayType.PlayerDeactivate:case h.PlayByPlayType.StartPeriod:case h.PlayByPlayType.EndPeriod:case h.PlayByPlayType.ImplicitPlayerActivate:case h.PlayByPlayType.BeginPlay:case h.PlayByPlayType.EndPlay:throw Error("".concat(f.playByPlayType," cannot change team"));default:(0,p.assertUnreachable)(f.playByPlayType)}}},r.prototype.getMetaEventToChangeTeamAndPlayer=function(e,i,c){var f=this.playByPlay.currentState.entryForEventId(e);if(f!==void 0){var _=f.entry;if(_.teamId===i)return this.getMetaEventToChangePlayer(e,c);switch(_.playByPlayType){case h.PlayByPlayType.Play:return(0,u.makeReplaceEventToChangeTeamAndPlayer)(_,i,c);case h.PlayByPlayType.ScoreAdjustment:case h.PlayByPlayType.ScoreOverride:case h.PlayByPlayType.PlayerActivate:case h.PlayByPlayType.PlayerDeactivate:case h.PlayByPlayType.StartPeriod:case h.PlayByPlayType.EndPeriod:case h.PlayByPlayType.ImplicitPlayerActivate:case h.PlayByPlayType.BeginPlay:case h.PlayByPlayType.EndPlay:throw Error("".concat(_.playByPlayType," cannot change team"));default:(0,p.assertUnreachable)(_.playByPlayType)}}},r}(l.CompactorController);return La.MultiSportCompactorController=o,La}var or={},Qf;function qa(){if(Qf)return or;Qf=1,Object.defineProperty(or,"__esModule",{value:!0}),or.pushInLinescore=or.LinescoreEngine=or.LinescoreState=void 0;var n=X,l=n.__importStar(fe()),t=n.__importStar(Ee()),p=n.__importStar(Oe()),d=Me(),y=function(v){n.__extends(o,v);function o(){return v!==null&&v.apply(this,arguments)||this}return Object.defineProperty(o.prototype,"lineScores",{get:function(){return this.lineScoresImmutable.toJS()},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"lineScoresImmutable",{get:function(){return this.get("lineScores")},enumerable:!1,configurable:!0}),o}(p.ImmutableState);or.LinescoreState=y;var s=function(v){n.__extends(o,v);function o(a,r,e,i){var c=v.call(this,a)||this;return c.baseEvents=a,c.period=r,c.score=e,c.confirguration=i,c}return o.prototype.initialState=function(){return new y(l.fromJS({lineScores:{}}))},o.prototype.processOneEvent=function(a,r){var e=this;switch(r.code){case d.MultiSportEventCode.SetTeams:return this.handleSetTeams(a,r);case d.MultiSportEventCode.Play:return(0,d.onValidPlayCode)(a,r,this.confirguration.play_codes,function(i,c){return e.update(i)});case d.MultiSportEventCode.AdjustScore:case d.MultiSportEventCode.OverrideScore:return this.update(a);default:return a}},o.prototype.handleSetTeams=function(a,r){return a.setIn(["lineScores",r.attributes.homeId],l.List.of(0)).setIn(["lineScores",r.attributes.awayId],l.List.of(0))},o.prototype.update=function(a){var r=this.period.stateAfterEvent(this.nextEventOffset),e=r.period-(r.isActive?0:1),i=this.score.stateAfterEvent(this.nextEventOffset),c=i.awayId,f=i.homeId,_=i.scores,S=_[f],P=_[c],I=S-h(a.lineScores[f],e),E=P-h(a.lineScores[c],e);return a.updateIn(["lineScores",f],u(e,I)).updateIn(["lineScores",c],u(e,E))},o}(t.VersionedStateEngine);or.LinescoreEngine=s;function u(v,o){return function(a){return a.set(v-1,o).map(function(r){return r||0})}}or.pushInLinescore=u;function h(v,o){var a=o-1;return a<=0?0:v.slice(0,a).reduce(function(r,e){return(r??0)+(e??0)})}return or}var Zr={},Xf;function Ua(){if(Xf)return Zr;Xf=1,Object.defineProperty(Zr,"__esModule",{value:!0}),Zr.MultiSportActivePlayerEngine=Zr.ActivePlayerState=void 0;var n=X,l=n.__importStar(fe()),t=n.__importStar(Ee()),p=n.__importStar(Oe()),d=Me(),y=function(u){n.__extends(h,u);function h(){return u!==null&&u.apply(this,arguments)||this}return Object.defineProperty(h.prototype,"activePlayersImmutable",{get:function(){return this.get("teams")},enumerable:!1,configurable:!0}),h.prototype.isPlayerActive=function(v,o){var a=this.getIn(["teams",v]);return a===void 0?!1:o!==void 0&&a.contains(o)},Object.defineProperty(h.prototype,"activePlayers",{get:function(){return this.activePlayersImmutable.toJS()},enumerable:!1,configurable:!0}),h.prototype.activatePlayer=function(v,o){return this.updateIn(["teams",v],function(a){return o===void 0||a.contains(o)?a:a.push(o)})},h}(p.ImmutableState);Zr.ActivePlayerState=y;var s=function(u){n.__extends(h,u);function h(v,o){var a=u.call(this,v)||this;return a.baseEvents=v,a.configuration=o,a}return h.prototype.initialState=function(){return new y(l.fromJS({teams:{},teamIdForPlayId:{}}))},h.prototype.processOneEvent=function(v,o){var a=this;switch(o.code){case d.MultiSportEventCode.SetTeams:return this.handleSetTeams(v,o);case d.MultiSportEventCode.ActivatePlayer:return this.handleActivatePlayer(v,o);case d.MultiSportEventCode.DeactivatePlayer:return this.handleDeactivatePlayer(v,o);case d.MultiSportEventCode.Play:return(0,d.onValidPlayCode)(v,o,this.configuration.play_codes,function(r,e){return a.handlePlay(r,e)});case d.MultiSportEventCode.AssignPlayer:return this.handleAssignPlayer(v,o);default:return v}},h.prototype.handleSetTeams=function(v,o){var a=o.attributes.homeId,r=o.attributes.awayId;return v.setIn(["teams",a],l.List()).setIn(["teams",r],l.List())},h.prototype.handleActivatePlayer=function(v,o){var a=o.attributes.team_id,r=o.attributes.player_id;return v.activatePlayer(a,r)},h.prototype.handleDeactivatePlayer=function(v,o){var a=o.attributes.team_id,r=o.attributes.player_id;return v.updateIn(["teams",a],function(e){var i=e.indexOf(r);return i>=0?e.delete(i):e})},h.prototype.handlePlay=function(v,o){var a=o.id,r=o.attributes.team_id;return v.setIn(["teamIdForPlayId",a],r)},h.prototype.handleAssignPlayer=function(v,o){var a=o.attributes.play_event_id,r=o.attributes.player_id,e=v.getIn(["teamIdForPlayId",a]);return e===void 0?v:v.activatePlayer(e,r)},h}(t.VersionedStateEngine);return Zr.MultiSportActivePlayerEngine=s,Zr}var Mo={},Zf;function xo(){return Zf||(Zf=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.FOOTBALL_CONFIGURATION=n.TwoPointConversionType=n.TouchdownType=n.PlayCode=void 0;var l;(function(t){t.CompletePass="complete_pass",t.ExtraPoint="extra_point",t.FieldGoal="field_goal",t.Fumble="fumble",t.IncompletePass="incomplete_pass",t.Interception="interception",t.Kickoff="kickoff",t.KickoffReturn="kickoff_return",t.Punt="punt",t.PuntReturn="punt_return",t.Run="run",t.Sack="sack",t.Safety="safety",t.Tackle="tackle",t.Touchdown="touchdown",t.Turnover="turnover",t.TwoPointConversion="two_point_conversion"})(l=n.PlayCode||(n.PlayCode={})),function(t){t.Pass="pass",t.Run="run",t.Defense="defense",t.SpecialTeams="special_teams"}(n.TouchdownType||(n.TouchdownType={})),function(t){t.Pass="pass",t.Run="run"}(n.TwoPointConversionType||(n.TwoPointConversionType={})),n.FOOTBALL_CONFIGURATION={play_codes:Object.values(l)}}(Mo)),Mo}var en={},ep;function Wa(){if(ep)return en;ep=1,Object.defineProperty(en,"__esModule",{value:!0}),en.MultiSportPeriodEngine=en.PeriodState=void 0;var n=X,l=n.__importStar(fe()),t=n.__importStar(Ee()),p=n.__importStar(Oe()),d=Me(),y=function(u){n.__extends(h,u);function h(){return u!==null&&u.apply(this,arguments)||this}return Object.defineProperty(h.prototype,"period",{get:function(){return this.get("period")},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"periodType",{get:function(){return this.get("periodType")},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"isActive",{get:function(){return this.get("isActive")},enumerable:!1,configurable:!0}),h}(p.ImmutableState);en.PeriodState=y;var s=function(u){n.__extends(h,u);function h(v,o){var a=u.call(this,v)||this;return a.baseEvents=v,a.confirguration=o,a}return h.prototype.initialState=function(){return new y(l.fromJS({period:1,isActive:!1}))},h.prototype.processOneEvent=function(v,o){var a=this;switch(o.code){case d.MultiSportEventCode.Play:return(0,d.onValidPlayCode)(v,o,this.confirguration.play_codes,function(r,e){return a.handlePlay(r)});case d.MultiSportEventCode.EndPeriod:return this.handleEndPeriod(v);case d.MultiSportEventCode.SetGameSettings:return this.handleSetGameSettings(v,o);default:return v}},h.prototype.handlePlay=function(v){return v.isActive?v:v.set("isActive",!0)},h.prototype.handleEndPeriod=function(v){return v.isActive?v.increment("period",1).set("isActive",!1):v.increment("period",1)},h.prototype.handleSetGameSettings=function(v,o){var a=o.attributes||{};return typeof a.period_type<"u"?v.set("periodType",a.period_type):v},h}(t.VersionedStateEngine);return en.MultiSportPeriodEngine=s,en}var $a={},tp;function zv(){if(tp)return $a;tp=1,Object.defineProperty($a,"__esModule",{value:!0}),$a.PlayByPlayEngine=void 0;var n=X,l=n.__importStar(fe()),t=kt(),p=xo(),d=function(y){n.__extends(s,y);function s(){return y!==null&&y.apply(this,arguments)||this}return s.prototype.handleBeginPlay=function(u,h){var v=new t.PlayByPlayEntry(l.fromJS({template:"Begin Play",id:"begin_play",playByPlayType:t.PlayByPlayType.BeginPlay,eventIds:[h.id],playerAssignable:!1,teamAssignable:!1,deletable:!0}));return u=u.pushInProgressEntry(v),u.setInProgress(!0)},s.prototype.handleEndPlay=function(u,h){var v=u.setInProgress(!1),o=v.inProgressEntries;if(o.isEmpty())return v;var a=o.reduce(function(e,i){var c=e;switch(i==null?void 0:i.playCode){case p.PlayCode.Touchdown:switch(c.playCode){case p.PlayCode.CompletePass:return i.setIn(["template"],"Passing Touchdown by ".concat(i.teamId));case p.PlayCode.Run:return i.setIn(["template"],"Rushing Touchdown by ".concat(i.teamId));case p.PlayCode.Fumble:return i.setIn(["template"],"Fumble returned for Touchdown by ".concat(i.teamId));case p.PlayCode.Interception:return i.setIn(["template"],"Interception returned for Touchdown by ".concat(i.teamId));case p.PlayCode.KickoffReturn:return i.setIn(["template"],"Kick Return for Touchdown by ".concat(i.teamId));case p.PlayCode.PuntReturn:return i.setIn(["template"],"Punt Return for Touchdown by ".concat(i.teamId));default:return i}case p.PlayCode.TwoPointConversion:switch(c.playCode){case p.PlayCode.CompletePass:return i.setIn(["template"],"Passing 2-Point Conversion by ".concat(i.teamId));case p.PlayCode.Run:return i.setIn(["template"],"Rushing 2-Point Conversion by ".concat(i.teamId));default:return i}default:return i}}),r=[];return o.map(function(e){var i,c;return r.push.apply(r,(c=(i=e==null?void 0:e.eventIds)===null||i===void 0?void 0:i.toArray())!==null&&c!==void 0?c:[])}),r.push.apply(r,[h.id]),a=a==null?void 0:a.setIn(["eventIds"],l.List(r)),v=v.clearInProgressEntries(),v.pushEntry(a)},s.prototype.handlePlay=function(u,h){var v=this.period.stateBeforeEvent(this.nextEventOffset),o=u;if(v&&v.isActive===!1){var a=new t.PlayByPlayEntry(l.fromJS({template:"Start of period ".concat(v.period),id:"start_of_period_".concat(v.period),playByPlayType:t.PlayByPlayType.StartPeriod,period:v.period,playerAssignable:!1,teamAssignable:!1,deletable:!1,createdAt:h.createdAt}));o=o.pushEntry(a)}var r=h.attributes.play_code,e;if(r===p.PlayCode.Touchdown||r===p.PlayCode.FieldGoal||r===p.PlayCode.ExtraPoint||r===p.PlayCode.TwoPointConversion||r===p.PlayCode.Safety){var i=this.score.stateAfterEvent(this.nextEventOffset);e=i==null?void 0:i.scoresImmutable}else e=void 0;var c=new t.PlayByPlayEntry(l.fromJS({template:"".concat(h.attributes.play_code," by ").concat(h.attributes.team_id),id:h.attributes.pbp_entry_id,playByPlayType:t.PlayByPlayType.Play,eventIds:[h.id],playCode:r,teamId:h.attributes.team_id,period:v.period,teamScores:e,playerAssignable:!0,teamAssignable:!0,deletable:!0,createdAt:h.createdAt,playDetails:h.attributes.play_details}));return o.isInProgress?o.pushInProgressEntry(c):o.pushEntry(c)},s}(t.MultiSportPlayByPlayEngine);return $a.PlayByPlayEngine=d,$a}var Va={},tn={},rp;function bn(){if(rp)return tn;rp=1,Object.defineProperty(tn,"__esModule",{value:!0}),tn.MultiSportScoreEngine=tn.ScoreState=void 0;var n=X,l=n.__importStar(fe()),t=n.__importStar(Ee()),p=n.__importStar(Oe()),d=Me(),y=function(u){n.__extends(h,u);function h(){return u!==null&&u.apply(this,arguments)||this}return Object.defineProperty(h.prototype,"scoresImmutable",{get:function(){return this.get("scores")},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"scores",{get:function(){return this.scoresImmutable.toJS()},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"homeId",{get:function(){return this.get("homeId")},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"awayId",{get:function(){return this.get("awayId")},enumerable:!1,configurable:!0}),h.prototype.incrementScore=function(v,o){return this.incrementIn(["scores",v],o)},h.prototype.resetScores=function(){var v;return this.set("scores",l.fromJS((v={},v[this.homeId]=0,v[this.awayId]=0,v)))},h}(p.ImmutableState);tn.ScoreState=y;var s=function(u){n.__extends(h,u);function h(v,o){var a=u.call(this,v)||this;return a.baseEvents=v,a.configuration=o,a}return h.prototype.initialState=function(){return new y(l.fromJS({scores:{},homeId:void 0,awayId:void 0}))},h.prototype.processOneEvent=function(v,o){var a=this;switch(o.code){case d.MultiSportEventCode.SetTeams:return this.handleSetTeams(v,o);case d.MultiSportEventCode.Play:return(0,d.onValidPlayCode)(v,o,this.configuration.play_codes,function(r,e){return a.handlePlay(r,e)});case d.MultiSportEventCode.AdjustScore:return this.handleAdjustScore(v,o);case d.MultiSportEventCode.OverrideScore:return this.handleOverrideScore(v,o);case d.MultiSportEventCode.EndPeriod:return this.handleEndPeriod(v);default:return v}},h.prototype.handleSetTeams=function(v,o){var a,r=o.attributes.homeId,e=o.attributes.awayId;return v.set("homeId",r).set("awayId",e).set("scores",l.fromJS((a={},a[r]=0,a[e]=0,a)))},h.prototype.handleEndPeriod=function(v){return v},h.prototype.handleAdjustScore=function(v,o){return v.incrementScore(o.attributes.team_id,o.attributes.adjustment)},h.prototype.handleOverrideScore=function(v,o){return v.setIn(["scores",o.attributes.team_id],o.attributes.points)},h}(t.VersionedStateEngine);return tn.MultiSportScoreEngine=s,tn}var np;function Kv(){if(np)return Va;np=1,Object.defineProperty(Va,"__esModule",{value:!0}),Va.ScoreEngine=void 0;var n=X,l=bn(),t=xo(),p=function(d){n.__extends(y,d);function y(){return d!==null&&d.apply(this,arguments)||this}return y.prototype.handlePlay=function(s,u){var h=u.attributes.play_code,v=u.attributes.team_id;switch(h){case t.PlayCode.Touchdown:return s.incrementScore(v,6);case t.PlayCode.FieldGoal:return s.incrementScore(v,3);case t.PlayCode.Safety:return s.incrementScore(v,2);case t.PlayCode.ExtraPoint:return s.incrementScore(v,1);case t.PlayCode.TwoPointConversion:return s.incrementScore(v,2);default:return s}},y}(l.MultiSportScoreEngine);return Va.ScoreEngine=p,Va}var za={},ap;function Ka(){if(ap)return za;ap=1,Object.defineProperty(za,"__esModule",{value:!0}),za.SharedStateAccessor=void 0;var n=X,l=n.__importStar(gt()),t=Co(),p=function(d){n.__extends(y,d);function y(s,u){var h=d.call(this,s,u)||this;return h.controller=u,h}return Object.defineProperty(y.prototype,"gameSettingsDoc",{get:function(){return this.controller.gameSettings?this.get("gameSettingsDoc",this.controller.gameSettings):t.GameSettings.emptyGameSettingsDoc()},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"activePlayers",{get:function(){return this.get("activePlayers",this.controller.activePlayer)},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"lineScores",{get:function(){return this.get("lineScores",this.controller.lineScore)},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"stats",{get:function(){return this.controller.stats?this.get("stats",this.controller.stats):{}},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"scores",{get:function(){return this.get("scores",this.controller.score)},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"periodStats",{get:function(){return this.controller.statsPerPeriod?this.get("periodStats",this.controller.statsPerPeriod):{}},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"allPlayByPlay",{get:function(){return this.get("allEntries",this.controller.playByPlay)},enumerable:!1,configurable:!0}),y.prototype.getCurrentGameSituation=function(){return{activePlayers:this.activePlayers,lineScores:this.lineScores,scores:this.scores,period:this.get("period",this.controller.period),periodType:(0,t.getPeriodType)(this.gameSettingsDoc),periodIsActive:this.get("isActive",this.controller.period)}},Object.defineProperty(y.prototype,"currentGameSituation",{get:function(){return this.getCurrentGameSituation()},enumerable:!1,configurable:!0}),y.prototype.getScorekeepingState=function(){return{gameSituation:this.currentGameSituation,homeTeamId:this.get("homeId",this.controller.score),awayTeamId:this.get("awayId",this.controller.score)}},Object.defineProperty(y.prototype,"scorekeepingState",{get:function(){return this.getScorekeepingState()},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"announcements",{get:function(){var s={scores:this.scores,homeTeamId:this.get("homeId",this.controller.score),awayTeamId:this.get("awayId",this.controller.score),periodNumber:this.get("period",this.controller.period),periodType:(0,t.getPeriodType)(this.gameSettingsDoc)};return this.controller.announcements(s)},enumerable:!1,configurable:!0}),y}(l.EngineStateAccessor);return za.SharedStateAccessor=p,za}var ip;function Jv(){if(ip)return xa;ip=1,Object.defineProperty(xa,"__esModule",{value:!0}),xa.FootballCompactorController=void 0;var n=X,l=Or(),t=ja(),p=qa(),d=Ua(),y=xo(),s=Wa(),u=zv(),h=Kv(),v=Ka(),o=function(a){n.__extends(r,a);function r(){var e=a.call(this)||this;e.stateAccessorClass=v.SharedStateAccessor,e.activePlayer=new d.MultiSportActivePlayerEngine([],y.FOOTBALL_CONFIGURATION),e.period=new s.MultiSportPeriodEngine([],y.FOOTBALL_CONFIGURATION),e.score=new h.ScoreEngine([],y.FOOTBALL_CONFIGURATION),e.playByPlay=new u.PlayByPlayEngine([],y.FOOTBALL_CONFIGURATION,e.activePlayer,e.period,e.score),e.lineScore=new p.LinescoreEngine([],e.period,e.score,y.FOOTBALL_CONFIGURATION),e.engines=[e.activePlayer,e.period,e.score,e.playByPlay,e.lineScore],e.compactor=new l.SabertoothEventCompactor;for(var i=0,c=e.engines;i<c.length;i++){var f=c[i];f.baseEvents=e.compactor.outStream}return e}return r.prototype.getDerivedMultiGameStatsWithBaseStats=function(e){return{}},r.prototype.processVoiceEvents=function(e,i){throw new Error("Voice Scoring not supported by this sport")},r.prototype.announcements=function(e){throw new Error("Announcements not supported by this sport")},r}(t.MultiSportCompactorController);return xa.FootballCompactorController=o,xa}var Ja={},rn={},nn={},sp;function zi(){if(sp)return nn;sp=1,Object.defineProperty(nn,"__esModule",{value:!0}),nn.MultiSportBoxScoreEngine=nn.MultiSportBoxScoreState=void 0;var n=X,l=n.__importStar(Ee()),t=n.__importStar(Oe()),p=function(y){n.__extends(s,y);function s(){return y!==null&&y.apply(this,arguments)||this}return s}(t.ImmutableState);nn.MultiSportBoxScoreState=p;var d=function(y){n.__extends(s,y);function s(u,h,v){var o=y.call(this,u)||this;return o.baseEvents=u,o.score=h,o.activePlayerEngine=v,o}return s}(l.VersionedStateEngine);return nn.MultiSportBoxScoreEngine=d,nn}var Lo={},Do={},op;function Ya(){return op||(op=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.GOAL_SPORT_CONFIGURATION=n.PlayCode=void 0;var l;(function(t){t.Goal="goal",t.MissedShot="missed_shot",t.Assist="assist",t.Save="save"})(l=n.PlayCode||(n.PlayCode={})),n.GOAL_SPORT_CONFIGURATION={play_codes:Object.values(l)}}(Do)),Do}var up;function Go(){return up||(up=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.TeamPlayerStats=n.Stats=n.GoalStat=void 0;var l=X,t=l.__importStar(fe()),p=$e(),d=Me(),y=l.__importStar(Ca()),s=Ya(),u;(function(e){e.G="G",e.A="A",e.SH="SH",e.SHPT="SH%",e.SV="SV",e.GP="GP",e.PTS="PTS",e.PTS2="PTS2"})(u=n.GoalStat||(n.GoalStat={}));var h;(function(e){function i(){return Object.values(u)}e.values=i;function c(){return v(e.values().reduce(function(E,B){return E.set(B,0)},t.Map()))}e.empty=c;function f(E,B){if((0,d.isValidPlayCode)(B,s.GOAL_SPORT_CONFIGURATION.play_codes))return P(!0,E,B);y.unreachablePlayCode(B)}e.addPlay=f;function _(E,B){if((0,d.isValidPlayCode)(B,s.GOAL_SPORT_CONFIGURATION.play_codes))return P(!1,E,B);y.unreachablePlayCode(B)}e.removePlay=_;function S(E){switch(E){case u.G:case u.A:case u.PTS:case u.PTS2:case u.SH:case u.SHPT:case u.SV:case u.GP:return;default:return}}e.averageKey=S;function P(E,B,b){return v(function(){switch(b){case s.PlayCode.Goal:return I(E,B,u.G,u.SH);case s.PlayCode.Assist:return I(E,B,u.A);case s.PlayCode.MissedShot:return I(E,B,u.SH);case s.PlayCode.Save:return I(E,B,u.SV);default:y.unreachablePlayCode(b)}}())}function I(E,B){for(var b=[],R=2;R<arguments.length;R++)b[R-2]=arguments[R];return b.reduce(function(F,x){return F.updateIn([x],0,function(w){return E?++w:--w})},B)}})(h=n.Stats||(n.Stats={})),function(e){function i(F){var x=Object.entries(F).reduce(function(L,D){var U=D[0],G=D[1];return L.setIn([U],G.stats.offense[u.PTS]).setIn([U],G.stats.offense[u.PTS2])},t.Map.of()),w=e.fromTeamsStatDoc(F,!1);return e.toTeamsStatDoc(w,x)}e.getDerivedMultiGameStatsWithBaseStats=i;function c(F){return F.toJS().reduce(function(x,w){var L=t.Map().set(p.TOTAL,h.empty()).set(p.UNASSIGNED_PLAYER,h.empty());return x.set(w,L)},t.Map())}e.fromTeams=c;function f(F,x){return x.reduce(function(w,L,D){var U=F.getIn([D,p.TOTAL,u.PTS]),G=F.getIn([D,p.UNASSIGNED_PLAYER,u.PTS]),q=F.getIn([D,p.TOTAL,u.PTS2]),z=F.getIn([D,p.UNASSIGNED_PLAYER,u.PTS2]),ne=F.setIn([D,p.TOTAL,u.PTS],U).setIn([D,p.UNASSIGNED_PLAYER,u.PTS],G).setIn([D,p.TOTAL,u.PTS2],q).setIn([D,p.UNASSIGNED_PLAYER,u.PTS2],z);return w[D]=B(ne.get(D)),w},{})}e.toTeamsStatDoc=f;function _(F,x){return Object.entries(F).reduce(function(w,L){var D=L[0],U=L[1],G=U.stats,q=U.unassigned,z=U.players,ne=Object.entries(z).reduce(function(ue,ee){var $=ee[0],Y=ee[1];return ue.setIn([D,$],E(Y.stats,!!x))},w).setIn([D,p.TOTAL],E(G,!!x));return q?ne.setIn([D,p.UNASSIGNED_PLAYER],E(q.stats,!1)):ne},t.fromJS({}))}e.fromTeamsStatDoc=_;function S(F,x){return F.reduce(function(w,L,D){return w.setIn([D],P(F.get(D),x.get(D)))},t.Map())}e.subtract=S;function P(F,x){return F.reduce(function(w,L,D){return w.setIn([D],I(F.get(D),x.get(D,h.empty())))},t.Map())}function I(F,x){return r(F.reduce(function(w,L,D){return w.setIn([D],F.get(D)-x.get(D,0))},h.empty()),void 0)}function E(F,x){return r(t.fromJS(F.offense),x)}function B(F){return F.reduce(function(x,w,L){switch(L){case p.TOTAL:case p.UNASSIGNED_PLAYER:return x;default:return x.players[L]=b(w),x}},{players:{},unassigned:b(F.get(p.UNASSIGNED_PLAYER)),stats:R(F.get(p.TOTAL))})}function b(F){return{stats:R(F)}}function R(F){return{offense:F.toJS()}}}(n.TeamPlayerStats||(n.TeamPlayerStats={}));function v(e){return o(e,a,r)}function o(e){for(var i=[],c=1;c<arguments.length;c++)i[c-1]=arguments[c];return i.reduce(function(f,_){return _(f)},e)}function a(e){var i=function(_){return e.get(_,0)},c=i(u.G)+i(u.A),f=i(u.G)*2+i(u.A);return e.setIn([u.PTS],c).setIn([u.PTS2],f)}function r(e,i){var c=function(S){return e.get(S,0)},f=function(S,P){return c(S)/c(P)},_=e.setIn([u.SHPT],f(u.G,u.SH));return _=o(_),i?h.values().reduce(function(S,P){var I=h.averageKey(P);return I?S.setIn([I],f(P,u.GP)):S},_):_}}(Lo)),Lo}var lp;function Yv(){if(lp)return rn;lp=1,Object.defineProperty(rn,"__esModule",{value:!0}),rn.BoxScoreEngine=rn.BoxScoreState=void 0;var n=X,l=n.__importStar(fe()),t=$e(),p=zi(),d=Me(),y=Go(),s=Ya(),u=function(v){n.__extends(o,v);function o(){return v!==null&&v.apply(this,arguments)||this}return Object.defineProperty(o.prototype,"stats",{get:function(){return y.TeamPlayerStats.toTeamsStatDoc(this.teamPlayerStats,this.teamPoints)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"teamPoints",{get:function(){return this.get("teamPoints")},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"teamPlayerStats",{get:function(){return this.get("stats")},enumerable:!1,configurable:!0}),o}(p.MultiSportBoxScoreState);rn.BoxScoreState=u;var h=function(v){n.__extends(o,v);function o(a,r,e){var i=v.call(this,a,r,e)||this;return i.baseEvents=a,i.score=r,i.activePlayerEngine=e,i}return o.prototype.initialState=function(){return new u(l.fromJS({teams:[],teamPoints:{},playForPlayer:{},startedPlayerCount:0,stats:l.Map()}))},o.prototype.processOneEvent=function(a,r){var e=this;switch(r.code){case d.MultiSportEventCode.SetTeams:return o.handleSetTeams(a,r);case d.MultiSportEventCode.Play:return(0,d.onValidPlayCode)(a,r,s.GOAL_SPORT_CONFIGURATION.play_codes,function(i,c){return e.handlePlay(i,c)});case d.MultiSportEventCode.AssignPlayer:return this.handleAssignPlayer(a,r);case d.MultiSportEventCode.AdjustScore:return this.handleScoreChange(a,r);case d.MultiSportEventCode.OverrideScore:return this.handleScoreChange(a,r);case d.MultiSportEventCode.ActivatePlayer:return o.handleActivatePlayer(a,r);default:return a}},o.handleSetTeams=function(a,r){var e=r.attributes,i=e.homeId,c=e.awayId;return a.setIn(["teamPoints",i],0).setIn(["teamPoints",c],0).setIn(["teams"],l.List.of(i,c)).setIn(["stats"],y.TeamPlayerStats.fromTeams(l.List.of(i,c))).updateIn(["stats",i,t.TOTAL],y.Stats.empty(),function(f){return f.setIn([y.GoalStat.GP],1)}).updateIn(["stats",c,t.TOTAL],y.Stats.empty(),function(f){return f.setIn([y.GoalStat.GP],1)})},o.prototype.handleScoreChange=function(a,r){var e=r.attributes.team_id,i=this.score.stateAfterEvent(this.nextEventOffset).scores[e];return a.setIn(["teamPoints",e],i)},o.handleActivatePlayer=function(a,r){var e=r.attributes,i=e.team_id,c=e.player_id;return o.markPlayerSeen(c,i,a)},o.prototype.determineEventPlayValue=function(a){switch(a.code){case d.MultiSportEventCode.Play:var r=a.attributes.play_code;switch(r){case s.PlayCode.Goal:return 1;default:return 0}case d.MultiSportEventCode.AdjustScore:return a.attributes.adjustment;case d.MultiSportEventCode.OverrideScore:return a.attributes.points;default:return 0}},o.prototype.handlePlay=function(a,r){var e=r.attributes,i=e.team_id,c=e.play_code;return this.handleScoreChange(a.updateIn(["stats",i,t.UNASSIGNED_PLAYER],y.Stats.empty(),function(f){return y.Stats.addPlay(f,c)}).updateIn(["stats",i,t.TOTAL],y.Stats.empty(),function(f){return y.Stats.addPlay(f,c)}),r)},o.prototype.handleAssignPlayer=function(a,r){var e=r.attributes,i=e.play_event_id,c=e.player_id,f=this.baseEvents,_=a.getIn(["playForPlayer",i],t.UNASSIGNED_PLAYER),S=f[this.indexForEventId(i)]||f.slice(this.nextEventOffset).find(function(B){return B.id===i}),P=S.attributes,I=P.team_id,E=P.play_code;return(0,d.onValidPlayCode)(a,S,s.GOAL_SPORT_CONFIGURATION.play_codes,function(){return o.markPlayerSeen(c,I,a.setIn(["playForPlayer",i],c).updateIn(["stats",I,c],y.Stats.empty(),function(B){return y.Stats.addPlay(B,E)}).updateIn(["stats",I,_],y.Stats.empty(),function(B){return y.Stats.removePlay(B,E)}))})},o.markPlayerSeen=function(a,r,e){var i=["stats",r,a];return e.updateIn(i,y.Stats.empty(),function(c){return c.setIn([y.GoalStat.GP],1)})},o}(p.MultiSportBoxScoreEngine);return rn.BoxScoreEngine=h,rn}var an={},sn={},cp;function Ki(){if(cp)return sn;cp=1,Object.defineProperty(sn,"__esModule",{value:!0}),sn.MultiSportPerPeriodBoxScoreEngine=sn.MultiSportPeriodBoxScoreState=void 0;var n=X,l=n.__importStar(Ee()),t=n.__importStar(Oe()),p=function(y){n.__extends(s,y);function s(){return y!==null&&y.apply(this,arguments)||this}return s}(t.ImmutableState);sn.MultiSportPeriodBoxScoreState=p;var d=function(y){n.__extends(s,y);function s(u,h,v){var o=y.call(this,u)||this;return o.baseEvents=u,o.period=h,o.stats=v,o}return s}(l.VersionedStateEngine);return sn.MultiSportPerPeriodBoxScoreEngine=d,sn}var dp;function Qv(){if(dp)return an;dp=1,Object.defineProperty(an,"__esModule",{value:!0}),an.PerPeriodBoxScoreEngine=an.PeriodBoxScoreState=void 0;var n=X,l=n.__importStar(fe()),t=$e(),p=Go(),d=Ki(),y=Me(),s=function(h){n.__extends(v,h);function v(){return h!==null&&h.apply(this,arguments)||this}return Object.defineProperty(v.prototype,"periodStats",{get:function(){var o=this.get("statsPerPeriod");return o.reduce(function(a,r,e){var i=r.reduce(function(c,f,_){return c.setIn([_],f.getIn([t.TOTAL,p.GoalStat.PTS]))},l.Map());return a[e]=p.TeamPlayerStats.toTeamsStatDoc(r,i),a},{})},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"lineScores",{get:function(){return Object.entries(this.periodStats).reduce(function(o,a){var r=a[0],e=a[1],i=parseInt(r,10),c=Object.entries(e).reduce(function(f,_){var S=_[0],P=_[1];return f[S]=P.stats.offense[p.GoalStat.PTS],f},{});return Object.entries(c).reduce(function(f,_){var S=_[0],P=_[1],I=f.getIn([S],l.List());return I=I.insert(i,P),f.setIn([S],I)},o)},l.Map()).toJS()},enumerable:!1,configurable:!0}),v}(d.MultiSportPeriodBoxScoreState);an.PeriodBoxScoreState=s;var u=function(h){n.__extends(v,h);function v(o,a,r){var e=h.call(this,o,a,r)||this;return e.baseEvents=o,e.period=a,e.stats=r,e}return v.prototype.initialState=function(){return new s(l.fromJS({statsPerPeriod:l.Map()}))},v.prototype.processOneEvent=function(o,a){switch(a.code){case y.MultiSportEventCode.Play:case y.MultiSportEventCode.SetTeams:case y.MultiSportEventCode.AssignPlayer:case y.MultiSportEventCode.AdjustScore:case y.MultiSportEventCode.OverrideScore:return this.handleStatsChange(o);default:return o}},v.prototype.handleStatsChange=function(o){var a;if(this.stats){var r=this.stats.stateAfterEvent(this.nextEventOffset),e=p.TeamPlayerStats.fromTeamsStatDoc(r.stats),i=this.period.stateAfterEvent(this.nextEventOffset),c=Math.max(1,i.period-(i.isActive?0:1)),f=(a=l.List).of.apply(a,e.keySeq().toArray()),_=function(E){return o.getIn(["statsPerPeriod",E],P)},S=Array.from({length:c},function(E,B){return++B}),P=p.TeamPlayerStats.fromTeams(f),I=c===1?e:S.slice(0,-1).reduce(function(E,B){return p.TeamPlayerStats.subtract(E,_(B))},e);return S.reduce(function(E,B){return E.updateIn(["statsPerPeriod",B],function(b){return B===c?I:b||P})},o)}else return o},v}(d.MultiSportPerPeriodBoxScoreEngine);return an.PerPeriodBoxScoreEngine=u,an}var Qa={},fp;function Xv(){if(fp)return Qa;fp=1,Object.defineProperty(Qa,"__esModule",{value:!0}),Qa.PlayByPlayEngine=void 0;var n=X,l=n.__importStar(fe()),t=kt(),p=Ya(),d=function(y){n.__extends(s,y);function s(){return y!==null&&y.apply(this,arguments)||this}return s.prototype.handlePlay=function(u,h){var v=this.period.stateBeforeEvent(this.nextEventOffset),o=u;if(v&&v.isActive===!1){var a=new t.PlayByPlayEntry(l.fromJS({template:"Start of period ".concat(v.period),id:"start_of_period_".concat(v.period),playByPlayType:t.PlayByPlayType.StartPeriod,period:v.period,playerAssignable:!1,teamAssignable:!1,deletable:!1,createdAt:h.createdAt}));o=o.pushEntry(a)}var r=h.attributes.play_code,e;if(r===p.PlayCode.Goal){var i=this.score.stateAfterEvent(this.nextEventOffset);e=i==null?void 0:i.scoresImmutable}else e=void 0;var c=new t.PlayByPlayEntry(l.fromJS({template:"".concat(h.attributes.play_code," by ").concat(h.attributes.team_id),id:h.attributes.pbp_entry_id,playByPlayType:t.PlayByPlayType.Play,eventIds:[h.id],playCode:r,teamId:h.attributes.team_id,period:v.period,teamScores:e,playerAssignable:!0,teamAssignable:!0,deletable:!0,createdAt:h.createdAt}));return o.pushEntry(c)},s}(t.MultiSportPlayByPlayEngine);return Qa.PlayByPlayEngine=d,Qa}var Xa={},pp;function Zv(){if(pp)return Xa;pp=1,Object.defineProperty(Xa,"__esModule",{value:!0}),Xa.ScoreEngine=void 0;var n=X,l=bn(),t=Ya(),p=function(d){n.__extends(y,d);function y(){return d!==null&&d.apply(this,arguments)||this}return y.prototype.handlePlay=function(s,u){var h=u.attributes.play_code,v=u.attributes.team_id;switch(h){case t.PlayCode.Goal:return s.incrementScore(v,1);default:return s}},y}(l.MultiSportScoreEngine);return Xa.ScoreEngine=p,Xa}var hp;function eg(){if(hp)return Ja;hp=1,Object.defineProperty(Ja,"__esModule",{value:!0}),Ja.GoalSportCompactorController=void 0;var n=X,l=Or(),t=ja(),p=qa(),d=Ua(),y=Yv(),s=Ya(),u=Wa(),h=Qv(),v=Xv(),o=Zv(),a=Go(),r=Ka(),e=function(i){n.__extends(c,i);function c(){var f=i.call(this)||this;f.stateAccessorClass=r.SharedStateAccessor,f.activePlayer=new d.MultiSportActivePlayerEngine([],s.GOAL_SPORT_CONFIGURATION),f.period=new u.MultiSportPeriodEngine([],s.GOAL_SPORT_CONFIGURATION),f.score=new o.ScoreEngine([],s.GOAL_SPORT_CONFIGURATION),f.stats=new y.BoxScoreEngine([],f.score,f.activePlayer),f.playByPlay=new v.PlayByPlayEngine([],s.GOAL_SPORT_CONFIGURATION,f.activePlayer,f.period,f.score,f.stats),f.lineScore=new p.LinescoreEngine([],f.period,f.score,s.GOAL_SPORT_CONFIGURATION),f.statsPerPeriod=new h.PerPeriodBoxScoreEngine([],f.period,f.stats),f.engines=[f.activePlayer,f.period,f.score,f.playByPlay,f.lineScore,f.statsPerPeriod,f.stats],f.compactor=new l.SabertoothEventCompactor;for(var _=0,S=f.engines;_<S.length;_++){var P=S[_];P.baseEvents=f.compactor.outStream}return f}return c.prototype.getDerivedMultiGameStatsWithBaseStats=function(f){return a.TeamPlayerStats.getDerivedMultiGameStatsWithBaseStats(f)},c.prototype.processVoiceEvents=function(f,_){throw new Error("Voice Scoring not supported by this sport")},c.prototype.announcements=function(f){throw new Error("Announcements not supported by this sport")},c}(t.MultiSportCompactorController);return Ja.GoalSportCompactorController=e,Ja}var Za={},Ho={};let Ji;const tg=new Uint8Array(16);function yp(){if(!Ji&&(Ji=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Ji))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Ji(tg)}var rg=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Yi(n){return typeof n=="string"&&rg.test(n)}const Ye=[];for(let n=0;n<256;++n)Ye.push((n+256).toString(16).slice(1));function Qi(n,l=0){return Ye[n[l+0]]+Ye[n[l+1]]+Ye[n[l+2]]+Ye[n[l+3]]+"-"+Ye[n[l+4]]+Ye[n[l+5]]+"-"+Ye[n[l+6]]+Ye[n[l+7]]+"-"+Ye[n[l+8]]+Ye[n[l+9]]+"-"+Ye[n[l+10]]+Ye[n[l+11]]+Ye[n[l+12]]+Ye[n[l+13]]+Ye[n[l+14]]+Ye[n[l+15]]}function ng(n,l=0){const t=Qi(n,l);if(!Yi(t))throw TypeError("Stringified UUID is invalid");return t}let vp,No,jo=0,qo=0;function ag(n,l,t){let p=l&&t||0;const d=l||new Array(16);n=n||{};let y=n.node||vp,s=n.clockseq!==void 0?n.clockseq:No;if(y==null||s==null){const r=n.random||(n.rng||yp)();y==null&&(y=vp=[r[0]|1,r[1],r[2],r[3],r[4],r[5]]),s==null&&(s=No=(r[6]<<8|r[7])&16383)}let u=n.msecs!==void 0?n.msecs:Date.now(),h=n.nsecs!==void 0?n.nsecs:qo+1;const v=u-jo+(h-qo)/1e4;if(v<0&&n.clockseq===void 0&&(s=s+1&16383),(v<0||u>jo)&&n.nsecs===void 0&&(h=0),h>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");jo=u,qo=h,No=s,u+=122192928e5;const o=((u&268435455)*1e4+h)%4294967296;d[p++]=o>>>24&255,d[p++]=o>>>16&255,d[p++]=o>>>8&255,d[p++]=o&255;const a=u/4294967296*1e4&268435455;d[p++]=a>>>8&255,d[p++]=a&255,d[p++]=a>>>24&15|16,d[p++]=a>>>16&255,d[p++]=s>>>8|128,d[p++]=s&255;for(let r=0;r<6;++r)d[p+r]=y[r];return l||Qi(d)}function gp(n){if(!Yi(n))throw TypeError("Invalid UUID");let l;const t=new Uint8Array(16);return t[0]=(l=parseInt(n.slice(0,8),16))>>>24,t[1]=l>>>16&255,t[2]=l>>>8&255,t[3]=l&255,t[4]=(l=parseInt(n.slice(9,13),16))>>>8,t[5]=l&255,t[6]=(l=parseInt(n.slice(14,18),16))>>>8,t[7]=l&255,t[8]=(l=parseInt(n.slice(19,23),16))>>>8,t[9]=l&255,t[10]=(l=parseInt(n.slice(24,36),16))/1099511627776&255,t[11]=l/4294967296&255,t[12]=l>>>24&255,t[13]=l>>>16&255,t[14]=l>>>8&255,t[15]=l&255,t}function ig(n){n=unescape(encodeURIComponent(n));const l=[];for(let t=0;t<n.length;++t)l.push(n.charCodeAt(t));return l}const sg="6ba7b810-9dad-11d1-80b4-00c04fd430c8",og="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function _p(n,l,t){function p(d,y,s,u){var h;if(typeof d=="string"&&(d=ig(d)),typeof y=="string"&&(y=gp(y)),((h=y)===null||h===void 0?void 0:h.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let v=new Uint8Array(16+d.length);if(v.set(y),v.set(d,y.length),v=t(v),v[6]=v[6]&15|l,v[8]=v[8]&63|128,s){u=u||0;for(let o=0;o<16;++o)s[u+o]=v[o];return s}return Qi(v)}try{p.name=n}catch{}return p.DNS=sg,p.URL=og,p}function ug(n){if(typeof n=="string"){const l=unescape(encodeURIComponent(n));n=new Uint8Array(l.length);for(let t=0;t<l.length;++t)n[t]=l.charCodeAt(t)}return lg(cg(dg(n),n.length*8))}function lg(n){const l=[],t=n.length*32,p="0123456789abcdef";for(let d=0;d<t;d+=8){const y=n[d>>5]>>>d%32&255,s=parseInt(p.charAt(y>>>4&15)+p.charAt(y&15),16);l.push(s)}return l}function Sp(n){return(n+64>>>9<<4)+14+1}function cg(n,l){n[l>>5]|=128<<l%32,n[Sp(l)-1]=l;let t=1732584193,p=-271733879,d=-1732584194,y=271733878;for(let s=0;s<n.length;s+=16){const u=t,h=p,v=d,o=y;t=rt(t,p,d,y,n[s],7,-680876936),y=rt(y,t,p,d,n[s+1],12,-389564586),d=rt(d,y,t,p,n[s+2],17,606105819),p=rt(p,d,y,t,n[s+3],22,-1044525330),t=rt(t,p,d,y,n[s+4],7,-176418897),y=rt(y,t,p,d,n[s+5],12,1200080426),d=rt(d,y,t,p,n[s+6],17,-1473231341),p=rt(p,d,y,t,n[s+7],22,-45705983),t=rt(t,p,d,y,n[s+8],7,1770035416),y=rt(y,t,p,d,n[s+9],12,-1958414417),d=rt(d,y,t,p,n[s+10],17,-42063),p=rt(p,d,y,t,n[s+11],22,-1990404162),t=rt(t,p,d,y,n[s+12],7,1804603682),y=rt(y,t,p,d,n[s+13],12,-40341101),d=rt(d,y,t,p,n[s+14],17,-1502002290),p=rt(p,d,y,t,n[s+15],22,1236535329),t=nt(t,p,d,y,n[s+1],5,-165796510),y=nt(y,t,p,d,n[s+6],9,-1069501632),d=nt(d,y,t,p,n[s+11],14,643717713),p=nt(p,d,y,t,n[s],20,-373897302),t=nt(t,p,d,y,n[s+5],5,-701558691),y=nt(y,t,p,d,n[s+10],9,38016083),d=nt(d,y,t,p,n[s+15],14,-660478335),p=nt(p,d,y,t,n[s+4],20,-405537848),t=nt(t,p,d,y,n[s+9],5,568446438),y=nt(y,t,p,d,n[s+14],9,-1019803690),d=nt(d,y,t,p,n[s+3],14,-187363961),p=nt(p,d,y,t,n[s+8],20,1163531501),t=nt(t,p,d,y,n[s+13],5,-1444681467),y=nt(y,t,p,d,n[s+2],9,-51403784),d=nt(d,y,t,p,n[s+7],14,1735328473),p=nt(p,d,y,t,n[s+12],20,-1926607734),t=at(t,p,d,y,n[s+5],4,-378558),y=at(y,t,p,d,n[s+8],11,-2022574463),d=at(d,y,t,p,n[s+11],16,1839030562),p=at(p,d,y,t,n[s+14],23,-35309556),t=at(t,p,d,y,n[s+1],4,-1530992060),y=at(y,t,p,d,n[s+4],11,1272893353),d=at(d,y,t,p,n[s+7],16,-155497632),p=at(p,d,y,t,n[s+10],23,-1094730640),t=at(t,p,d,y,n[s+13],4,681279174),y=at(y,t,p,d,n[s],11,-358537222),d=at(d,y,t,p,n[s+3],16,-722521979),p=at(p,d,y,t,n[s+6],23,76029189),t=at(t,p,d,y,n[s+9],4,-640364487),y=at(y,t,p,d,n[s+12],11,-421815835),d=at(d,y,t,p,n[s+15],16,530742520),p=at(p,d,y,t,n[s+2],23,-995338651),t=it(t,p,d,y,n[s],6,-198630844),y=it(y,t,p,d,n[s+7],10,1126891415),d=it(d,y,t,p,n[s+14],15,-1416354905),p=it(p,d,y,t,n[s+5],21,-57434055),t=it(t,p,d,y,n[s+12],6,1700485571),y=it(y,t,p,d,n[s+3],10,-1894986606),d=it(d,y,t,p,n[s+10],15,-1051523),p=it(p,d,y,t,n[s+1],21,-2054922799),t=it(t,p,d,y,n[s+8],6,1873313359),y=it(y,t,p,d,n[s+15],10,-30611744),d=it(d,y,t,p,n[s+6],15,-1560198380),p=it(p,d,y,t,n[s+13],21,1309151649),t=it(t,p,d,y,n[s+4],6,-145523070),y=it(y,t,p,d,n[s+11],10,-1120210379),d=it(d,y,t,p,n[s+2],15,718787259),p=it(p,d,y,t,n[s+9],21,-343485551),t=gr(t,u),p=gr(p,h),d=gr(d,v),y=gr(y,o)}return[t,p,d,y]}function dg(n){if(n.length===0)return[];const l=n.length*8,t=new Uint32Array(Sp(l));for(let p=0;p<l;p+=8)t[p>>5]|=(n[p/8]&255)<<p%32;return t}function gr(n,l){const t=(n&65535)+(l&65535);return(n>>16)+(l>>16)+(t>>16)<<16|t&65535}function fg(n,l){return n<<l|n>>>32-l}function Xi(n,l,t,p,d,y){return gr(fg(gr(gr(l,n),gr(p,y)),d),t)}function rt(n,l,t,p,d,y,s){return Xi(l&t|~l&p,n,l,d,y,s)}function nt(n,l,t,p,d,y,s){return Xi(l&p|t&~p,n,l,d,y,s)}function at(n,l,t,p,d,y,s){return Xi(l^t^p,n,l,d,y,s)}function it(n,l,t,p,d,y,s){return Xi(t^(l|~p),n,l,d,y,s)}const pg=_p("v3",48,ug);var Pp={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function hg(n,l,t){if(Pp.randomUUID&&!l&&!n)return Pp.randomUUID();n=n||{};const p=n.random||(n.rng||yp)();if(p[6]=p[6]&15|64,p[8]=p[8]&63|128,l){t=t||0;for(let d=0;d<16;++d)l[t+d]=p[d];return l}return Qi(p)}function yg(n,l,t,p){switch(n){case 0:return l&t^~l&p;case 1:return l^t^p;case 2:return l&t^l&p^t&p;case 3:return l^t^p}}function Uo(n,l){return n<<l|n>>>32-l}function vg(n){const l=[1518500249,1859775393,2400959708,3395469782],t=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof n=="string"){const s=unescape(encodeURIComponent(n));n=[];for(let u=0;u<s.length;++u)n.push(s.charCodeAt(u))}else Array.isArray(n)||(n=Array.prototype.slice.call(n));n.push(128);const p=n.length/4+2,d=Math.ceil(p/16),y=new Array(d);for(let s=0;s<d;++s){const u=new Uint32Array(16);for(let h=0;h<16;++h)u[h]=n[s*64+h*4]<<24|n[s*64+h*4+1]<<16|n[s*64+h*4+2]<<8|n[s*64+h*4+3];y[s]=u}y[d-1][14]=(n.length-1)*8/Math.pow(2,32),y[d-1][14]=Math.floor(y[d-1][14]),y[d-1][15]=(n.length-1)*8&4294967295;for(let s=0;s<d;++s){const u=new Uint32Array(80);for(let e=0;e<16;++e)u[e]=y[s][e];for(let e=16;e<80;++e)u[e]=Uo(u[e-3]^u[e-8]^u[e-14]^u[e-16],1);let h=t[0],v=t[1],o=t[2],a=t[3],r=t[4];for(let e=0;e<80;++e){const i=Math.floor(e/20),c=Uo(h,5)+yg(i,v,o,a)+r+l[i]+u[e]>>>0;r=a,a=o,o=Uo(v,30)>>>0,v=h,h=c}t[0]=t[0]+h>>>0,t[1]=t[1]+v>>>0,t[2]=t[2]+o>>>0,t[3]=t[3]+a>>>0,t[4]=t[4]+r>>>0}return[t[0]>>24&255,t[0]>>16&255,t[0]>>8&255,t[0]&255,t[1]>>24&255,t[1]>>16&255,t[1]>>8&255,t[1]&255,t[2]>>24&255,t[2]>>16&255,t[2]>>8&255,t[2]&255,t[3]>>24&255,t[3]>>16&255,t[3]>>8&255,t[3]&255,t[4]>>24&255,t[4]>>16&255,t[4]>>8&255,t[4]&255]}const gg=_p("v5",80,vg);var _g="00000000-0000-0000-0000-000000000000";function Sg(n){if(!Yi(n))throw TypeError("Invalid UUID");return parseInt(n.slice(14,15),16)}var Pg=Object.freeze({__proto__:null,NIL:_g,parse:gp,stringify:ng,v1:ag,v3:pg,v4:hg,v5:gg,validate:Yi,version:Sg}),Ig=ds(Pg),Ip;function mg(){return Ip||(Ip=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.CONTEXTUAL_HINTS=n.PLAY_KEYWORDS=n.PLAY_REPLACEMENTS=n.WORD_REPLACEMENTS=n.BASIC_REPLACEMENTS=n.VoiceScoringEngine=void 0;var l=X,t=l.__importStar(fe()),p=l.__importStar(Ig),d=Me(),y=function(){function s(u,h,v,o){this.activePlayer=u,this.scoreEngine=h,this.sportConfiguration=v,this.isHomeTeam=o,this.recordedEvents=[],this.currentEvent={},this.TEAM_KEYWORDS=t.Map({}),this.ownTeamId=o?h.latestState.homeId:h.latestState.awayId,this.opponentTeamId=o?h.latestState.awayId:h.latestState.homeId,this.ownTeamPlayers=u.latestState.activePlayers[this.ownTeamId].map(function(a){return a.toLowerCase()}),this.opponentTeamPlayers=u.latestState.activePlayers[this.opponentTeamId].map(function(a){return a.toLowerCase()}),this.TEAM_KEYWORDS=this.TEAM_KEYWORDS.set("home",o?this.ownTeamId:this.opponentTeamId).set("away",o?this.opponentTeamId:this.ownTeamId).set("opponent",this.opponentTeamId)}return s.prototype.processSpeech=function(u){var h=this,v=u.toLowerCase();return[Object.entries(n.BASIC_REPLACEMENTS),Object.entries(n.WORD_REPLACEMENTS),Object.entries(n.PLAY_REPLACEMENTS)].forEach(function(o){for(var a=0,r=o;a<r.length;a++){var e=r[a],i=e[0],c=e[1],f=new RegExp(i,"gi");v=v.replace(f,c)}}),v.toLowerCase().split(" ").forEach(function(o){switch(!0){case n.PLAY_KEYWORDS.hasOwnProperty(o):var a=n.PLAY_KEYWORDS[o];h.currentEventIsValid()&&(h.recordedEvents.push(h.currentEvent),h.currentEvent={}),h.currentEvent.play_code=a,h.currentEvent.team_id||(h.currentEvent.team_id=h.ownTeamId);break;case h.TEAM_KEYWORDS.get(o)!==void 0:var r=h.TEAM_KEYWORDS.get(o);h.currentEvent.team_id=r,h.currentEvent.player_id&&h.currentEvent.player_word&&(r===h.ownTeamId&&h.ownTeamPlayers.includes(o)||r===h.opponentTeamId&&h.opponentTeamPlayers.includes(o)?h.currentEvent.player_id=o:(h.currentEvent.player_id=void 0,h.currentEvent.player_word=void 0));break;case h.ownTeamPlayers.includes(o):h.currentEvent.player_word=o,h.currentEvent.player_id=o,h.currentEvent.team_id=h.ownTeamId;break;case h.opponentTeamPlayers.includes(o):h.currentEvent.player_word=o,h.currentEvent.player_id=o,h.currentEvent.team_id=h.opponentTeamId;break;default:return}}),this.currentEventIsValid()&&this.recordedEvents.push(this.currentEvent),this.convertToActualEvents(this.recordedEvents)},s.prototype.convertToActualEvents=function(u){var h=[];return u.forEach(function(v){if(v.team_id&&v.play_code){var o={id:p.v4(),code:d.MultiSportEventCode.Play,attributes:{team_id:v.team_id,play_code:v.play_code,pbp_entry_id:p.v4()}};if(h.push(o),v.player_id){var a={id:p.v4(),code:d.MultiSportEventCode.AssignPlayer,attributes:{play_event_id:o.id,player_id:v.player_id,is_edit:!1}};h.push(a)}}}),h},s.prototype.currentEventIsValid=function(){return this.currentEvent.play_code&&this.currentEvent.team_id?this.currentEvent.team_id===this.ownTeamId?this.sportConfiguration.play_codes.includes(this.currentEvent.play_code):this.sportConfiguration.opponent_play_codes?this.sportConfiguration.opponent_play_codes.includes(this.currentEvent.play_code):!1:!1},s}();n.VoiceScoringEngine=y,n.BASIC_REPLACEMENTS={" a ":""," an ":"","\\.":" point ","'s":""},n.WORD_REPLACEMENTS={for:"four",fourty:"forty","'s":"","two point ":"two-point ","two points":"two-points","two pointer":"two-pointer","three point ":"three-point ","three points":"three-points","three pointer":"three-pointer","free throw":"free-throw",file:"foul",far:"foul",fell:"foul",steel:"steal",access:"assist",assess:"assist",assessed:"assist",black:"block"},n.PLAY_REPLACEMENTS={"two point":"two-point","two points":"two-points","two pointer":"two-pointer","three point":"three-point","three points":"three-points","three pointer":"three-pointer","free throw":"free-throw","point miss":"point-miss","point missed":"point-miss","miss two":"missed-two","missed two":"missed-two","miss three":"missed-three","missed three":"missed-three","throw miss":"throw-miss","miss free":"missed-free","missed free":"missed-free"},n.PLAY_KEYWORDS={steal:"steal",rebound:"rebound",assist:"assist",turnover:"turnover",block:"block","two-point":"made2","two-points":"made2","two-pointer":"made2","two-point-miss":"missed2","missed-two-points":"missed2","missed-two-pointer":"missed2","three-point":"made3","three-points":"made3","three-pointer":"made3","three-point-miss":"missed3","missed-three-points":"missed3","missed-three-pointer":"missed3","missed-three":"missed3","free-throw":"madeFreeThrow","free-throw-miss":"missedFreeThrow","missed-free-throw":"missedFreeThrow"},n.CONTEXTUAL_HINTS=["two-point miss","two-point make","three-point miss","three-point make"]}(Ho)),Ho}var on={},mp;function bg(){if(mp)return on;mp=1,Object.defineProperty(on,"__esModule",{value:!0}),on.BoxScoreEngine=on.BoxScoreState=void 0;var n=X,l=n.__importStar(fe()),t=$e(),p=zi(),d=Me(),y=Jr(),s=Ma(),u=function(v){n.__extends(o,v);function o(){return v!==null&&v.apply(this,arguments)||this}return Object.defineProperty(o.prototype,"stats",{get:function(){return s.TeamPlayerStats.toTeamsStatDoc(this.teamPlayerStats,this.teamPoints)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"teamPoints",{get:function(){return this.get("teamPoints")},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"teamPlayerStats",{get:function(){return this.get("stats")},enumerable:!1,configurable:!0}),o}(p.MultiSportBoxScoreState);on.BoxScoreState=u;var h=function(v){n.__extends(o,v);function o(a,r,e){var i=v.call(this,a,r,e)||this;return i.baseEvents=a,i.score=r,i.activePlayerEngine=e,i}return o.prototype.initialState=function(){return new u(l.fromJS({teams:[],teamPoints:{},playForPlayer:{},startedPlayerCount:0,stats:l.Map()}))},o.prototype.processOneEvent=function(a,r){var e=this;switch(r.code){case d.MultiSportEventCode.SetTeams:return o.handleSetTeams(a,r);case d.MultiSportEventCode.Play:return(0,d.onValidPlayCode)(a,r,y.HOOPS_CONFIGURATION.play_codes,function(i,c){return i=e.handlePlusMinusCalculation(i,c),e.handlePlay(i,c)});case d.MultiSportEventCode.AssignPlayer:return a=this.handleAssignPlayer(a,r),this.handlePlusMinusCalcForImplicitSub(a,r);case d.MultiSportEventCode.AdjustScore:return a=this.handlePlusMinusCalculation(a,r),this.handleScoreChange(a,r);case d.MultiSportEventCode.OverrideScore:return a=this.handlePlusMinusCalculation(a,r),this.handleScoreChange(a,r);case d.MultiSportEventCode.ActivatePlayer:return o.handleActivatePlayer(a,r);default:return a}},o.handleSetTeams=function(a,r){var e=r.attributes,i=e.homeId,c=e.awayId;return a.setIn(["teamPoints",i],0).setIn(["teamPoints",c],0).setIn(["teams"],l.List.of(i,c)).setIn(["stats"],s.TeamPlayerStats.fromTeams(l.List.of(i,c))).updateIn(["stats",i,t.TOTAL],s.Stats.empty(),function(f){return f.setIn([s.HoopsStat.GP],1)}).updateIn(["stats",c,t.TOTAL],s.Stats.empty(),function(f){return f.setIn([s.HoopsStat.GP],1)})},o.prototype.handleScoreChange=function(a,r){var e=r.attributes.team_id,i=this.score.stateAfterEvent(this.nextEventOffset).scores[e];return a.setIn(["teamPoints",e],i)},o.handleActivatePlayer=function(a,r){var e=r.attributes,i=e.team_id,c=e.player_id;return o.markPlayerSeen(c,i,a)},o.prototype.handlePlusMinusCalculation=function(a,r){var e=r.attributes.team_id,i=this.determineEventPlayValue(r),c=this.activePlayerEngine.stateAfterEvent(this.nextEventOffset).activePlayers;return Object.entries(c).reduce(function(f,_){var S=_[0],P=_[1],I=S===e?i:-i;return P.reduce(function(E,B){return E.updateIn(["stats",S,B,s.HoopsStat.PM],0,function(b){return b+I})},f)},a)},o.prototype.determineEventPlayValue=function(a){switch(a.code){case d.MultiSportEventCode.Play:var r=a.attributes.play_code;switch(r){case y.PlayCode.MadeFreeThrow:return 1;case y.PlayCode.Made2:return 2;case y.PlayCode.Made3:return 3;default:return 0}case d.MultiSportEventCode.AdjustScore:return a.attributes.adjustment;case d.MultiSportEventCode.OverrideScore:return a.attributes.points;default:return 0}},o.prototype.handlePlay=function(a,r){var e=r.attributes,i=e.team_id,c=e.play_code;return this.handleScoreChange(a.updateIn(["stats",i,t.UNASSIGNED_PLAYER],s.Stats.empty(),function(f){return s.Stats.addPlay(f,c)}).updateIn(["stats",i,t.TOTAL],s.Stats.empty(),function(f){return s.Stats.addPlay(f,c)}),r)},o.prototype.handleAssignPlayer=function(a,r){var e=r.attributes,i=e.play_event_id,c=e.player_id,f=this.baseEvents,_=a.getIn(["playForPlayer",i],t.UNASSIGNED_PLAYER),S=f[this.indexForEventId(i)]||f.slice(this.nextEventOffset).find(function(B){return B.id===i}),P=S.attributes,I=P.team_id,E=P.play_code;return(0,d.onValidPlayCode)(a,S,y.HOOPS_CONFIGURATION.play_codes,function(){return o.markPlayerSeen(c,I,a.setIn(["playForPlayer",i],c).updateIn(["stats",I,c],s.Stats.empty(),function(B){return s.Stats.addPlay(B,E)}).updateIn(["stats",I,_],s.Stats.empty(),function(B){return s.Stats.removePlay(B,E)}))})},o.prototype.handlePlusMinusCalcForImplicitSub=function(a,r){var e,i=r.attributes,c=i.play_event_id,f=i.player_id,_=this.baseEvents,S=_[this.indexForEventId(c)]||_.slice(this.nextEventOffset).find(function(E){return E.id===c}),P=S.attributes.team_id,I=this.determineEventPlayValue(S);return!((e=this.activePlayerEngine.stateBeforeEvent(this.nextEventOffset))===null||e===void 0)&&e.isPlayerActive(P,f)?a:a.updateIn(["stats",P,f,s.HoopsStat.PM],0,function(E){return E+I})},o.markPlayerSeen=function(a,r,e){var i=["stats",r,a],c=e.get("startedPlayerCount"),f=c<5?1:e.getIn(n.__spreadArray(n.__spreadArray([],i,!0),[s.HoopsStat.GS],!1),0);return e.updateIn(i,s.Stats.empty(),function(_){return _.setIn([s.HoopsStat.GP],1)}).updateIn(i,s.Stats.empty(),function(_){return _.setIn([s.HoopsStat.GS],f)}).updateIn(["startedPlayerCount"],function(_){return++_})},o}(p.MultiSportBoxScoreEngine);return on.BoxScoreEngine=h,on}var un={},bp;function Eg(){if(bp)return un;bp=1,Object.defineProperty(un,"__esModule",{value:!0}),un.PerPeriodBoxScoreEngine=un.PeriodBoxScoreState=void 0;var n=X,l=n.__importStar(fe()),t=$e(),p=Me(),d=Ki(),y=Ma(),s=function(h){n.__extends(v,h);function v(){return h!==null&&h.apply(this,arguments)||this}return Object.defineProperty(v.prototype,"periodStats",{get:function(){var o=this.get("statsPerPeriod");return o.reduce(function(a,r,e){var i=r.reduce(function(c,f,_){return c.setIn([_],f.getIn([t.TOTAL,y.HoopsStat.PTS]))},l.Map());return a[e]=y.TeamPlayerStats.toTeamsStatDoc(r,i),a},{})},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"lineScores",{get:function(){return Object.entries(this.periodStats).reduce(function(o,a){var r=a[0],e=a[1],i=parseInt(r,10),c=Object.entries(e).reduce(function(f,_){var S=_[0],P=_[1];return f[S]=P.stats.offense[y.HoopsStat.PTS],f},{});return Object.entries(c).reduce(function(f,_){var S=_[0],P=_[1],I=f.getIn([S],l.List());return I=I.insert(i,P),f.setIn([S],I)},o)},l.Map()).toJS()},enumerable:!1,configurable:!0}),v}(d.MultiSportPeriodBoxScoreState);un.PeriodBoxScoreState=s;var u=function(h){n.__extends(v,h);function v(o,a,r){var e=h.call(this,o,a,r)||this;return e.baseEvents=o,e.period=a,e.stats=r,e}return v.prototype.initialState=function(){return new s(l.fromJS({statsPerPeriod:l.Map()}))},v.prototype.processOneEvent=function(o,a){switch(a.code){case p.MultiSportEventCode.Play:case p.MultiSportEventCode.SetTeams:case p.MultiSportEventCode.AssignPlayer:case p.MultiSportEventCode.AdjustScore:case p.MultiSportEventCode.OverrideScore:return this.handleStatsChange(o);default:return o}},v.prototype.handleStatsChange=function(o){var a;if(this.stats){var r=this.stats.stateAfterEvent(this.nextEventOffset),e=y.TeamPlayerStats.fromTeamsStatDoc(r.stats),i=this.period.stateAfterEvent(this.nextEventOffset),c=Math.max(1,i.period-(i.isActive?0:1)),f=(a=l.List).of.apply(a,e.keySeq().toArray()),_=function(E){return o.getIn(["statsPerPeriod",E],P)},S=Array.from({length:c},function(E,B){return++B}),P=y.TeamPlayerStats.fromTeams(f),I=c===1?e:S.slice(0,-1).reduce(function(E,B){return y.TeamPlayerStats.subtract(E,_(B))},e);return S.reduce(function(E,B){return E.updateIn(["statsPerPeriod",B],function(b){return B===c?I:b||P})},o)}else return o},v}(d.MultiSportPerPeriodBoxScoreEngine);return un.PerPeriodBoxScoreEngine=u,un}var ei={},Ep;function Bg(){if(Ep)return ei;Ep=1,Object.defineProperty(ei,"__esModule",{value:!0}),ei.PlayByPlayEngine=void 0;var n=X,l=n.__importStar(fe()),t=kt(),p=Jr(),d=Uf(),y=function(s){n.__extends(u,s);function u(){var h=s!==null&&s.apply(this,arguments)||this;return h.playsForStreakTracking=[p.PlayCode.Made2,p.PlayCode.Made3],h.playsForStreakBreaking=[p.PlayCode.Missed2,p.PlayCode.Missed3],h}return u.prototype.handlePlay=function(h,v){var o=this.period.stateBeforeEvent(this.nextEventOffset),a=this.score.stateAfterEvent(this.nextEventOffset),r=h;if(o&&!o.isActive){var e=o.period,i=o.periodType,c=new t.PlayByPlayEntry(l.fromJS({template:"Start of period ".concat(o.period),id:"start_of_period_".concat(o.period),playByPlayType:t.PlayByPlayType.StartPeriod,period:e,playerAssignable:!1,teamAssignable:!1,deletable:!1,createdAt:v.createdAt,summary:this.getPeriodSummary(a,e,i)}));r=r.pushEntry(c)}var f=v.attributes.play_code,_;f===p.PlayCode.Made2||f===p.PlayCode.Made3||f===p.PlayCode.MadeFreeThrow?_=a.scoresImmutable:_=void 0;var S=v.attributes.team_id,P=new t.PlayByPlayEntry(l.fromJS({template:"".concat(f," by ").concat(S),id:v.attributes.pbp_entry_id,playByPlayType:t.PlayByPlayType.Play,eventIds:[v.id],playCode:f,teamId:S,period:o.period,teamScores:_,playerAssignable:!0,teamAssignable:!0,deletable:!0,createdAt:v.createdAt,summary:(0,d.getPlayCommentary)(f,S),playDetails:v.attributes.play_details}));return r.pushEntry(P)},u.prototype.getPeriodSummary=function(h,v,o){var a=h.awayId,r=h.homeId,e=h.scores[a],i=h.scores[r];return(0,d.getPeriodStartCommentary)(a,r,e,i,v,o)},u.prototype.getColorCommentaryMaybe=function(h,v,o,a,r){return(0,d.getColorCommentaryMaybe)(h,v,o,a,r)},u.prototype.getAdjustScoreSummary=function(h,v){return(0,d.getAdjustScoreCommentary)(h,v)},u.prototype.getEndPeriodSummary=function(h,v,o){return(0,d.getEndPeriodCommentary)(h,v,o)},u.prototype.getActivatePlayerSummary=function(h){return(0,d.getActivatePlayerCommentary)(h)},u.prototype.getDeactivatePlayerSummary=function(h){return(0,d.getDeactivatePlayerCommentary)(h)},u}(t.MultiSportPlayByPlayEngine);return ei.PlayByPlayEngine=y,ei}var ti={},Bp;function Tg(){if(Bp)return ti;Bp=1,Object.defineProperty(ti,"__esModule",{value:!0}),ti.ScoreEngine=void 0;var n=X,l=bn(),t=Jr(),p=function(d){n.__extends(y,d);function y(){return d!==null&&d.apply(this,arguments)||this}return y.prototype.handlePlay=function(s,u){var h=u.attributes.play_code,v=u.attributes.team_id;switch(h){case t.PlayCode.Made2:return s.incrementScore(v,2);case t.PlayCode.Made3:return s.incrementScore(v,3);case t.PlayCode.MadeFreeThrow:return s.incrementScore(v,1);default:return s}},y}(l.MultiSportScoreEngine);return ti.ScoreEngine=p,ti}var ln={},ri={},Tp;function Og(){if(Tp)return ri;Tp=1,Object.defineProperty(ri,"__esModule",{value:!0}),ri.MultiSportGameSettingsState=void 0;var n=X,l=n.__importStar(Oe()),t=function(p){n.__extends(d,p);function d(){return p!==null&&p.apply(this,arguments)||this}return d}(l.ImmutableState);return ri.MultiSportGameSettingsState=t,ri}var Op;function Ag(){if(Op)return ln;Op=1,Object.defineProperty(ln,"__esModule",{value:!0}),ln.HoopsGameSettingsEngine=ln.HoopsGameSettingsState=void 0;var n=X,l=n.__importStar(Ee()),t=Me(),p=n.__importStar(fe()),d=Og(),y=Co(),s=function(h){n.__extends(v,h);function v(){return h!==null&&h.apply(this,arguments)||this}return Object.defineProperty(v.prototype,"gameSettingsDoc",{get:function(){return y.GameSettings.fromHoopsMap(this.gameSettingsImmutable)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"gameSettingsImmutable",{get:function(){return this.get("gameSettings")},enumerable:!1,configurable:!0}),v}(d.MultiSportGameSettingsState);ln.HoopsGameSettingsState=s;var u=function(h){n.__extends(v,h);function v(o){var a=h.call(this,o)||this;return a.baseEvents=o,a}return v.prototype.initialState=function(){return new s(p.fromJS({gameSettings:void 0}))},v.prototype.processOneEvent=function(o,a){switch(a.code){case t.MultiSportEventCode.SetGameSettings:return this.handleGameSettingsChange(a);default:return o}},v.prototype.handleGameSettingsChange=function(o){var a=o.attributes;return new s(p.fromJS({gameSettings:{gameClock:a.game_clock,periodType:a.period_type.toLowerCase(),periodLength:a.period_length,teamTimeouts:a.team_timeouts,timeoutsReset:a.timeouts_reset.toLowerCase()}}))},v}(l.VersionedStateEngine);return ln.HoopsGameSettingsEngine=u,ln}var ni={},ai={},Ap;function Rg(){if(Ap)return ai;Ap=1,Object.defineProperty(ai,"__esModule",{value:!0}),ai.SabertoothPlayCodeTransformer=void 0;var n=function(){function l(){}return l}();return ai.SabertoothPlayCodeTransformer=n,ai}var Rp;function Fg(){if(Rp)return ni;Rp=1,Object.defineProperty(ni,"__esModule",{value:!0}),ni.HoopsPlayCodeTransformer=void 0;var n=X,l=Rg(),t=Jr(),p=function(d){n.__extends(y,d);function y(){return d!==null&&d.apply(this,arguments)||this}return y.prototype.transform=function(s,u){switch(s){case t.PlayCode.Rebound:if(u&&u.rebound_type){var h=u.rebound_type;if(h===t.PlayCode.OffensiveRebound)return t.PlayCode.OffensiveRebound;if(h===t.PlayCode.DefensiveRebound)return t.PlayCode.DefensiveRebound}break}return s},y}(l.SabertoothPlayCodeTransformer);return ni.HoopsPlayCodeTransformer=p,ni}var Fp;function kg(){if(Fp)return Za;Fp=1,Object.defineProperty(Za,"__esModule",{value:!0}),Za.HoopsCompactorController=void 0;var n=X,l=Or(),t=ja(),p=qa(),d=mg(),y=Ua(),s=bg(),u=Jr(),h=Wa(),v=Eg(),o=Bg(),a=Tg(),r=Ma(),e=jf(),i=Ag(),c=Ka(),f=Fg(),_=function(S){n.__extends(P,S);function P(){var I=S.call(this)||this;I.stateAccessorClass=c.SharedStateAccessor,I.activePlayer=new y.MultiSportActivePlayerEngine([],u.HOOPS_CONFIGURATION),I.period=new h.MultiSportPeriodEngine([],u.HOOPS_CONFIGURATION),I.score=new a.ScoreEngine([],u.HOOPS_CONFIGURATION),I.stats=new s.BoxScoreEngine([],I.score,I.activePlayer),I.gameSettings=new i.HoopsGameSettingsEngine([]),I.playByPlay=new o.PlayByPlayEngine([],u.HOOPS_CONFIGURATION,I.activePlayer,I.period,I.score,I.stats),I.lineScore=new p.LinescoreEngine([],I.period,I.score,u.HOOPS_CONFIGURATION),I.statsPerPeriod=new v.PerPeriodBoxScoreEngine([],I.period,I.stats),I.engines=[I.activePlayer,I.period,I.score,I.playByPlay,I.lineScore,I.statsPerPeriod,I.stats,I.gameSettings],I.compactor=new l.SabertoothEventCompactor(new f.HoopsPlayCodeTransformer);for(var E=0,B=I.engines;E<B.length;E++){var b=B[E];b.baseEvents=I.compactor.outStream}return I}return P.prototype.getDerivedMultiGameStatsWithBaseStats=function(I){return r.TeamPlayerStats.getDerivedMultiGameStatsWithBaseStats(I)},P.prototype.processVoiceEvents=function(I,E){var B=new d.VoiceScoringEngine(this.activePlayer,this.score,u.HOOPS_CONFIGURATION,E);return B.processSpeech(I)},P.prototype.announcements=function(I){return(0,e.generateAnnouncements)(I)},P}(t.MultiSportCompactorController);return Za.HoopsCompactorController=_,Za}var Wo={},kp;function wg(){return kp||(kp=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.HOOPS_STATS=n.VOLLEYBALL_STATS=n.RUGBY_STATS=n.GOAL_STATS=n.StatTableColumnsAccessor=void 0;var l=Me(),t=function(){function d(y){this.sport=y.sport}return d.prototype.getGameStatTableColumns=function(){var y=[];switch(this.sport){case l.Sport.SOCCER:case l.Sport.FIELD_HOCKEY:return y=Object.keys(n.GOAL_STATS).filter(function(s){return!["GP","PTS"].includes(s)}),y.map(function(s){return n.GOAL_STATS[s]});case l.Sport.HOCKEY:case l.Sport.LACROSSE:case l.Sport.WATER_POLO:return y=Object.keys(n.GOAL_STATS).filter(function(s){return!["GP","PTS2"].includes(s)}),y.map(function(s){return n.GOAL_STATS[s]});case l.Sport.RUGBY:return y=Object.keys(n.RUGBY_STATS).filter(function(s){return s!=="GP"}),y.map(function(s){return n.RUGBY_STATS[s]});case l.Sport.VOLLEYBALL:return y=Object.keys(n.VOLLEYBALL_STATS),y.map(function(s){return n.VOLLEYBALL_STATS[s]});case l.Sport.BASKETBALL:return y=["PTS","PF","FG","FGP","PT3","P3PT","FT","FTP","TO","ORB","DRB","REB","AST","STL","BLK","PM"],y.map(function(s){return n.HOOPS_STATS[s]});default:return[]}},d.prototype.getDerivedStatTableColumns=function(){var y=[];switch(this.sport){case l.Sport.SOCCER:case l.Sport.FIELD_HOCKEY:return y=Object.keys(n.GOAL_STATS).filter(function(s){return s!=="PTS"}),y.map(function(s){return n.GOAL_STATS[s]});case l.Sport.HOCKEY:case l.Sport.LACROSSE:case l.Sport.WATER_POLO:return y=Object.keys(n.GOAL_STATS).filter(function(s){return s!=="PTS2"}),y.map(function(s){return n.GOAL_STATS[s]});case l.Sport.RUGBY:return Object.values(n.RUGBY_STATS);case l.Sport.BASKETBALL:return Object.values(n.HOOPS_STATS);case l.Sport.VOLLEYBALL:return Object.values(n.VOLLEYBALL_STATS);default:return[]}},d.prototype.getOpponentGameStatTableColumns=function(){var y=[];switch(this.sport){case l.Sport.BASKETBALL:return y=["PTS","PF","FGM","M3PT","FG","FGP","PT3","P3PT","FT","FTP","TO","ORB","DRB","REB"],y.map(function(s){return n.HOOPS_STATS[s]});default:return[]}},d}();n.StatTableColumnsAccessor=t,n.GOAL_STATS={GP:{type:"GP",display_name:"GP",definition:"Games Played",format:l.StatFormat.INTEGER},G:{type:"G",display_name:"G",definition:"Goals",format:l.StatFormat.INTEGER},A:{type:"A",display_name:"A",definition:"Assists",format:l.StatFormat.INTEGER},PTS:{type:"PTS",display_name:"PTS",definition:"Points (goals + assists)",format:l.StatFormat.INTEGER},PTS2:{type:"PTS2",display_name:"PTS",definition:"Points (goals x 2 + assists)",format:l.StatFormat.INTEGER},SH:{type:"SH",display_name:"SH",definition:"Shots",format:l.StatFormat.INTEGER},"SH%":{type:"SH%",display_name:"SH%",definition:"Shot Percentage",format:l.StatFormat.PERCENTAGE},SV:{type:"SV",display_name:"SV",definition:"Saves",format:l.StatFormat.INTEGER}},n.RUGBY_STATS={GP:{type:"GP",display_name:"GP",definition:"Games Played",format:l.StatFormat.INTEGER},T:{type:"T",display_name:"T",definition:"Tries Scored",format:l.StatFormat.INTEGER},C:{type:"C",display_name:"C",definition:"Conversions",format:l.StatFormat.INTEGER},PC:{type:"PC",display_name:"PC",definition:"Penalty Conversions",format:l.StatFormat.INTEGER},DG:{type:"DG",display_name:"DG",definition:"Drop Goals",format:l.StatFormat.INTEGER},PTS:{type:"PTS",display_name:"PTS",definition:"Points Scored",format:l.StatFormat.INTEGER}},n.VOLLEYBALL_STATS={SA:{type:"SA",display_name:"SA",definition:"Serve Attempts (Total Serves)",format:l.StatFormat.INTEGER},A:{type:"A",display_name:"A",definition:"Service Aces",format:l.StatFormat.INTEGER},SE:{type:"SE",display_name:"SE",definition:"Service Errors",format:l.StatFormat.INTEGER},AP:{type:"A%",display_name:"A%",definition:"Ace Percentage (A/SA)",format:l.StatFormat.PERCENTAGE_SIGN}};var p={FGM:{type:"FGM",display_name:"FGM",definition:"Field Goals Made",format:l.StatFormat.INTEGER},FGA:{type:"FGA",display_name:"FGA",definition:"Field Goals Attempted",format:l.StatFormat.INTEGER},M3PT:{type:"3PTM",display_name:"3PTM",definition:"Three Point Field Goals Made",format:l.StatFormat.INTEGER},A3PT:{type:"3PTA",display_name:"3PTA",definition:"Three Point Field Goals Attempted",format:l.StatFormat.INTEGER},FTM:{type:"FTM",display_name:"FTM",definition:"Free Throws Made",format:l.StatFormat.INTEGER},FTA:{type:"FTA",display_name:"FTA",definition:"Free Throws Attempted",format:l.StatFormat.INTEGER}};n.HOOPS_STATS={GP:{type:"GP",display_name:"GP",definition:"Games Played",format:l.StatFormat.INTEGER},GS:{type:"GS",display_name:"GS",definition:"Games Started",format:l.StatFormat.INTEGER},PTS:{type:"PTS",display_name:"PTS",definition:"Points",format:l.StatFormat.INTEGER},PF:{type:"PF",display_name:"PF",definition:"Personal fouls",format:l.StatFormat.INTEGER},PPG:{type:"PPG",display_name:"PPG",definition:"Points per game",format:l.StatFormat.FLOAT_PERCENTAGE},PFPG:{type:"PFPG",display_name:"PFPG",definition:"Personal fouls per game",format:l.StatFormat.FLOAT_PERCENTAGE},FGM:p.FGM,FGA:p.FGA,FG:{type:"FG",display_name:"FG",definition:"Field goals made-attempted",format:l.StatFormat.JOIN,joined_stats:[p.FGM,p.FGA]},FGP:{type:"FG%",display_name:"FG%",definition:"Percentage of field goals made",format:l.StatFormat.PERCENTAGE},M3PT:p.M3PT,A3PT:p.A3PT,PT3:{type:"3PT",display_name:"3PT",definition:"3-point field goals made-attempted",format:l.StatFormat.JOIN,joined_stats:[p.M3PT,p.A3PT]},P3PT:{type:"3PT%",display_name:"3PT%",definition:"Percentage of 3-point field goals made",format:l.StatFormat.PERCENTAGE},FTM:p.FTM,FTA:p.FTA,FT:{type:"FT",display_name:"FT",definition:"Free throws made-attempted",format:l.StatFormat.JOIN,joined_stats:[p.FTM,p.FTA]},FTP:{type:"FT%",display_name:"FT%",definition:"Percentage of free throws made",format:l.StatFormat.PERCENTAGE},TO:{type:"TO",display_name:"TO",definition:"Turnovers",format:l.StatFormat.INTEGER},ORB:{type:"ORB",display_name:"ORB",definition:"Offensive Rebounds",format:l.StatFormat.INTEGER},DRB:{type:"DRB",display_name:"DRB",definition:"Defensive Rebounds",format:l.StatFormat.INTEGER},REB:{type:"REB",display_name:"REB",definition:"Total Rebounds",format:l.StatFormat.INTEGER},AST:{type:"AST",display_name:"AST",definition:"Assists",format:l.StatFormat.INTEGER},STL:{type:"STL",display_name:"STL",definition:"Steals",format:l.StatFormat.INTEGER},BLK:{type:"BLK",display_name:"BLK",definition:"Blocks",format:l.StatFormat.INTEGER},PM:{type:"+/-",display_name:"+/-",definition:"The team's net points while the player is on the court",format:l.StatFormat.INTEGER},TOPG:{type:"TOPG",display_name:"TOPG",definition:"Turnovers per game",format:l.StatFormat.FLOAT_PERCENTAGE},RPG:{type:"RPG",display_name:"RPG",definition:"Rebounds per game",format:l.StatFormat.FLOAT_PERCENTAGE},APG:{type:"APG",display_name:"APG",definition:"Assists per game",format:l.StatFormat.FLOAT_PERCENTAGE},SPG:{type:"SPG",display_name:"SPG",definition:"Steals per game",format:l.StatFormat.FLOAT_PERCENTAGE},BPG:{type:"BPG",display_name:"BPG",definition:"Blocks per game",format:l.StatFormat.FLOAT_PERCENTAGE},EFGP:{type:"eFG%",display_name:"eFG%",definition:"Effective field goal percentage",format:l.StatFormat.PERCENTAGE},TSP:{type:"TS%",display_name:"TS%",definition:"True shooting percentage",format:l.StatFormat.PERCENTAGE},AST2TO:{type:"AST/TO",display_name:"AST/TO",definition:"Assist to turnover ratio",format:l.StatFormat.FLOAT_PERCENTAGE}}}(Wo)),Wo}var ii={},cn={},$o={},wp;function si(){return wp||(wp=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.RUGBY_POINTS=n.RUGBY_CONFIGURATION=n.PlayCode=void 0;var l;(function(t){t.Try="try",t.Conversion="conversion",t.PenaltyGoal="penalty_goal",t.DropGoal="drop_goal"})(l=n.PlayCode||(n.PlayCode={})),n.RUGBY_CONFIGURATION={play_codes:Object.values(l)},n.RUGBY_POINTS={penalty_goal:3,drop_goal:3,conversion:2,try:5}}($o)),$o}var Vo={},Cp;function zo(){return Cp||(Cp=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.TeamPlayerStats=n.Stats=n.RugbyStat=void 0;var l=X,t=l.__importStar(fe()),p=l.__importStar(Ca()),d=$e(),y=Me(),s=si(),u;(function(e){e.T="T",e.C="C",e.PC="PC",e.DG="DG",e.GP="GP",e.PTS="PTS"})(u=n.RugbyStat||(n.RugbyStat={}));var h;(function(e){function i(){return Object.values(u)}e.values=i;function c(){return v(e.values().reduce(function(E,B){return E.set(B,0)},t.Map()))}e.empty=c;function f(E,B){if((0,y.isValidPlayCode)(B,s.RUGBY_CONFIGURATION.play_codes))return P(!0,E,B);p.unreachablePlayCode(B)}e.addPlay=f;function _(E,B){if((0,y.isValidPlayCode)(B,s.RUGBY_CONFIGURATION.play_codes))return P(!1,E,B);p.unreachablePlayCode(B)}e.removePlay=_;function S(E){switch(E){default:return}}e.averageKey=S;function P(E,B,b){return v(function(){switch(b){case s.PlayCode.Try:return I(E,B,u.T);case s.PlayCode.Conversion:return I(E,B,u.C);case s.PlayCode.PenaltyGoal:return I(E,B,u.PC);case s.PlayCode.DropGoal:return I(E,B,u.DG);default:p.unreachablePlayCode(b)}}())}function I(E,B){for(var b=[],R=2;R<arguments.length;R++)b[R-2]=arguments[R];return b.reduce(function(F,x){return F.updateIn([x],0,function(w){return E?++w:--w})},B)}})(h=n.Stats||(n.Stats={})),function(e){function i(F){var x=Object.entries(F).reduce(function(L,D){var U=D[0],G=D[1];return L.setIn([U],G.stats.offense[u.PTS])},t.Map.of()),w=e.fromTeamsStatDoc(F,!1);return e.toTeamsStatDoc(w,x)}e.getDerivedMultiGameStatsWithBaseStats=i;function c(F){return F.toJS().reduce(function(x,w){var L=t.Map().set(d.TOTAL,h.empty()).set(d.UNASSIGNED_PLAYER,h.empty());return x.set(w,L)},t.Map())}e.fromTeams=c;function f(F,x){return x.reduce(function(w,L,D){var U=F.getIn([D,d.TOTAL,u.PTS]),G=F.getIn([D,d.UNASSIGNED_PLAYER,u.PTS]),q=U-G,z=L-q,ne=F.setIn([D,d.TOTAL,u.PTS],L).setIn([D,d.UNASSIGNED_PLAYER,u.PTS],z);return w[D]=B(ne.get(D)),w},{})}e.toTeamsStatDoc=f;function _(F,x){return Object.entries(F).reduce(function(w,L){var D=L[0],U=L[1],G=U.stats,q=U.unassigned,z=U.players,ne=Object.entries(z).reduce(function(ue,ee){var $=ee[0],Y=ee[1];return ue.setIn([D,$],E(Y.stats,!!x))},w).setIn([D,d.TOTAL],E(G,!!x));return q?ne.setIn([D,d.UNASSIGNED_PLAYER],E(q.stats,!1)):ne},t.fromJS({}))}e.fromTeamsStatDoc=_;function S(F,x){return F.reduce(function(w,L,D){return w.setIn([D],P(F.get(D),x.get(D)))},t.Map())}e.subtract=S;function P(F,x){return F.reduce(function(w,L,D){return w.setIn([D],I(F.get(D),x.get(D,h.empty())))},t.Map())}function I(F,x){return r(F.reduce(function(w,L,D){return w.setIn([D],F.get(D)-x.get(D,0))},h.empty()),void 0)}function E(F,x){return r(t.fromJS(F.offense),x)}function B(F){return F.reduce(function(x,w,L){switch(L){case d.TOTAL:case d.UNASSIGNED_PLAYER:return x;default:return x.players[L]=b(w),x}},{players:{},unassigned:b(F.get(d.UNASSIGNED_PLAYER)),stats:R(F.get(d.TOTAL))})}function b(F){return{stats:R(F)}}function R(F){return{offense:F.toJS()}}}(n.TeamPlayerStats||(n.TeamPlayerStats={}));function v(e){return o(e,a,r)}function o(e){for(var i=[],c=1;c<arguments.length;c++)i[c-1]=arguments[c];return i.reduce(function(f,_){return _(f)},e)}function a(e){var i=function(f){return e.get(f,0)},c=i(u.T)*s.RUGBY_POINTS.try+i(u.C)*s.RUGBY_POINTS.conversion+i(u.DG)*s.RUGBY_POINTS.drop_goal+i(u.PC)*s.RUGBY_POINTS.penalty_goal;return e.setIn([u.PTS],c)}function r(e,i){var c=function(S){return e.get(S,0)},f=function(S,P){return c(S)/c(P)},_=e;return _=o(_),i?h.values().reduce(function(S,P){var I=h.averageKey(P);return I?S.setIn([I],f(P,u.GP)):S},_):_}}(Vo)),Vo}var Mp;function Cg(){if(Mp)return cn;Mp=1,Object.defineProperty(cn,"__esModule",{value:!0}),cn.BoxScoreEngine=cn.BoxScoreState=void 0;var n=X,l=n.__importStar(fe()),t=$e(),p=zi(),d=Me(),y=si(),s=zo(),u=function(v){n.__extends(o,v);function o(){return v!==null&&v.apply(this,arguments)||this}return Object.defineProperty(o.prototype,"stats",{get:function(){return s.TeamPlayerStats.toTeamsStatDoc(this.teamPlayerStats,this.teamPoints)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"teamPoints",{get:function(){return this.get("teamPoints")},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"teamPlayerStats",{get:function(){return this.get("stats")},enumerable:!1,configurable:!0}),o}(p.MultiSportBoxScoreState);cn.BoxScoreState=u;var h=function(v){n.__extends(o,v);function o(a,r,e){var i=v.call(this,a,r,e)||this;return i.baseEvents=a,i.score=r,i.activePlayerEngine=e,i}return o.prototype.initialState=function(){return new u(l.fromJS({teams:[],teamPoints:{},playForPlayer:{},startedPlayerCount:0,stats:l.Map()}))},o.prototype.processOneEvent=function(a,r){var e=this;switch(r.code){case d.MultiSportEventCode.SetTeams:return o.handleSetTeams(a,r);case d.MultiSportEventCode.Play:return(0,d.onValidPlayCode)(a,r,y.RUGBY_CONFIGURATION.play_codes,function(i,c){return e.handlePlay(i,c)});case d.MultiSportEventCode.AssignPlayer:return this.handleAssignPlayer(a,r);case d.MultiSportEventCode.AdjustScore:return this.handleScoreChange(a,r);case d.MultiSportEventCode.OverrideScore:return this.handleScoreChange(a,r);case d.MultiSportEventCode.ActivatePlayer:return o.handleActivatePlayer(a,r);default:return a}},o.handleSetTeams=function(a,r){var e=r.attributes,i=e.homeId,c=e.awayId;return a.setIn(["teamPoints",i],0).setIn(["teamPoints",c],0).setIn(["teams"],l.List.of(i,c)).setIn(["stats"],s.TeamPlayerStats.fromTeams(l.List.of(i,c))).updateIn(["stats",i,t.TOTAL],s.Stats.empty(),function(f){return f.setIn([s.RugbyStat.GP],1)}).updateIn(["stats",c,t.TOTAL],s.Stats.empty(),function(f){return f.setIn([s.RugbyStat.GP],1)})},o.prototype.handleScoreChange=function(a,r){var e=r.attributes.team_id,i=this.score.stateAfterEvent(this.nextEventOffset).scores[e];return a.setIn(["teamPoints",e],i)},o.handleActivatePlayer=function(a,r){var e=r.attributes,i=e.team_id,c=e.player_id;return o.markPlayerSeen(c,i,a)},o.prototype.determineEventPlayValue=function(a){switch(a.code){case d.MultiSportEventCode.Play:var r=a.attributes.play_code;switch(r){case y.PlayCode.Try:return y.RUGBY_POINTS.try;case y.PlayCode.Conversion:return y.RUGBY_POINTS.conversion;case y.PlayCode.PenaltyGoal:return y.RUGBY_POINTS.penalty_goal;case y.PlayCode.DropGoal:return y.RUGBY_POINTS.drop_goal;default:return 0}case d.MultiSportEventCode.AdjustScore:return a.attributes.adjustment;case d.MultiSportEventCode.OverrideScore:return a.attributes.points;default:return 0}},o.prototype.handlePlay=function(a,r){var e=r.attributes,i=e.team_id,c=e.play_code;return this.handleScoreChange(a.updateIn(["stats",i,t.UNASSIGNED_PLAYER],s.Stats.empty(),function(f){return s.Stats.addPlay(f,c)}).updateIn(["stats",i,t.TOTAL],s.Stats.empty(),function(f){return s.Stats.addPlay(f,c)}),r)},o.prototype.handleAssignPlayer=function(a,r){var e=r.attributes,i=e.play_event_id,c=e.player_id,f=this.baseEvents,_=a.getIn(["playForPlayer",i],t.UNASSIGNED_PLAYER),S=f[this.indexForEventId(i)]||f.slice(this.nextEventOffset).find(function(B){return B.id===i}),P=S.attributes,I=P.team_id,E=P.play_code;return(0,d.onValidPlayCode)(a,S,y.RUGBY_CONFIGURATION.play_codes,function(){return o.markPlayerSeen(c,I,a.setIn(["playForPlayer",i],c).updateIn(["stats",I,c],s.Stats.empty(),function(B){return s.Stats.addPlay(B,E)}).updateIn(["stats",I,_],s.Stats.empty(),function(B){return s.Stats.removePlay(B,E)}))})},o.markPlayerSeen=function(a,r,e){var i=["stats",r,a];return e.updateIn(i,s.Stats.empty(),function(c){return c.setIn([s.RugbyStat.GP],1)})},o}(p.MultiSportBoxScoreEngine);return cn.BoxScoreEngine=h,cn}var dn={},xp;function Mg(){if(xp)return dn;xp=1,Object.defineProperty(dn,"__esModule",{value:!0}),dn.PerPeriodBoxScoreEngine=dn.PeriodBoxScoreState=void 0;var n=X,l=n.__importStar(fe()),t=$e(),p=Me(),d=Ki(),y=zo(),s=function(h){n.__extends(v,h);function v(){return h!==null&&h.apply(this,arguments)||this}return Object.defineProperty(v.prototype,"periodStats",{get:function(){var o=this.get("statsPerPeriod");return o.reduce(function(a,r,e){var i=r.reduce(function(c,f,_){return c.setIn([_],f.getIn([t.TOTAL,y.RugbyStat.PTS]))},l.Map());return a[e]=y.TeamPlayerStats.toTeamsStatDoc(r,i),a},{})},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"lineScores",{get:function(){return Object.entries(this.periodStats).reduce(function(o,a){var r=a[0],e=a[1],i=parseInt(r,10),c=Object.entries(e).reduce(function(f,_){var S=_[0],P=_[1];return f[S]=P.stats.offense[y.RugbyStat.PTS],f},{});return Object.entries(c).reduce(function(f,_){var S=_[0],P=_[1],I=f.getIn([S],l.List());return I=I.insert(i,P),f.setIn([S],I)},o)},l.Map()).toJS()},enumerable:!1,configurable:!0}),v}(d.MultiSportPeriodBoxScoreState);dn.PeriodBoxScoreState=s;var u=function(h){n.__extends(v,h);function v(o,a,r){var e=h.call(this,o,a,r)||this;return e.baseEvents=o,e.period=a,e.stats=r,e}return v.prototype.initialState=function(){return new s(l.fromJS({statsPerPeriod:l.Map()}))},v.prototype.processOneEvent=function(o,a){switch(a.code){case p.MultiSportEventCode.Play:case p.MultiSportEventCode.SetTeams:case p.MultiSportEventCode.AssignPlayer:case p.MultiSportEventCode.AdjustScore:case p.MultiSportEventCode.OverrideScore:return this.handleStatsChange(o);default:return o}},v.prototype.handleStatsChange=function(o){var a;if(this.stats){var r=this.stats.stateAfterEvent(this.nextEventOffset),e=y.TeamPlayerStats.fromTeamsStatDoc(r.stats),i=this.period.stateAfterEvent(this.nextEventOffset),c=Math.max(1,i.period-(i.isActive?0:1)),f=(a=l.List).of.apply(a,e.keySeq().toArray()),_=function(E){return o.getIn(["statsPerPeriod",E],P)},S=Array.from({length:c},function(E,B){return++B}),P=y.TeamPlayerStats.fromTeams(f),I=c===1?e:S.slice(0,-1).reduce(function(E,B){return y.TeamPlayerStats.subtract(E,_(B))},e);return S.reduce(function(E,B){return E.updateIn(["statsPerPeriod",B],function(b){return B===c?I:b||P})},o)}else return o},v}(d.MultiSportPerPeriodBoxScoreEngine);return dn.PerPeriodBoxScoreEngine=u,dn}var oi={},Lp;function xg(){if(Lp)return oi;Lp=1,Object.defineProperty(oi,"__esModule",{value:!0}),oi.PlayByPlayEngine=void 0;var n=X,l=n.__importStar(fe()),t=kt(),p=si(),d=function(y){n.__extends(s,y);function s(){return y!==null&&y.apply(this,arguments)||this}return s.prototype.handlePlay=function(u,h){var v=this.period.stateBeforeEvent(this.nextEventOffset),o=u;if(v&&v.isActive===!1){var a=new t.PlayByPlayEntry(l.fromJS({template:"Start of period ".concat(v.period),id:"start_of_period_".concat(v.period),playByPlayType:t.PlayByPlayType.StartPeriod,period:v.period,playerAssignable:!1,teamAssignable:!1,deletable:!1,createdAt:h.createdAt}));o=o.pushEntry(a)}var r=h.attributes.play_code,e;if(r===p.PlayCode.Try||r===p.PlayCode.Conversion||r===p.PlayCode.PenaltyGoal||r===p.PlayCode.DropGoal){var i=this.score.stateAfterEvent(this.nextEventOffset);e=i==null?void 0:i.scoresImmutable}else e=void 0;var c=new t.PlayByPlayEntry(l.fromJS({template:"".concat(h.attributes.play_code," by ").concat(h.attributes.team_id),id:h.attributes.pbp_entry_id,playByPlayType:t.PlayByPlayType.Play,eventIds:[h.id],playCode:r,teamId:h.attributes.team_id,period:v.period,teamScores:e,playerAssignable:!0,teamAssignable:!0,deletable:!0,createdAt:h.createdAt}));return o.pushEntry(c)},s}(t.MultiSportPlayByPlayEngine);return oi.PlayByPlayEngine=d,oi}var ui={},Dp;function Lg(){if(Dp)return ui;Dp=1,Object.defineProperty(ui,"__esModule",{value:!0}),ui.ScoreEngine=void 0;var n=X,l=bn(),t=si(),p=function(d){n.__extends(y,d);function y(){return d!==null&&d.apply(this,arguments)||this}return y.prototype.handlePlay=function(s,u){var h=u.attributes.play_code,v=u.attributes.team_id;switch(h){case t.PlayCode.Try:return s.incrementScore(v,t.RUGBY_POINTS.try);case t.PlayCode.Conversion:return s.incrementScore(v,t.RUGBY_POINTS.conversion);case t.PlayCode.PenaltyGoal:return s.incrementScore(v,t.RUGBY_POINTS.penalty_goal);case t.PlayCode.DropGoal:return s.incrementScore(v,t.RUGBY_POINTS.drop_goal);default:return s}},y}(l.MultiSportScoreEngine);return ui.ScoreEngine=p,ui}var Gp;function Dg(){if(Gp)return ii;Gp=1,Object.defineProperty(ii,"__esModule",{value:!0}),ii.RugbyCompactorController=void 0;var n=X,l=Or(),t=ja(),p=qa(),d=Ua(),y=Cg(),s=si(),u=Wa(),h=Mg(),v=xg(),o=Lg(),a=zo(),r=Ka(),e=function(i){n.__extends(c,i);function c(){var f=i.call(this)||this;f.stateAccessorClass=r.SharedStateAccessor,f.activePlayer=new d.MultiSportActivePlayerEngine([],s.RUGBY_CONFIGURATION),f.period=new u.MultiSportPeriodEngine([],s.RUGBY_CONFIGURATION),f.score=new o.ScoreEngine([],s.RUGBY_CONFIGURATION),f.stats=new y.BoxScoreEngine([],f.score,f.activePlayer),f.playByPlay=new v.PlayByPlayEngine([],s.RUGBY_CONFIGURATION,f.activePlayer,f.period,f.score),f.lineScore=new p.LinescoreEngine([],f.period,f.score,s.RUGBY_CONFIGURATION),f.statsPerPeriod=new h.PerPeriodBoxScoreEngine([],f.period,f.stats),f.engines=[f.activePlayer,f.period,f.score,f.playByPlay,f.lineScore,f.statsPerPeriod,f.stats],f.compactor=new l.SabertoothEventCompactor;for(var _=0,S=f.engines;_<S.length;_++){var P=S[_];P.baseEvents=f.compactor.outStream}return f}return c.prototype.getDerivedMultiGameStatsWithBaseStats=function(f){return a.TeamPlayerStats.getDerivedMultiGameStatsWithBaseStats(f)},c.prototype.processVoiceEvents=function(f,_){throw new Error("Voice Scoring not supported by this sport")},c.prototype.announcements=function(f){throw new Error("Announcements not supported by this sport")},c}(t.MultiSportCompactorController);return ii.RugbyCompactorController=e,ii}var li={},fn={},Ko={},Jo={},Hp;function En(){return Hp||(Hp=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.ServeOutcome=n.VOLLEYBALL_CONFIGURATION=n.PlayCode=void 0;var l;(function(t){t.Point="point",t.Serve="serve"})(l=n.PlayCode||(n.PlayCode={})),n.VOLLEYBALL_CONFIGURATION={play_codes:Object.values(l)},function(t){t.In="in",t.Ace="ace",t.Error="error"}(n.ServeOutcome||(n.ServeOutcome={}))}(Jo)),Jo}var Np;function Yo(){return Np||(Np=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.TeamPlayerStats=n.Stats=n.VolleyballStat=void 0;var l=X,t=l.__importStar(fe()),p=l.__importStar(Ca()),d=$e(),y=Me(),s=En(),u;(function(c){c.PTS="PTS",c.GP="GP",c.SH="SH",c.SA="SA",c.A="A",c.SE="SE",c.AP="A%"})(u=n.VolleyballStat||(n.VolleyballStat={}));var h=Object.values(s.ServeOutcome),v;(function(c){function f(){return Object.values(u)}c.values=f;function _(){return o(c.values().reduce(function(F,x){return F.set(x,0)},t.Map()))}c.empty=_;function S(F,x){if((0,y.isValidPlayCode)(x,s.VOLLEYBALL_CONFIGURATION.play_codes))return B(!0,F,x);p.unreachablePlayCode(x)}c.addPlay=S;function P(F,x){return(0,y.isValidPlayCode)(x,h)?b(!0,F,x):F}c.addServeOutcome=P;function I(F,x){if((0,y.isValidPlayCode)(x,s.VOLLEYBALL_CONFIGURATION.play_codes))return B(!1,F,x);p.unreachablePlayCode(x)}c.removePlay=I;function E(F){switch(F){default:return}}c.averageKey=E;function B(F,x,w){return o(function(){switch(w){case s.PlayCode.Point:return R(F,x,u.SH);default:return x}}())}function b(F,x,w){return o(function(){switch(w){case s.ServeOutcome.In:return R(F,x,u.SA);case s.ServeOutcome.Ace:return R(F,x,u.SA,u.A);case s.ServeOutcome.Error:return R(F,x,u.SA,u.SE);default:return x}}())}function R(F,x){for(var w=[],L=2;L<arguments.length;L++)w[L-2]=arguments[L];return w.reduce(function(D,U){return D.updateIn([U],0,function(G){return F?++G:--G})},x)}})(v=n.Stats||(n.Stats={})),function(c){function f(w){var L=Object.entries(w).reduce(function(U,G){var q=G[0],z=G[1];return U.setIn([q],z.stats.offense[u.PTS])},t.Map.of()),D=c.fromTeamsStatDoc(w,!1);return c.toTeamsStatDoc(D,L)}c.getDerivedMultiGameStatsWithBaseStats=f;function _(w){return w.toJS().reduce(function(L,D){var U=t.Map().set(d.TOTAL,v.empty()).set(d.UNASSIGNED_PLAYER,v.empty());return L.set(D,U)},t.Map())}c.fromTeams=_;function S(w,L){return L.reduce(function(D,U,G){var q=w.getIn([G,d.TOTAL,u.PTS]),z=w.getIn([G,d.UNASSIGNED_PLAYER,u.PTS]),ne=w.setIn([G,d.TOTAL,u.PTS],q).setIn([G,d.UNASSIGNED_PLAYER,u.PTS],z);return D[G]=R(ne.get(G)),D},{})}c.toTeamsStatDoc=S;function P(w,L){return Object.entries(w).reduce(function(D,U){var G=U[0],q=U[1],z=q.stats,ne=q.unassigned,ue=q.players,ee=Object.entries(ue).reduce(function($,Y){var W=Y[0],J=Y[1];return $.setIn([G,W],b(J.stats,!!L))},D).setIn([G,d.TOTAL],b(z,!!L));return ne?ee.setIn([G,d.UNASSIGNED_PLAYER],b(ne.stats,!1)):ee},t.fromJS({}))}c.fromTeamsStatDoc=P;function I(w,L){return w.reduce(function(D,U,G){return D.setIn([G],E(w.get(G),L.get(G)))},t.Map())}c.subtract=I;function E(w,L){return w.reduce(function(D,U,G){return D.setIn([G],B(w.get(G),L.get(G,v.empty())))},t.Map())}function B(w,L){return i(w.reduce(function(D,U,G){return D.setIn([G],w.get(G)-L.get(G,0))},v.empty()),void 0)}function b(w,L){return i(t.fromJS(w.offense),L)}function R(w){return w.reduce(function(L,D,U){switch(U){case d.TOTAL:case d.UNASSIGNED_PLAYER:return L;default:return L.players[U]=F(D),L}},{players:{},unassigned:F(w.get(d.UNASSIGNED_PLAYER)),stats:x(w.get(d.TOTAL))})}function F(w){return{stats:x(w)}}function x(w){return{offense:w.toJS()}}}(n.TeamPlayerStats||(n.TeamPlayerStats={}));function o(c){return a(c,r,i)}function a(c){for(var f=[],_=1;_<arguments.length;_++)f[_-1]=arguments[_];return f.reduce(function(S,P){return P(S)},c)}function r(c){var f=function(S){return c.get(S,0)},_=f(u.SH);return c.setIn([u.PTS],_)}function e(c){var f=function(S){return c.get(S,0)},_=function(S,P){return f(S)/f(P)};return c.setIn([u.AP],_(u.A,u.SA))}function i(c,f){var _=function(I){return c.get(I,0)},S=function(I,E){return _(I)/_(E)},P=c;return P=a(P,e),f?v.values().reduce(function(I,E){var B=v.averageKey(E);return B?I.setIn([B],S(E,u.GP)):I},P):P}}(Ko)),Ko}var jp;function Gg(){if(jp)return fn;jp=1,Object.defineProperty(fn,"__esModule",{value:!0}),fn.BoxScoreEngine=fn.BoxScoreState=void 0;var n=X,l=n.__importStar(fe()),t=$e(),p=zi(),d=Me(),y=Yo(),s=En(),u=function(v){n.__extends(o,v);function o(){return v!==null&&v.apply(this,arguments)||this}return Object.defineProperty(o.prototype,"stats",{get:function(){return y.TeamPlayerStats.toTeamsStatDoc(this.teamPlayerStats,this.teamPoints)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"teamPoints",{get:function(){return this.get("teamPoints")},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"teamPlayerStats",{get:function(){return this.get("stats")},enumerable:!1,configurable:!0}),o}(p.MultiSportBoxScoreState);fn.BoxScoreState=u;var h=function(v){n.__extends(o,v);function o(a,r,e,i){var c=v.call(this,a,r,e)||this;return c.baseEvents=a,c.score=r,c.activePlayerEngine=e,c.servingEngine=i,c}return o.prototype.initialState=function(){return new u(l.fromJS({teams:[],teamPoints:{},playForPlayer:{},startedPlayerCount:0,stats:l.Map()}))},o.prototype.processOneEvent=function(a,r){var e=this;switch(r.code){case d.MultiSportEventCode.SetTeams:return o.handleSetTeams(a,r);case d.MultiSportEventCode.Play:return(0,d.onValidPlayCode)(a,r,s.VOLLEYBALL_CONFIGURATION.play_codes,function(i,c){return e.handlePlay(i,c)});case d.MultiSportEventCode.AssignPlayer:return this.handleAssignPlayer(a,r);case d.MultiSportEventCode.SetServer:return this.handleSetServer(a,r);case d.MultiSportEventCode.AdjustScore:return this.handleScoreChange(a,r);case d.MultiSportEventCode.OverrideScore:return this.handleScoreChange(a,r);case d.MultiSportEventCode.ActivatePlayer:return o.handleActivatePlayer(a,r);default:return a}},o.handleSetTeams=function(a,r){var e=r.attributes,i=e.homeId,c=e.awayId;return a.setIn(["teamPoints",i],0).setIn(["teamPoints",c],0).setIn(["teams"],l.List.of(i,c)).setIn(["stats"],y.TeamPlayerStats.fromTeams(l.List.of(i,c))).updateIn(["stats",i,t.TOTAL],y.Stats.empty(),function(f){return f.setIn([y.VolleyballStat.GP],1)}).updateIn(["stats",c,t.TOTAL],y.Stats.empty(),function(f){return f.setIn([y.VolleyballStat.GP],1)})},o.prototype.handleScoreChange=function(a,r){var e=r.attributes.team_id,i=this.score.stateAfterEvent(this.nextEventOffset).scores[e];return a.setIn(["teamPoints",e],i)},o.handleActivatePlayer=function(a,r){var e=r.attributes,i=e.team_id,c=e.player_id;return o.markPlayerSeen(c,i,a)},o.prototype.determineEventPlayValue=function(a){switch(a.code){case d.MultiSportEventCode.Play:var r=a.attributes.play_code;switch(r){case s.PlayCode.Point:return 1;default:return 0}case d.MultiSportEventCode.AdjustScore:return a.attributes.adjustment;case d.MultiSportEventCode.OverrideScore:return a.attributes.points;default:return 0}},o.prototype.handlePlay=function(a,r){var e,i,c,f,_,S,P,I=r.attributes,E=I.team_id,B=I.play_code,b=I.play_details,R=(e=b==null?void 0:b.serving_team_id)!==null&&e!==void 0?e:E,F=this.handleScoreChange(a.updateIn(["stats",R,t.TOTAL],y.Stats.empty(),function(L){return y.Stats.addPlay(L,B)}),r);if(B===s.PlayCode.Serve){var x=(S=(f=(c=(i=this.servingEngine.stateBeforeEventId(r.id))===null||i===void 0?void 0:i.servingInfo)===null||c===void 0?void 0:c.playerId)!==null&&f!==void 0?f:(_=this.lastSetServerEvent)===null||_===void 0?void 0:_.attributes.player_id)!==null&&S!==void 0?S:t.UNASSIGNED_PLAYER,w=(P=b==null?void 0:b.serve_outcome)!==null&&P!==void 0?P:s.ServeOutcome.In;return x!==t.UNASSIGNED_PLAYER&&(F=o.markPlayerSeen(x,E,F)),F.updateIn(["stats",R,x],y.Stats.empty(),function(L){return y.Stats.addServeOutcome(L,w)}).updateIn(["stats",R,t.TOTAL],y.Stats.empty(),function(L){return y.Stats.addServeOutcome(L,w)})}else return F},o.prototype.handleSetServer=function(a,r){return this.lastSetServerEvent=r,a},o.prototype.handleAssignPlayer=function(a,r){var e=r.attributes,i=e.play_event_id,c=e.player_id,f=this.baseEvents,_=a.getIn(["playForPlayer",i],t.UNASSIGNED_PLAYER),S=f[this.indexForEventId(i)]||f.slice(this.nextEventOffset).find(function(B){return B.id===i}),P=S.attributes,I=P.team_id,E=P.play_code;return(0,d.onValidPlayCode)(a,S,s.VOLLEYBALL_CONFIGURATION.play_codes,function(){return o.markPlayerSeen(c,I,a.setIn(["playForPlayer",i],c).updateIn(["stats",I,c],y.Stats.empty(),function(B){return y.Stats.addPlay(B,E)}).updateIn(["stats",I,_],y.Stats.empty(),function(B){return y.Stats.removePlay(B,E)}))})},o.markPlayerSeen=function(a,r,e){var i=["stats",r,a];return e.updateIn(i,y.Stats.empty(),function(c){return c.setIn([y.VolleyballStat.GP],1)})},o}(p.MultiSportBoxScoreEngine);return fn.BoxScoreEngine=h,fn}var pn={},qp;function Hg(){if(qp)return pn;qp=1,Object.defineProperty(pn,"__esModule",{value:!0}),pn.PerPeriodBoxScoreEngine=pn.PeriodBoxScoreState=void 0;var n=X,l=n.__importStar(fe()),t=$e(),p=Yo(),d=Ki(),y=Me(),s=function(h){n.__extends(v,h);function v(){return h!==null&&h.apply(this,arguments)||this}return Object.defineProperty(v.prototype,"periodStats",{get:function(){var o=this.get("statsPerPeriod");return o.reduce(function(a,r,e){var i=r.reduce(function(c,f,_){return c.setIn([_],f.getIn([t.TOTAL,p.VolleyballStat.PTS]))},l.Map());return a[e]=p.TeamPlayerStats.toTeamsStatDoc(r,i),a},{})},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"lineScores",{get:function(){return Object.entries(this.periodStats).reduce(function(o,a){var r=a[0],e=a[1],i=parseInt(r,10),c=Object.entries(e).reduce(function(f,_){var S=_[0],P=_[1];return f[S]=P.stats.offense[p.VolleyballStat.PTS],f},{});return Object.entries(c).reduce(function(f,_){var S=_[0],P=_[1],I=f.getIn([S],l.List());return I=I.insert(i,P),f.setIn([S],I)},o)},l.Map()).toJS()},enumerable:!1,configurable:!0}),v}(d.MultiSportPeriodBoxScoreState);pn.PeriodBoxScoreState=s;var u=function(h){n.__extends(v,h);function v(o,a,r){var e=h.call(this,o,a,r)||this;return e.baseEvents=o,e.period=a,e.stats=r,e}return v.prototype.initialState=function(){return new s(l.fromJS({statsPerPeriod:l.Map()}))},v.prototype.processOneEvent=function(o,a){switch(a.code){case y.MultiSportEventCode.Play:case y.MultiSportEventCode.SetTeams:case y.MultiSportEventCode.AssignPlayer:case y.MultiSportEventCode.AdjustScore:case y.MultiSportEventCode.OverrideScore:return this.handleStatsChange(o);default:return o}},v.prototype.handleStatsChange=function(o){var a;if(this.stats){var r=this.stats.stateAfterEvent(this.nextEventOffset),e=p.TeamPlayerStats.fromTeamsStatDoc(r.stats),i=this.period.stateAfterEvent(this.nextEventOffset),c=Math.max(1,i.period-(i.isActive?0:1)),f=(a=l.List).of.apply(a,e.keySeq().toArray()),_=function(E){return o.getIn(["statsPerPeriod",E],P)},S=Array.from({length:c},function(E,B){return++B}),P=p.TeamPlayerStats.fromTeams(f),I=c===1?e:S.slice(0,-1).reduce(function(E,B){return p.TeamPlayerStats.subtract(E,_(B))},e);return S.reduce(function(E,B){return E.updateIn(["statsPerPeriod",B],function(b){return B===c?I:b||P})},o)}else return o},v}(d.MultiSportPerPeriodBoxScoreEngine);return pn.PerPeriodBoxScoreEngine=u,pn}var ci={},Up;function Ng(){if(Up)return ci;Up=1,Object.defineProperty(ci,"__esModule",{value:!0}),ci.PlayByPlayEngine=void 0;var n=X,l=n.__importStar(fe()),t=kt(),p=En(),d=function(y){n.__extends(s,y);function s(u,h,v,o,a,r,e,i){var c=y.call(this,u,h,o,a,r,i)||this;return c.baseEvents=u,c.configuration=h,c.setScoreEngine=v,c.activePlayer=o,c.period=a,c.score=r,c.servingEngine=e,c.stats=i,c}return s.prototype.handleBeginPlay=function(u,h){var v=new t.PlayByPlayEntry(l.fromJS({template:"Begin Play",id:"begin_play",playByPlayType:t.PlayByPlayType.BeginPlay,eventIds:[h.id],playerAssignable:!1,teamAssignable:!1,deletable:!0}));return u=u.pushInProgressEntry(v),u.setInProgress(!0)},s.prototype.handleEndPlay=function(u,h){var v=u.setInProgress(!1),o=v.inProgressEntries;if(o.isEmpty())return v;var a=o.reduce(function(e,i){var c,f=e;switch(i==null?void 0:i.playCode){case p.PlayCode.Point:switch(f.playCode){case p.PlayCode.Serve:if(f.playDetails){var _=f.playDetails.get("serve_outcome"),S={serve_outcome:_??"",serving_team_id:(c=f==null?void 0:f.teamId)!==null&&c!==void 0?c:""};return i.setIn(["playDetails"],S).setIn(["playerId"],f.playerId).setIn(["template"],"Serve ".concat(_," by ").concat(f.teamId,", Point by ").concat(i.teamId))}else return i;default:return i}default:return i}}),r=[];return o.map(function(e){var i,c;return r.push.apply(r,(c=(i=e==null?void 0:e.eventIds)===null||i===void 0?void 0:i.toArray())!==null&&c!==void 0?c:[])}),r.push.apply(r,[h.id]),a=a==null?void 0:a.setIn(["eventIds"],l.List(r)),v=v.clearInProgressEntries(),v.pushEntry(a)},s.prototype.handlePlay=function(u,h){var v=this.period.stateBeforeEvent(this.nextEventOffset),o=u;if(v&&!v.isActive){var a=new t.PlayByPlayEntry(l.fromJS({template:"Start of period ".concat(v.period),id:"start_of_period_".concat(v.period),playByPlayType:t.PlayByPlayType.StartPeriod,period:v.period,playerAssignable:!1,teamAssignable:!1,deletable:!1,createdAt:h.createdAt}));o=o.pushEntry(a)}var r,e;switch(h.attributes.play_code){case p.PlayCode.Point:r=this.setScoreEngine.stateAfterEvent(this.nextEventOffset).scoresImmutable;break;case p.PlayCode.Serve:e=this.servingEngine.stateBeforeEvent(this.nextEventOffset).servingInfo.playerId;break}var i=new t.PlayByPlayEntry(l.fromJS({template:"".concat(h.attributes.play_code," by ").concat(e??h.attributes.team_id),id:h.attributes.pbp_entry_id,playByPlayType:t.PlayByPlayType.Play,eventIds:[h.id],playCode:h.attributes.play_code,teamId:h.attributes.team_id,period:v.period,playerId:e,periodScores:r,playerAssignable:!0,teamAssignable:!0,deletable:!0,createdAt:h.createdAt,playDetails:h.attributes.play_details,initialState:{servingTeamId:this.servingEngine.stateBeforeEvent(this.nextEventOffset).servingInfo.teamId}}));return o.isInProgress?o.pushInProgressEntry(i):o.pushEntry(i)},s.prototype.handleAdjustScore=function(u,h){var v=h.attributes.team_id,o=h.attributes.adjustment,a=this.score.stateAfterEvent(this.nextEventOffset),r=this.setScoreEngine.stateAfterEvent(this.nextEventOffset),e=this.period.stateBeforeEvent(this.nextEventOffset),i=new t.PlayByPlayEntry(l.fromJS({template:"Score adjusted: ".concat(o," for ").concat(v),id:h.attributes.pbp_entry_id,playByPlayType:t.PlayByPlayType.ScoreAdjustment,eventIds:[h.id],teamId:v,period:e==null?void 0:e.period,teamScores:a==null?void 0:a.scoresImmutable,periodScores:r==null?void 0:r.scoresImmutable,scoreAdjustment:o,playerAssignable:!1,teamAssignable:!0,deletable:!0,createdAt:h.createdAt}));return u.pushEntry(i)},s.prototype.handleEndPeriod=function(u,h){var v=this.period.stateBeforeEvent(this.nextEventOffset),o=this.score.stateAfterEvent(this.nextEventOffset),a=this.setScoreEngine.stateBeforeEvent(this.nextEventOffset),r=new t.PlayByPlayEntry(l.fromJS({template:"End of period ".concat(v==null?void 0:v.period),id:"end_of_period_".concat(v==null?void 0:v.period),playByPlayType:t.PlayByPlayType.EndPeriod,eventIds:[h.id],period:v==null?void 0:v.period,teamScores:o==null?void 0:o.scoresImmutable,periodScores:a==null?void 0:a.scoresImmutable,playerAssignable:!1,teamAssignable:!1,deletable:!0,createdAt:h.createdAt}));return u.pushEntry(r)},s}(t.MultiSportPlayByPlayEngine);return ci.PlayByPlayEngine=d,ci}var di={},Wp;function jg(){if(Wp)return di;Wp=1,Object.defineProperty(di,"__esModule",{value:!0}),di.MatchScoreEngine=void 0;var n=X,l=bn(),t=function(p){n.__extends(d,p);function d(y,s,u){var h=p.call(this,y,s)||this;return h.baseEvents=y,h.setScoreEngine=u,h}return d.prototype.handlePlay=function(y,s){return y},d.prototype.handleEndPeriod=function(y){var s=y.homeId,u=y.awayId,h=this.setScoreEngine.stateBeforeEvent(this.nextEventOffset).scores,v=h[u],o=h[s];if(o===v)return y;var a=o>v?s:u;return y.incrementScore(a,1)},d}(l.MultiSportScoreEngine);return di.MatchScoreEngine=t,di}var fi={},$p;function qg(){if($p)return fi;$p=1,Object.defineProperty(fi,"__esModule",{value:!0}),fi.VolleyballLineScoreEngine=void 0;var n=X,l=qa(),t=function(p){n.__extends(d,p);function d(y,s,u,h,v){var o=p.call(this,y,s,u,v)||this;return o.baseEvents=y,o.period=s,o.score=u,o.setScore=h,o}return d.prototype.update=function(y){var s=this.period.stateAfterEvent(this.nextEventOffset),u=s.period-(s.isActive?0:1),h=this.setScore.stateAfterEvent(this.nextEventOffset),v=h.awayId,o=h.homeId,a=h.scores,r=a[o],e=a[v];return y.updateIn(["lineScores",o],(0,l.pushInLinescore)(u,r)).updateIn(["lineScores",v],(0,l.pushInLinescore)(u,e))},d}(l.LinescoreEngine);return fi.VolleyballLineScoreEngine=t,fi}var pi={},hi={},Vp;function Ug(){if(Vp)return hi;Vp=1,Object.defineProperty(hi,"__esModule",{value:!0}),hi.MultiSportPeriodScoreEngine=void 0;var n=X,l=bn(),t=function(p){n.__extends(d,p);function d(){return p!==null&&p.apply(this,arguments)||this}return d.prototype.handleEndPeriod=function(y){return y.resetScores()},d}(l.MultiSportScoreEngine);return hi.MultiSportPeriodScoreEngine=t,hi}var zp;function Wg(){if(zp)return pi;zp=1,Object.defineProperty(pi,"__esModule",{value:!0}),pi.SetScoreEngine=void 0;var n=X,l=En(),t=Ug(),p=function(d){n.__extends(y,d);function y(){return d!==null&&d.apply(this,arguments)||this}return y.prototype.handlePlay=function(s,u){var h=u.attributes.play_code,v=u.attributes.team_id;switch(h){case l.PlayCode.Point:return s.incrementScore(v,1);default:return s}},y}(t.MultiSportPeriodScoreEngine);return pi.SetScoreEngine=p,pi}var yi={},Kp;function $g(){if(Kp)return yi;Kp=1,Object.defineProperty(yi,"__esModule",{value:!0}),yi.VolleyballStateAccessor=void 0;var n=X,l=Ka(),t=function(p){n.__extends(d,p);function d(y,s){var u=p.call(this,y,s)||this;return u.controller=s,u}return Object.defineProperty(d.prototype,"setScores",{get:function(){return this.get("scores",this.controller.setScoreEngine)},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"servingInfo",{get:function(){return this.get("servingInfo",this.controller.servingEngine)},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"scorekeepingState",{get:function(){return n.__assign(n.__assign({},p.prototype.getScorekeepingState.call(this)),{gameSituation:this.currentGameSituation})},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"currentGameSituation",{get:function(){return n.__assign(n.__assign({},p.prototype.getCurrentGameSituation.call(this)),{setScores:this.setScores,servingInfo:this.servingInfo})},enumerable:!1,configurable:!0}),d}(l.SharedStateAccessor);return yi.VolleyballStateAccessor=t,yi}var hn={},Jp;function Vg(){if(Jp)return hn;Jp=1,Object.defineProperty(hn,"__esModule",{value:!0}),hn.ServingEngine=hn.ServingState=void 0;var n=X,l=n.__importStar(fe()),t=n.__importStar(Ee()),p=n.__importStar(Oe()),d=Me(),y=En(),s=function(h){n.__extends(v,h);function v(){return h!==null&&h.apply(this,arguments)||this}return Object.defineProperty(v.prototype,"servingInfoImmutable",{get:function(){return this.get("servingInfo")},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"homeId",{get:function(){return this.get("homeId")},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"awayId",{get:function(){return this.get("awayId")},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"servingInfo",{get:function(){return this.servingInfoImmutable},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"teamId",{get:function(){return this.servingInfo.teamId},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"playerId",{get:function(){return this.servingInfo.playerId},enumerable:!1,configurable:!0}),v.prototype.setServingTeam=function(o){return this.teamId===o?this:this.set("servingInfo",{teamId:o,playerId:void 0,assignLater:!1})},v.prototype.setServingPlayer=function(o,a){return this.set("servingInfo",{teamId:this.teamId,playerId:o,assignLater:a})},v.prototype.switchTeams=function(){return this.teamId===this.homeId?this.setServingTeam(this.awayId):this.teamId===this.awayId?this.setServingTeam(this.homeId):this},v}(p.ImmutableState);hn.ServingState=s;var u=function(h){n.__extends(v,h);function v(o){var a=h.call(this,o)||this;return a.baseEvents=o,a}return v.prototype.initialState=function(){return new s(l.fromJS({servingInfo:{}}))},v.prototype.processOneEvent=function(o,a){var r=this;switch(a.code){case d.MultiSportEventCode.SetTeams:return this.handleSetTeams(o,a);case d.MultiSportEventCode.Play:return(0,d.onValidPlayCode)(o,a,y.VOLLEYBALL_CONFIGURATION.play_codes,function(e,i){return r.handlePlay(e,i)});case d.MultiSportEventCode.SetServer:return this.handleSetServer(o,a);case d.MultiSportEventCode.EndPeriod:return this.handleEndPeriod(o);default:return o}},v.prototype.handleSetTeams=function(o,a){var r=a.attributes.homeId,e=a.attributes.awayId;return o.set("homeId",r).set("awayId",e).setServingTeam(r)},v.prototype.handleSetServer=function(o,a){var r=a.attributes.team_id,e=a.attributes.player_id,i=a.attributes.assign_later;return o.setServingTeam(r).setServingPlayer(e,i)},v.prototype.handlePlay=function(o,a){var r=a.attributes.team_id,e=a.attributes.play_code;switch(e){case y.PlayCode.Point:return o.setServingTeam(r);default:return o}},v.prototype.handleEndPeriod=function(o){return o.switchTeams()},v}(t.VersionedStateEngine);return hn.ServingEngine=u,hn}var vi={},yn={},Yp;function zg(){if(Yp)return yn;Yp=1,Object.defineProperty(yn,"__esModule",{value:!0}),yn.makeServe=yn.makeSetServer=void 0;var n=Ge(),l=Me();function t(d){var y=d.teamId,s=d.playerId,u=d.assignLater,h=u===void 0?!1:u,v=d.pbpEntryId,o=d.createdAt,a=o===void 0?void 0:o;return{id:(0,n.uuid4)(),code:l.MultiSportEventCode.SetServer,createdAt:a,attributes:{pbp_entry_id:v||(0,n.uuid4)(),team_id:y,player_id:s,assign_later:h},compactorAttributes:{stream:"main"}}}yn.makeSetServer=t;function p(d){var y=d.teamId,s=d.pbpEntryId,u=d.serveOutcome,h=d.id,v=h===void 0?void 0:h,o=d.createdAt,a=o===void 0?void 0:o;return{id:v??(0,n.uuid4)(),code:l.MultiSportEventCode.Play,createdAt:a,attributes:{pbp_entry_id:s||(0,n.uuid4)(),team_id:y,play_code:"serve",play_details:{serve_outcome:u}},compactorAttributes:{stream:"main"}}}return yn.makeServe=p,yn}var Qp;function Kg(){if(Qp)return vi;Qp=1,Object.defineProperty(vi,"__esModule",{value:!0}),vi.makeMetaEventToSetServer=void 0;var n=kt(),l=Ge(),t=zg();function p(d,y,s){if(d.eventIds===void 0||d.eventIds.size===0)throw new Error("entry is missing eventIds");if(!d.eventIds.contains(s))throw new Error("entry doesn't contains the beforeId");if(d.teamId===void 0)throw new Error("entry is missing teamId");if(d.playByPlayType!==n.PlayByPlayType.Play)throw new Error("entry is wrong play type ".concat(d.playByPlayType));var u;return d.playDetails&&d.playDetails.serving_team_id?u=d.playDetails.serving_team_id:u=d.teamId,{id:(0,l.uuid4)(),code:"insert",beforeId:s,events:[(0,t.makeSetServer)({teamId:u,playerId:y,assignLater:!1,createdAt:d.createdAt})]}}return vi.makeMetaEventToSetServer=p,vi}var Xp;function Jg(){if(Xp)return li;Xp=1,Object.defineProperty(li,"__esModule",{value:!0}),li.VolleyballCompactorController=void 0;var n=X,l=Or(),t=Ua(),p=Gg(),d=En(),y=Wa(),s=Hg(),u=Ng(),h=jg(),v=Yo(),o=qg(),a=Wg(),r=$g(),e=Vg(),i=ja(),c=Kg(),f=kt(),_=function(S){n.__extends(P,S);function P(){var I=S.call(this)||this;I.stateAccessorClass=r.VolleyballStateAccessor,I.activePlayer=new t.MultiSportActivePlayerEngine([],d.VOLLEYBALL_CONFIGURATION),I.period=new y.MultiSportPeriodEngine([],d.VOLLEYBALL_CONFIGURATION),I.setScoreEngine=new a.SetScoreEngine([],d.VOLLEYBALL_CONFIGURATION),I.score=new h.MatchScoreEngine([],d.VOLLEYBALL_CONFIGURATION,I.setScoreEngine),I.servingEngine=new e.ServingEngine([]),I.stats=new p.BoxScoreEngine([],I.score,I.activePlayer,I.servingEngine),I.playByPlay=new u.PlayByPlayEngine([],d.VOLLEYBALL_CONFIGURATION,I.setScoreEngine,I.activePlayer,I.period,I.score,I.servingEngine,I.stats),I.lineScore=new o.VolleyballLineScoreEngine([],I.period,I.score,I.setScoreEngine,d.VOLLEYBALL_CONFIGURATION),I.statsPerPeriod=new s.PerPeriodBoxScoreEngine([],I.period,I.stats),I.engines=[I.activePlayer,I.period,I.setScoreEngine,I.score,I.playByPlay,I.lineScore,I.statsPerPeriod,I.stats,I.servingEngine],I.compactor=new l.SabertoothEventCompactor;for(var E=0,B=I.engines;E<B.length;E++){var b=B[E];b.baseEvents=I.compactor.outStream}return I}return P.prototype.getDerivedMultiGameStatsWithBaseStats=function(I){return v.TeamPlayerStats.getDerivedMultiGameStatsWithBaseStats(I)},P.prototype.processVoiceEvents=function(I,E){throw new Error("Voice Scoring not supported by this sport")},P.prototype.getMetaEventToChangePlayer=function(I,E){var B=this.playByPlay.currentState.entryForEventId(I);if(B!==void 0){var b=B.entry;return b.playByPlayType===f.PlayByPlayType.Play&&(b.playCode===d.PlayCode.Serve||b.playDetails&&b.playDetails.serve_outcome)?(0,c.makeMetaEventToSetServer)(b,E,I):S.prototype.getMetaEventToChangePlayer.call(this,I,E)}},P.prototype.getMetaEventToUnassignPlayer=function(I){var E=this.playByPlay.currentState.entryForEventId(I);if(E!==void 0){var B=E.entry;return B.playByPlayType===f.PlayByPlayType.Play&&(B.playCode===d.PlayCode.Serve||B.playDetails&&B.playDetails.serve_outcome)?(0,c.makeMetaEventToSetServer)(B,void 0,I):S.prototype.getMetaEventToUnassignPlayer.call(this,I)}},P.prototype.announcements=function(I){throw new Error("Announcements not supported by this sport")},P}(i.MultiSportCompactorController);return li.VolleyballCompactorController=_,li}Object.defineProperty(Mn,"__esModule",{value:!0}),Mn.controllers=void 0;var Yg=X,Zp=Yg.__importStar(Tv()),Qg=Lv(),Xg=jv(),Zg=Jv(),e_=eg(),t_=kg(),r_=wg(),n_=Dg(),a_=Jg();Mn.controllers={baseball:{usingTranscoder:Zp.BaseballTranscoderController,usingCompactor:Zp.BaseballCompactorController},basketball:{usingCompactor:Qg.BasketballCompactorController,usingPassthrough:Xg.BasketballPassthroughController},hoops:{usingCompactor:t_.HoopsCompactorController},goalSport:{usingCompactor:e_.GoalSportCompactorController},rugby:{usingCompactor:n_.RugbyCompactorController},football:{usingCompactor:Zg.FootballCompactorController},volleyball:{usingCompactor:a_.VolleyballCompactorController},statTableColumnsAccessor:{usingCompactor:r_.StatTableColumnsAccessor}},function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.controllers=void 0;var l=Mn,t=er,p=Mn;Object.defineProperty(n,"controllers",{enumerable:!0,get:function(){return p.controllers}}),typeof window<"u"&&(window.controllers=l.controllers,window.transcoderConfigFromStream=t.transcoderConfigFromStream)}(bu);const eh=self;let Zi;const th=eh.postMessage;eh.onmessage=n=>{const l=n.data;switch(l.code){case"init":return i_(l);case"call_method_on_controller":return s_(l);case"get_property_on_state_accessor":return o_(l);case"call_method_on_state_accessor":return u_(l);default:return rh(`Unexpected message ${l}`)}};function rh(n){th({code:"log",attributes:{content:n}})}function es(n,l){th({code:"fulfill",id:n.id,attributes:{value:l}})}function i_(n){const{sport:l,controllerType:t,constructorArgs:p}=n.attributes;Zi=new bu.controllers[l][t](...p),rh(`Started new Sabertooth controller with sport ${l} and type ${t}`),es(n,!0)}function s_(n){const{methodName:l,args:t}=n.attributes,p=Zi[l](...t);es(n,p)}function nh(n,l){return n==="latestState"?Zi.latestState():Zi[n](l)}function o_(n){const{propertyName:l,stateAccessor:t,stateAccessorArgument:p}=n.attributes,d=nh(t,p);es(n,d[l])}function u_(n){const{methodName:l,args:t,stateAccessor:p,stateAccessorArgument:d}=n.attributes,y=nh(p,d);es(n,y[l](...t))}})();
//# sourceMappingURL=sabertooth.worker-DpGF4bWc.js.map
